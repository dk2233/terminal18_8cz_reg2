gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0000 00001 ﻿; w tej wersji wartosci temperatur sa wysylane zaraz po pomiarze
               00002 
               00003 
               00004 ;zmieniono histereze na histereza 1 - gorna
               00005 ;- oraz histereza 2  - dolna
               00006 
               00007 
               00008 
               00009 
               00010 ;program dopasowany do wspolpracy z ukladem 
               00011 ;z pracy statutowej2007
               00012 ;tzn tylko rejestracja danych
               00013 
               00014 ;procek = 18f4320
               00015 
               00016 ;procek = 18f442
               00017 
               00018 
               00019 ;dodano  prezentacja  
               00020 ;poprawa 
  00000010     00021 jak_duzo_zliczen_tmr1_na_sekunde    equ   0x10
               00022 
  018F4320     00023 procek = 18f4320
               00024 
               00025 IF (procek == 18f442)
               00026 list p=18f442
               00027 include  "p18f442.inc"
               00028 
               00029          __CONFIG _CONFIG1H, _OSCS_OFF_1H & _XT_OSC_1H 
               00030          __CONFIG _CONFIG2L, _BOR_OFF_2L & _PWRT_ON_2L
               00031          __CONFIG _CONFIG2H, _WDT_OFF_2H
               00032          
               00033          __CONFIG _CONFIG4L, _DEBUG_ON_4L & _LVP_OFF_4L & _STVR_OFF_4L
               00034         
               00035 ENDIF
               00036 
               00037 IF (procek==18f4320)
               00038 list p=18f4320
               00039 include  "p18f4320.inc"
               00001         LIST
               00002 ; P18F4320.INC  Standard Header File, Version 1.0   Microchip Technology, Inc.
               01095         LIST
               00040 
300000 71FF    00041          __CONFIG _CONFIG1H, _IESO_OFF_1H & _XT_OSC_1H 
               00042          __CONFIG _CONFIG2L, _BOR_ON_2L & _BORV_45_2L & _PWRT_ON_2L
300002 FEF2    00043          __CONFIG _CONFIG2H, _WDT_OFF_2H
300004 FDFF    00044          __CONFIG _CONFIG3H, _PBAD_DIG_3H & _MCLRE_ON_3H
300006 FF7A    00045          __CONFIG _CONFIG4L, _DEBUG_ON_4L & _LVP_OFF_4L & _STVR_OFF_4L
               00046 ENDIF
               00047          
               00048          ;__CONFIG _XT_OSC & _WDT_OFF & _PWRTE_ON & _BODEN_OFF & _LVP_OFF & _CPD_OFF & _WRT_OFF & _CP_OFF & _DEBUG_OFF
               00049 
               00050 ;definicje są w odzielnym pliku
               00051 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00052 include "def_var.h"
               00001 
               00002 
               00003          
               00004 
               00005 
               00006 
               00007          cblock   80h
               00008          w_temp
               00009          status_temp
               00010          pclath_temp
               00011          bsr_temp
               00012          fsrl_temp
               00013          fsrh_temp
               00014          linia1
               00015          linia2
               00016          linia3
               00017          linia4
               00018          letter
               00019          n
               00020          bit
               00021          odebrano_liter
               00022          liczba1
               00023          liczba2
               00024          liczba3
               00025          tmp                       ; uzywany w odbiorze danych i procedurach poleceń
               00026          tmp_hex                    ;uzywany w procedurze hex2dec
               00027          tmp_hex_H                  ;starszy bajt 
               00028          tmp6                       ; uzywany w poprawce temp
               00029          tmp7                        ; uzywany do odbioru danych z rs232
               00030          dec100
               00031          dec10
               00032          dec1
               00033          stan_key
               00034          stan2_key
               00035          wynikh
               00036          wynik
               00037          wynik01
               00038          znaczniki ;0x09a
               00039          markers
               00040          markers2
               00041          markers3
               00042          dane_lcd
               00043          tmp_lcd              ; używany w procedurach lcd
               00044          rcsta_temp
               00045          ile_kanalow ;0x09f
               00046            ktory_kanal_mierze ; 0x0a0
               00047          odstep_pomiarowy
               00048          aktualny_odstep
               00049           ktory_rejestr_zapisuje
               00050           pomiarH
               00051           pomiarL
               00052           pomiar_ulamek
               00053            
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00054           jaka_wartosc_regulujeH
               00055           jaka_wartosc_regulujeL
               00056           jak_duzo_probek ; 0x0a9
               00057           
               00058           ktora_probka
               00059           ktory_kanal
               00060           usrednianie_przez_co_mnoze
               00061           znaczniki_ds
               00062           polecenie_wysylane
               00063          jak_duzo_bajtow_odbieram_z_ds
               00064          
               00065          pomiar0H
               00066          pomiar0L
               00067          pomiar1H
               00068          pomiar1L
               00069          pomiar2H
               00070          pomiar2L
               00071          pomiar3H
               00072          pomiar3L
               00073          pomiar4H
               00074          pomiar4L
               00075          pomiar5H
               00076          pomiar5L
               00077          pomiar6H
               00078          pomiar6L
               00079          pomiar7H
               00080          pomiar7L
               00081          pomiar_prad1H
               00082          pomiar_prad1L
               00083          pomiar_prad2H
               00084          pomiar_prad2L
               00085          bajt_ds
               00086          poprawka0
               00087          poprawka1
               00088          poprawka2
               00089          poprawka3
               00090          poprawka4
               00091          poprawka5
               00092          poprawka6
               00093          poprawka7
               00094          poprawka_prad1
               00095          poprawka_prad2
               00096          jak_duzo_kanalow_pradu
               00097          ktory_aktualnie_kanal_pradu
               00098          
               00099          dzien_10
               00100          dzien_1
               00101          godziny_10
               00102          godziny_1
               00103          minuty_10
               00104          minuty_1
               00105          sekundy_10
               00106          sekundy_1
               00107          
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00108          do_sekundy
               00109          pozycja_menu    
               00110          numer_opcji
               00111          polozenie_gwiazdki
               00112          szybka_zmiana_wartosci
               00113          
               00114          fsrl1_temp
               00115          fsrh1_temp
               00116          histereza1
               00117          histereza2
               00118          
               00119          ustawianie_czasu_co_wyswietlam
               00120          ktory_czujnik_reguluje
               00121          endc
               00122 ;0xbe                           
               00123         
               00124          
               00125 ;        cblock 100h
               00126                   
               00127 ;        endc
               00128 
               00129 ;eeprom                  
               00130          cblock   0
               00131          poprawka0_ee
               00132          poprawka1_ee
               00133          poprawka2_ee
               00134          poprawka3_ee
               00135          poprawka4_ee
               00136          poprawka5_ee
               00137          poprawka6_ee
               00138          poprawka7_ee
               00139          poprawka_prad1_ee
               00140          poprawka_prad2_ee
               00141          
               00142          endc
               00143 ;rejestry nieuzywane wykorzystuje jako dane
               00144 
               00145 ;        equ      TMR1L
               00146 
               00147 ;        equ      TMR1H
               00148 
               00149 ;                 equ      CCPR1H
               00150 ;linia            equ      CCPR1L
               00151                   
               00152          
  00000004     00153 lampka            equ      4
  00000004     00154 lampka2           equ      4
               00155 
  00000005     00156 czujnik_ds1820    equ      5                  
               00157 
  00000F81     00158 portlampka2       equ      PORTB
  00000F82     00159 port_ds1820       equ      PORTC
  00000F82     00160 port_CTS      equ      PORTC                  
  00000F82     00161 port_RTS      equ          PORTC 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00162          
  00000004     00163 znacznik_CTS      equ      4
  00000005     00164 znacznik_RTS      equ      5
               00165 ;klawisze
               00166 
               00167 
               00168 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;markers
               00169 ;/*wyswietl */     
  00000000     00170 czy_usrednianie   equ      0
  00000001     00171 czy_wysylanie     equ      1
  00000002     00172 pomiary_zrobione  equ      2  ;znacznik tego czy pomiary zostaly skonczone
  00000003     00173 inicjuj_pomiary   equ         3
  00000004     00174 czy_wysylac_pomiary_serial    equ       4
  00000005     00175 czy_wyswietlam_temp     equ   5  
  00000006     00176 czy_wlaczyc_ponownie_temp    equ    6
  00000007     00177 trzymanie_klawisza            equ   7
               00178              
               00179 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;markers2
               00180 
  00000000     00181 przerwanie_t0     equ      0
  00000001     00182 przerwanie_t1     equ      1
  00000002     00183 pomiary           equ      2
  00000003     00184 sprawdz_odebrane  equ      3
  00000004     00185 wyslij_pomiar     equ      4
  00000005     00186 zalacz_moc        equ      5
  00000006     00187 reguluj           equ      6
  00000007     00188 wylacz_moc        equ      7
               00189 
               00190 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;markers3
               00191 
  00000000     00192 pomiary_pradu           equ   0
  00000001     00193 znacznik_pomiaru_pradu  equ   1
  00000002     00194 czy_zegar_wyswietlac    equ   2
  00000003     00195 odswiezanie_zegara      equ   3
  00000004     00196 wcisnieto_klawisz       equ   4
  00000005     00197 dzialanie_po_klawiszu   equ    5
  00000006     00198 napisz_minus            equ   6
  00000007     00199 pokazuje_temperatury_47       equ   7
               00200 
               00201 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;znaczniki
  00000000     00202 czy_ponownie_wlaczyc_temp     equ   0
  00000001     00203 czy_ponownie_wlaczyc_zegar    equ   1
  00000002     00204 czy_moge_juz_zmieniac         equ   2 ; dotyczy momentu w którym trzymanie klawisza trwa 1 s -> zmiana wartości
               00205 
               00206 
               00207 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;pozycja_menu
               00208 ;jezeli jest 0 to ekran główny
               00209 ;ekran_glowny      equ   0
  00000000     00210 menu_opcje1       equ   0
  00000001     00211 menu_opcje2       equ   1
  00000002     00212 menu_opcje3       equ   2
  00000003     00213 menu_opcje4       equ   3
               00214 
  00000007     00215 zmiana_opcji      equ   7
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000004     00216 menu_opcje_end    equ   4
  00000010     00217 numer_opcji_koncowej    equ   0x10
               00218 
               00219 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;numery opcji
  00000001     00220 opcja_czujniki            equ        1
  00000002     00221 opcja_odstep            equ         2
  00000003     00222 opcja_srednia                  equ       3
  00000004     00223 opcja_regulacja                equ        4
  00000005     00224 opcja_ustaw_temp              equ   5
  00000006     00225 opcja_pomiar_i             equ   6
  00000007     00226 opcja_wlacz_1                 equ   7
  00000008     00227 opcja_wlacz_2                 equ   8
  00000009     00228 opcja_histereza1               equ   9
  0000000A     00229 opcja_histereza2              equ  0xa
               00230 
  0000000B     00231 opcja_czujnik_regulacji            equ   0xb
  0000000C     00232 opcja_ustaw_serial                   equ   0xc
  0000000D     00233 opcja_wyswietl_zegar          equ   0xd
  0000000E     00234 opcja_wyswietl_temp           equ   0xe
  0000000F     00235 opcja_podswietlenie           equ   0xf
  00000010     00236 opcja_ustaw_zegar             equ   0x10           
               00237 ;;
               00238 ;poprawki_czuj           equ   
               00239 
  0000000C     00240 polozenie_liczby_menu         equ   0xc
               00241 
               00242 ;;;
  00000001     00243 nie      equ      1
  00000010     00244 ile_znakow        equ      10h
               00245 
               00246 
               00247 ;znaczniki
  00000000     00248 kalibracja        equ 0
               00249 
               00250 
  00000F81     00251 port_serial       equ      PORTB
  00000007     00252 RXD               equ      7
               00253 
               00254 
               00255 ;
  00000002     00256 ma       equ      2
  00000001     00257 mb       equ      1
  00000000     00258 mc       equ      0
  00000003     00259 dana     equ      3        
  00000004     00260 kb_change         equ      4
  00000005     00261 kb_cofnij         equ      5
  00000006     00262 kb_enter    equ      6
  00000007     00263 kb_minus    equ      7
               00264 
               00265 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;klawisze
  00000004     00266 dlugosc_oczekiwania_na_zmiane       equ   4
  00000F83     00267 latch_keys        equ      PORTD
  00000F83     00268 port_keys         equ      PORTD
  00000000     00269 latch_back        equ   0
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000001     00270 latch_down        equ   1
  00000002     00271 latch_up          equ   2
  00000003     00272 latch_enter       equ   3
               00273 
               00274 ;stan_key
  00000000     00275 mamy_back    equ   0
  00000001     00276 mamy_down   equ   1
  00000002     00277 mamy_up     equ   2
  00000003     00278 mamy_enter  equ   3
               00279 
               00280 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
               00281 
               00282 
               00283 
               00284 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;LCD
               00285 
  00000028     00286 set_4bit          equ   b'00101000'
  0000000C     00287 display_on        equ   b'00001100'
  0000002A     00288 init_4bit          equ      b'00101010' ;ustawia 2 linie i 5x8 font
               00289 
  00000F8C     00290 latch_lcd          equ      LATD
  00000F8B     00291 latch_lcd_e        equ      LATC
  00000F8A     00292 latch_lcd_rw       equ      LATB
  00000F8A     00293 latch_lcd_rs       equ      LATB
               00294 
               00295 ;definicja bitow uzywanych w 4 bitowym przesylaniu 0 - uzywany 1 - nieuzywany
               00296 ;zwiazane z opcja kasowania
  0000000F     00297 ktore_bity_uzywane_na_lcd     equ   0x0f
  000000F0     00298 ktore_bity_lcd_tris           equ   0xf0
  0000000F     00299 normalne_ustawienie_tris_lcd  equ   0x0f
               00300 
               00301 
  00000F83     00302 port_lcd          equ      PORTD
               00303 
  00000F82     00304 port_lcd_e      equ     PORTC
  00000F81     00305 port_lcd_rw     equ     PORTB
  00000F81     00306 port_lcd_rs     equ     PORTB
               00307 
  00000F95     00308 tris_lcd          equ      TRISD
               00309 ;0 to pomiar
               00310 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
               00311 
  00000001     00312 pin_e_4724        equ      1
               00313 
               00314 ;3 to ref+
               00315 
               00316 
  00000003     00317 enable          equ     3
  00000003     00318 rs              equ     3
  00000002     00319 rw              equ     2
               00320 
               00321 ;znaki transmisyjne
  0000000D     00322 znak_cr           equ      0dh
  0000000A     00323 znak_lf           equ      0ah
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  000000CC     00324 znak_I            equ      0cch
               00325 
               00326 ;znaczniki_ds
               00327                   ;inicjacja         equ      0
               00328                   ;skip_rom          equ      1             
  00000001     00329 dane_odebraneH    equ      1
  00000000     00330 dane_odebraneL    equ      0   
               00331 
               00332  
               00333 
  00000F81     00334 port_triak        equ      PORTB
  00000F8A     00335 latch_moc         equ       LATB
               00336 
  00000000     00337 triak1            equ      0
  00000001     00338 triak2            equ      1
               00339 
  00000002     00340 pomiar_prad1      equ      2
  00000004     00341 pomiar_prad2      equ      4
               00342 
               00343 ;histereza         equ   4
  00000F82     00344 port_multiplekser equ   PORTC
  00000F8B     00345 latch_multiplekser equ   LATC
  00000000     00346 pin_A                  equ    0
  00000001     00347 pin_B                   equ   1
  00000002     00348 pin_C                   equ   2
               00349 
               00350 
               00351 
               00352 ;ustawienia czujników
               00353 
  00000007     00354 ilosc_czujnikow            equ      7      
               00053 
  00000001     00054 czy_ekran         equ      1
  00000001     00055 czy_pomiary_na_ekran       equ      1
  00000001     00056 polozenie_danych_lcd equ 1
               00057 ;2007-06-07
               00058 ;
               00059 ;dodano obsluge ds1820
               00060 ;poprawiono bledy
               00061 ;ten program odbiera dane korzystajac z modulu obslugi USART
               00062 ;w procesorze
               00063 
               00064 ;jest to "karta" zbioru danych z 2 czujników temp
               00065 ;LM35 i
               00066 ;
               00067 ;
               00068 ;PORTD -0 -Klawisz Back
               00069 ;PORTD -1 -Klawisz down
               00070 ;PORTD -2 - klawisz up
               00071 ;PORTD -3 -Klawisz enter
               00072 ;PORTD -4 - LCD Data
               00073 ;PORTD -5 - Lcd Data
               00074 ;PORTD -6 - Lcd Data
               00075 ;PORTD -7 - Lcd Data
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00076 
               00077 ;PORTB -0 -Triak 1 
               00078 ;PORTB -1 -Triak 2
               00079 ;PORTB -2 -R/W
               00080 ;PORTB -3 - RS
               00081 ;PORTB -4 -
               00082 ;PORTB -5 -
               00083 ;PORTB -6 - 
               00084 ;PORTB -7 -
               00085          
               00086 ;PORTC - 0 -  A 4051
               00087 ;PORTC - 1 -   B 4051
               00088 ;PORTC-  2 -  C 4051
               00089 ;POrtc - 3 -   Enable
               00090 ;POrtc - 4 -  CTS (czyli ze procek wysyla) (dane z procka)
               00091 ;POrtc - 5 - RTS (czyli znacznik ze komputer cos wysyla) (dane do procka)
               00092 ;POrtc - 6 - transmit
               00093 ;POrtc - 7 - receive
               00094 
               00095 ;PORTA - 0 - Anlog - 8 wejsc lm35 przez mulitplesker
               00096 ;PORTA - 1 - 
               00097 ;PORTA - 2 - pomiar pradu 1
               00098 ;PORTA - 3 - REferencyjne+2,560 V
               00099 ;PORTA - 4 - 
               00100 ;PORTA - 5 - pomiar pradu 2 
               00101 ;PORTE - 0 - 
               00102 ;PORTE - 1 - 
               00103 ;PORTE - 2 - 
               00104 
               00105 ;TMR0L - czekanie miedzy kanalami analoga na pomiar
               00106 ;tmr1  - odliczanie sekund pomiaru
               00107 ;tmr2  - ewentualnie ds1820
               00108 ;tmr3  -zegar systemowy (przyciski systemu)
               00109 
               00110 ;bledy przy pomiarach - tzn gdzies sie wiesza gdy wylaczy sie pomiary
               00111 ;zaczyna wyrzucac na ekran wszystkie pomiary nie usredniajac  
               00112 ;to wynika z faktu ze przy wysylaniu danych pojawia sie powrotne wysylania
               00113 
               00114 ;okazuje sie ze wlaczenie odbioru "cat /dev/ttyS0" powoduje przeskok RTS w stan 0 (tzn informacja o nadawaniu)
               00115 
               00116 ;trzeba zrobic tak by odczyt przez komputer byl tylko w czasie wysylania danych tzn 
               00117 ;gdy CTS jest na wysoko poza tym powinien byc brak odczytu
               00118 
               00119 ;INDF0 (FSR0L i FSR0H) - uzywane tylko w odbiorze danych, tzn w komunikacji z portem szeregowym, oraz w poleceniach 
               00120 ;INDF1   - uzywane w operacjach Analog oraz w procedurze obróbki danej zmierzonej przez A/D
               00121 ;INDF2  - używany w procedurach czasu, oraz w 
               00122 
               00123 
               00124 ;2008.03.01
               00125 ;dodano obsluge zegara i jego wyswietlanie
               00126 ;brak procedury miganie :zamieniona na procedura_obslugi_zegara
               00127 
               00128 ;program działa zupełnie nieźle, jednak wiesza się przy większej liczbie czujników
               00129 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00130 ;2008.03.31
               00131 
               00132 
               00133 
               00134 ;2008.04.14
               00135 
               00136 ;wciąż się wiesza podczas pomiarów temperatury  - próba wyłączania wskazania zegara w trakcie pomiarów nie wpłynęła na poprawę pracy
               00137 ;wyłączanie wskazywania temperatur również nie wpłynęło na stabilność pracy
               00138 
               00139 ;poprawa czyszczenia ekranu kiedy zmieniam wskazania temp na ekranie głównym
               00140 
               00141 ;poprawa pracy pokazywania zawartości rejestru
               00142 ;
               00143 ;obsługa  wpisywania histerezy, temperatury regulowanej, średniej, ilości próbek,
               00144                                                                                                                                                                                                                                               
               00145 ;2008.04.15
               00146 ;wieszanie programu w trakcie pomiarów wynikają z błędów w algorytmie uśredniania wyników
               00147 ;po zmniejszeniu średniej do 32 próbek nie następuje wieszanie
               00148 ;wyraźnie na błędy wpływa ilość próbek 64 i 128
               00149 
               00150 ;próba zmiany algorytmu uśredniania uzyskanego wyniku
               00151 ;uśrednianie liczb:
               00152 ;0x80 (128 próbek) to mnożenie przez 0x02 (2/256)
               00153 ;0x40 (64 próbki) 0x04
               00154 ;0x20 (32)  0x08
               00155 ;0x10 (16)   0x10
               00156 ;0x08 (8)    0x20 
               00157 ;0x04 (4 próbki) 0x64
               00158 ;0x02 (2 próbki) 0x80 (128/256 czyli 0.5) 
               00159 
               00160 ;usunięcie procedury przesuwania
               00161 ;2008.04.16
               00162 ;poprawiony algorytm usredniania pomiarow
               00163 ;
               00164 ;dodano możliwość zmiany wartości przez trzymanie przycisku
               00165 ;ustaw temp, odstep, 
               00166 
               00167 ;2008.04.17
               00168 ;ostatecznie poprawiłem wieszanie układu, poprawiłem błędy podczas wyświetlania danych na ekranie -> błędy były przy powrocie z
               00169 ;procedur przerwań, tzn W z W_temp wracał najpierw, a potem jeszcze do W zapisywane były inne wartości
               00170 ;poza tym błędy były przy wywoływaniu procedur klawisza. Otóż każde naciśnięcie klawisza wywoływało przeskok do procedury
               00171 ;w przypadku gdy trzymany był klawisz i procedury wykryły że należy zmieniać wskazanie liczby, następował przekok do procedur wykrycia klawisza up lub down,
               00172 ;jednak powrót następował za pomocą procedury "goto". Stąd problem, bowiem wywołanie funkcji trzymania klawisza są za pomocą call. To powodowało brak
               00173 ;powrotu z funkcji call, i w końcu zapchanie stosu.
               00174 ;układowi brakuje wciąż:
               00175 ;           - zmiany ustawień zegara
               00176 ;           - wybór wartości mocy dostarczanej do układu
               00177 ;           - błędy - przy wyświetlaniu prądu triaka 2 jego wartosć jest dodawana do wskazania temperatury 1, 
               00178 ;           - dodać wybór wskazania który czujnik temperatury jest czujnikiem regulatora
               00179 ;           - dodać  procedurę regulatora P
               00180 ;           - regulator PID
               00181 ;           - dodać przeliczanie wartości zmierzonej prądu na wskazanie amperów
               00182 ;Poprawić procedurę liczenia średniej wartości pomiarów z pewnego czasu - mieszać ze sobą pomiary w postaci
               00183 ; pomiar czujnika 1,2,3,4,5 - dłuższa przerwa, 1,2,3,4,5, dłuższa przerwa, etc
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00184 
               00185 ;2008.04.26
               00186 ;błędne działanie procedur pomiaru temperatury - zły pomiar temperatur ujemnych 
               00187 ;zamiast poprawnej wartości ujemnych po osiągnięciu 0 oC wyświetlana jest wartość -64 oC.
               00188 ;poza tym zamiast 0 wyświetlane były temperatury na poziomie 1.25 - 1.5 oC. 
               00189 ;Zważywszy że czujnik był wyskalowany dla temperatur 23 - 20 C, wskazuje to na nierównomierną
               00190 ;skalę błędu - zmiana być może liniowa - należy to sprawdzić
               00191 
               00192 ;2008.04.27
               00193 ;dodano ustawianie wartości zegara
               00194 ;
               00195 ;2009.04.22
               00196 ;poprawa działania histerezy regulacji dwustawnej
               00197 
               00198 
               00199 ;2011.05.09 
               00200 ;dalej jest problem z praca regulacji dwustawnej i pomiarami temperatury w punkcie 5
               00201 
               00202 
0000           00203          org      0000h
0000 00204 BEGIN
               00205          ;bsf      PCLATH,3
               00206          ;bcf      PCLATH,4
               00207          
0000 EF0B F00E 00208          goto     inicjacja
               00209                   
               00210          
0008           00211          org      0008h
               00212          
0008 00213 przerwanie
               00214 ;zachowuje rejestr W
0008 CFD8 F081 00215       movff    STATUS,status_temp
000C 6F80      00216          movwf    w_temp
               00217 ;zachowuje rejestr STATUS
               00218          
000E CFE0 F083 00219          movff    BSR,bsr_temp
               00220          
0012 50E9      00221          movf     FSR0L,w
0014 6F84      00222          movwf    fsrl_temp
0016 50EA      00223          movf     FSR0H,w
0018 6F85      00224          movwf    fsrh_temp
               00225          
001A 50E1      00226          movf     FSR1L,w
001C 6FE4      00227          movwf    fsrl1_temp
001E 50E2      00228          movf     FSR1H,w
0020 6FE5      00229          movwf    fsrh1_temp
               00230          
               00231 ;po to by wszystkie ustawienia banki itd byly na 0    
               00232          ;bsf      STATUS,RP0
0022 AA9D      00233          btfss    PIE1,RCIE
0024 EF17 F000 00234          goto     przerwanie_1
               00235          
               00236          ;bcf      STATUS,RP0
0028 BA9E      00237          btfsc    PIR1,RCIF
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
002A EF99 F000 00238          goto     wykryto_odbior    
               00239 
002E 00240 przerwanie_1
               00241          ;bsf      STATUS,RP0
               00242          
002E A09D      00243          btfss    PIE1,TMR1IE
0030 EF1D F000 00244          goto     przerwanie_2
               00245          
               00246          ;bcf      STATUS,RP0
0034 B09E      00247          btfsc    PIR1,TMR1IF
0036 EF46 F000 00248          goto     wykryto_t1
               00249 
003A 00250 przerwanie_2      
               00251         
               00252          
003A A89D      00253          btfss    PIE1,TXIE
003C EF23 F000 00254          goto     przerwanie_3
               00255          
               00256          ;bcf      STATUS,RP0
0040 B89E      00257          btfsc    PIR1,TXIF
0042 EFBB F000 00258          goto     przerwanie_wysylania
               00259          
0046 00260 przerwanie_3      
               00261          
               00262          
0046 AC9D      00263          btfss    PIE1,ADIE
0048 EF29 F000 00264          goto     przerwanie_4
               00265          
               00266          ;bcf      STATUS,RP0
004C BC9E      00267          btfsc    PIR1,ADIF
004E EFC5 F000 00268          goto     przerwanie_pomiaru
               00269          
0052 00270 przerwanie_4
               00271          
               00272          
0052 A29D      00273          btfss    PIE1,TMR2IE
0054 EF2F F000 00274          goto     przerwanie_5
               00275          
               00276          ;bcf      STATUS,RP0
0058 B29E      00277          btfsc    PIR1,TMR2IF
005A EF96 F000 00278          goto     wykryto_t2
005E 00279 przerwanie_5
               00280          
               00281 ;        goto     wykryto_rb
               00282         
               00283         
005E B4F2      00284         btfsc    INTCON,TMR0IF
0060 EF91 F000 00285         goto     wykryto_t0
               00286 
0064 00287 przerwanie_6
0064 A2A0      00288         btfss    PIE2,TMR3IE
0066 EF38 F000 00289         goto     przerwanie_7
               00290          
               00291         
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
006A B2A1      00292         btfsc    PIR2,TMR3IF
006C EFD3 F000 00293         goto     wykryto_t3   
               00294         
0070 00295 przerwanie_7        
               00296 ;        btfsc    PIR1,TMR2IF
               00297 ;        goto     wykryto_t2
               00298          
               00299 ;        btfsc    PIR1,TMR2IF
               00300 ;        goto     wykryto_t2
               00301          
0070 00302 wyjscie_przerwanie
               00303 
0070 C083 FFE0 00304          movff    bsr_temp,BSR
               00305          
               00306          
0074 5184      00307          movf     fsrl_temp,w
0076 6EE9      00308          movwf    FSR0L
0078 5185      00309          movf     fsrh_temp,w
007A 6EEA      00310          movwf    FSR0H
               00311          
007C 51E4      00312          movf     fsrl1_temp,w
007E 6EE1      00313          movwf    FSR1L
0080 51E5      00314          movf     fsrh1_temp,w
0082 6EE2      00315          movwf    FSR1H
               00316          
0084 5180      00317          movf     w_temp,w
0086 C081 FFD8 00318          movff    status_temp,STATUS
               00319 
008A 0010      00320          retfie
               00321          
               00322          
               00323          
008C 00324 wykryto_t1
               00325 
               00326                                                       ;Procedury obslugi czasu
008C 909E      00327       bcf      PIR1,TMR1IF
               00328       
               00329       
               00330          ;czy minelo 16 sekund
008E 83A0      00331       bsf      markers2,przerwanie_t1   
               00332          
0090 0E10      00333       movlw jak_duzo_zliczen_tmr1_na_sekunde
0092 19DF      00334       xorwf do_sekundy,w
               00335 ;jezeli    nie  0 w wyniku to skok do procedury 
0094 E13D      00336       bnz   wykryto_t1_wyjscie      
               00337 ;jezeli 0 to zwiększ sekunda o 1      
               00338       
0096 6BDF      00339       clrf  do_sekundy
0098 2BDE      00340       incf  sekundy_1,f
               00341            
               00342 ;sprawdz czy cyfra jednosci nie przekroczyla 9 sekund
009A 0E3A      00343       movlw 0x3a
009C 19DE      00344       xorwf sekundy_1,w
009E E134      00345       bnz   ustaw_wyswietlanie_czasu_na_lcd
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00346 ;czyszcze    liczbe jednosci i zwiekszam o jeden liczbe 
00A0 0E30      00347       movlw 0x30
00A2 6FDE      00348       movwf  sekundy_1
00A4 2BDD      00349       incf  sekundy_10,f
               00350       
00A6 0E36      00351       movlw 0x36
00A8 19DD      00352       xorwf sekundy_10,w
00AA E12E      00353       bnz   ustaw_wyswietlanie_czasu_na_lcd
00AC 0E30      00354       movlw 0x30
00AE 6FDD      00355       movwf  sekundy_10
               00356       
00B0 2BDC      00357       incf  minuty_1,f
               00358 ;sprawdzam czy nie przekroczylem  
               00359       
00B2 0E3A      00360       movlw 0x3a
00B4 19DC      00361       xorwf minuty_1,w
               00362       
00B6 E128      00363       bnz   ustaw_wyswietlanie_czasu_na_lcd
00B8 0E30      00364       movlw 0x30
00BA 6FDC      00365       movwf minuty_1
00BC 2BDB      00366       incf  minuty_10,f
               00367       
00BE 0E36      00368       movlw 0x36
00C0 19DB      00369       xorwf minuty_10,w
00C2 E122      00370       bnz   ustaw_wyswietlanie_czasu_na_lcd
00C4 0E30      00371       movlw 0x30
00C6 6FDB      00372       movwf minuty_10
               00373                                           ;godziny      
00C8 2BDA      00374       incf  godziny_1,f
               00375 ;sprawdz czy jezeli jest 4 czy nie ma 2 na godziny_10
00CA 0E34      00376       movlw       0x34
00CC 63DA      00377       cpfseq      godziny_1
00CE EF7E F000 00378       goto        sprawdz_godziny
00D2 0E32      00379       movlw       0x32
00D4 63D9      00380       cpfseq      godziny_10
00D6 EF7E F000 00381       goto        sprawdz_godziny
00DA 0E30      00382       movlw       0x30
00DC 6FD9      00383       movwf godziny_10
00DE 6FDA      00384       movwf godziny_1
00E0 2BD8      00385       incf  dzien_1,f
               00386       
               00387             
00E2 00388 sprawdz_dzien
00E2 0E3A      00389       movlw 0x3a
00E4 19D8      00390       xorwf dzien_1,w
00E6 E110      00391       bnz   ustaw_wyswietlanie_czasu_na_lcd
00E8 0E30      00392       movlw 0x30
00EA 6FD8      00393       movwf  dzien_1
00EC 2BD7      00394       incf  dzien_10,f
               00395       
00EE 0E3A      00396       movlw 0x3a
00F0 19D9      00397       xorwf godziny_10,w
00F2 E10A      00398       bnz   ustaw_wyswietlanie_czasu_na_lcd
00F4 0E30      00399       movlw 0x30
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00F6 6FD7      00400       movwf dzien_10
               00401       
00F8 EF84 F000 00402       goto  ustaw_wyswietlanie_czasu_na_lcd
00FC 00403 sprawdz_godziny      
00FC 0E3A      00404       movlw 0x3a
00FE 19DA      00405       xorwf godziny_1,w
0100 E103      00406       bnz   ustaw_wyswietlanie_czasu_na_lcd
0102 0E30      00407       movlw 0x30
0104 6FDA      00408       movwf godziny_1
0106 2BD9      00409       incf  godziny_10,f
               00410       
               00411       
               00412       
               00413 
               00414 
0108 00415 ustaw_wyswietlanie_czasu_na_lcd
               00416       ;czy system obsluguje zegar, bo nie musi i nie powinien przy bardzo częstym pomiarze i wysyłaniu danych
               00417       ;czyli co 1/16
               00418       
0108 A5A1      00419       btfss markers3,czy_zegar_wyswietlac
010A EF88 F000 00420       goto  wykryto_t1_wyjscie 
               00421       
               00422       ;a jezeli ma odswiezyc wszystkie znaki:
010E 87A1      00423       bsf   markers3,odswiezanie_zegara
               00424       
               00425       ;jezeli mam odswiezyc zegar to wylaczam na chwilke pomiary i dopiero po wyswietleniu 
               00426       ;sprawdz czy byly wlaczone pomiary
               00427       ;btfss       markers2,pomiary
               00428       ;goto        wykryto_t1_wyjscie 
               00429       
               00430       
               00431       ;bsf   markers,pomiary_zrobione
               00432       ;i zaznacz zeby je jeszcze raz wlaczyl po wyswietleniu czasu
               00433       ;bsf   markers,czy_wlaczyc_ponownie_temp
               00434       
               00435       
               00436       
0110 00437 wykryto_t1_wyjscie  
0110 2BDF      00438       incf     do_sekundy,f
               00439       
0112 EF38 F000 00440       goto     wyjscie_przerwanie                  
               00441          
0116 00442 wykryto_rb
               00443 ;wlaczam przerwanie tmr2 i ustawiam przy pomocy TMR2 na 100us tzn 
               00444 ;
               00445 ;
               00446          
0116 90F2      00447          bcf      INTCON,RBIF
               00448          
               00449 ;        btfsc    markers2,odbior
               00450 ;        goto     wyjscie_przerwanie
               00451          
0118 BE81      00452          btfsc    port_serial,RXD
011A EF38 F000 00453          goto     wyjscie_przerwanie         
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00454 ;        btfsc    bit,7
               00455 ;        goto     wylaczam_odbior
               00456 ;        bsf      markers2,poczatkowy_bit
               00457          
011E EF38 F000 00458          goto     wyjscie_przerwanie
               00459 
0122 00460 wykryto_t0
               00461 ;uzywam do wykrywania czy juz zrobic pomiar
               00462 IF (procek == 18f442)
               00463          bcf      INTCON,T0IF
               00464          bcf      INTCON,T0IE
               00465          
               00466 ENDIF
               00467 
               00468 IF (procek == 18f4320)
0122 94F2      00469          bcf      INTCON,TMR0IF
0124 9AF2      00470          bcf      INTCON,TMR0IE
               00471          
               00472 ENDIF
               00473          
0126 82C2      00474          bsf      ADCON0,GO 
               00475          ;clrf     pomiarH
               00476          ;clrf     pomiarL
               00477          ;clrf     pomiar_ulamek        
0128 EF38 F000 00478          goto     wyjscie_przerwanie
               00479          
012C 00480 wykryto_t2
               00481 ;uzywam do odmierzania czasu dla DS1820
               00482 ;1 - 
               00483 ;oczekuje kolejne max 480 us. jezeli po tym czasie nie wystapi jeden to napisz blad
               00484 
               00485 ;
               00486 
               00487 ;
012C 929E      00488          bcf      PIR1,TMR2IF
               00489          
               00490 ;jezeli tesuje czas     
               00491 ;          bcf     PORTC,2         
               00492          ;bsf      STATUS,RP0
012E 929D      00493          bcf     PIE1,TMR2IE
               00494          ;bcf      STATUS,RP0
0130 94CA      00495          bcf      T2CON,TMR2ON
               00496              
               00497          
               00498          
               00499 ;        btfss    markers2,
               00500 ;        goto     wyjscie_przerwanie
               00501          
               00502 ;        bsf      markers2,odbierz_bit
               00503         
               00504 
0132 00505 wykryto_odbior
               00506 ;        btfsc    odebrano_liter,4
               00507          ;call     miganie
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00508 ;czytanie rcsta go kasuje
0132 00509 wykryto_odbior_odczyt
               00510 ;jezeli mam ustawione na ekran to nic nie odbieraj    
0132 B7A0      00511          btfsc    markers2,sprawdz_odebrane
0134 EF38 F000 00512          goto     wyjscie_przerwanie
               00513 ;wylacz inne przerwania
               00514 ;        bsf      STATUS,RP0
               00515 ;        bcf      PIE1,TMR1IE
               00516 ;        bcf      STATUS,RP0
               00517          
               00518 ;          bcf      markers2,blad_transmisji
               00519 ;czy jest framing error
0138 B4AB      00520          btfsc    RCSTA,FERR
013A EFC2 F000 00521          goto     wykryto_blad
               00522 ;        bsf      markers2,blad_transmisji
               00523          
013E B2AB      00524          btfsc    RCSTA,OERR
0140 EFBD F000 00525          goto     wykryto_oerr
               00526          
               00527          
0144 518D      00528          movf     odebrano_liter,w
0146 0F00      00529          addlw    dane_odebraneL
0148 6EE9      00530          movwf    FSR0L
014A 0E01      00531          movlw    dane_odebraneH
014C 6EEA      00532          movwf    FSR0H
               00533          
014E 50AE      00534          movf     RCREG,w
0150 6EEF      00535          movwf    INDF0
               00536 ;jezeli blad transmisji to nie zapamietuj         
               00537 ;          btfsc    markers2,blad_transmisji
               00538 ;          goto     wykryto_odbior_odczyt_dalej  
               00539 ;                    
               00540          
               00541          
               00542          
0152 0E0A      00543          movlw    0x0a
0154 18EF      00544          xorwf    INDF0,w
0156 B4D8      00545          btfsc    STATUS,Z
0158 EFB1 F000 00546          goto     wykryto_odbior_CR
               00547          
               00548 ;        movlw    0x0a
               00549 ;        xorwf    INDF0,w
               00550 ;        btfss    STATUS,Z
015C 2B8D      00551         incf     odebrano_liter,f
               00552          
015E EF38 F000 00553          goto     wyjscie_przerwanie
               00554 ;        goto     wykryto_odbior_wyjscie
               00555 ;        
               00556          
               00557 ;        movlw    0x0A
               00558 ;        xorwf    INDF0,w
               00559 ;        btfss    STATUS,Z
               00560 ;        goto     wykryto_odbior_wyjscie
               00561          
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00562                   
0162 00563 wykryto_odbior_CR 
               00564 ;sprawdz czy pierwszym znakiem jest *
               00565          
0162 87A0      00566          bsf      markers2,sprawdz_odebrane
               00567 ;        clrf     odebrano_liter
               00568 ;        movf     RCREG,w
               00569 ;        movwf    INDF0
               00570 ;        
               00571 ;        czysc dwa bwyswietlajty na zero -> znacznik konca wyswietlania         
               00572 ;        
               00573          
0164 0E0D      00574         movlw     0x0d
0166 6EEF      00575          movwf    INDF0
               00576           
0168 2AE9      00577         incf    FSR0L,f
016A 6EEF      00578         movwf    INDF0
016C 2AE9      00579         incf    FSR0L,f
016E 6AEF      00580         clrf     INDF0
0170 2AE9      00581          incf    FSR0L,f
0172 6AEF      00582         clrf     INDF0
               00583 ;wylaczam szeregowy odbior
0174 98AB      00584          bcf      RCSTA,CREN        
               00585 
0176 00586 przerwanie_wysylania       
0176 EF38 F000 00587          goto     wyjscie_przerwanie
               00588 
017A 00589 wykryto_oerr      
017A 98AB      00590          bcf      RCSTA,CREN        
017C 0000      00591          nop
017E 88AB      00592          bsf      RCSTA,CREN
               00593                                     
0180 EF38 F000 00594          goto     wyjscie_przerwanie
0184 00595 wykryto_blad
0184 50AE      00596          movf     RCREG,w
0186 EF38 F000 00597          goto     wyjscie_przerwanie
               00598 
018A 00599 przerwanie_pomiaru
018A 9C9E      00600          bcf      PIR1,ADIF
               00601 ;kopiuje pomiar do rejestru
               00602 ;sprawdz czy ustawiono 1 lub 0 - wtedy nic nie dziele 
               00603          
018C 0E9B      00604          movlw    wynikh
018E A19F      00605          btfss    markers,czy_usrednianie
0190 0EAA      00606          movlw    pomiarH
               00607 ;        addwf    ktory_rejestr_zapisuje,w
0192 6EE1      00608          movwf    FSR1L
0194 6AE2      00609          clrf     FSR1H
               00610          
0196 50C4      00611          movf     ADRESH,w
0198 6EE7      00612          movwf    INDF1
019A 2AE1      00613          incf     FSR1L,f
               00614 
019C 50C3      00615          movf     ADRESL,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00616 
019E 6EE7      00617          movwf    INDF1
01A0 89A0      00618          bsf      markers2,wyslij_pomiar
               00619 ;nastepnym razem zapisze do kolejnego rejestru        
               00620 ;        incf     ktory_rejestr_zapisuje,f
01A2 EF38 F000 00621          goto     wyjscie_przerwanie
               00622    
               00623 
01A6 00624 wykryto_t3
               00625 
01A6 92A1      00626       bcf   PIR2,TMR3IF
               00627       ;sprawdzam czy klawisz jest dalej wcisniety
               00628       
               00629       ;robie and z zawartoscia stan_key
               00630       ;jezeli jest w wyniku 0 (tzn ze klawisz wciaz jest trzymany
               00631       ;np dla klawisza back stan latch_keys:  xxxx1110 - jezeli wcisniety 
               00632       ;                                      stan_keys          xxxx001  
               00633       ;w wyniku 0 chyba że klawisz puszczono i jest 1
01A8 5199      00634       movf        stan_key,w
01AA 1483      00635       andwf       latch_keys,w
               00636 ;tzn ze wciaz przycisk jest wcisniety
               00637       ;i nic nie robie czyli wychodze
01AC B4D8      00638       btfsc       STATUS,Z
01AE EFDF F000 00639       goto         wykryto_t3_nie_puszczono
               00640       
               00641       ;natomiast jezeli wyszlo 1 to sprawdz ktory przycisk zostal puszczony  
               00642       ;i wymus sprawdzenie i dalsze podprogramy zwiazane z danym klawiszem
01B2 99A1      00643       bcf         markers3,wcisnieto_klawisz
01B4 9F9F      00644       bcf         markers,trzymanie_klawisza
01B6 959E      00645       bcf         znaczniki,czy_moge_juz_zmieniac
               00646       
               00647       ;wylacz przerwanie tmr3
01B8 8BA1      00648       bsf         markers3,dzialanie_po_klawiszu
01BA EF38 F000 00649       goto        wyjscie_przerwanie
               00650       
01BE 00651 wykryto_t3_nie_puszczono
               00652 ;jeżeli zaznaczony jest bit trzymanie_klawisza to pozwól na szybką zmianę wartości w trakcie 
               00653 ;trzymania przycisku
               00654 
               00655 ;jeżeli już zaznaczono ze moge zmieniac to nie sprawdzaj miniecia sekundy
01BE B59E      00656       btfsc       znaczniki,czy_moge_juz_zmieniac
01C0 EF38 F000 00657       goto        wyjscie_przerwanie
               00658 
01C4 AF9F      00659       btfss       markers,trzymanie_klawisza
01C6 EF38 F000 00660       goto        wyjscie_przerwanie
               00661 ;szybka zmiana dopiero po sekundzie - czyli dwa zliczenia
01CA 2FE3      00662       decfsz      szybka_zmiana_wartosci,f
01CC EF38 F000 00663       goto        wyjscie_przerwanie
               00664 
01D0 0E01      00665       movlw       1
01D2 6FE3      00666       movwf       szybka_zmiana_wartosci
               00667 ;jeżeli już jest 0 to pozwól na zmianę       
01D4 859E      00668       bsf         znaczniki,czy_moge_juz_zmieniac
01D6 EF38 F000 00669       goto        wyjscie_przerwanie
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00670       
               00671 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;KOniec Przerwan   
               00672 ;;;;;;;;;;;;;;;;;;;;;;;;
               00673 ;;;PROGRAM
               00674 ;;;;;;;;;;;;;;;;;;;;;;;;;
               00675 include  "../libs/lcd.h"
               00001  ;;ten dokument zawiera definicje wszystkich funkcji
               00002 ;;uytych do wywietlania danych na LCD
               00003 ;;wywietlanie 8 bitowe
               00004 
               00005 ;def lcd
               00006 ;cay port RB0-RB7 uyty jako dane do LCD
               00007 ;init
               00008 ;to idzie na port zwizany z danymi
               00009 
               00010 
               00011 
  00000030     00012 init_8bit       equ     b'00110000'
  0000003C     00013 set_8bit        equ     b'00111100' ; 8bit, 2 linie,font 5x8
  00000008     00014 function_set2   equ     b'00001000' ;ustawia 2 linie i 5x8 font
               00015 ;init_4bit          equ      b'00100010' ;ustawia 2 linie i 5x8 font
               00016 
  00000008     00017 display_off     equ     b'00001000' ;ustawia blinking,cursor,
  00000006     00018 entry           equ     b'00000110' ;increment
  00000080     00019 dd_addres_set   equ     b'10000000' ;od rb6 do rb0 wstawi�adres
               00020 
  00000001     00021 display_clear   equ     b'00000001'
  0000000C     00022 display_on      equ     b'00001100';bez kursora
  0000000F     00023 display_2       equ     b'00001111'
  00000010     00024 write_4bit      equ     b'00010000' ;pisz na ekranie
  00000040     00025 write           equ     b'01000000' ;zacz rd6 - rs
               00026 
  00000002     00027 disp_home       equ     b'00000010'
               00028 
               00029 
               00030 ;;dla 4bit�
  00000003     00031 function_set1_4b        equ     b'00000011' ;- ustawia 4 bit
  00000008     00032 function_set2_4b        equ     b'00001000' ;ustawia 2 linie i 5x8 font
  00000000     00033 display1_4b     equ     b'00000000'
  0000000F     00034 display2_4b     equ     b'00001111' ;ustawia blinking,cursor,
  00000000     00035 entry1_4b               equ     b'00000000'
  0000000C     00036 entry2_4b               equ     b'00001100' ;increment
  00000000     00037 display_clear1_4b       equ     b'00000000'
  00000001     00038 display_clear2_4b       equ     b'00000001'
               00039 
               00040 
  00000030     00041 _0              equ     b'00110000'
  00000031     00042 _1              equ     b'00110001'
  00000032     00043 _2              equ     b'00110010'
  00000033     00044 _3              equ     b'00110011'
  00000034     00045 _4              equ     b'00110100'
  00000035     00046 _5              equ     b'00110101'
  00000036     00047 _6              equ     b'00110110'
  00000037     00048 _7              equ     b'00110111'
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000038     00049 _8              equ     b'00111000'
  00000039     00050 _9              equ     b'00111001'
  0000003A     00051 _dwukropek      equ     b'00111010'
  00000020     00052 _puste          equ     b'00100000'
  0000002E     00053 _kropka         equ     b'00101110'
  000000DF     00054 _stopni         equ     b'11011111'
  0000002D     00055 _minus          equ     0x2d
  0000002B     00056 _plus           equ     0x2b
  00000041     00057 _A              equ     b'01000001'
  00000042     00058 _B              equ     b'01000010'
  00000043     00059 _C              equ     b'01000011'
  00000044     00060 _D              equ     b'01000100'
  00000045     00061 _E              equ     b'01000101'
  00000046     00062 _F              equ     b'01000110'
  00000047     00063 _G              equ     b'01000111'
  00000048     00064 _H              equ     b'01001000'
  00000049     00065 _I              equ     b'01001001'
  0000004A     00066 _J              equ     b'01001010'
  0000004B     00067 _K              equ     b'01001011'
  0000004C     00068 _L              equ     b'01001100'
  0000004D     00069 _M              equ     b'01001101'
  0000004E     00070 _N              equ     b'01001110'
  0000004F     00071 _O              equ     b'01001111'
  00000050     00072 _P              equ     b'01010000'
  00000051     00073 _Q              equ     b'01010001'
  00000052     00074 _R              equ     b'01010010'
  00000053     00075 _S              equ     b'01010011'
  00000054     00076 _T              equ     b'01010100'
  00000055     00077 _U              equ     b'01010101'
  00000056     00078 _V              equ     b'01010110'
  00000057     00079 _W              equ     b'01010111'
  00000058     00080 _X              equ     b'01011000'
  00000059     00081 _Y              equ     b'01011001'
  0000005A     00082 _Z              equ     b'01011010'
               00083 
  00000061     00084 _a              equ     b'01100001'
  00000062     00085 _b              equ     b'01100010'
  00000063     00086 _c              equ     b'01100011'
  00000064     00087 _d              equ     b'01100100'
  00000065     00088 _e              equ     b'01100101'
  00000066     00089 _f              equ     b'01100110'
  00000067     00090 _g              equ     b'01100111'
  00000068     00091 _h              equ     b'01101000'
  00000069     00092 _i              equ     b'01101001'
  0000006A     00093 _j              equ     b'01101010'
  0000006B     00094 _k              equ     b'01101011'
  0000006C     00095 _l              equ     b'01101100'
  0000006D     00096 _m              equ     b'01101101'
  0000006E     00097 _n              equ     b'01101110'
  0000006F     00098 _o              equ     b'01101111'
  00000070     00099 _p              equ     b'01110000'
  00000071     00100 _q              equ     b'01110001'
  00000072     00101 _r              equ     b'01110010'
  00000073     00102 _s              equ     b'01110011'
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000074     00103 _t              equ     b'01110100'
  00000075     00104 _u              equ     b'01110101'
  00000076     00105 _v              equ     b'01110110'
  00000077     00106 _w              equ     b'01110111'
  00000078     00107 _x              equ     b'01111000'
  00000079     00108 _y              equ     b'01111001'
  0000007A     00109 _z              equ     b'01111010'
               00110 
  0000002A     00111 _star           equ     0x2a
  0000005E     00112 _up             equ     b'01011110'
  0000002C     00113 _przecinek      equ     0x2c
  0000003C     00114 _mniejszosci      equ      0x3c
  0000003E     00115 _wiekszosci       equ      0x3e
  0000007C     00116 _linia_pionowa    equ         0x7c
               00117 
               00118 
  00000080     00119 linia_pierwsza  equ     0x80
  00000080     00120 linia_gorna     equ     0x80
               00121 
  000000C0     00122 linia_dolna     equ     0xc0
  000000C0     00123 linia_druga     equ     0xc0
               00124 
  00000090     00125 linia_trzecia   equ     0x90
  000000D0     00126 linia_czwarta   equ     0xd0
               00127 ;
               00128 
               00676 
               00677 include  "../libs/lcd4bit18.asm"
               00001 ;wersja 2007-12-07
               00002 ;dla prockow serji 18fxxx
               00003 ;do odczekania 64ms uzywam komendy cpfsgt
               00004 ;zmienne
               00005 ;ktore_bity_uzywane_na_lcd - ktore porty ekranu sa uzywane jako dane
               00006 ;ktore_bity_lcd_tris   - definiuje ktore bity maja byc zamieniane na wejscie podczas check busy
               00007 ;tris_lcd   -definiuje ktory tris wplywa na tris lcd
               00008 ;set_4bit   - ustawienia dla lcd
               00009 ;tmp_lcd - tymczasowa zmienna uywana tylko w procedurach lcd
               00010 
01DA 00011 wait
               00012          
               00013         ;bsf      portlampka,lampka              
               00014 IF (procek == 18f442)
               00015         bcf     INTCON,T0IF
               00016 wait_petla                   
               00017         btfss   INTCON,T0IF      
               00018         goto    wait_petla
               00019         bcf     INTCON,T0IF            
               00020 ENDIF
               00021 
               00022 IF (procek == 18f4320)
01DA 94F2      00023          bcf     INTCON,TMR0IF
01DC 00024 wait_petla         
01DC A4F2      00025         btfss   INTCON,TMR0IF      
01DE EFEE F000 00026         goto    wait_petla
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
01E2 94F2      00027         bcf     INTCON,TMR0IF
01E4 9AF2      00028         bcf      INTCON,TMR0IE
               00029               
               00030 ENDIF        
               00031         ;bcf      portlampka,lampka              
01E6 0012      00032         return
               00033         
               00034          
               00035 ;funkcja wysy?aj?ca 4 bitowa
               00036 ;LCD
               00037 ;;;;;;;;;;;;;;;;;;;;;;;;;
               00038 
01E8 00039 send
               00040 ;np PORTA bity 0-3  sa uzywane przez 4 bitowy ekran lcd
               00041 ;najpierw wysylane sa 4bity gorne
01E8 6FA2      00042          movwf    dane_lcd
01EA 0E02      00043          movlw    2
01EC 6FA3      00044          movwf    tmp_lcd
01EE 00045 send4bit_petla
               00046          
               00047 ;przenosze PORTA tak aby gorne bity nieulegly zmianie
01EE 0E0F      00048          movlw    ktore_bity_uzywane_na_lcd
01F0 168C      00049          andwf    latch_lcd,f
               00050                           
               00051 IF (polozenie_danych_lcd == 0)        
               00052 ;jesli na gorze bitow port d
               00053          
               00054          swapf    dane_lcd,f
               00055 ENDIF
               00056 
               00057          
01F2 0EF0      00058          movlw    ktore_bity_lcd_tris
01F4 15A2      00059          andwf    dane_lcd,w
01F6 268C      00060          addwf    latch_lcd,f
               00061          
01F8 8682      00062          bsf      port_lcd_e,enable
01FA 0000      00063          nop
01FC 0000      00064          nop
01FE 9682      00065          bcf      port_lcd_e,enable
               00066 IF (polozenie_danych_lcd == 1)        
               00067 ;jesli na gorze bitow port d
               00068          
0200 3BA2      00069          swapf    dane_lcd,f
               00070 ENDIF
               00071             
0202 2FA3      00072          decfsz   tmp_lcd,f
0204 EFF7 F000 00073          goto     send4bit_petla
0208 0012      00074          return
               00075          ;movwf    latch_lcd
               00076          
               00077          
               00078 ;funkcja pisz?ca na ekranie
020A 00079 write_lcd
               00080 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00081          
020A 868A      00082          bsf      latch_lcd_rs,rs
               00083          ;bsf      PORTB,rs
               00084          
020C ECF4 F000 00085          call     send
               00086          
0210 968A      00087          bcf      latch_lcd_rs,rs    
               00088          ;bcf      PORTB,rs
0212 0012      00089          return
               00090 
               00091 ;funkcja czyszcz?ca ekran
               00092 
               00093 ;funkcja czyszcz?ca ekran
               00094 
0214 00095 cmd_off
               00096 
               00097          
0214 968A      00098          bcf      latch_lcd_rs,rs
               00099          
               00100          
0216 0012      00101         return
               00102          
               00103 
               00104 
               00105 ;funkcja czysci cala linie
               00106 ; przed jej wywolaniem w W umi#1esc adres linii
               00107 ;po zakonczeniu z powrotem w niej umieszcza adres
               00108 ;stara wersja - dziala na cala linie
               00109 
0218 00110 clear_line_old
0218 6F8B      00111          movwf    n
021A 9681      00112          bcf      port_lcd_rs,rs
               00113          
021C 518B      00114          movf     n,w
021E 6FA2      00115          movwf    dane_lcd
0220 ECF4 F000 00116          call     send
0224 0E10      00117          movlw    ile_znakow
0226 6F95      00118          movwf    tmp7
0228 0FFF      00119          addlw    0xff
022A 6FA3      00120          movwf    tmp_lcd
022C 00121 clear_line_old2
022C EC32 F001 00122          call     check_busy
0230 0E20      00123          movlw    _puste
0232 6FA2      00124          movwf    dane_lcd
0234 EC05 F001 00125          call     write_lcd
               00126          
0238 2F95      00127          decfsz   tmp7,f
023A EF16 F001 00128          goto     clear_line_old2
               00129          
023E EC0A F001 00130          call     cmd_off
0242 518B      00131          movf     n,w
0244 0012      00132          return
               00133          
0246 00134 clear_line
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00135 ;przed wywolaniem do n trzeba wrzucic ilosc kasowanych znakow
               00136 ;a w W musi byc adres linii         
0246 6FA2      00137          movwf    dane_lcd
0248 ECF4 F000 00138          call     send
               00139          
024C 00140 clear_line_petla
024C EC32 F001 00141          call     check_busy
0250 0E20      00142          movlw    _puste
0252 6FA2      00143          movwf    dane_lcd
0254 EC05 F001 00144          call     write_lcd
               00145          
0258 2F8B      00146          decfsz   n,f
025A EF26 F001 00147          goto     clear_line_petla
               00148          
025E EC0A F001 00149          call     cmd_off
               00150         
0262 0012      00151          return
               00152 
               00153          
               00154          
0264 00155 check_busy
               00156 
               00157 IF (polozenie_danych_lcd == 1)        
               00158 ;jesli na gorze bitow port d
0264 0E0F      00159          movlw    0x0f
               00160          
0266 168C      00161          andwf    latch_lcd,f
               00162 ENDIF
               00163 
               00164 IF (polozenie_danych_lcd == 0)        
               00165 ;jesli w dolnej polowce  bajtu rejestru  portd
               00166          movlw    0xf0
               00167          
               00168          andwf    latch_lcd,f
               00169 ENDIF
               00170          
               00171          ;clrf     port_lcd
               00172          ;clrf     PORTD
               00173 ;przesylam dane np tris 00000001
               00174 ;chce zrobic tak by bylo 
               00175 ;  11110001
               00176        
0268 5095      00177          movf     tris_lcd,w
026A 09F0      00178          iorlw    ktore_bity_lcd_tris
026C 6E95      00179          movwf    tris_lcd    
               00180          
               00181       
               00182          
               00183          
               00184                   
026E 848A      00185          bsf      latch_lcd_rw,rw
0270 968A      00186          bcf      latch_lcd_rs,rs
               00187 
0272 00188 check
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00189          
0272 868B      00190          bsf      latch_lcd_e,enable
               00191          
               00192  IF (polozenie_danych_lcd == 0) 
               00193 ;jezli dolne bity portud 
               00194          swapf    port_lcd,w
               00195 ENDIF
               00196             
               00197 IF (polozenie_danych_lcd == 1)        
               00198 ;jesli na gorze bitow port d
               00199             
0274 5083      00200          movf    port_lcd,w
               00201 ENDIF
0276 0BF0      00202          andlw    0xf0
               00203          
0278 6FA3      00204          movwf    tmp_lcd
               00205          
027A 968B      00206          bcf      latch_lcd_e,enable
               00207             
027C 0000      00208          nop 
               00209          
027E 868B      00210          bsf      latch_lcd_e,enable
               00211          
               00212 IF (polozenie_danych_lcd == 1) 
               00213 ;jesli na gorze bitow port d
0280 3883      00214          swapf    port_lcd,w
               00215 ENDIF
               00216             
               00217 IF (polozenie_danych_lcd == 0)        
               00218 
               00219             
               00220          movf    port_lcd,w
               00221 ENDIF         
               00222      
0282 0B0F      00223          andlw    0x0f
               00224          
0284 27A3      00225          addwf    tmp_lcd,f
               00226          
0286 968B      00227          bcf      latch_lcd_e,enable    
               00228             
0288 BFA3      00229          btfsc    tmp_lcd,7
028A EF39 F001 00230          goto     check
               00231          
028E 0E0F      00232          movlw   normalne_ustawienie_tris_lcd
0290 6E95      00233          movwf    tris_lcd
               00234          
               00235          
0292 948A      00236          bcf      latch_lcd_rw,rw
0294 968A      00237          bcf      latch_lcd_rs,rs
0296 0012      00238          return
               00239 
               00240 
               00241 
               00242 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                           
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00243 ;poczatek dzialania 4 bitowego ekranu
               00244 
0298 00245 lcd_init
0298 EC0A F001 00246          call     cmd_off
               00247          
               00248 IF (polozenie_danych_lcd == 1)        
               00249 ;jesli na gorze bitow port d
029C 0E0F      00250          movlw    0x0f         
029E 168C      00251          andwf    latch_lcd,f
               00252 ENDIF
               00253 
               00254 IF (polozenie_danych_lcd == 0)        
               00255 ;jesli w dolnej polowce  bajtu rejestru  portd
               00256          movlw    0xf0         
               00257          andwf    latch_lcd,f
               00258 ENDIF
               00259 
               00260 
02A0 948A      00261          bcf      latch_lcd_rw,rw
02A2 968B      00262          bcf      latch_lcd_e,enable
               00263 ;wylaczam przerwanie         
               00264         
02A4 6AD6      00265          clrf     TMR0L
               00266 IF (procek == 18f442)
               00267          bcf      INTCON,T0IE
               00268          
               00269 ENDIF
               00270 IF (procek == 18f4320)
02A6 9AF2      00271          bcf      INTCON,TMR0IE
               00272          
               00273          
               00274 ENDIF         
               00275          
               00276 ;wylaczam przerwania tmr0         
               00277         
02A8 ECED F000 00278          call     wait     ;64ms
               00279 
02AC 0E2A      00280          movlw    init_4bit
02AE 0BF0      00281          andlw    ktore_bity_lcd_tris
               00282 ;teraz w W mam postac 0011 w tym nibbles ktory jest port lcd , jezeli gorne to 00110000
02B0 128C      00283          iorwf    latch_lcd,f
               00284          
02B2 868B      00285          bsf     latch_lcd_e,enable
02B4 0000      00286          nop
02B6 968B      00287          bcf     latch_lcd_e,enable
               00288          ;call     send    ;zalaczam
02B8 6AD6      00289          clrf     TMR0L ;64 ms
02BA ECED F000 00290          call     wait
               00291          
02BE 0E2A      00292          movlw    init_4bit
02C0 0BF0      00293          andlw    ktore_bity_lcd_tris
               00294 ;teraz w W mam postac 0011 w tym nibbles ktory jest port lcd , jezeli gorne to 00110000
02C2 128C      00295          iorwf    latch_lcd,f
               00296          
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
02C4 868B      00297          bsf     latch_lcd_e,enable
02C6 0000      00298          nop
02C8 968B      00299          bcf     latch_lcd_e,enable
               00300          ;call     send    ;zalaczam
02CA 6AD6      00301          clrf     TMR0L ;64 ms
02CC ECED F000 00302          call     wait
               00303          
02D0 0E2A      00304          movlw    init_4bit
02D2 0BF0      00305          andlw    ktore_bity_lcd_tris
               00306 ;teraz w W mam postac 0011 w tym nibbles ktory jest port lcd , jezeli gorne to 00110000
02D4 128C      00307          iorwf    latch_lcd,f
               00308          
02D6 868B      00309          bsf     latch_lcd_e,enable
02D8 0000      00310          nop
02DA 968B      00311          bcf     latch_lcd_e,enable
               00312          ;call     send    ;zalaczam
02DC 6AD6      00313          clrf     TMR0L ;64 ms
02DE ECED F000 00314          call     wait
               00315          
02E2 0E28      00316          movlw    set_4bit
02E4 ECF4 F000 00317          call     send
               00318          
02E8 EC32 F001 00319          call     check_busy
               00320          
02EC 0E01      00321          movlw    display_clear
               00322          ;movwf    port_lcd,ACCESS
02EE ECF4 F000 00323          call     send
02F2 EC32 F001 00324          call     check_busy
               00325          
02F6 0E0C      00326          movlw   display_on
               00327          ;movwf    port_lcd,ACCESS
02F8 ECF4 F000 00328          call     send
               00329          
               00330          ;clrf   TMR0L;64 ms
               00331          ;call     wait
02FC EC32 F001 00332          call     check_busy
               00333          
               00334         
               00335         ;clrf   TMR0L;64 ms
               00336          ;call     wait
               00337 
               00338          ;call    check_busy
0300 0E06      00339          movlw   entry
               00340         ;movwf   port_lcd,ACCESS
0302 ECF4 F000 00341         call    send
0306 EC32 F001 00342         call     check_busy
030A 0012      00678 
               00679 ;include  "../../libs/dziel_przez2_18.asm"
               00680 
               00681 include  "../libs/eeprom18.asm"
030C 00001 czytaj_eeprom
               00002 
               00003        
               00004 ;IF procek==1         
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
030C 6EA9      00005          movwf    EEADR
               00006 ;ENDIF         
               00007 ;IF procek==2
               00008  ;        movwf    EEADRL
               00009 ;ENDIF         
               00010            
030E 9EA6      00011          bcf      EECON1,EEPGD
0310 80A6      00012          bsf      EECON1,RD
               00013          
               00014        
               00015 
0312 50A8      00016          movf     EEDATA,w
               00017 
0314 0012      00018          return
               00019          
0316 00020 zapis_eeprom
               00021 ;do w adres pod ktory zapisuje
               00022 ;do FSR (INDF) co zapisuje         
               00023 ;poprawka ze zapisuje dana spod INDF1         
               00024          
0316 00025 check_if_write
0316 B2A6      00026          btfsc    EECON1,WR
0318 EF8B F001 00027          goto     check_if_write
               00028     
               00029  
               00030          
               00031 ;IF procek==1         
031C 6EA9      00032          movwf    EEADR
               00033 ;ENDIF         
               00034 
               00035        
031E 50E7      00036          movf     INDF1,w
               00037         
0320 6EA8      00038          movwf     EEDATA
               00039       
0322 9EA6      00040          bcf      EECON1,EEPGD
0324 84A6      00041          bsf      EECON1,WREN
               00042   ;bez przerwan       
0326 9EF2      00043          bcf      INTCON,GIE
               00044          
0328 0E55      00045          movlw    55h
032A 6EA7      00046          movwf    EECON2
032C 0EAA      00047          movlw    0aah
032E 6EA7      00048          movwf    EECON2
               00049          
0330 82A6      00050          bsf      EECON1,WR                  
               00051          
0332 8EF2      00052          bsf      INTCON,GIE
0334 94A6      00053          bcf      EECON1,WREN
               00054          
               00055          
               00056                   
0336 0012      00682 
0338 00683 Start
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00684 ;odczytuje wartosci poprawek czujnikow temperatury
0338 0E00      00685       movlw     poprawka0_ee
033A 6EE9      00686       movwf      FSR0L
033C 6AEA      00687       clrf       FSR0H
033E 0ECB      00688       movlw      poprawka0
0340 6EE1      00689       movwf      FSR1L
0342 6AE2      00690       clrf       FSR1H
               00691       
0344 00692 petla_odczytu_poprawek_z_eeprom
0344 50E9      00693       movf       FSR0L,w
0346 EC86 F001 00694       call        czytaj_eeprom
034A 6EE7      00695       movwf      INDF1
               00696       
034C 2AE9      00697       incf       FSR0L,f
034E 2AE1      00698       incf       FSR1L,f
0350 0E0A      00699       movlw      0x0a
0352 18E9      00700       xorwf      FSR0L,w
0354 A4D8      00701       btfss      STATUS,Z
0356 EFA2 F001 00702       goto        petla_odczytu_poprawek_z_eeprom
               00703       
               00704       
               00705 
               00706 IF  (czy_ekran==1)
035A EC4C F001 00707          call     lcd_init
035E EC32 F001 00708          call     check_busy
0362 EC0A F001 00709          call    cmd_off
               00710          
               00711          
               00712 ;        call     check_busy
0366 0E80      00713          movlw   linia_gorna
0368 ECF4 F000 00714          call    send
036C EC32 F001 00715          call     check_busy
0370 0E45      00716          movlw    _E
0372 EC05 F001 00717          call     write_lcd
               00718 ENDIF
               00719          
               00720 ;konfiguruje port szeregowy
               00721 ;ustawiam baud rate
               00722          ;bsf      STATUS,RP0
               00723          ;bcf      STATUS,RP1
               00724 ;        movlw    0x1a
               00725 ;         movlw    0x1a
               00726 ;         movlw    0x1a
0376 0E0C      00727          movlw    0x0c
0378 6EAF      00728          movwf    SPBRG
037A 6AAC      00729          clrf     TXSTA
037C 84AC      00730          bsf      TXSTA,BRGH
037E 8AAC      00731          bsf      TXSTA,TXEN
               00732          
               00733 
               00734          
               00735 ;wlaczam przerwanie szeregu
0380 8A9D      00736          bsf      PIE1,RCIE
               00737 ;        bsf      PIE1,TXIE
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00738          ;bcf      STATUS,RP0
0382 0E90      00739          movlw    b'10010000'
0384 6EAB      00740          movwf    RCSTA
               00741          
               00742          
               00743 
0386 0E00      00744          movlw    0
0388 6FA9      00745          movwf    ktory_rejestr_zapisuje
               00746                   
               00747          
               00748          
038A 6FB0      00749          movwf   ktora_probka
               00750          
               00751 
038C 0E08      00752          movlw    8
038E 6FB5      00753          movwf    jak_duzo_bajtow_odbieram_z_ds
               00754          
0390 8882      00755          bsf      port_CTS,znacznik_CTS
               00756          
               00757          
               00758          ;tu ustawiam napiecia referencyjne jako AN3 i Vss 
               00759 ;wszystkie 
               00760 IF  (procek==18f442)
               00761          movlw    b'10000001'
               00762          movwf    ADCON1
               00763 ENDIF         
               00764 IF  (procek==18f4320)         
0392 0E1A      00765          movlw    b'00011010'
0394 6EC1      00766          movwf    ADCON1
               00767          
0396 0EA6      00768          movlw    b'10100110'
0398 6EC0      00769          movwf    ADCON2
               00770 ENDIF
               00771 
039A 85A1      00772       bsf   markers3,czy_zegar_wyswietlac
               00773 
039C 0E30      00774          movlw    0x30
039E 6FD7      00775          movwf    dzien_10
03A0 6FD8      00776          movwf    dzien_1
03A2 6FD9      00777          movwf    godziny_10
03A4 6FDA      00778          movwf    godziny_1
03A6 6FDB      00779          movwf    minuty_10
03A8 6FDC      00780          movwf    minuty_1
03AA 6FDD      00781          movwf    sekundy_10
03AC 6FDE      00782          movwf    sekundy_1
               00783          
               00784          
               00785          ;ustawienie opcji pomiarowych dla menu
03AE 0E00      00786          movlw          0
03B0 6FA5      00787          movwf          ile_kanalow
03B2 0E20      00788          movlw          0x20
03B4 6FA7      00789          movwf          odstep_pomiarowy
03B6 0E80      00790          movlw          0x80
03B8 6FAF      00791          movwf          jak_duzo_probek
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00792          
03BA EC90 F003 00793          call           ustaw_wartosc_dzielenia_usredniania
               00794          
03BE 819F      00795          bsf            markers,czy_usrednianie
               00796          
03C0 0E00      00797          movlw    0
03C2 6FAD      00798          movwf    jaka_wartosc_regulujeH
03C4 0E80      00799          movlw    0x80
03C6 6FAE      00800          movwf    jaka_wartosc_regulujeL
               00801          
03C8 0E02      00802          movlw    2
03CA 6FE6      00803          movwf    histereza1
               00804          
03CC 0E02      00805          movlw    2
03CE 6FE7      00806          movwf    histereza2
               00807          
               00808          ;włączam znaczniki sprawiające że przy opuszczeniu menu następuje ponowne włączenie
               00809 ;zegara oraz pokazywania temperatury
               00810 ;z poziomu menu można zmienić te znaczniki tak by nie nastąpiło ponowne wyświetlanie zegara i temperatur
03D0 0E00      00811          movlw    0
03D2 6FE9      00812          movwf    ktory_czujnik_reguluje
               00813          
03D4 839E      00814          bsf            znaczniki,czy_ponownie_wlaczyc_zegar
03D6 819E      00815          bsf            znaczniki,czy_ponownie_wlaczyc_temp
               00816          
03D8 EFD6 F00D 00817          goto     LOOP
               00818   
               00819          
03DC 00820 hex2dec18
               00821       ;zamiana wartosci szesnastkowej na dziesietne
               00822       ;dziele przez 10 tzn mnoze przez 0x1a/256 (0x26) lub przez 0x19/256 (25)
               00823 ;      i wynik jednosci w PRODH, a ulamek w ProdL
               00824       ;w młodszym bajcie wyniku jest ułamek
               00825       ;należy przed uruchomieniem procedury 
               00826       ; umieścić liczbę dzieloną w rejestrze  
               00827       ;tmp_hex
               00828       ;bajt starszy w tmp_hex_H
               00829       
               00830       
               00831       ;clrf        dec1
               00832       ;clrf        dec10
03DC 6B96      00833       clrf        dec100
               00834       
               00835       ;dziele przez 5
               00836       ;mullw       0x33
               00837       ;wynik jest w starszym bajcie
               00838       ;movf        PRODH,w
               00839       ;dzielę przez 2 - 0x80
               00840       ;dzielę przez 0.0976 - mnoże przez 0x19
03DE 5192      00841       movf        tmp_hex,w
03E0 0D19      00842       mullw       0x19
03E2 50F4      00843       movf        PRODH,w
               00844       
03E4 6F97      00845       movwf       dec10
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
03E6 0D0A      00846       mullw       0xa
03E8 50F3      00847       movf        PRODL,w
               00848       ;tmp_hex - dec10*10 = liczba jednosci
03EA 5D92      00849       subwf       tmp_hex,w
03EC 6F98      00850       movwf       dec1
               00851 ;sprawdzam czy liczba jedności nie przekracza 10, czyli czy nie jest większa > 9
03EE 0E09      00852       movlw       0x9
03F0 6598      00853       cpfsgt      dec1  
03F2 EF00 F002 00854       goto        hex2dec18_nie_przekroczono_1
               00855       
03F6 0E0A      00856       movlw       0xa
03F8 5F98      00857       subwf       dec1,f
03FA 2B97      00858       incf        dec10,f
               00859       
03FC B0D8      00860       btfsc       STATUS,C
03FE 2B96      00861       incf        dec100,f
               00862       
               00863       
0400 00864 hex2dec18_nie_przekroczono_1
               00865 ;sprawdz czy liczba dziesiatek  nie przekracza liczby 10 tzn podziel liczbę przez 10 (mnożę przez 0x1a)
               00866       ;przez 5
0400 5197      00867       movf       dec10,w
               00868       ;mullw       0x33
               00869       
               00870       ;movf        PRODH,w
               00871       ;dzielę przez 26
0402 0D1A      00872       mullw       0x1a
               00873       
0404 50F4      00874       movf        PRODH,w
               00875 ;jezeli jest 0 to skocz dalej
0406 E005      00876       bz          hex2dec18_brak_setek
               00877 ;jezeli brak 0 tzn ze w wyniku mamy jakies liczby setek
0408 6F96      00878       movwf       dec100
               00879       ;a ile zostalo liczb 10 - 
040A 0E0A      00880       movlw       0xa
040C 0396      00881       mulwf       dec100
               00882       ;mnoze dec100*100 i wynik odejmuje od liczby 10
040E 50F3      00883       movf        PRODL,w
0410 5F97      00884       subwf       dec10,f
               00885 ; i juz mam ilosc dziesiatek i setek i jednosci z wyniku zamiany jednego bajta na postać dziesiętną
               00886       
0412 00887 hex2dec18_brak_setek
               00888 ;teraz sprawdzam czy w starszym bajcie liczby dzielonej stoi jakas wartość jezeli tak to zwiekszam ilosc setek i dziesiatek
               00889 ;jezeli w starszym bajcie stoi cos:
               00890       
0412 5193      00891       movf       tmp_hex_H,w
               00892             
               00893       
               00894       ;jezeli 0 to koncz prace procedury
0414 E015      00895       bz          hex2_dec_koniec
               00896       ;jezeli nie to popraw wyniki o poprawke
0416 0A01      00897       xorlw       0x01
0418 E005      00898       bz          hex2dec_temperatur_popraw_o_64
               00899       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
041A 5193      00900       movf       tmp_hex_H,w
041C 0A02      00901       xorlw       0x02
041E E008      00902       bz          hex2dec_temperatur_popraw_o_128
               00903 
0420 EF20 F002 00904       goto        hex2_dec_koniec
               00905       
0424 00906 hex2dec_temperatur_popraw_o_64
0424 0E06      00907       movlw       0x06
0426 2797      00908       addwf       dec10,f
0428 0E04      00909       movlw       0x04
042A 2798      00910       addwf       dec1,f
042C EF20 F002 00911       goto        hex2_dec_koniec
               00912       
0430 00913 hex2dec_temperatur_popraw_o_128
0430 0E01      00914       movlw       0x01
0432 2796      00915       addwf       dec100,f
0434 0E02      00916       movlw       0x02
0436 2797      00917       addwf       dec10,f
0438 0E08      00918       movlw       0x08
043A 2798      00919       addwf       dec1,f
043C EF20 F002 00920       goto        hex2_dec_koniec
               00921       
0440 00922 hex2_dec_koniec
0440 0012      00923       return
               00924 
               00925 
               00926                                                                                                 ;ZEGAR    Systemowy  
               00927  
               00928 
0442 00929 napisz_czas
0442 97A1      00930       bcf   markers3,odswiezanie_zegara
               00931       ;wyswietlam wszyskie wielkosci czasowe na 1 linii ekranu
0444 EC32 F001 00932       call     check_busy
0448 0E80      00933       movlw   linia_gorna
044A ECF4 F000 00934       call    send
044E EC32 F001 00935       call     check_busy
               00936       
0452 0E20      00937      movlw  _puste 
               00938      ;jeżeli praca w trybie regulacji to pisz r
0454 BDA0      00939      btfsc  markers2,reguluj
0456 0E72      00940      movlw  _r
0458 EC05 F001 00941      call   write_lcd
               00942      
045C EC32 F001 00943      call     check_busy
               00944      
               00945      ;jeżeli praca w trybie transferu szeregowego
0460 0E20      00946      movlw  _puste 
0462 B99F      00947      btfsc  markers,czy_wysylac_pomiary_serial
0464 0E73      00948      movlw  _s
0466 EC05 F001 00949      call   write_lcd
046A EC32 F001 00950      call     check_busy 
               00951       
               00952       
               00953       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00954       ;addlw 2
               00955       
               00956       
               00957             
046E 0ED7      00958       movlw       dzien_10
0470 6ED9      00959       movwf       FSR2L      
0472 6ADA      00960       clrf        FSR2H
0474 EF41 F002 00961       goto        petla_napisz_czas
               00962       
0478 00963 petla_napisz_czas_dwukropek      
               00964 ;po kazdych dwóch cyfrach pisz dwukropek
0478 0E3A      00965       movlw       _dwukropek
047A EC05 F001 00966       call        write_lcd
047E EC32 F001 00967       call        check_busy
               00968             
               00969 ;w FSR2l umieszczam adres komorki dzien_10, zwiekszajac ten adres o 1 mam dostep po kolei do wszystkich wartosci 
               00970 ;czasowych
0482 00971 petla_napisz_czas
               00972 ;sprawdz czy cyfra 10 jest 0 - jezeli tak to wyswietl puste
0482 0E30      00973       movlw 0x30
0484 18D9      00974       xorwf FSR2L,w
0486 B4D8      00975       btfsc STATUS,Z
0488 EF49 F002 00976       goto  wyswietl_puste
               00977 ;jezeli wyswietlam zawartosc rejestru      
048C 50DF      00978       movf  INDF2,w
048E EF4A F002 00979       goto  wyswietl_1
               00980       
0492 00981 wyswietl_puste
0492 0E20      00982       movlw _puste
               00983       
0494 00984 wyswietl_1      
               00985       
               00986       
0494 EC05 F001 00987       call  write_lcd
0498 EC32 F001 00988       call  check_busy
               00989       
049C 2AD9      00990       incf  FSR2L,f
049E 50DF      00991       movf  INDF2,w
04A0 EC05 F001 00992       call  write_lcd
04A4 EC32 F001 00993       call  check_busy
               00994       
04A8 2AD9      00995       incf  FSR2L,f
               00996       
04AA 0EDF      00997       movlw       sekundy_1+1
04AC 18D9      00998       xorwf       FSR2L,w
04AE E1E4      00999       bnz         petla_napisz_czas_dwukropek
               01000       
               01001       ;po wyswietleniu zegara znow kaz mierzyc
               01002       
04B0 AD9F      01003       btfss       markers,czy_wlaczyc_ponownie_temp
04B2 EFD6 F00D 01004       goto        LOOP 
               01005       
               01006       
               01007       ;bcf   markers,pomiary_zrobione
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01008       ;i zaznacz zeby je jeszcze raz wlaczyl po wyswietleniu czasu
04B6 9D9F      01009       bcf   markers,czy_wlaczyc_ponownie_temp
               01010       
04B8 EFD6 F00D 01011       goto  LOOP
               01012       ;sprawdz czy INDF2 ==    sekundy_1 + 1
               01013       
               01014       
               01015  
               01016 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                                 SPRAWDZANIE CZY nastapilo 0  
04BC 01017 odznacz_by_znow_mierzyc
               01018                                     ;sprawdz czy odstep miedzy pomiarami juz minal
               01019       
               01020       ;incf  aktualny_odstep,w
               01021       
               01022       ;movf  aktualny_odstep,w
               01023       ;bnz   bez_wlaczania_pomiarow
               01024       
04BC 2FA8      01025          decfsz   aktualny_odstep,f
04BE 0012      01026          return                
               01027          
04C0 51A7      01028          movf     odstep_pomiarowy,w
04C2 6FA8      01029          movwf    aktualny_odstep
               01030          
04C4 A59F      01031          btfss    markers,pomiary_zrobione
04C6 0012      01032          return
               01033          
04C8 959F      01034          bcf      markers,pomiary_zrobione
04CA 879F      01035          bsf      markers,inicjuj_pomiary
04CC 0012      01036          return
               01037 
               01038 
               01039 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;  KAZDE ROZPOCZEcie POMIAROW         
04CE 01040 rozpocznij_pomiary         
               01041 ;dokonuj pomiaru  na pierwszym kanale
               01042 ;wlaczam tez przerwanie analogowego pomiaru
               01043          
               01044 ;wlacz przerwanie jak skonczy mierzyc zeby wyslac
               01045 ;wystarczy ze 000 do bitow kanalu
04CE 6B87      01046       clrf  linia2
04D0 6B89      01047       clrf  linia4
04D2 99A0      01048          bcf      markers2,wyslij_pomiar 
               01049          ;
04D4 51A5      01050          movf     ile_kanalow,w
04D6 6FA6      01051          movwf    ktory_kanal_mierze 
               01052          
04D8 51AF      01053          movf    jak_duzo_probek,w
04DA 6FB0      01054          movwf   ktora_probka
04DC 6BB1      01055          clrf     ktory_kanal
               01056          
               01057          ;movwf   ktore_dzielenie_przez2
               01058          
04DE 5082      01059          movf     port_multiplekser,w
               01060 ;czyszcze aktualne ustawienia multipleksera
               01061 ;jezeli byl tu b'01010001'     
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
04E0 0BF8      01062          andlw    b'11111000'
               01063 ;w wyniku mamy b'01010000'      
04E2 6E8B      01064          movwf    latch_multiplekser   
               01065          
04E4 50C2      01066          movf     ADCON0,w
               01067          
               01068          ;bsf      STATUS,RP0
               01069          ;bcf      STATUS,RP1
               01070 ;        movlw    0x1a
               01071          
               01072          ;bcf      STATUS,RP0    
               01073          ;clrf     TMR0L
               01074 IF (procek == 18f442)
               01075          ;bcf      INTCON,T0IF
               01076          ;bsf      INTCON,T0IE
               01077          andlw    b'11000111'
               01078          movwf    ADCON0
               01079          
               01080 ENDIF
               01081 IF (procek == 18f4320)
               01082          ;bcf      INTCON,TMR0IF
               01083          ;bsf      INTCON,TMR0IE
04E6 0BC3      01084          andlw    b'11000011'
04E8 6EC2      01085          movwf    ADCON0
               01086          
               01087 ENDIF
               01088          
               01089          ;jezeli mam wykonywac pomiary to zapisz z rejestru ile mam robic pomiarow
04EA B1A1      01090          btfsc    markers3,pomiary_pradu
04EC 6BD6      01091          clrf     ktory_aktualnie_kanal_pradu
               01092          
04EE 979F      01093          bcf      markers,inicjuj_pomiary
               01094          
04F0 82C2      01095          bsf      ADCON0,GO
04F2 8C9D      01096          bsf      PIE1,ADIE
               01097          
04F4 0012      01098         return             
               01099 
               01100          
04F6 01101 bez_wlaczania_pomiarow
               01102 
               01103          
               01104       
04F6 01105 procedura_obslugi_zegara
               01106 ;najpierw sprawdz czy minelo 16 zliczen?
               01107       
               01108 
               01109 
               01110       ;jezeli pomiary to cy je robic?
04F6 B5A0      01111          btfsc    markers2,pomiary
04F8 EC5E F002 01112          call     odznacz_by_znow_mierzyc
               01113       ;odznacz    
04FC 93A0      01114          bcf      markers2,przerwanie_t1
               01115       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01116       
               01117          ;btfss    portlampka,lampka
               01118          ;goto     zapal    
               01119          ;bcf      portlampka,lampka
               01120                   
04FE 0012      01121          return
               01122 ;zapal    
               01123  ;        bsf      portlampka,lampka
               01124   ;       return
               01125 
0500 01126 zapal_lampke
0500 7881      01127          btg    portlampka2,lampka2
               01128          
               01129          ; goto     zapal_lampke2
               01130          ; bcf      portlampka2,lampka2
               01131                   
               01132          ; goto     powrot_z_polecen
               01133 ; zapal_lampke2
               01134          ; bsf      portlampka2,lampka2
               01135          
0502 EF29 F005 01136           goto     powrot_z_polecen
               01137 
               01138 
               01139 
0506 01140 sumuj_liczby
0506 6B8F      01141          clrf     liczba2
0508 6B8E      01142          clrf     liczba1
               01143          
               01144          ;incf     FSR0L,f
               01145          
050A 01146 sumuj_liczby_do_kropki
               01147          
050A ECF1 F002 01148          call     kopiuj_liczbe_przeslana
050E C091 F08E 01149          movff    tmp,liczba1
               01150                            
               01151 ;sprawdz czy przekroczono bajt
               01152          ;btfsc    STATUS,C
               01153          ;incf     liczba2,f
               01154          ;                  
               01155          ;incf     FSR0L,f
               01156          ;movlw    _kropka
               01157          ;xorwf    INDF0,w
               01158          ;btfsc    STATUS,Z
               01159          ;incf     FSR0L,f
               01160          
               01161          ;movlw    0x0a
               01162          ;xorwf    INDF0,w
               01163          ;btfss    STATUS,Z
               01164          ;goto     sumuj_liczby_do_kropki     
0512 ECF1 F002 01165          call     kopiuj_liczbe_przeslana
0516 C091 F08F 01166          movff     tmp,liczba2
               01167          
               01168          
051A 38F4      01169          swapf    PRODH,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
051C 0B0F      01170          andlw    0x0f
051E ECFC F002 01171          call     zamien_na_hex
0522 6EAD      01172          movwf    TXREG
               01173          
0524 ECAB F002 01174          call     sprawdz_czy_mozna_wysylac
               01175          
0528 50F4      01176          movf     PRODH,w
               01177 ;robiac taka operacje kasuje starszy bajt na 3 a mlodszy bez zmian      
052A 0B0F      01178          andlw    0x0f
052C ECFC F002 01179          call     zamien_na_hex
0530 6EAD      01180          movwf    TXREG
0532 ECAB F002 01181          call     sprawdz_czy_mozna_wysylac
               01182          
0536 38F3      01183          swapf    PRODL,w
0538 0B0F      01184          andlw    0x0f
053A ECFC F002 01185          call     zamien_na_hex
053E 6EAD      01186          movwf    TXREG
               01187          
0540 ECAB F002 01188          call     sprawdz_czy_mozna_wysylac
               01189          
0544 50F3      01190          movf     PRODL,w
               01191 ;robiac taka operacje kasuje starszy bajt na 3 a mlodszy bez zmian      
0546 0B0F      01192          andlw    0x0f
0548 ECFC F002 01193          call     zamien_na_hex
054C 6EAD      01194          movwf    TXREG
               01195          
054E ECAB F002 01196          call     sprawdz_czy_mozna_wysylac
               01197 ;zapisz  cyfra
               01198          
               01199          ;call     wyswietlanie_liczby
0552 EF29 F005 01200          goto     powrot_z_polecen
               01201 
0556 01202 sprawdz_czy_mozna_wysylac
               01203          ;bsf      STATUS,RP0
0556 01204 TMR_nie_pusty     
0556 A2AC      01205          btfss    TXSTA,TRMT
0558 EFAB F002 01206          goto     TMR_nie_pusty     
               01207          ;bcf      STATUS,RP0
055C 01208 TXREG_nie_pusty   
055C A89E      01209          btfss    PIR1,TXIF
055E EFAE F002 01210          goto     TXREG_nie_pusty
0562 0012      01211          return   
               01212          
0564 01213 wyslij_znak
               01214 ;sprawdz czy USART transmit buffer jest pusty
0564 0E00      01215          movlw    dane_odebraneL
               01216          
0566 6EE9      01217          movwf    FSR0L
0568 0E01      01218          movlw    dane_odebraneH
056A 6EEA      01219          movwf    FSR0H
               01220          
056C 01221 wyslij_znak_petla 
056C ECAB F002 01222          call     sprawdz_czy_mozna_wysylac
               01223 ;laduje dane do wyslania   
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0570 2AE9      01224          incf     FSR0L,f
               01225          
               01226 ;        movf     INDF0,w
               01227 ;        call     write_lcd
               01228 ;        call     check_busy
               01229          
0572 0E0D      01230          movlw    0x0d
0574 18EF      01231         xorwf    INDF0,w
0576 B4D8      01232          btfsc    STATUS,Z
0578 EFC2 F002 01233          goto     wyslij_znak_koniec
               01234          
057C 50EF      01235          movf    INDF0,w
057E 6EAD      01236          movwf    TXREG
0580 EFB6 F002 01237          goto     wyslij_znak_petla
0584 01238 wyslij_znak_koniec
0584 ECAB F002 01239          call     sprawdz_czy_mozna_wysylac
0588 0E20      01240          movlw    _puste
058A 6EAD      01241          movwf    TXREG
058C ECAB F002 01242          call     sprawdz_czy_mozna_wysylac
0590 0E3A      01243          movlw    _dwukropek
0592 6EAD      01244          movwf    TXREG
0594 ECAB F002 01245          call     sprawdz_czy_mozna_wysylac
0598 0E2D      01246          movlw    _minus
059A 6EAD      01247          movwf    TXREG
059C ECAB F002 01248          call     sprawdz_czy_mozna_wysylac
05A0 0E0A      01249          movlw    znak_lf
05A2 6EAD      01250          movwf    TXREG
               01251          
05A4 06E9      01252          decf     FSR0L,f
               01253 ;        call     sprawdz_czy_mozna_wysylac
               01254 ;        movlw    znak_lf
               01255 ;        movwf    TXREG
               01256          
05A6 EF29 F005 01257          goto     powrot_z_polecen
               01258          
05AA 01259 sprawdz_czy_odebrano_litere
05AA 0E30      01260          movlw    0x30
05AC 5CEF      01261          subwf    INDF0,w
05AE 6F95      01262          movwf    tmp7
               01263 ;sprawdzam czy zostaly jakies bity w gornej polowce bajtu
               01264          
05B0 0BF0      01265          andlw    0xf0 
05B2 B4D8      01266          btfsc    STATUS,Z
05B4 0012      01267          return
               01268 ;jezeli odebrano litere duza (A,B,C,D,E,F) to po odjeciu 0x41 nic nie powinno zostac w                    
05B6 0E41      01269          movlw    0x41
05B8 5CEF      01270          subwf    INDF0,w
05BA 6F95      01271          movwf    tmp7
               01272 
05BC 0BF0      01273          andlw    0xf0 
05BE A4D8      01274          btfss    STATUS,Z
05C0 EFE5 F002 01275          goto     sprawdz_czy_odebrano_mala_litere
               01276 ;zasada taka to co zostalo po odjeciu 0x41 to 0 dla A 1 dla B etc
               01277 ;aby miec prawdziwy znak dodaje do tego 0x0a         
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
05C4 0E0A      01278          movlw    0x0A
05C6 2795      01279          addwf    tmp7,f
05C8 0012      01280          return
05CA 01281 sprawdz_czy_odebrano_mala_litere
05CA 0E61      01282          movlw    0x61
05CC 5CEF      01283          subwf    INDF0,w
05CE 6F95      01284          movwf    tmp7
05D0 0BF0      01285          andlw    0xf0 
05D2 A4D8      01286          btfss    STATUS,Z
05D4 EFEF F002 01287          goto     zla_dana_wez_0
05D8 0E0A      01288          movlw    0x0A
05DA 2795      01289          addwf    tmp7,f
05DC 0012      01290          return
05DE 01291 zla_dana_wez_0
05DE 6B95      01292          clrf     tmp7
05E0 0012      01293          return
               01294          
05E2 01295 kopiuj_liczbe_przeslana
               01296 ;procedura dziala na tej zasadzie
               01297 ;ze znaki 0123456789;:<=>?
               01298 ;wysłane na ekran 
               01299 ;po odjeciu 0x30 sa 4bitami liczby
               01300 ;pierwszy znak jest wyzszym bajtem
               01301 ;drugi znak nizszym
               01302 
               01303 ;dodano obsluge literek a,b,c,d,e,f
               01304 ;zamiast znakow ;:<=>?
05E2 2AE9      01305          incf     FSR0L,f
               01306          
05E4 ECD5 F002 01307          call   sprawdz_czy_odebrano_litere  
               01308          
               01309          
05E8 3995      01310          swapf    tmp7,w
05EA 6F91      01311          movwf    tmp
               01312          
05EC 2AE9      01313          incf     FSR0L,f
05EE ECD5 F002 01314          call     sprawdz_czy_odebrano_litere
05F2 5195      01315          movf     tmp7,w
05F4 2791      01316          addwf    tmp,f
               01317          
05F6 0012      01318          return
               01319                   
05F8 01320 zamien_na_hex
               01321 ;jezeli po odjeciu 0a jest niezanaczony bit C
               01322 ;to znaczy ze dodaj 
05F8 6F95      01323          movwf    tmp7
05FA 0E0A      01324          movlw    0x0a
05FC 5D95      01325          subwf    tmp7,w
05FE A0D8      01326          btfss    STATUS,C
0600 EF05 F003 01327          goto     cyfry_0_9
0604 5195      01328          movf     tmp7,w
0606 0F37      01329          addlw    0x37
0608 0012      01330          return
060A 01331 cyfry_0_9         
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
060A 5195      01332          movf     tmp7,w
060C 0F30      01333          addlw    0x30
060E 0012      01334          return
               01335          
0610 01336 ustaw_spbrg
               01337          
               01338          
0610 ECF1 F002 01339          call     kopiuj_liczbe_przeslana
0614 5191      01340          movf     tmp,w
               01341 ;zmieniam SPBRG
               01342          ;bsf      STATUS,RP0
               01343          ;bcf      STATUS,RP1
               01344 ;        movlw    0x1a
0616 6EAF      01345          movwf    SPBRG    
               01346          ;bcf      STATUS,RP0
0618 EF29 F005 01347          goto     powrot_z_polecen
               01348 
061C 01349 pokaz_rejestr     
               01350          
061C ECF1 F002 01351          call     kopiuj_liczbe_przeslana
               01352          
               01353 ;przechowuje FSR0L gdzies    
               01354          
               01355          
0620 5191      01356          movf     tmp,w
0622 6EDA      01357          movwf    FSR2H
0624 ECF1 F002 01358          call     kopiuj_liczbe_przeslana
0628 5191      01359          movf     tmp,w
062A 6ED9      01360          movwf    FSR2L
               01361 ;        movf     INDF0,w
               01362 ;teraz rodzielam bajt na 4 bity starsze i 4 bity mlodsze
062C 38DF      01363          swapf    INDF2,w
062E 0B0F      01364          andlw    0x0f
0630 ECFC F002 01365          call     zamien_na_hex
0634 6EAD      01366          movwf    TXREG
               01367          
0636 ECAB F002 01368          call     sprawdz_czy_mozna_wysylac
               01369          
063A 50DF      01370          movf     INDF2,w
               01371 ;robiac taka operacje kasuje starszy bajt na 3 a mlodszy bez zmian      
063C 0B0F      01372          andlw    0x0f
063E ECFC F002 01373          call     zamien_na_hex
0642 6EAD      01374          movwf    TXREG
0644 ECAB F002 01375          call     sprawdz_czy_mozna_wysylac
0648 0E0A      01376          movlw    znak_lf
064A 6EAD      01377          movwf    TXREG
064C ECAB F002 01378          call     sprawdz_czy_mozna_wysylac
               01379          
0650 EF29 F005 01380          goto     powrot_z_polecen
               01381 
               01382 
               01383 ;inicjuje pomiar co ile sekund na ktoryms z kanalow     
0654 01384 zle_polecenie
0654 6B91      01385          clrf     tmp
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0656 01386 zle_polecenie_petla
               01387 ;jestem w pamieci gdzie skok musi byc wykonany w  
               01388 ;250 komorce stad do 
               01389 ;PCLATH musze zaladowac 0x2
0656 0E02      01390          movlw    0x02
0658 6EFA      01391          movwf    PCLATH
065A 5191      01392          movf     tmp,w
065C EC3B F003 01393         call    Tab_zle_polecenie
0660 6AFA      01394         clrf      PCLATH
               01395 ;je?eli przeczytał 0 to kończ wyświetlanie
0662 0A00      01396          xorlw    0
0664 B4D8      01397          btfsc    STATUS,Z
0666 EF29 F005 01398          goto     powrot_z_polecen
066A ECAB F002 01399          call     sprawdz_czy_mozna_wysylac
066E 6EAD      01400          movwf    TXREG
0670 2B91      01401          incf     tmp,f
0672 EF2B F003 01402          goto    zle_polecenie_petla
               01403          
0676 01404 Tab_zle_polecenie         
0676 26F9      01405          addwf    PCL,f
0678 0C7A      01406          retlw    _z
067A 0C6C      01407          retlw    _l
067C 0C65      01408          retlw    _e
067E 0C20      01409          retlw    _puste
0680 0C70      01410          retlw    _p
0682 0C6F      01411          retlw    _o
0684 0C6C      01412          retlw    _l
0686 0C65      01413          retlw    _e
0688 0C63      01414          retlw    _c
068A 0C65      01415          retlw    _e
068C 0C6E      01416          retlw    _n
068E 0C69      01417          retlw    _i
0690 0C65      01418          retlw    _e
0692 0C0D      01419          retlw    znak_cr
0694 0C00      01420          retlw    0
               01421          
0696 01422 inicjuj_pomiar
               01423 ;odbierz cyfre ile mam wlaczyc portow analogowych
               01424          
               01425 ;do pomiarow potrzebuje rejestr TMR2         
0696 2AE9      01426          incf     FSR0L,f
0698 50EF      01427          movf     INDF0,w
069A B4D8      01428          btfsc    STATUS,Z
069C EF73 F003 01429          goto     wylacz_pomiary
               01430          
06A0 0E30      01431          movlw    0x30
06A2 5CEF      01432          subwf    INDF0,w
06A4 B4D8      01433          btfsc    STATUS,Z
06A6 EF73 F003 01434          goto     wylacz_pomiary
06AA 6FA5      01435          movwf    ile_kanalow
               01436          
06AC 6FA6      01437          movwf    ktory_kanal_mierze
               01438          
               01439             
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01440 ;sprawdz czy liczba kanalow nie jest wieksza od 8
               01441 ;jezeli od ile_kanalow odejme 8 i nie wyjdzie bit C
               01442 ;tzn pozyczki to przyjmij 0x07
06AE 0808      01443          sublw    0x08
06B0 A0D8      01444          btfss    STATUS,C
06B2 EF2A F003 01445          goto     zle_polecenie
               01446 ;jezeli nie ma kropki to koncz
06B6 2AE9      01447          incf     FSR0L,f
06B8 0E2E      01448          movlw    _kropka
06BA 18EF      01449          xorwf    INDF0,w
06BC A4D8      01450          btfss    STATUS,Z
06BE EF29 F005 01451          goto     powrot_z_polecen
               01452 ;odbierz kolejne cyfry
               01453         
06C2 ECF1 F002 01454          call     kopiuj_liczbe_przeslana
06C6 5191      01455          movf     tmp,w
06C8 6FA7      01456          movwf    odstep_pomiarowy
06CA 6FA8      01457          movwf    aktualny_odstep
               01458 ;wlacz analog/cyfre
06CC 0E01      01459          movlw    b'00000001'
06CE 6EC2      01460          movwf    ADCON0
06D0 85A0      01461          bsf      markers2,pomiary
               01462          ;bcf      portlampka2,lampka2
               01463          ;clrf     TMR2
               01464          ;movlw    b'00000000'
               01465          ;movwf    T2CON
06D2 51AF      01466          movf    jak_duzo_probek,w
               01467          
06D4 6FB0      01468          movwf   ktora_probka
06D6 5082      01469          movf     port_multiplekser,w
               01470          
               01471 ;czyszcze aktualne ustawienia 
               01472 ;jezeli byl tu b'01010001'     
06D8 0BF8      01473          andlw    b'11111000'
               01474 ;w wyniku mamy b'01010000'      
06DA 6E8B      01475          movwf    latch_multiplekser
               01476          
               01477 ;IF  (czy_ekran==1)
               01478 ;         
               01479 ;         movlw   linia_gorna+4
               01480 ;         call    send
               01481  ;        call     check_busy
               01482 ;         movlw    _B
               01483 ;         call     write_lcd
               01484 ;ENDIF
06DC 8B9F      01485          bsf      markers,czy_wyswietlam_temp
06DE 859F      01486          bsf      markers,pomiary_zrobione
06E0 899F      01487          bsf   markers,czy_wysylac_pomiary_serial
               01488          
06E2 EF29 F005 01489          goto     powrot_z_polecen    
               01490 
06E6 01491 wylacz_pomiary
06E6 999F      01492       bcf   markers,czy_wysylac_pomiary_serial
06E8 0E00      01493          movlw    b'00000000'
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
06EA 6EC2      01494          movwf    ADCON0
06EC 95A0      01495          bcf      markers2,pomiary
06EE 99A0      01496          bcf     markers2,wyslij_pomiar
06F0 9881      01497          bcf     portlampka2,lampka2
06F2 9DA0      01498          bcf      markers2,reguluj
               01499          ;bcf      markers2,
06F4 9B9F      01500          bcf      markers,czy_wyswietlam_temp
06F6 EF29 F005 01501          goto     powrot_z_polecen                      
               01502 ;polecenie ustawia regulator -> pokazuje wzgledem ktorego pomiaru ma regulowac wyjscie regulatora wybrane arbitralnie np PORTC0
               01503 ;i do tego portu podlaczam wyjscie na przekaznik lub triac     
               01504 ;
               01505 ;*Rx.yyyy
06FA 01506 wylacz_regulator
06FA 9DA0      01507          bcf      markers2,reguluj
06FC 9881      01508          bcf      portlampka2,lampka2
06FE EF29 F005 01509          goto     powrot_z_polecen              
0702 01510 ustaw_regulator
               01511 ;jezeli nie wlaczylem wczesniej analoga to nie wlaczam regulatora
               01512 
0702 A5A0      01513          btfss    markers2,pomiary
0704 EF7D F003 01514          goto     wylacz_regulator
               01515          
0708 2AE9      01516          incf     FSR0L,f
070A ECD5 F002 01517          call     sprawdz_czy_odebrano_litere
070E 5195      01518          movf     tmp7,w
               01519 ;         btfsc    STATUS,Z
               01520 ;         goto     wylacz_regulator
               01521          
0710 6FAD      01522         movwf    jaka_wartosc_regulujeH
0712 ECF1 F002 01523          call     kopiuj_liczbe_przeslana
0716 5191      01524          movf     tmp,w 
0718 6FAE      01525          movwf    jaka_wartosc_regulujeL
               01526          
071A 8DA0      01527          bsf      markers2,reguluj
071C EF29 F005 01528          goto     powrot_z_polecen    
               01529 
               01530          
0720 01531 ustaw_wartosc_dzielenia_usredniania         
               01532 ;sprawdzam    który bit jest ustawiony
               01533 ;jeżeli jak_duzo_probek == 0x80 to ustawiony jest bit 7
0720 BFAF      01534       btfsc       jak_duzo_probek,7
0722 0E02      01535       movlw       0x02
               01536 ;bit 6 = 0x40   
0724 BDAF      01537       btfsc       jak_duzo_probek,6
0726 0E04      01538       movlw       0x04
               01539       
0728 BBAF      01540       btfsc       jak_duzo_probek,5
072A 0E08      01541       movlw       0x08
               01542 ;0x10      
072C B9AF      01543       btfsc       jak_duzo_probek,4
072E 0E10      01544       movlw       0x10
               01545 ;0x20      
0730 B7AF      01546       btfsc       jak_duzo_probek,3
0732 0E20      01547       movlw       0x20
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01548 ;0x40      
0734 B5AF      01549       btfsc       jak_duzo_probek,2
0736 0E40      01550       movlw       0x40
               01551       
               01552 ;2 próbki      
0738 B3AF      01553       btfsc       jak_duzo_probek,1
073A 0E80      01554       movlw       0x80
               01555       
073C 6FB2      01556       movwf       usrednianie_przez_co_mnoze
               01557       
073E 0012      01558       return
               01559       
0740 01560 ustaw_probki                              ;                 PROBKI
0740 6BAA      01561          clrf     pomiarH
0742 6BAB      01562          clrf     pomiarL
0744 6BAC      01563          clrf     pomiar_ulamek
0746 6B9B      01564          clrf     wynikh
0748 6B9C      01565          clrf     wynik
               01566 ;zawsze wyłącz na początku usrednianie
074A 919F      01567          bcf      markers,czy_usrednianie
               01568          
074C ECF1 F002 01569          call     kopiuj_liczbe_przeslana
0750 5191      01570          movf     tmp,w
0752 6FAF      01571          movwf    jak_duzo_probek
               01572          
               01573          ;movwf   ktora_probka
               01574          
               01575 ;sprawdz czy usredniamy czy nie tzn czy wartosc jak_duzo_probek < 2
0754 0801      01576          sublw    1
0756 B0D8      01577          btfsc    STATUS,C
0758 EF29 F005 01578          goto     powrot_z_polecen
075C 819F      01579          bsf      markers,czy_usrednianie
               01580 ;ustaw wartość liczby przez którą mnoże każdy z pomiarów -> tzn przez ile dzielę
               01581          
075E EC90 F003 01582          call     ustaw_wartosc_dzielenia_usredniania
               01583          
0762 EF29 F005 01584          goto     powrot_z_polecen
               01585 
0766 01586 rozkaz_wysylania_znaku_na_lcd
0766 ECF1 F002 01587          call     kopiuj_liczbe_przeslana
076A 5191      01588          movf     tmp,w
076C ECF4 F000 01589          call     send
0770 ECF1 F002 01590          call     kopiuj_liczbe_przeslana
0774 5191      01591          movf     tmp,w
0776 EC05 F001 01592          call     write_lcd
077A EF29 F005 01593          goto     powrot_z_polecen
               01594 
               01595                                                                   ;*                                  *************************POLecenie DS1820
077E 01596 PIN_HI
               01597         
077E 8A94      01598         BSF     TRISC, czujnik_ds1820           ; high impedance
               01599         
               01600         
0780 0012      01601         RETURN
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01602 
0782 01603 PIN_LO
0782 9A82      01604         BCF     port_ds1820,czujnik_ds1820
               01605         
0784 9A94      01606         BCF     TRISC, czujnik_ds1820           ; low impedance zero
               01607         
               01608         
0786 0012      01609         RETURN
0788 01610 send_1
0788 6ACC      01611          clrf     TMR2
078A 929E      01612          bcf      PIR1,TMR2IF
078C ECC1 F003 01613          call     PIN_LO
0790 0000      01614          nop
0792 ECBF F003 01615          call     PIN_HI
               01616          ;bcf      port_ds1820,czujnik_ds1820
               01617          ;nop
               01618          ;nop
               01619          ;nop
               01620          ;nop
               01621          ;nop
               01622          ;nop
               01623          ;bsf      port_ds1820,czujnik_ds1820
0796 01624 petla_send1
0796 A29E      01625          btfss    PIR1,TMR2IF        
0798 EFCB F003 01626          goto     petla_send1
               01627          
079C 0012      01628          return
               01629 
079E 01630 send_0
               01631          ;bsf      port_ds1820,czujnik_ds1820
079E ECC1 F003 01632          call     PIN_LO
07A2 6ACC      01633          clrf     TMR2
07A4 0000      01634          nop
               01635          
07A6 929E      01636          bcf      PIR1,TMR2IF
               01637          
07A8 9A82      01638          bcf      port_ds1820,czujnik_ds1820
07AA 01639 petla_send0
07AA A29E      01640          btfss    PIR1,TMR2IF        
07AC EFD5 F003 01641          goto     petla_send0
07B0 ECBF F003 01642          call     PIN_HI
               01643          
07B4 0012      01644          return
               01645 
               01646 
               01647 
07B6 01648 inicjacja_ds1820
               01649 ;wysyla 0 na linie danych do ds1820 przez 
               01650 ;inicjalizacja 0 na wyjsciu okolo 480us tzn dla ustawienia 1:2 
               01651 ;        dokladnie 256 z liczeniem TMR2 co 2, pozniej otwarcie portu na wejscie przejscie do 1 i po kilkunastu us otwarcie portu na wejscie
               01652 ;        powinien byc obecny sygnal 0 do okolo 240 us.
               01653 ;otwieram port na wyjscie
07B6 98AB      01654          bcf      RCSTA,CREN
               01655          
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
07B8 9A94      01656          bcf      TRISC,czujnik_ds1820
               01657          
               01658 ;ustawiam tmr2 na zliczanie 2 
07BA 0EFF      01659          movlw    0xff
               01660          
07BC 6ECB      01661          movwf    PR2
               01662          
               01663          
07BE 0E0C      01664          movlw    b'00001100'
07C0 6ECA      01665          movwf    T2CON
07C2 929E      01666          bcf      PIR1,TMR2IF
               01667 ;wlaczam przerwanie Tmr2
               01668          ;bsf      STATUS,RP0
               01669          ;bsf      PIE1,TMR2IE2
               01670          ;bcf      STATUS,RP0         
07C4 ECBF F003 01671          call     PIN_HI
07C8 ECC1 F003 01672          call     PIN_LO
               01673 ;daje znacznik ze dotyczy to inicjacji ds1820
               01674          ;bsf      znaczniki_ds,inicjacja
               01675 ;petla czekania na koniec inicjacji
07CC 01676 petla_inicjacji1
               01677          
07CC A29E      01678          btfss    PIR1,TMR2IF
07CE EFE6 F003 01679          goto     petla_inicjacji1
               01680 ;teraz przelaczam sie na odbior danych z ds1820
               01681          
07D2 8A94      01682          bsf      TRISC,czujnik_ds1820
               01683          
07D4 0000      01684          nop
07D6 929E      01685          bcf      PIR1,TMR2IF
               01686 ;sprawdzam czy w ciagu 480us pojawilo sie 0 na porcie czujnika
07D8 01687 petla_inicjacji2
07D8 AA82      01688          btfss    port_ds1820,czujnik_ds1820
07DA EF00 F004 01689          goto     petla_inicjacji3
07DE A29E      01690          btfss    PIR1,TMR2IF
07E0 EFEC F003 01691          goto     petla_inicjacji2
               01692          
07E4 01693 blad_inicjacji_ds
07E4 ECAB F002 01694          call    sprawdz_czy_mozna_wysylac
07E8 0E0A      01695          movlw    znak_lf
07EA 6EAD      01696          movwf   TXREG
07EC ECAB F002 01697          call    sprawdz_czy_mozna_wysylac
07F0 0E35      01698          movlw    0x35
               01699          
07F2 6EAD      01700          movwf   TXREG
07F4 ECAB F002 01701          call    sprawdz_czy_mozna_wysylac
07F8 0E0A      01702          movlw    znak_lf
07FA 6EAD      01703          movwf   TXREG
07FC EF29 F005 01704          goto     powrot_z_polecen   
0800 01705 petla_inicjacji3
0800 BA82      01706          btfsc    port_ds1820,czujnik_ds1820
0802 EF06 F004 01707          goto     inicjacja_ok
0806 A29E      01708          btfss    PIR1,TMR2IF
0808 EF00 F004 01709          goto     petla_inicjacji3
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01710          
080C 01711 inicjacja_ok
080C B39F      01712          btfsc    markers,czy_wysylanie
080E EF20 F004 01713          goto     wysylanie_danych_rozkaz
               01714          
0812 ECAB F002 01715          call    sprawdz_czy_mozna_wysylac
0816 0E0A      01716          movlw    znak_lf
0818 6EAD      01717          movwf   TXREG
081A ECAB F002 01718          call    sprawdz_czy_mozna_wysylac
081E 0E4F      01719          movlw    _O
               01720          
0820 6EAD      01721          movwf   TXREG
0822 ECAB F002 01722          call    sprawdz_czy_mozna_wysylac
0826 0E4B      01723          movlw    _K
0828 6EAD      01724          movwf   TXREG
082A ECAB F002 01725          call    sprawdz_czy_mozna_wysylac
082E 0E0A      01726          movlw    znak_lf
0830 6EAD      01727          movwf   TXREG
0832 ECAB F002 01728          call    sprawdz_czy_mozna_wysylac
               01729          
0836 EF29 F005 01730          goto     powrot_z_polecen
               01731          
               01732          
               01733              
               01734 ;jezeli otrzyma 1 to na ekran wysyla informacje 'ds ok'         
               01735 
               01736 
083A 01737 wysylanie_danych
083A 839F      01738          bsf      markers,czy_wysylanie
083C EFDB F003 01739          goto     inicjacja_ds1820
0840 01740 wysylanie_danych_rozkaz
0840 939F      01741          bcf      markers,czy_wysylanie
               01742          
               01743         
               01744 ;ustawiam tmr2 na 60us bo tyle trwa jeden bit  
0842 0E3C      01745          movlw    0x3c
               01746          
0844 6ECB      01747          movwf    PR2
               01748          
               01749          ;bcf      TRISC,czujnik_ds1820
               01750         
               01751          ;bcf      STATUS,RP0
               01752 ;zliczanie 1:1         
0846 0E04      01753          movlw    b'00000100'
0848 6ECA      01754          movwf    T2CON
084A 929E      01755          bcf      PIR1,TMR2IF
               01756 ;wlaczam przerwanie Tmr2
               01757          
084C 01758 wysylanie_bajtu_rozkazu
               01759 ;zczytuje dana do wyslania
084C ECF1 F002 01760         call      kopiuj_liczbe_przeslana
0850 5191      01761         movf      tmp,w
0852 6FB4      01762         movwf     polecenie_wysylane
0854 6ACC      01763         clrf      TMR2
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0856 0E08      01764         movlw     8
0858 6F8B      01765         movwf     n
085A 01766 petla_sending        
               01767 ;jezeli 0 to wyslij   0
085A A1B4      01768         btfss     polecenie_wysylane,0
085C ECCF F003 01769         call      send_0
0860 B1B4      01770         btfsc     polecenie_wysylane,0
0862 ECC4 F003 01771         call      send_1
0866 8A82      01772         bsf       port_ds1820,czujnik_ds1820
0868 90D8      01773         bcf       STATUS,C
086A 33B4      01774         rrcf       polecenie_wysylane,f
               01775         ;bcf       STATUS,C
               01776         ;movf      polecenie_wysylane,w
               01777         ;btfss     STATUS,Z
086C 2F8B      01778         decfsz    n,f
086E EF2D F004 01779         goto      petla_sending
               01780         
               01781 ;sprawdzam czy kolejny bajt jest 0x0d        
0872 2AE9      01782         incf     FSR0L,f
0874 50EF      01783         movf      INDF0,w
0876 0A0D      01784         xorlw     0x0d
0878 B4D8      01785         btfsc     STATUS,Z
087A EF42 F004 01786         goto     sprawdz_czy_ds1820_wysyla
               01787         
087E 06E9      01788         decf      FSR0L,f
0880 EF26 F004 01789         goto      wysylanie_bajtu_rozkazu
               01790         
               01791         
0884 01792 sprawdz_czy_ds1820_wysyla
0884 0ECA      01793          movlw    bajt_ds
0886 6EE9      01794          movwf    FSR0L
0888 51B5      01795          movf     jak_duzo_bajtow_odbieram_z_ds,w
088A 6F8E      01796          movwf    liczba1
               01797             
               01798         ;goto     powrot_z_polecen
               01799 ;procedura sprawdza czy ds1820 cos wysyla jezeli tak to sprawdza przez 60 us czy jest choc na chwile 0
               01800 ;normalnie jezeli ds1820 nic nie wysyla to jest caly czas 1 bez rzadnych zmian
088C 01801 petla_odbioru_ds1820
088C 0E08      01802         movlw     8
088E 6F8B      01803         movwf     n
0890 6ACC      01804         clrf      TMR2
0892 6AEF      01805         clrf      INDF0
0894 929E      01806         bcf       PIR1,TMR2IF
               01807         
0896 01808 petla_czy_jest_0
0896 ECC1 F003 01809          call     PIN_LO
089A 0000      01810          nop
089C ECBF F003 01811          call     PIN_HI
08A0 0000      01812          nop
08A2 0000      01813          nop
08A4 0000      01814          nop
08A6 0000      01815          nop
08A8 0000      01816          nop
08AA 0000      01817          nop
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
08AC 0000      01818          nop
08AE 5082      01819          movf     port_ds1820,w
08B0 6F8F      01820          movwf    liczba2
08B2 AB8F      01821          btfss    liczba2,czujnik_ds1820
08B4 90D8      01822          bcf      STATUS,C
08B6 BB8F      01823          btfsc    liczba2,czujnik_ds1820
08B8 80D8      01824          bsf      STATUS,C
08BA 32EF      01825          rrcf      INDF0,f
               01826          
08BC 01827 czekam_na_kolejny_bit
08BC A29E      01828         btfss    PIR1,TMR2IF
08BE EF5E F004 01829         goto      czekam_na_kolejny_bit
08C2 929E      01830         bcf       PIR1,TMR2IF
               01831         
08C4 2F8B      01832         decfsz    n,f
08C6 EF4B F004 01833         goto      petla_czy_jest_0
08CA 2AE9      01834         incf      FSR0L,f
               01835 ;czy juz przeszly wszystkie linie (4 bajty odebrano)  
08CC 2F8E      01836         decfsz    liczba1,f
08CE EF46 F004 01837         goto      petla_odbioru_ds1820
               01838         
               01839 ;jezeli minelo 60us i nic sie nie dzialo to przerwij odbieranie 
               01840         ;btfsc    PIR1,TMR2IF
08D2 51B5      01841         movf     jak_duzo_bajtow_odbieram_z_ds,w
08D4 6F8B      01842         movwf     n
08D6 0ECA      01843         movlw    bajt_ds
08D8 6EE9      01844         movwf    FSR0L
08DA 01845 petla_wysylania_odebranych_bajtow        
08DA ECAB F002 01846         call    sprawdz_czy_mozna_wysylac
               01847          
08DE 38EF      01848          swapf    INDF0,w
08E0 0B0F      01849          andlw    0x0f
08E2 ECFC F002 01850          call     zamien_na_hex
08E6 6EAD      01851          movwf   TXREG
               01852          
08E8 ECAB F002 01853          call    sprawdz_czy_mozna_wysylac
               01854          
08EC 50EF      01855          movf     INDF0,w
08EE 0B0F      01856          andlw    0x0f
08F0 ECFC F002 01857          call     zamien_na_hex
08F4 6EAD      01858          movwf   TXREG     
08F6 2AE9      01859          incf     FSR0L,f
08F8 2F8B      01860          decfsz   n,f
08FA EF6D F004 01861          goto     petla_wysylania_odebranych_bajtow
               01862          
08FE ECAB F002 01863          call    sprawdz_czy_mozna_wysylac
0902 0E0A      01864          movlw    znak_lf
0904 6EAD      01865          movwf   TXREG   
0906 EF29 F005 01866         goto     powrot_z_polecen
               01867         
090A 01868 ustawienie_liczby_odbieranych_bajtow
               01869          
090A 2AE9      01870          incf     FSR0L,f
090C ECD5 F002 01871          call     sprawdz_czy_odebrano_litere
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0910 5195      01872          movf     tmp7,w
0912 080B      01873          sublw    0x0b
0914 A0D8      01874          btfss    STATUS,C
0916 EF91 F004 01875          goto     ustawienie_liczby_odbieranych_bajtow_zero
               01876          
091A 5195      01877          movf     tmp7,w
091C 6FB5      01878          movwf    jak_duzo_bajtow_odbieram_z_ds
091E EF29 F005 01879          goto     powrot_z_polecen
               01880          
0922 01881 ustawienie_liczby_odbieranych_bajtow_zero
0922 0E04      01882          movlw    0x04
0924 6FB5      01883          movwf    jak_duzo_bajtow_odbieram_z_ds
0926 EF29 F005 01884          goto     powrot_z_polecen
               01885          
               01886 ;zarejestrowalem 0
               01887         
               01888 ;tzn czy przez czas 8  bitow cos         
092A 01889 rozkazy_ds1820
092A 2AE9      01890         incf     FSR0L,f
092C 0E69      01891         movlw    _i
092E 18EF      01892         xorwf    INDF0,w
0930 B4D8      01893         btfsc    STATUS,Z 
0932 EFDB F003 01894         goto      inicjacja_ds1820
               01895         
0936 0E73      01896         movlw    _s
0938 18EF      01897         xorwf    INDF0,w
093A B4D8      01898         btfsc    STATUS,Z 
093C EF1D F004 01899         goto     wysylanie_danych
               01900         
0940 0E62      01901         movlw    _b
0942 18EF      01902         xorwf    INDF0,w
0944 B4D8      01903         btfsc    STATUS,Z 
0946 EF85 F004 01904         goto     ustawienie_liczby_odbieranych_bajtow
               01905         
094A EF29 F005 01906         goto     powrot_z_polecen
               01907         
               01908 ;*********KOniec ds1820
094E 01909 wlaczenie_rejestracji_pradu
094E ECF1 F002 01910       call     kopiuj_liczbe_przeslana
               01911       
0952 5191      01912       movf     tmp,w
               01913       
               01914 ;sprawdzenie czy nie podano liczby większej od 2 (mniejszą od 3)
0954 0E03      01915       movlw       3
0956 6191      01916       cpfslt    tmp
               01917 ;jezeli wyszlo C tzn ze przekroczono
0958 EF29 F005 01918       goto        powrot_z_polecen
               01919       
095C 5191      01920       movf     tmp,w
095E E005      01921       bz       wylaczenie_rejestarcji_pradu
0960 6FD5      01922       movwf       jak_duzo_kanalow_pradu
               01923       
0962 81A1      01924       bsf   markers3,pomiary_pradu
0964 6BD6      01925       clrf        ktory_aktualnie_kanal_pradu
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01926       
0966 EF29 F005 01927       goto        powrot_z_polecen
               01928       
096A 01929 wylaczenie_rejestarcji_pradu
096A 91A1      01930       bcf   markers3,pomiary_pradu
096C EF29 F005 01931       goto        powrot_z_polecen
               01932       
0970 01933 rozkaz_rejestracji_poprawki_pomiaru_temperatury
               01934       ;incf     FSR0L,f   
0970 ECF1 F002 01935       call     kopiuj_liczbe_przeslana
               01936 
               01937         
0974 5191      01938       movf     tmp,w
               01939 ;tmp6 przechowuje pod ktory adres zapisac poprawke      
0976 6F94      01940       movwf    tmp6
0978 0809      01941       sublw    9
               01942 ;jezeli wyszlo C tzn ze przekroczono a kanalow mamy tylko 8 + 2 pradowe
097A A0D8      01943       btfss       STATUS,C
097C EF29 F005 01944       goto        powrot_z_polecen
               01945       
               01946       
               01947 ;sprawdz czy przeslana dana nie jest wieksza od 7 jezeli jest to przerwij
               01948 ;odbierz kolejna liczbe
               01949       ;incf     FSR0L,f
0980 ECF1 F002 01950       call     kopiuj_liczbe_przeslana
               01951 
               01952       ;jest w tmp  poprawka
0984 0ECB      01953       movlw    poprawka0
               01954       ;dec100 przechowuje ktorego czujnika to dotyczy
0986 2594      01955       addwf    tmp6,w
0988 6EE1      01956       movwf    FSR1L
098A 6AE2      01957       clrf     FSR1H
               01958       ;zapisuje do rejestru poprawek
098C 5191      01959       movf     tmp,w
098E 6EE7      01960       movwf    INDF1
               01961       ;movwf    poprawka
0990 0E91      01962       movlw       tmp
0992 6EE1      01963       movwf    FSR1L
               01964       
0994 0E00      01965       movlw poprawka0_ee
0996 2594      01966       addwf tmp6,w
0998 EC8B F001 01967       call  zapis_eeprom
099C EF29 F005 01968       goto        powrot_z_polecen
               01969 
09A0 01970 wybor_czujnika_regulatora
09A0 ECF1 F002 01971       call     kopiuj_liczbe_przeslana
               01972       
               01973       
               01974       ;sprawdzam czy nie jest większe od 7
09A4 0E08      01975       movlw    8
09A6 6191      01976       cpfslt   tmp
09A8 EFDA F004 01977       goto     wybrano_czujnik_regulatora_wiekszy_od_7
               01978       
09AC 5191      01979       movf     tmp,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01980       
09AE 6FE9      01981       movwf    ktory_czujnik_reguluje
               01982       
09B0 EF29 F005 01983       goto        powrot_z_polecen
               01984 
09B4 01985 wybrano_czujnik_regulatora_wiekszy_od_7
09B4 0E00      01986       movlw       0
09B6 6FE9      01987       movwf       ktory_czujnik_reguluje
09B8 EF29 F005 01988       goto        powrot_z_polecen
               01989       
09BC 01990 sprawdz_czy_polecenie                  
               01991 ;sprawdz czy odebrano 'znak_cr'
09BC 0E00      01992          movlw    0x00
09BE 6EE9      01993          movwf    FSR0L
09C0 0E01      01994          movlw    1
09C2 6EEA      01995          movwf    FSR0H
               01996          
09C4 0E2A      01997          movlw    _star
09C6 18EF      01998          xorwf    INDF0,w
09C8 A4D8      01999          btfss    STATUS,Z
               02000 IF (czy_ekran==1)         
09CA EF2E F005 02001          goto     wyslij_na_ekran_to_co_odebralem
               02002 ENDIF         
               02003 IF       (czy_ekran==0)
               02004         goto     powrot_z_polecen
               02005 ENDIF         
               02006    
               02007 
               02008 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;         
09CE 02009 sprawdz_ktore_polecenie
               02010 ;polecenia:
               02011 ;
               02012 ;        *L-zapal lub zgas lampke lampke
               02013 ;        *Px.y - pomiar kanal x wyrzucany na port szeregowy co y czasu (y to 1/2 sekundy)
               02014 ;                 konfiguruje kanal 0 i referencyjne zasilajace
               02015 ;        *P - puste przerywa pomiary
               02016 ;        *Cx - czysci x linie ekranu i zeruje kursor
               02017 ;        *Ryyy    - reguluj odczyt x(ktory kanal) na poziom y ustawienia w ilosc odczytanej cyfry
               02018 ;        *+x.y - dodaje x + y i wynik na 4 linii ekranu
               02019 ;        *>x      przeslij znak x
               02020 ;        **xx   ustaw zegar szeregowego xxx->do SPBRG 
               02021 ;        xx -> zapis szesnastkowy tzn **:: ustawia SPBRG na 0xaa
               02022 ;        *#xxxx - pokaz zawartosc rejestru xxxx (podobnie jak powyzej) - podaje dwa bajty np 0fff
               02023 ;        *S00 - ustawienie ilosci probek na jeden pomiar
               02024 ;        
               02025 ;        *Di  -  inicjuje ds1820
               02026 ;        *Dr  -read rom (only one ds)
               02027 ;        *Ds      -skip rom (whitout rom identification)
               02028 
               02029 ;        *exxyy  - na ekran w miejscu xx wyrzuc znak yy
               02030 ;        *p0xyy  - poprawka kanalu x o yy
               02031 ;           *i0x - pomiar pradu z kanalow 2     
               02032 ;           *A    - który czujnik użyty jest w regulacji
               02033 ;zacznij robic
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02034 ;sprawdzam czy
09CE 2AE9      02035          incf     FSR0L,f
               02036          
09D0 0E4C      02037          movlw    _L
09D2 18EF      02038          xorwf    INDF0,w
09D4 B4D8      02039          btfsc    STATUS,Z
09D6 EF80 F002 02040          goto     zapal_lampke
               02041          
               02042          
               02043          
09DA 0E2B      02044          movlw    _plus
09DC 18EF      02045          xorwf    INDF0,w
09DE B4D8      02046          btfsc    STATUS,Z
09E0 EF83 F002 02047          goto     sumuj_liczby
               02048 ;*> - znak wysylania
09E4 0E3E      02049          movlw    0x3e
09E6 18EF      02050          xorwf    INDF0,w
09E8 B4D8      02051          btfsc    STATUS,Z
09EA EFB2 F002 02052          goto     wyslij_znak
               02053 ;**         
09EE 0E2A      02054          movlw    _star
09F0 18EF      02055          xorwf    INDF0,w
09F2 B4D8      02056          btfsc    STATUS,Z
09F4 EF08 F003 02057          goto     ustaw_spbrg
               02058 ;*# - pokaz komorke pamieci         
09F8 0E23      02059          movlw    0x23
09FA 18EF      02060          xorwf    INDF0,w
09FC B4D8      02061          btfsc    STATUS,Z
09FE EF0E F003 02062          goto     pokaz_rejestr
               02063 ;*P -> pomiar     
0A02 0E50      02064          movlw    _P
0A04 18EF      02065          xorwf    INDF0,w
0A06 B4D8      02066          btfsc    STATUS,Z
0A08 EF4B F003 02067          goto     inicjuj_pomiar
               02068 
               02069 
               02070 ;*r ->Reguluj
0A0C 0E52      02071          movlw    _R
0A0E 18EF      02072          xorwf    INDF0,w
0A10 B4D8      02073          btfsc    STATUS,Z
0A12 EF81 F003 02074          goto     ustaw_regulator
               02075          
               02076 ;*S ->probki
0A16 0E53      02077          movlw    _S
0A18 18EF      02078          xorwf    INDF0,w
0A1A B4D8      02079          btfsc    STATUS,Z
0A1C EFA0 F003 02080          goto     ustaw_probki
               02081 ;*D rozkazy Ds1820
0A20 0E44      02082          movlw    _D
0A22 18EF      02083          xorwf    INDF0,w
0A24 B4D8      02084          btfsc    STATUS,Z
0A26 EF95 F004 02085          goto     rozkazy_ds1820
               02086 ;*e 
0A2A 0E65      02087          movlw    _e
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0A2C 18EF      02088          xorwf    INDF0,w
0A2E B4D8      02089          btfsc    STATUS,Z
0A30 EFB3 F003 02090          goto     rozkaz_wysylania_znaku_na_lcd
               02091          
               02092          
               02093 ;*p - poprawka  czujnika temperatury i o ile np: *p0009 czyli 0 o 9 (ujemne to uzupelnienia czyli *p00fe to poprawka o -1
0A34 0E70      02094          movlw    _p
0A36 18EF      02095          xorwf    INDF0,w
0A38 B4D8      02096          btfsc    STATUS,Z
0A3A EFB8 F004 02097          goto     rozkaz_rejestracji_poprawki_pomiaru_temperatury
               02098          
               02099 ;*i - pomiar pradu np *i0x
               02100          
0A3E 0E69      02101          movlw    _i
0A40 18EF      02102          xorwf    INDF0,w
0A42 B4D8      02103          btfsc    STATUS,Z
0A44 EFA7 F004 02104          goto     wlaczenie_rejestracji_pradu
               02105          
0A48 0E41      02106          movlw    _A
0A4A 18EF      02107          xorwf    INDF0,w
0A4C B4D8      02108          btfsc    STATUS,Z
0A4E EFD0 F004 02109          goto     wybor_czujnika_regulatora
               02110          
               02111 ;ustaw szybkosc portu szeregowego
               02112 ;ustawienie jest zapisane do EEPROM i w momencie startu urzadzenia stamtad czytane
               02113 ;mozliwe ustawienia:
               02114 ;0x1a - 11200 baudow
               02115 ;0x0c - 19200 baudow
               02116 ;
               02117          
               02118                            
0A52 02119 powrot_z_polecen
               02120 ;        movlw    _up
0A52 2AE9      02121          incf     FSR0L,f
0A54 97A0      02122          bcf      markers2,sprawdz_odebrane
0A56 6B8D      02123          clrf     odebrano_liter
0A58 88AB      02124          bsf      RCSTA,CREN
               02125 ;        clrf     FSR0L
               02126 ;        movwf    INDF
0A5A 0012      02127          return
               02128          
               02129          
0A5C 02130 wyslij_na_ekran_to_co_odebralem
0A5C EC32 F001 02131       call     check_busy
0A60 0EC0      02132          movlw    linia_dolna
0A62 ECF4 F000 02133          call     send
0A66 EC32 F001 02134          call     check_busy
0A6A 0E00      02135          movlw    dane_odebraneL
0A6C 6EE9      02136          movwf    FSR0L      
0A6E 0E01      02137          movlw    dane_odebraneH
0A70 6EEA      02138          movwf    FSR0H      
               02139          
0A72 02140 wyswietl_litere_petla
               02141          
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0A72 0E0D      02142          movlw    0x0d
0A74 18EF      02143          xorwf    INDF0,w
0A76 B4D8      02144          btfsc    STATUS,Z
0A78 EF58 F005 02145          goto     koniec_wyswietlania
               02146          
               02147 ;sprawdz czy odebrano pusty znak...
               02148 ;        movlw    0x0a
               02149 ;        xorwf    INDF,w
               02150 ;        btfsc    STATUS,Z
               02151 ;        goto     koniec_wyswietlania        
               02152          
0A7C 50EF      02153          movf     INDF0,w
0A7E B4D8      02154          btfsc    STATUS,Z
0A80 EF58 F005 02155          goto     koniec_wyswietlania
               02156 
               02157 
0A84 518D      02158          movf     odebrano_liter,w
0A86 A4D8      02159          btfss    STATUS,Z
0A88 EF46 F005 02160          goto     wyswietl_litere_petla2
               02161          
               02162          
               02163 ;        goto     koniec_wyswietlania
               02164 
0A8C 02165 wyswietl_litere_petla2
               02166          ;movlw    linia_dolna
               02167          ;addwf    linia2,w
               02168          ;call     send
               02169          ;call     check_busy
               02170          
0A8C 50EF      02171          movf     INDF0,w
0A8E EC05 F001 02172          call     write_lcd
0A92 EC32 F001 02173          call     check_busy
               02174 ;        clrf     odebrana_litera
0A96 2B87      02175          incf     linia2,f
               02176          
               02177 ;        movlw    0A
               02178 ;        xorwf    linia2
0A98 A987      02179          btfss    linia2,4
0A9A EF55 F005 02180          goto     wyswietl_litere_petla3
               02181          
0A9E 6B87      02182          clrf     linia2
0AA0 0E0F      02183          movlw    0x0f
0AA2 6F8B      02184          movwf    n
0AA4 0EC0      02185          movlw    linia_dolna
0AA6 EC23 F001 02186          call     clear_line
               02187          
0AAA 02188 wyswietl_litere_petla3
0AAA 2AE9      02189          incf     FSR0L,f
               02190 ;        decfsz   odebrano_liter,f
0AAC EF39 F005 02191          goto     wyswietl_litere_petla
               02192          
0AB0 02193 koniec_wyswietlania        
               02194          ;clrf     odebrano_liter
               02195          ;bcf      markers2,wyswietl
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0AB0 88AB      02196          bsf      RCSTA,CREN
0AB2 EF29 F005 02197          goto     powrot_z_polecen
               02198 
               02199          
               02200          
               02201          
               02202          
               02203          
               02204 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                                     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  
               02205 
               02206 
               02207 ; tu sa procedury pomiaru
               02208 
               02209 
               02210 
               02211 
               02212                                                    ;POMIARY!!!!!!!!!!!!!!!!!!!!!!!         
               02213 
               02214                                                    
               02215                                                    
               02216                                                    
               02217                                                    
               02218                                                    
               02219                                                    
               02220                                                    
               02221                                                    
               02222 ;;;;;;;;;;;;;;;
               02223 
               02224 
               02225             
0AB6 02226 wyswietl_cyfry_temperatury
               02227       ;sprawdz czy rzadna z cyfr nie przekracza 10
0AB6 0E0A      02228       movlw       0x0a
0AB8 5D98      02229       subwf       dec1,w
0ABA E302      02230       bnc         sprawdz_10
0ABC 6F98      02231       movwf       dec1
0ABE 2B97      02232       incf        dec10,f
               02233       
0AC0 02234 sprawdz_10
0AC0 0E0A      02235      movlw       0x0a
0AC2 5D97      02236       subwf       dec10,w
0AC4 E302      02237       bnc         wyswietl_cyfry_temperatury2
0AC6 6F97      02238       movwf       dec10
0AC8 2B96      02239       incf        dec100,f
               02240   
0ACA 02241 wyswietl_cyfry_temperatury2  
0ACA EC32 F001 02242          call     check_busy
0ACE 51B1      02243         movf        ktory_kanal,w
               02244          
0AD0 0F30      02245       addlw       0x30
               02246       ;movlw       _plus
0AD2 EC05 F001 02247       call        write_lcd
               02248       
0AD6 EC32 F001 02249       call     check_busy
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0ADA 0E20      02250       movlw       _puste
               02251       
               02252       
               02253       
               02254       
               02255       
0ADC BDA1      02256       btfsc       markers3,napisz_minus
0ADE 0E2D      02257       movlw       _minus
0AE0 EC05 F001 02258       call        write_lcd
               02259       
               02260       
               02261          
0AE4 EC32 F001 02262       call     check_busy
0AE8 5196      02263       movf     dec100,w
0AEA E10E      02264       bnz       pisz_cyfre_100
               02265       
0AEC 0E20      02266       movlw    _puste
0AEE EC05 F001 02267       call     write_lcd
0AF2 EC32 F001 02268       call     check_busy
0AF6 5197      02269       movf     dec10,w
0AF8 E10D      02270       bnz      pisz_cyfre_10
               02271       
0AFA 0E20      02272       movlw    _puste
0AFC EC05 F001 02273       call     write_lcd
0B00 EC32 F001 02274       call     check_busy
0B04 EF90 F005 02275       goto     pisz_cyfre_1
               02276       
0B08 02277 pisz_cyfre_100
0B08 5196      02278       movf        dec100,w
0B0A 0F30      02279       addlw       0x30
0B0C EC05 F001 02280       call     write_lcd
0B10 EC32 F001 02281       call     check_busy
               02282 
0B14 02283 pisz_cyfre_10
0B14 5197      02284       movf        dec10,w
0B16 0F30      02285       addlw       0x30
0B18 EC05 F001 02286       call     write_lcd
0B1C EC32 F001 02287       call     check_busy
               02288       
0B20 02289 pisz_cyfre_1
0B20 5198      02290       movf        dec1,w
0B22 0F30      02291       addlw       0x30
0B24 EC05 F001 02292       call     write_lcd
0B28 EC32 F001 02293       call     check_busy
               02294       
0B2C 0E2E      02295       movlw    _kropka
0B2E EC05 F001 02296       call     write_lcd
               02297       
               02298       
               02299 ;sprawdz ktory ulamek
0B32 519D      02300       movf     wynik01,w
0B34 E008      02301       bz       pisz_ulamek_00
               02302       
0B36 0A40      02303       xorlw    0x40
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0B38 E011      02304       bz       pisz_ulamek_25
               02305       
0B3A 519D      02306       movf     wynik01,w
0B3C 0A80      02307       xorlw    0x80
0B3E E019      02308       bz       pisz_ulamek_50
               02309       
0B40 519D      02310       movf     wynik01,w
0B42 0AC0      02311       xorlw    0xc0
0B44 E021      02312       bz       pisz_ulamek_75
               02313       
               02314       
0B46 02315 pisz_ulamek_00
0B46 EC32 F001 02316       call     check_busy
0B4A 0E30      02317       movlw    0x30
0B4C EC05 F001 02318       call     write_lcd
0B50 EC32 F001 02319       call     check_busy
0B54 0E20      02320       movlw    _puste
0B56 EC05 F001 02321       call     write_lcd
               02322       
               02323       
0B5A 0012      02324       return
               02325 
0B5C 02326 pisz_ulamek_25
0B5C EC32 F001 02327       call     check_busy
0B60 0E32      02328       movlw    0x32
0B62 EC05 F001 02329       call     write_lcd
               02330       
0B66 EC32 F001 02331       call     check_busy
0B6A 0E35      02332       movlw    0x35
0B6C EC05 F001 02333       call     write_lcd
0B70 0012      02334       return
               02335       
0B72 02336 pisz_ulamek_50
0B72 EC32 F001 02337       call     check_busy
0B76 0E35      02338       movlw    0x35
0B78 EC05 F001 02339       call     write_lcd
0B7C EC32 F001 02340       call     check_busy
0B80 0E30      02341       movlw    0x30
0B82 EC05 F001 02342       call     write_lcd
0B86 0012      02343       return
               02344       
0B88 02345 pisz_ulamek_75
0B88 EC32 F001 02346       call     check_busy
0B8C 0E37      02347       movlw    0x37
0B8E EC05 F001 02348       call     write_lcd
0B92 EC32 F001 02349       call     check_busy
0B96 0E35      02350       movlw    0x35
0B98 EC05 F001 02351       call     write_lcd
0B9C 0012      02352       return
               02353       
               02354       
0B9E 02355 odejmij_512_od_wyniku_sredniej
               02356 
0B9E 0E02      02357          movlw    0x02
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0BA0 5FAA      02358          subwf    pomiarH,f
               02359          ;jezeli jest 0 to nic wiecej nie trzeba robic
               02360          
0BA2 B4D8      02361          btfsc    STATUS,Z
0BA4 EFD9 F005 02362          goto     wynik_to_po_prostu_L
               02363          
               02364        ;jezeli w wyniku nie ma bitu 7 to oznacza brak liczby ujemnej
0BA8 AFAA      02365        btfss      pomiarH,7
0BAA EFD9 F005 02366        goto       wynik_to_po_prostu_L
               02367        
               02368        
               02369        
               02370       ;w wyniku mamy np ff90 - brak 0
               02371       ;tego nie trzeba bo polecenie negf - działa z -1 przed zastosowaniem
               02372       ;decf  pomiarL,f
               02373       
               02374       ;przy odejmowaniu C jest normalnie ustawione
               02375       ;btfss STATUS,C
               02376       
               02377       ;ale to trzeba bo tak samo zadziała dla starszego bajtu, a on nie ma być -1
0BAE 2BAA      02378       incf  pomiarH,f
               02379       
               02380       ;zaznacz ze pisz minus
0BB0 8DA1      02381       bsf   markers3,napisz_minus
               02382       ;negf  pomiarL,f
               02383       ;negf  pomiarH,f
               02384 
0BB2 02385 wynik_to_po_prostu_L
0BB2 0012      02386       return
               02387 
               02388 
0BB4 02389 usrednianie_wartosci
               02390 ;oblicz srednia dzielac za pomoca ilosc probek pobieranych
               02391          
0BB4 51AF      02392         movf    jak_duzo_probek,w
               02393         
               02394         ;movwf   ktore_dzielenie_przez2
               02395         
               02396         
               02397         
               02398 
0BB6 6B9D      02399         clrf      wynik01
               02400         
0BB8 02401 petla_dzielenia
               02402                                                                     ; bcf     STATUS,C
               02403                                                                     ; call     dzielenie_przez_przesuwanie
               02404                                                                   ;mam na poczatku w ktore dzieleni_przez2 b'10000000'
               02405                                                                   ;po jednym dzieleniu mam b'01000000'
               02406                                                                     ; bcf       STATUS,C
               02407                                                                     ; rrcf     ktore_dzielenie_przez2,f
               02408                                                                     ; btfss   ktore_dzielenie_przez2,0
               02409                                                                     ; goto     petla_dzielenia
               02410                                                                      
               02411 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02412 
0BB8 51B2      02413       movf    usrednianie_przez_co_mnoze,w
0BBA 039C      02414       mulwf     wynik
               02415       
               02416       ;w PRODH jest wartość do wynik, a w ProdL do wynik01
0BBC 50F4      02417       movf        PRODH,w
0BBE 6F9C      02418       movwf       wynik
0BC0 50F3      02419       movf        PRODL,w
0BC2 6F9D      02420       movwf       wynik01
               02421       
0BC4 519B      02422       movf        wynikh,w
0BC6 E008      02423       bz          procedura_sumowania_wyniku
               02424       
0BC8 51B2      02425       movf      usrednianie_przez_co_mnoze,w
0BCA 039B      02426       mulwf     wynikh
               02427       
0BCC 50F4      02428       movf        PRODH,w
0BCE 6F9B      02429       movwf       wynikh
0BD0 50F3      02430       movf        PRODL,w
0BD2 279C      02431       addwf       wynik,f
               02432       ;jeżeli przekroczyłem bajt to zwiększ o 1
               02433       
0BD4 B0D8      02434       btfsc       STATUS,C
0BD6 2B9B      02435       incf        wynikh,f
               02436          
0BD8 02437 procedura_sumowania_wyniku
0BD8 519D      02438          movf     wynik01,w
0BDA 27AC      02439          addwf    pomiar_ulamek,f
               02440 ;jezeli przekroczono pomiarL
0BDC A0D8      02441          btfss    STATUS,C
0BDE EFF5 F005 02442          goto     nie_przekroczono_bajtu_ulamka
0BE2 0E01      02443          movlw    1
0BE4 27AB      02444          addwf    pomiarL,f
               02445 
               02446          
0BE6 B0D8      02447          btfsc    STATUS,C
0BE8 2BAA      02448          incf     pomiarH,f
               02449          
0BEA 02450 nie_przekroczono_bajtu_ulamka         
0BEA 519C      02451          movf     wynik,w
0BEC 27AB      02452          addwf    pomiarL,f
0BEE B0D8      02453          btfsc    STATUS,C
0BF0 2BAA      02454          incf     pomiarH,f
               02455         
0BF2 519B      02456          movf     wynikh,w
0BF4 27AA      02457          addwf    pomiarH,f
0BF6 0012      02458          return
               02459          
0BF8 02460 znow_kaz_mierzyc
               02461 
               02462 ;         bsf      STATUS,RP0
               02463  ;        bcf      STATUS,RP1
               02464 ;        movlw    0x1a
               02465   ;       bsf      PIE1,ADIE
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02466    ;      bcf      STATUS,RP0
               02467     ;     bsf      ADCON0,2 
               02468          ;clrf     TMR0L
               02469          ;bcf      INTCON,T0IF
               02470          ;bsf      INTCON,T0IE
               02471 IF (procek== 18f442)         
               02472          
               02473 ENDIF
               02474 IF (procek== 18f4320)         
               02475          
               02476 ENDIF
0BF8 82C2      02477          bsf      ADCON0,GO
0BFA 99A0      02478          bcf      markers2,wyslij_pomiar
               02479          
0BFC 0012      02480          return
               02481           
               02482 ;na koniec dodaj do pomiarH i pomiarL i pomiar_ulamek
               02483 
0BFE 02484 wysylanie_pomiaru
               02485 
               02486 ;jezeli na każdy pomiar wykonuje szereg pomiarów to nie wysyłaj jeszcze
0BFE 99A0      02487          bcf      markers2,wyslij_pomiar
0C00 A19F      02488          btfss    markers,czy_usrednianie
0C02 EF08 F006 02489          goto     zapisz_do_pamieci
               02490        
               02491 
0C06 ECDA F005 02492          call     usrednianie_wartosci
               02493 
0C0A 2FB0      02494          decfsz   ktora_probka,f
0C0C EFFC F005 02495          goto     znow_kaz_mierzyc
               02496          ;return        
0C10 02497 zapisz_do_pamieci
               02498 ;przed zapisem pomiaru w pamieci ulamki > 0x80 (tzn od 0.5 ) zamieniam na +1 do pomiarL 
               02499 ;w przeciwnym wypadku pomijam
               02500          ;movlw    0x81
               02501          ;subwf    pomiar_ulamek,w
               02502          ;btfss    STATUS,C
               02503          ;goto     zapisz_starszy
               02504          ;bcf      STATUS,C
               02505          ;movlw    1
               02506          ;addwf    pomiarL,f
               02507          ;btfsc    STATUS,C
               02508          ;incf     pomiarH,f
               02509 ;                                                              
               02510          
               02511          
               02512          
               02513          
0C10 B3A1      02514          btfsc    markers3,znacznik_pomiaru_pradu
0C12 EF83 F006 02515          goto     zapis_do_pamieci_prad
               02516          
0C16 02517 zapis_do_pamieci_temperatury  
               02518 
               02519                         ;                                         POPRAWKA temperatury
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 64


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0C16 6AE2      02520          clrf     FSR1H
0C18 0ECB      02521          movlw    poprawka0
               02522          
               02523          
               02524          ;ktora poprawka
0C1A 6EE1      02525          movwf    FSR1L
0C1C 51B1      02526          movf     ktory_kanal,w
0C1E 26E1      02527          addwf    FSR1L,f
0C20 50E7      02528          movf     INDF1,w
               02529          
               02530 
0C22 27AB      02531          addwf    pomiarL,f
               02532          
               02533          ;sprawdz czy poprawka jest ujemna
               02534       ;tzn czy jest zaznaczony bit 7
               02535       ;jezeli tak to nie sprawdzaj przekroczenia
0C24 BEE7      02536         btfsc     INDF1,7
0C26 EF17 F006 02537         goto      zapisz_do_pamieci_nie_sprawdzaj_przekroczenia
               02538          ;jezeli przekroczylem to
               02539          
0C2A B0D8      02540          btfsc    STATUS,C
0C2C 2BAA      02541          incf     pomiarH,f
               02542          
0C2E 02543 zapisz_do_pamieci_nie_sprawdzaj_przekroczenia
               02544                         ;koniec poprawiania wyniku o blad kanalu pomiarowego i skalowanie czujnika
               02545                         
               02546 ;dopiero teraz zamieniam na wartość -512                        
               02547 
               02548 
               02549 
               02550 ;jednak przed odjęciem 512 sprawdzam czy nie ustawiono przesylu do komputera
               02551 
0C2E 02552 zapisz_do_pamieci_czy_mam_send
0C2E A99F      02553          btfss       markers,czy_wysylac_pomiary_serial
0C30 EF33 F006 02554          goto        zapisz_do_pamieci_juz_po_SERIAL
               02555       
0C34 9882      02556          bcf      port_CTS,znacznik_CTS
               02557 
               02558                   
               02559          
               02560         
0C36 98AB      02561          bcf      RCSTA,CREN
               02562  
               02563          
0C38 ECAB F002 02564          call    sprawdz_czy_mozna_wysylac
               02565          
0C3C 51AA      02566          movf    pomiarH,w
0C3E 0F30      02567          addlw    0x30
0C40 6EAD      02568          movwf   TXREG
               02569            
0C42 ECAB F002 02570          call    sprawdz_czy_mozna_wysylac
               02571          
               02572         
0C46 39AB      02573          swapf    pomiarL,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 65


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0C48 0B0F      02574          andlw    0x0f
0C4A ECFC F002 02575          call     zamien_na_hex
0C4E 6EAD      02576          movwf   TXREG
               02577          
               02578          
0C50 ECAB F002 02579          call    sprawdz_czy_mozna_wysylac
               02580          
0C54 51AB      02581          movf     pomiarL,w
0C56 0B0F      02582          andlw    0x0f
0C58 ECFC F002 02583          call     zamien_na_hex
0C5C 6EAD      02584          movwf   TXREG     
               02585          
               02586 
0C5E ECAB F002 02587          call    sprawdz_czy_mozna_wysylac
               02588          
0C62 0E2C      02589          movlw    _przecinek
               02590         
0C64 6EAD      02591          movwf   TXREG     
               02592          
               02593 
0C66 02594 zapisz_do_pamieci_juz_po_SERIAL        
               02595           ;                                         teraz odejmuje od starszego bajtu 0x02 
0C66 ECCF F005 02596          call     odejmij_512_od_wyniku_sredniej
               02597         
               02598         
0C6A 0EB6      02599          movlw    pomiar0H
0C6C 6EE1      02600          movwf    FSR1L
               02601                   
0C6E 51B1      02602          movf     ktory_kanal,w
0C70 26E1      02603          addwf    FSR1L,f
0C72 26E1      02604          addwf    FSR1L,f
               02605                   
0C74 51AA      02606          movf     pomiarH,w         
0C76 6EE7      02607          movwf    INDF1
               02608                               ;IF (czy_pomiary_na_ekran==1)  
               02609                               ;sprawdz czy mam wyswietlac 
               02610                               ;jezeli wszedlem do menu ekranu to nie wyswietlam temperatur
               02611                                     
               02612                                     ; btfss      markers,czy_wyswietlam_temp
               02613                                     ; goto        bez_wyswietlania_temp1
               02614 
               02615                                     
               02616                               ;         movf     INDF1,w
               02617                                        ;tu wlaczam procedurę zamiany szesnastkowej wartości na dziesiętną liczbę
               02618                                        
               02619                                        
               02620                                ;        addlw    0x30
               02621                                 ;       call     write_lcd
               02622                                  ;      incf     linia2,f
               02623                               ;ENDIF         
               02624 
0C78 02625 bez_wyswietlania_temp1
0C78 2AE1      02626          incf     FSR1L,f
0C7A 51AB      02627          movf     pomiarL,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 66


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02628                   
0C7C 6EE7      02629          movwf    INDF1
               02630 IF (czy_pomiary_na_ekran==1)   
               02631 
0C7E AB9F      02632       btfss      markers,czy_wyswietlam_temp
0C80 EF81 F006 02633       goto        bez_wyswietlania_temp2
               02634       
               02635             
               02636       ;sprawdz czy rejestr linia2 > 13
0C84 0E0C      02637       movlw       0x0c
               02638       ; sprawdzam                  rejestr > W
0C86 6187      02639       cpfslt      linia2      
0C88 6B87      02640       clrf        linia2
               02641       
               02642       
0C8A 02643 nie_czysc_rejestru_polozenia  
               02644   ;temperatury 0-3 na ekranie sa wyswietlane jezeli niezaznaczono bitu markers3,pokazuje_temperatury_47
               02645       ;aby to sprawdzic dokonuje operacji odjecia od 3 - ktory_kanal
               02646       
0C8A 0E04      02647       movlw       0x04
               02648       ; sprawdzam                  rejestr > W
0C8C 61B1      02649       cpfslt        ktory_kanal
0C8E EF52 F006 02650       goto          sprawdz_czy_mam_wyswietlac_47       
               02651  
               02652       ;jezeli wynik wskazuje na pomiary na kanale 0 - 3 to sprawdz czy nie wlaczony jest bit 
               02653       
0C92 BFA1      02654       btfsc       markers3,pokazuje_temperatury_47
0C94 EF81 F006 02655       goto        bez_wyswietlania_temp2
               02656       
0C98 0E01      02657       movlw 1
               02658       ;bit      0-1 ida na linie 2  -> 00000011
               02659       ; ktory_kanal   > 1 to na linii3
0C9A 65B1      02660       cpfsgt  ktory_kanal
0C9C EF63 F006 02661       goto         ustaw_linie_druga
               02662       ;jezeli kanal 2-3
0CA0 EF5B F006 02663       goto        ustaw_linie_trzecia
               02664             
               02665       
0CA4 02666 sprawdz_czy_mam_wyswietlac_47
               02667  ;jezeli wyswietlam kanal 4 -7
               02668  ; i zaznaczono ten bit tzn ze mam teraz kanal 4, ktory mam wyswietlac na ekranie (pomiary czujnikow 4-7)
               02669  
0CA4 AFA1      02670       btfss       markers3,pokazuje_temperatury_47
0CA6 EF81 F006 02671       goto        bez_wyswietlania_temp2
               02672       
0CAA 0E05      02673       movlw 5
               02674       ;bit      0-1 ida na linie 2  -> 00000011
               02675       ; ktory_kanal   > 5 to na linii3
0CAC 65B1      02676       cpfsgt  ktory_kanal
0CAE EF63 F006 02677       goto         ustaw_linie_druga
               02678       ;jezeli kanal ma wartosc 6-7
0CB2 EF5B F006 02679       goto        ustaw_linie_trzecia
               02680       
               02681       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 67


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0CB6 02682 ustaw_linie_trzecia
0CB6 EC32 F001 02683       call     check_busy
0CBA 0E90      02684          movlw    linia_trzecia
0CBC 2587      02685          addwf    linia2,w
0CBE ECF4 F000 02686          call      send      
0CC2 EF6B F006 02687          goto     napisz_wartosc_temperatury
               02688       
0CC6 02689 ustaw_linie_druga      
0CC6 EC32 F001 02690       call     check_busy
0CCA 0EC0      02691          movlw    linia_dolna
0CCC 2587      02692          addwf    linia2,w
0CCE ECF4 F000 02693          call      send
0CD2 EF6B F006 02694          goto     napisz_wartosc_temperatury
               02695          
               02696  
               02697          ;call     check_busy      
               02698          ;call     check_busy
               02699          ;swapf    INDF1,w
               02700          ;andlw    0x0f
               02701          ;call     zamien_na_hex
               02702                          
               02703          ;call     write_lcd
               02704          
               02705          ;call     check_busy
               02706          ;movf     INDF1,w
               02707          ;andlw    0x0f
               02708          ;call     zamien_na_hex
               02709          ;call     write_lcd
               02710          ;call     check_busy
               02711          ;movlw    _puste
               02712          ;call     write_lcd
               02713          
               02714          
               02715          
0CD6 02716 napisz_wartosc_temperatury         
0CD6 50E7      02717       movf        INDF1,w
0CD8 6F92      02718       movwf       tmp_hex
               02719       
0CDA 06E1      02720       decf        FSR1L,f ; - FSR1L pokazuje teraz wartosc starszego bajtu liczby zamienianej
0CDC 50E7      02721       movf        INDF1,w
               02722       
0CDE 6F93      02723       movwf       tmp_hex_H
               02724       
0CE0 BDA1      02725       btfsc       markers3,napisz_minus
0CE2 6D92      02726       negf        tmp_hex
               02727       
0CE4 BDA1      02728       btfsc       markers3,napisz_minus
0CE6 6D93      02729       negf        tmp_hex_H
               02730       
0CE8 5192      02731       movf        tmp_hex,w
               02732       ;dziele przez 4
0CEA 0D40      02733       mullw       0x40
               02734       
0CEC 50F3      02735       movf        PRODL,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 68


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0CEE 6F9D      02736       movwf       wynik01
               02737       
               02738       ;temperatura jest w bajcie starszym
0CF0 50F4      02739       movf        PRODH,w
0CF2 6F92      02740       movwf       tmp_hex
               02741       
0CF4 ECEE F001 02742          call     hex2dec18
               02743          
0CF8 EC5B F005 02744          call     wyswietl_cyfry_temperatury
               02745          
               02746          ;call     check_busy
               02747          ;movlw    _linia_pionowa
               02748          
               02749          ;call     write_lcd
0CFC 9DA1      02750          bcf      markers3,napisz_minus
0CFE 0E08      02751          movlw    8
               02752          
0D00 2787      02753          addwf     linia2,f
               02754          ;bcf      markers3,pokazuje_temperatury_47
               02755 ENDIF         
               02756 
0D02 02757 bez_wyswietlania_temp2
               02758 
0D02 EFC3 F006 02759       goto  procedura_regulacji_dwustawnej
               02760       
0D06 02761 zapis_do_pamieci_prad
0D06 6AE2      02762       clrf     FSR1H
0D08 0ED3      02763       movlw    poprawka_prad1
               02764          
               02765          ;ktora poprawka
0D0A 6EE1      02766          movwf    FSR1L
0D0C 05D6      02767          decf     ktory_aktualnie_kanal_pradu,w
0D0E 26E1      02768          addwf    FSR1L,f
0D10 50E7      02769          movf     INDF1,w
0D12 27AB      02770          addwf    pomiarL,f
               02771          ;jezeli przekroczylem to
0D14 B0D8      02772          btfsc    STATUS,C
0D16 2BAA      02773          incf     pomiarH,f
               02774         ;movwf     
               02775 
               02776                   
0D18 0EC6      02777          movlw    pomiar_prad1H        
0D1A 6EE1      02778          movwf    FSR1L
               02779                   
0D1C 05D6      02780          decf     ktory_aktualnie_kanal_pradu,w
0D1E 26E1      02781          addwf    FSR1L,f
0D20 26E1      02782          addwf    FSR1L,f
               02783                   
0D22 51AA      02784          movf     pomiarH,w         
0D24 6EE7      02785          movwf    INDF1 
               02786 IF (czy_pomiary_na_ekran==1)  
               02787 ;sprawdz czy mam wyswietlac 
               02788 ;jezeli wszedlem do menu ekranu to nie wyswietlam temperatur
               02789       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 69


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0D26 AB9F      02790       btfss      markers,czy_wyswietlam_temp
0D28 EFA3 F006 02791       goto        bez_wyswietlania_pradu
               02792 
0D2C EC32 F001 02793       call     check_busy
0D30 0ED0      02794          movlw    linia_czwarta
0D32 2589      02795          addwf    linia4,w
0D34 ECF4 F000 02796          call      send
               02797          
               02798          
               02799  
0D38 EC32 F001 02800          call     check_busy
0D3C 50E7      02801          movf     INDF1,w
               02802          ;tu wlaczam procedurę zamiany szesnastkowej wartości na dziesiętną liczbę
               02803          
               02804          
0D3E 0F30      02805          addlw    0x30
0D40 EC05 F001 02806          call     write_lcd
0D44 2B89      02807          incf     linia4,f
               02808 ENDIF         
               02809 
0D46 02810 bez_wyswietlania_pradu
               02811 
               02812          
0D46 2AE1      02813       incf     FSR1L,f
0D48 51AB      02814       movf     pomiarL,w
               02815                   
0D4A 6EE7      02816       movwf    INDF1    
               02817       
               02818 IF (czy_pomiary_na_ekran==1)
               02819 
0D4C AB9F      02820       btfss      markers,czy_wyswietlam_temp
0D4E EFC1 F006 02821       goto        bez_wyswietlania_pradu2
               02822        
0D52 EC32 F001 02823          call     check_busy
0D56 38E7      02824          swapf    INDF1,w
0D58 0B0F      02825          andlw    0x0f
0D5A ECFC F002 02826          call     zamien_na_hex
               02827                          
0D5E EC05 F001 02828          call     write_lcd
               02829          
0D62 EC32 F001 02830          call     check_busy
0D66 50E7      02831          movf     INDF1,w
0D68 0B0F      02832          andlw    0x0f
0D6A ECFC F002 02833          call     zamien_na_hex
0D6E EC05 F001 02834          call     write_lcd
0D72 EC32 F001 02835          call     check_busy
0D76 0E20      02836          movlw    _puste
0D78 EC05 F001 02837          call     write_lcd
0D7C 2B89      02838          incf     linia4,f
0D7E 2B89      02839          incf     linia4,f
0D80 2B89      02840          incf     linia4,f
               02841 ENDIF       
               02842 
0D82 02843 bez_wyswietlania_pradu2
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 70


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02844       
0D82 EF01 F007 02845       goto     sprawdz_czy_mam_dalej_mierzyc_prad
               02846       
0D86 02847 procedura_regulacji_dwustawnej         
               02848       
               02849 ;jezeli ostatni kanal to wyslij wszystkie, jezeli nie ostatni to zmierz kolejny
0D86 ADA0      02850          btfss    markers2,reguluj
0D88 EFF8 F006 02851          goto     sprawdz_czy_mam_dalej_mierzyc
               02852 ;jezeli mierze prad to nic nie sprawdzaj
               02853 
               02854      
               02855 ;porownaj wartosc pomierzona z zadana
               02856                   
               02857 
               02858 ;regulacja z 0 kanalu
               02859          
               02860          ;movf        ktory_kanal,w
               02861          ;xorlw         0         
               02862          ;btfsc          STATUS,Z
0D8C 51E9      02863          movf    ktory_czujnik_reguluje,w
0D8E 63B1      02864          cpfseq   ktory_kanal
0D90 EFF8 F006 02865          goto           sprawdz_czy_mam_dalej_mierzyc
               02866          
               02867                   ;tu musze poprawic prace regulatora
               02868          
               02869          ;chodzi o to zeby wlaczal moc kiedy temperatura spadnie ponizej temperatury zadanej - histereza
               02870          
               02871          
               02872          ;tzn jezeli moc jest wylaczona
               02873          
               02874          ;to wlacz dopiero kiedy temperatura osiagnie wartosc t min
               02875          
               02876          
               02877          ; czy moc jest teraz wlaczona?
               02878          
               02879          ;btfsc    
               02880 
               02881          
               02882          
0D94 51AD      02883          movf     jaka_wartosc_regulujeH,w
               02884          ;pomiarh - jaka_wartosc_regulujeH
0D96 5DAA      02885          subwf    pomiarH,w
               02886 ;sprawdz czy to samo czy wieksze
0D98 B4D8      02887          btfsc    STATUS,Z
0D9A EFD9 F006 02888          goto     sa_rowne_sprawdz_Lbajt
0D9E A0D8      02889          btfss    STATUS,C 
0DA0 EFD5 F006 02890          goto     zalacz_grzanie
               02891 ;tzn reguluj<pomiaru w starszym bajcie wiec wylacz grzanie
0DA4 8FA0      02892          bsf      markers2,wylacz_moc
0DA6 EFF8 F006 02893          goto     sprawdz_czy_mam_dalej_mierzyc
               02894          
0DAA 02895 zalacz_grzanie    
               02896 ;jezeli jakikolwiek pomiar wykazal ze trzeba wylaczyc to nie wlaczaj grzania
               02897 ;        
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 71


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0DAA AFA0      02898          btfss    markers2,wylacz_moc
0DAC 8BA0      02899          bsf      markers2,zalacz_moc
               02900          
0DAE EFF8 F006 02901          goto     sprawdz_czy_mam_dalej_mierzyc
               02902 
               02903                            
0DB2 02904 sa_rowne_sprawdz_Lbajt
               02905 ;tak samo
               02906          ;movf     histereza,w
               02907          ;sprawdz czy moc wylaczona - jezeli tak to wlacz 1  stopien nizej czyli 4 nizej
               02908 ;jezeli jest wlaczona energia to dodaj wartosc histerezy tj wylacza pozniej
               02909          ;btfsc    latch_moc,lampka2
0DB2 B081      02910          btfsc    port_triak,triak1
0DB4 EFE8 F006 02911          goto     regulacja_dwu_moc_ON
               02912          
               02913          
0DB8 02914 regulacja_dwu_moc_OFF         
               02915          ;jeżeli moc jest wyłączona w tej chwili to włącz ją dopiero gdy 
               02916          ;pomiar będzie mniejszy niż temperatura zadana 
               02917          
               02918          ;histereza dolna
0DB8 51E7      02919          movf     histereza2,w
0DBA 5DAE      02920          subwf     jaka_wartosc_regulujeL,w
               02921              
               02922          
0DBC 5DAB      02923          subwf    pomiarL,w
               02924 ;sprawdz czy to samo czy wieksze
0DBE B4D8      02925          btfsc    STATUS,Z
0DC0 EFD5 F006 02926          goto     zalacz_grzanie
               02927          
               02928          
               02929 ; jeżeli po odjęciu nie ma C w Statusie, tzn że pomiarL < pomiaru-histerezy
               02930          
0DC4 A0D8      02931          btfss    STATUS,C 
0DC6 EFD5 F006 02932          goto     zalacz_grzanie
               02933 ;tzn reguluj>pomiaru w mlodszym bajcie wiec wlacz grzanie
0DCA 8FA0      02934          bsf      markers2,wylacz_moc
0DCC EFF8 F006 02935          goto     sprawdz_czy_mam_dalej_mierzyc
               02936          
               02937          
0DD0 02938 regulacja_dwu_moc_ON
               02939          ;jeżeli moc jest włączona w tej chwili to wyłącz ją dopiero gdy 
               02940          ;pomiar będzie większy niż temperatura zadana + histereza zadana
               02941          
               02942          ;histereza górna
0DD0 51E6      02943          movf     histereza1,w
0DD2 25AE      02944          addwf    jaka_wartosc_regulujeL,w
               02945          
               02946          ; w WREG jest wartosc  histereza + ustawienie wartosci regulacji
               02947          
               02948        
0DD4 5DAB      02949          subwf    pomiarL,w  
               02950          ;w WREG  jest wartosc   pomiarL  -  (histereza + ustawienie wartosci )
               02951 ;sprawdz czy to samo czy wieksze
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 72


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0DD6 B4D8      02952          btfsc    STATUS,Z
0DD8 EFF1 F006 02953          goto     regulacja_dwu_moc_ON_wylacz
               02954 
               02955          
               02956          
               02957          ;C pojawia sie tylko gdy 
               02958          
0DDC A0D8      02959          btfss    STATUS,C 
0DDE EFD5 F006 02960          goto     zalacz_grzanie
               02961 ;tzn reguluj<pomiaru w mlodszym bajcie wiec wylacz grzanie
               02962 
0DE2 02963 regulacja_dwu_moc_ON_wylacz
0DE2 8FA0      02964          bsf      markers2,wylacz_moc
0DE4 EFF8 F006 02965          goto     sprawdz_czy_mam_dalej_mierzyc                         
0DE8 02966 sa_rowne_nic_nie_rob
0DE8 EFD5 F006 02967          goto     zalacz_grzanie    
0DEC EFF8 F006 02968          goto     sprawdz_czy_mam_dalej_mierzyc       
               02969 
0DF0 02970 sprawdz_czy_mam_dalej_mierzyc
               02971 ;sprawdzam tu czy mam wykonac pomiary dla kolejnego 
               02972 ;kanalu
               02973 ;tu czyszcze zawartosc rejestrow pomiaru
0DF0 6BAA      02974          clrf     pomiarH
0DF2 6BAB      02975          clrf     pomiarL
0DF4 6BAC      02976          clrf     pomiar_ulamek
               02977          
               02978          
0DF6 2FA6      02979          decfsz   ktory_kanal_mierze,f
0DF8 EF6B F007 02980          goto     zmierz_nastepny_czujnik_temperatury
               02981 
               02982 ;zmierz jeszcze prady          
               02983          
0DFC A1A1      02984          btfss    markers3,pomiary_pradu
0DFE EF0B F007 02985          goto     wykonano_pomiary_wszystkich_kanalow
               02986         
               02987         ;jeszcze mierze prady jezeli ustawiono bit pomiary_pradu
               02988          
0E02 02989 sprawdz_czy_mam_dalej_mierzyc_prad
               02990 
               02991          ;sprawdz czy rejestr przechowujący aktualne wskazanie mierzonej temperatury nie wskazuje 0
0E02 51D6      02992          movf     ktory_aktualnie_kanal_pradu,w;zwiększam o jeden żeby skala obydwu rejestrów była identyczna
               02993          
0E04 19D5      02994          xorwf    jak_duzo_kanalow_pradu,w
               02995          ;jezeli 0 tzn ze juz zmierzylem co trzeba
0E06 B4D8      02996          btfsc    STATUS,Z
0E08 EF0B F007 02997          goto     wykonano_pomiary_wszystkich_kanalow
               02998          
               02999       ;wlaczam pomiar pradu na 1 kanale
               03000       
               03001       ;do kanalu aktualnego trzeba dodać 8*2 by uzyskac kanal pradowy
               03002       ;bo aby zmierzyc 1 kanal pradu to z AN0 przeskok do AN2
               03003       ;z kanalu AN2 do AN4
               03004       
0E0C 0E08      03005       movlw    8
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 73


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03006             
0E0E 26C2      03007       addwf   ADCON0,f
0E10 2BD6      03008       incf     ktory_aktualnie_kanal_pradu,f
               03009       ;movlw    b'00111100'
               03010       ;andwf    ADCON0,w
0E12 EF66 F007 03011       goto  zmierz_prad
               03012       
               03013       ;goto     zmierz_nastepny_czujnik_temperatury   
               03014          
0E16 03015 wykonano_pomiary_wszystkich_kanalow
               03016 ;jezeli juz skonczylem wszystkie mierzyc to sprawdz czy mam wlaczyc grzanie
               03017 ;jezeli ustawiono bit o nie wlaczaniu to olej
0E16 ADA0      03018          btfss    markers2,reguluj
0E18 EF1B F007 03019          goto     koniec_mierzenia
               03020          
0E1C BFA0      03021          btfsc    markers2,wylacz_moc
0E1E EF18 F007 03022          goto    wylaczam_moc
               03023          
0E22 ABA0      03024          btfss    markers2,zalacz_moc
0E24 EF18 F007 03025          goto    wylaczam_moc
               03026          
0E28 A081      03027          btfss    port_triak,triak1
0E2A 8081      03028          bsf      port_triak,triak1
               03029          
0E2C EF19 F007 03030          goto    koncz_z_moca
0E30 03031 wylaczam_moc
0E30 9081      03032          bcf      port_triak,triak1
               03033          
0E32 03034 koncz_z_moca
0E32 9BA0      03035          bcf      markers2,zalacz_moc
0E34 9FA0      03036          bcf      markers2,wylacz_moc
               03037          
               03038          
               03039          
               03040          
               03041                                                 ;juz wszystkie kanaly i wysylaj pomiary
0E36 03042 koniec_mierzenia
               03043 
               03044  
               03045 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;koniec wysylania pomiarow 
               03046 
               03047 
               03048 
               03049 
               03050          ;jezeli mierzylem prady to sprawdz to, maxymalnie dwa prady podaje
0E36 A1A1      03051          btfss    markers3,pomiary_pradu
0E38 EF56 F007 03052          goto     juz_wysylac_znak_LF
               03053          
0E3C 03054 sprawdz_RTS_prad
               03055          ;btfss    port_RTS,znacznik_RTS
               03056          ;goto     sprawdz_RTS_prad
               03057       
               03058       ;jak duzo mialem mierzyc pradow
0E3C ECAB F002 03059          call    sprawdz_czy_mozna_wysylac
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 74


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0E40 0E69      03060          movlw    _i
               03061         
0E42 6EAD      03062          movwf   TXREG    
0E44 ECAB F002 03063          call    sprawdz_czy_mozna_wysylac
               03064          
               03065          
               03066          
0E48 51C6      03067          movf     pomiar_prad1H,w
0E4A 0F30      03068          addlw    0x30
0E4C 6EAD      03069          movwf   TXREG        
               03070          
0E4E ECAB F002 03071          call    sprawdz_czy_mozna_wysylac
               03072          
0E52 39C7      03073          swapf     pomiar_prad1L,w
0E54 0B0F      03074          andlw    0x0f
0E56 ECFC F002 03075          call     zamien_na_hex
0E5A 6EAD      03076          movwf   TXREG
               03077                   
0E5C ECAB F002 03078          call    sprawdz_czy_mozna_wysylac
               03079          
0E60 51C7      03080          movf    pomiar_prad1L,w
0E62 0B0F      03081          andlw    0x0f
0E64 ECFC F002 03082          call     zamien_na_hex
0E68 6EAD      03083          movwf   TXREG   
               03084          
0E6A ECAB F002 03085          call    sprawdz_czy_mozna_wysylac
               03086          
               03087          ;czy mialem mierzyc dwa prady czy tylko 1
               03088          ;movf     jak_duzo_kanalow_pradu,w
               03089          ;xorlw    2
               03090          ;btfss    STATUS,Z   
               03091          ;goto     juz_wysylac_znak_LF 
               03092 
               03093          
               03094          
0E6E 0E2C      03095          movlw    _przecinek
               03096         
0E70 6EAD      03097          movwf   TXREG    
0E72 ECAB F002 03098          call    sprawdz_czy_mozna_wysylac
               03099          
0E76 0E69      03100          movlw    _i
               03101         
0E78 6EAD      03102          movwf   TXREG    
0E7A ECAB F002 03103          call    sprawdz_czy_mozna_wysylac
               03104          
0E7E 51C8      03105          movf     pomiar_prad2H,w
0E80 0F30      03106          addlw    0x30
0E82 6EAD      03107          movwf   TXREG        
               03108          
0E84 ECAB F002 03109          call    sprawdz_czy_mozna_wysylac
               03110          
0E88 39C9      03111          swapf     pomiar_prad2L,w
0E8A 0B0F      03112          andlw    0x0f
0E8C ECFC F002 03113          call     zamien_na_hex
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 75


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0E90 6EAD      03114          movwf   TXREG
               03115                   
0E92 ECAB F002 03116          call    sprawdz_czy_mozna_wysylac
               03117          
0E96 51C9      03118          movf    pomiar_prad2L,w
0E98 0B0F      03119          andlw    0x0f
0E9A ECFC F002 03120          call     zamien_na_hex
0E9E 6EAD      03121          movwf   TXREG     
0EA0 ECAB F002 03122          call    sprawdz_czy_mozna_wysylac
               03123          
0EA4 0E2C      03124           movlw    _przecinek
               03125         
0EA6 6EAD      03126          movwf   TXREG    
0EA8 ECAB F002 03127          call    sprawdz_czy_mozna_wysylac
               03128          
               03129 ;jezeli moc zalaczona wyslij 1,
               03130 ;jezeli wylaczona wyslik 0,
               03131          
               03132          ;call    sprawdz_czy_mozna_wysylac
               03133          
               03134          ;btfsc    portlampka2,lampka2
               03135          ;movlw    0x31
               03136          
               03137          ;btfss    portlampka2,lampka2
               03138          ;movlw    0x30
               03139          
0EAC 03140 juz_wysylac_znak_LF         
               03141          ;movwf   TXREG
               03142          ;wysylam znak konca linii
0EAC ECAB F002 03143          call    sprawdz_czy_mozna_wysylac
0EB0 0E0A      03144          movlw    znak_lf
0EB2 6EAD      03145          movwf   TXREG
               03146          
0EB4 88AB      03147          bsf      RCSTA,CREN 
0EB6 0000      03148          nop
0EB8 0000      03149          nop
               03150          
0EBA 8882      03151          bsf      port_CTS,znacznik_CTS
               03152          
               03153          
0EBC 03154 koniec_pomiarow
               03155 
0EBC 6BAA      03156          clrf     pomiarH
0EBE 6BAB      03157          clrf     pomiarL
0EC0 6BAC      03158          clrf     pomiar_ulamek
               03159 
0EC2 859F      03160          bsf      markers,pomiary_zrobione
0EC4 99A0      03161          bcf      markers2,wyslij_pomiar
0EC6 93A1      03162          bcf   markers3,znacznik_pomiaru_pradu
0EC8 6B89      03163          clrf     linia4
0ECA 0012      03164          return         
               03165  
               03166 
0ECC 03167 zmierz_prad
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 76


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0ECC 51AF      03168       movf     jak_duzo_probek,w
0ECE 6FB0      03169       movwf    ktora_probka
0ED0 83A1      03170       bsf   markers3,znacznik_pomiaru_pradu
0ED2 EF7D F007 03171       goto     zmierz_nastepny_nie_3
               03172       
0ED6 03173 zmierz_nastepny_czujnik_temperatury
               03174 ;tzn kanal analogowy ten sam, ale zmienia sie ustawienie multipleksera
0ED6 2BB1      03175       incf     ktory_kanal,f
0ED8 51AF      03176       movf     jak_duzo_probek,w
0EDA 6FB0      03177       movwf    ktora_probka
               03178       ;movf     port_multiplekser,w
               03179 ;czyszcze aktualne ustawienia 
               03180 ;jezeli byl tu b'01010001'     
               03181       ;andlw    b'11111000'
               03182 ;w wyniku mamy b'01010000'      
               03183       ;addwf    ktory_kanal,w
0EDC 2A8B      03184       incf  latch_multiplekser,f
               03185       ;movwf    latch_multiplekser   
0EDE EF7D F007 03186       goto     zmierz_nastepny_nie_3
               03187       
0EE2 03188 zmierz_nastepny_kanal
               03189 ;zwiekaszam na kolejne wejscie  multipleksera
               03190             
0EE2 2BB1      03191          incf     ktory_kanal,f
0EE4 51AF      03192          movf     jak_duzo_probek,w
0EE6 6FB0      03193          movwf    ktora_probka
0EE8 50C2      03194          movf     ADCON0,w
               03195 ;musze zwiekszyc o jeden ten wycinek bitowy
               03196 ;b'xx000xxx' - czyli nawet nie starszy 4 bit
               03197 ;tylko cos w srodku
               03198 ;aby to zrobic stosuje prosty wybieg + 8 do ADCON0
               03199 
               03200 ;dla 18f4x20 mamy troszke zmian
               03201 ;ADCON0  wyglada ;b'xx0000xx'
               03202 IF (procek == 18f442)
               03203          addlw    8
               03204          movwf    ADCON0
               03205          movlw    b'00111000'
               03206          andwf    ADCON0,w
               03207          xorlw    b'00011000'
               03208          bnz      zmierz_nastepny_nie_3
               03209 ;drugi raz zwiekszam ADCON0 dla pominiecia 3 kanalu         
               03210          movlw    8
               03211          addwf    ADCON0,f
               03212 ENDIF
               03213 
               03214 IF (procek == 18f4320)
0EEA 0F04      03215          addlw    4
0EEC 6EC2      03216          movwf    ADCON0
0EEE 0E3C      03217          movlw    b'00111100'
0EF0 14C2      03218          andwf    ADCON0,w
0EF2 0A0C      03219          xorlw    b'00001100'
0EF4 E102      03220          bnz      zmierz_nastepny_nie_3
               03221 ;drugi raz zwiekszam ADCON0 dla pominiecia 3 kanalu         
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 77


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0EF6 0E04      03222          movlw    4
0EF8 26C2      03223          addwf    ADCON0,f
               03224 ENDIF
               03225          
0EFA 03226 zmierz_nastepny_nie_3
               03227 ;wlaczam pomiar i przerwanie
               03228          
0EFA 8C9D      03229          bsf      PIE1,ADIE
               03230          
               03231 ;rozpocznij pomiar      
               03232 ;wedlug opisu procka tu trzeba czekac okolo 20-30us  
               03233 ;dla pewnosci bede czekal 120us wykozystujac TMR2
               03234 ;czyszcze obecny TMR2
0EFC 6BAA      03235          clrf     pomiarH
0EFE 6BAB      03236          clrf     pomiarL
0F00 6BAC      03237          clrf     pomiar_ulamek
0F02 6AD6      03238          clrf     TMR0L
               03239 IF (procek == 18f442)
               03240          bcf      INTCON,T0IF
               03241          bsf      INTCON,T0IE
               03242 ENDIF
               03243 IF (procek == 18f4320)
0F04 94F2      03244          bcf      INTCON,TMR0IF
0F06 8AF2      03245          bsf      INTCON,TMR0IE
               03246 ENDIF
               03247          
               03248          ;clrf     TMR2
               03249          ;bsf    T2CON,TMR2ON
               03250         
               03251 ;tzn wlaczam przerwanie TMR2
               03252          ;bsf      STATUS,RP0
               03253          ;bsf     PIE1,TMR2IE
               03254          ;bcf      STATUS,RP0
               03255 ;przetestowanie czy dobry czas  
               03256 ;          bsf     PORTC,2         
0F08 99A0      03257          bcf      markers2,wyslij_pomiar
0F0A 0012      03258          return   
               03259     
               03260     
               03261     
               03262     
               03263     
               03264     
               03265     
               03266     
               03267 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;procedury klawiszy
0F0C 03268 wlacz_przerwanie_tmr3
               03269 
0F0C 92A0      03270       bcf   PIE2,TMR3IE
0F0E 6AB3      03271       clrf  TMR3H
0F10 6AB2      03272       clrf  TMR3L
0F12 92A1      03273       bcf   PIR2,TMR3IF
               03274       
0F14 82A0      03275       bsf   PIE2,TMR3IE
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 78


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03276 
0F16 0012      03277       return
               03278       
0F18 03279 wcisnieto_back
0F18 B9A1      03280       btfsc   markers3,wcisnieto_klawisz
0F1A 0012      03281       return
               03282       
0F1C 89A1      03283       bsf   markers3,wcisnieto_klawisz
0F1E 6B99      03284       clrf  stan_key
0F20 8199      03285       bsf   stan_key,mamy_back
               03286       
0F22 EF86 F007 03287       goto  wlacz_przerwanie_tmr3
               03288       
               03289       
               03290 
               03291       
               03292       
0F26 03293 wcisnieto_down
               03294 ;jeżeli zaznaczono że upłynął czas oczekiwania to wybierz procedurę zmiany      
0F26 B59E      03295       btfsc   znaczniki,czy_moge_juz_zmieniac
0F28 EFD8 F007 03296       goto  wykryto_down
               03297       
               03298       ;goto    wykryto_down_zmiana_opcji
               03299       
0F2C B9A1      03300       btfsc   markers3,wcisnieto_klawisz
0F2E 0012      03301       return
               03302       
0F30 89A1      03303       bsf   markers3,wcisnieto_klawisz
0F32 6B99      03304       clrf  stan_key
0F34 8399      03305       bsf   stan_key,mamy_down
               03306       
               03307       ;btfsc       pozycja_menu,zmiana_opcji
               03308       ;goto        sprawdz_czy_wlaczyc_szybka_zmiane
               03309       
0F36 EFB9 F007 03310       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03311       
0F3A EF86 F007 03312       goto  wlacz_przerwanie_tmr3
               03313 
               03314       
0F3E 03315 wcisnieto_up
0F3E B59E      03316       btfsc   znaczniki,czy_moge_juz_zmieniac
0F40 EF57 F009 03317       goto        wykryto_up
               03318       ;goto    wykryto_up_zmiana_opcji
               03319       
0F44 B9A1      03320       btfsc   markers3,wcisnieto_klawisz
0F46 0012      03321       return
               03322       
0F48 89A1      03323       bsf   markers3,wcisnieto_klawisz
0F4A 6B99      03324       clrf  stan_key
0F4C 8599      03325       bsf   stan_key,mamy_up
               03326       
               03327 ;jeżeli klawisz up wcisnieto w momencie gdy uzytkownik wybral juz zmiane wartosci
               03328       ;btfsc       pozycja_menu,zmiana_opcji
               03329       ;goto        sprawdz_czy_wlaczyc_szybka_zmiane
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 79


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03330       
0F4E EFB9 F007 03331       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03332       
0F52 EF86 F007 03333       goto        wlacz_przerwanie_tmr3
               03334       
0F56 03335 sprawdz_czy_wlaczyc_szybka_zmiane
               03336 ;jest w menu na pozycji     
               03337 ;opcja_odstep
               03338 ;opcja_ustaw_temp
               03339 
0F56 0E02      03340       movlw       opcja_odstep
0F58 63E1      03341       cpfseq      numer_opcji
0F5A EFB1 F007 03342       goto        sprawdz_czy_wlaczyc_szybka_zmiane2
               03343 
0F5E EFB9 F007 03344       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03345       
0F62 03346 sprawdz_czy_wlaczyc_szybka_zmiane2      
0F62 0E05      03347       movlw       opcja_ustaw_temp
0F64 63E1      03348       cpfseq      numer_opcji
0F66 EFB7 F007 03349       goto        sprawdz_czy_wlaczyc_szybka_zmiane3
               03350 
0F6A EFB9 F007 03351       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03352       
0F6E 03353 sprawdz_czy_wlaczyc_szybka_zmiane3
               03354       
0F6E EF86 F007 03355       goto  wlacz_przerwanie_tmr3
               03356  
0F72 03357 ustaw_sprawdzanie_szybkiej_zmiany
               03358 ;jak długo trzymam przycisk zanim zaczne zmieniac wartości
0F72 0E04      03359       movlw       dlugosc_oczekiwania_na_zmiane
0F74 6FE3      03360       movwf       szybka_zmiana_wartosci
               03361 ;zaznaczam że procedury sprawdzają zmianę opcji w czasie trzymania przycisku      
0F76 8F9F      03362       bsf         markers,trzymanie_klawisza
0F78 EF86 F007 03363       goto  wlacz_przerwanie_tmr3
               03364  
0F7C 03365 wcisnieto_enter
0F7C B9A1      03366       btfsc   markers3,wcisnieto_klawisz
0F7E 0012      03367       return
               03368       
0F80 89A1      03369       bsf   markers3,wcisnieto_klawisz
0F82 6B99      03370       clrf  stan_key
0F84 8799      03371       bsf   stan_key,mamy_enter
               03372       
0F86 EF86 F007 03373       goto  wlacz_przerwanie_tmr3
               03374 
               03375 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                BACK
0F8A 03376 wykryto_back
               03377       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz cofnij
               03378       
               03379       ;jezeli jestem w menu to wyswietl ponownie czas i temperatury
               03380       ;movf        pozycja_menu,w
               03381       ;bz         wykryto_back_nic_nie_rob
               03382       
               03383 ;jezeli pozycja menu jest różna od 0 to po nacisnieciu klawisza back
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 80


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03384 ;następuje powrót do ekranu z pomiarami temperatury oraz z zegarem systemowym
               03385 ;oraz z prądami
               03386       ;czyszczę wszystkie linie ekranu - polecenie clear display
0F8A EC32 F001 03387       call        check_busy
0F8E 0E01      03388       movlw       display_clear
0F90 ECF4 F000 03389       call        send
0F94 EC32 F001 03390       call        check_busy
               03391       
               03392       ;następnie włączam wyświetlanie czasu i temperatur
               03393 ;jeżeli znaczniki są ustawione to przy wyjściu
               03394       
0F98 B19E      03395       btfsc       znaczniki,czy_ponownie_wlaczyc_temp
0F9A 8B9F      03396       bsf         markers,czy_wyswietlam_temp
               03397       
0F9C B39E      03398       btfsc       znaczniki,czy_ponownie_wlaczyc_zegar
0F9E 85A1      03399       bsf         markers3,czy_zegar_wyswietlac
               03400       
0FA0 6BE0      03401       clrf       pozycja_menu
0FA2 6BE1      03402       clrf        numer_opcji
               03403       
0FA4 EFD4 F007 03404       goto  wykryto_back_exit
               03405       
               03406 
               03407      
               03408       ;jezeli w ekranie zegara to nic nie rob
               03409       
               03410       ;dla testow wyswietl na dole ekranu litere b
               03411       
               03412       
               03413 ; wykryto_back_pisz
               03414       ; call     write_lcd
0FA8 03415 wykryto_back_nic_nie_rob
0FA8 03416 wykryto_back_exit
0FA8 9BA1      03417       bcf   markers3,dzialanie_po_klawiszu
0FAA 6B99      03418       clrf  stan_key
0FAC EFF1 F00D 03419       goto  LOOP11
               03420       
               03421  
               03422 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                DOWN
0FB0 03423 wykryto_down
               03424       
               03425       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz cofnij
               03426       
0FB0 BFE0      03427       btfsc       pozycja_menu,zmiana_opcji
0FB2 EF4F F008 03428       goto        wykryto_down_zmiana_opcji
               03429       
               03430       ;jezeli jestem w menu to przeskocz na kolejną opcję gwiazdką
               03431       
               03432       
               03433       ;jezeli w ekranie zegara to pokaż kolejny zestaw czujników
0FB6 51E0      03434       movf        pozycja_menu,w
0FB8 E10A      03435       bnz         wykryto_down_sprawdz_czy_wyswietlam_kolejne_opcje
               03436 ;jezeli pozycja menu ==0 to po nacisnieciu klawisza zmien wskazania temperatury
               03437       ;najpierw czyść ekran
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 81


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0FBA EC32 F001 03438       call        check_busy
0FBE 0E01      03439       movlw       display_clear
0FC0 ECF4 F000 03440       call        send
0FC4 EC32 F001 03441       call        check_busy
0FC8 7FA1      03442       btg         markers3,pokazuje_temperatury_47
               03443       ;dla testow wyswietl na dole ekranu litere b
               03444       
0FCA EF4E F009 03445        goto        wykryto_down_exit
               03446       
0FCE 03447 wykryto_down_sprawdz_czy_wyswietlam_kolejne_opcje
               03448       
               03449       ; polozenie gwiazdki przechowuje liczbe wskazującą aktualny adres polozenia
               03450       ;gwiazdki w 
               03451       ;tablicy_gwiazdki
               03452       ;
               03453       
0FCE 0E1B      03454       movlw       HIGH tablica_gwiazdki
0FD0 6EF7      03455       movwf       TBLPTRH
               03456       
0FD2 0EA6      03457       movlw       LOW tablica_gwiazdki
0FD4 6EF6      03458       movwf       TBLPTRL
               03459       
               03460       ;poniewaz najpierw zmniejszam polozenie
0FD6 2BE2      03461       incf        polozenie_gwiazdki,f
0FD8 51E2      03462       movf       polozenie_gwiazdki,w
               03463       
0FDA 26F6      03464       addwf       TBLPTRL,f
               03465       
               03466        ;a nastepnie czytam z adresu tablica_gwiazdki + polozenie_gwiazdki to uzywam polecenia
0FDC 0008      03467       TBLRD *
               03468       
0FDE 0E01      03469       movlw       1
0FE0 62F5      03470       cpfseq      TABLAT
               03471 ;jezeli odczytano 1 tzn ze gwiazdka jest polozona na 
               03472 ; dole ekranu
               03473 ; i nalezy zmienic pozycje_menu oraz wyswietlic opcje menu z kolejnego ekranu
               03474 
0FE2 EF35 F008 03475       goto         wykryto_down_zmiana_polozenia_gwiazdki
               03476       ;polozenie_gwiazdki == 1
               03477       ;tzn opcje kolejnego ekranu sa wyswietlane
0FE6 0E01      03478       movlw       1
0FE8 6FE2      03479       movwf       polozenie_gwiazdki;znow na pierwszej linii
               03480       
               03481       ;numer opcji ulega zmianie na kolejny
0FEA 2BE1      03482       incf        numer_opcji,f
               03483       ;czyszczenie ekranu
0FEC EC32 F001 03484       call        check_busy
0FF0 0E01      03485       movlw       display_clear
0FF2 ECF4 F000 03486       call        send
0FF6 EC32 F001 03487       call        check_busy
               03488       
               03489       ;zaznaczam ze wyświetlam kolejny ekran opcji
               03490       
               03491       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 82


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03492       ;clrf        numer_opcji
               03493       
               03494       
               03495       ;call        check_busy
0FFA 0E80      03496       movlw       linia_gorna
               03497       
0FFC ECF4 F000 03498       call        send
1000 EC32 F001 03499       call        check_busy
               03500       
1004 0E2A      03501       movlw       _star
1006 EC05 F001 03502       call        write_lcd
100A EC32 F001 03503       call        check_busy      
               03504       
100E 90D8      03505       bcf         STATUS,C
1010 37E0      03506       rlcf       pozycja_menu,f
               03507       
               03508       ;btfsc       pozycja_menu,menu_opcje1
               03509       ;goto        wykryto_down_wyswietl_opcje_tablicy_jeden
               03510       
1012 B3E0      03511       btfsc       pozycja_menu,menu_opcje2
1014 EF1D F008 03512       goto        wykryto_down_wyswietl_opcje_tablicy_druga
               03513       
1018 B5E0      03514       btfsc       pozycja_menu,menu_opcje3
101A EF25 F008 03515       goto        wykryto_down_wyswietl_opcje_tablicy_trzy
               03516       
101E B7E0      03517       btfsc       pozycja_menu,menu_opcje4
1020 EF2D F008 03518       goto        wykryto_down_wyswietl_opcje_tablicy_cztery
               03519       
               03520       ;btfsc       pozycja_menu,menu_opcje_end ;(tj zaznaczono bit ekranu którego nie ma w tym wypadku są   ekrany bit 0 i 1,  2  a bit 3 oznacza ekran którego nie ma     )
               03521       ;goto        wykryto_down_wyswietl_opcje_tablicy_end
               03522       ;pisanie 
               03523       
               03524       
               03525       ;gdy wyświetlam opcje ekranu 1 - tzn gwiazdka byla na koncu opcji linii czwartej ekranu 2
1024 0E01      03526       movlw       1
1026 6FE1      03527       movwf       numer_opcji
1028 6FE0      03528       movwf       pozycja_menu
               03529       
102A 0E1B      03530       movlw       HIGH tablica_pierwsza
102C 6EF7      03531       movwf       TBLPTRH
               03532       
102E 0E00      03533       movlw       LOW tablica_pierwsza
1030 6EF6      03534       movwf       TBLPTRL
               03535       
1032 ECF8 F00A 03536       call        wyswietl_opcje_menu
               03537       
1036 EF4E F009 03538       goto        wykryto_down_exit
               03539       
               03540       
               03541       
103A 03542 wykryto_down_wyswietl_opcje_tablicy_druga
               03543       ;gdy wyświetlam opcje ekranu 2
103A 0E1B      03544       movlw       HIGH tablica_druga
103C 6EF7      03545       movwf       TBLPTRH
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 83


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03546       
103E 0E22      03547       movlw       LOW tablica_druga
1040 6EF6      03548       movwf       TBLPTRL
               03549       
               03550       
1042 ECF8 F00A 03551       call        wyswietl_opcje_menu
               03552       
1046 EF4E F009 03553       goto        wykryto_down_exit
               03554       
               03555 
               03556 
104A 03557 wykryto_down_wyswietl_opcje_tablicy_trzy
               03558       ;gdy wyświetlam opcje ekranu 3
104A 0E1B      03559       movlw       HIGH tablica_trzecia
104C 6EF7      03560       movwf       TBLPTRH
               03561       
104E 0E42      03562       movlw       LOW tablica_trzecia
1050 6EF6      03563       movwf       TBLPTRL
               03564       
               03565       
1052 ECF8 F00A 03566       call        wyswietl_opcje_menu
               03567       
1056 EF4E F009 03568       goto        wykryto_down_exit
               03569       
               03570       
               03571 ;wykryto_down_wyswietl_opcje_tablicy_end      
105A 03572 wykryto_down_wyswietl_opcje_tablicy_cztery      
105A 0E1B      03573       movlw       HIGH tablica_czwarta
105C 6EF7      03574       movwf       TBLPTRH
               03575       
105E 0E72      03576       movlw       LOW tablica_czwarta
1060 6EF6      03577       movwf       TBLPTRL
               03578       
1062 ECF8 F00A 03579       call        wyswietl_opcje_menu
               03580       
1066 EF4E F009 03581       goto        wykryto_down_exit
               03582       
106A 03583 wykryto_down_zmiana_polozenia_gwiazdki
               03584       ;opcje zmnieniaja się o tą położoną wyżej
106A 2BE1      03585       incf        numer_opcji,f
               03586       
               03587       ;nowa gwiazdka jest rysowana w miejscu odczytanym z tablicy
106C EC32 F001 03588       call     check_busy
1070 50F5      03589       movf        TABLAT,w
1072 ECF4 F000 03590       call        send
               03591       
1076 EC32 F001 03592       call     check_busy
               03593       
107A 0E2A      03594       movlw       _star
107C EC05 F001 03595       call        write_lcd
1080 EC32 F001 03596       call     check_busy
               03597       ;gwiazdka poprzednia jest kasowana - tzn znow czytam z tablicy ale tym razem polozenie poprzednie
               03598       
               03599       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 84


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1084 06F6      03600       decf        TBLPTRL,f
1086 0008      03601       TBLRD *
1088 50F5      03602       movf        TABLAT,w
108A ECF4 F000 03603       call        send
108E EC32 F001 03604       call     check_busy
1092 0E20      03605       movlw       _puste
1094 EC05 F001 03606       call        write_lcd
               03607       
1098 2AF6      03608       incf        TBLPTRL,f
               03609       
109A EF4E F009 03610       goto        wykryto_down_exit
               03611 
               03612       
109E 03613 wykryto_down_zmiana_opcji
109E 0E01      03614       movlw       opcja_czujniki
10A0 63E1      03615       cpfseq      numer_opcji
10A2 EF68 F008 03616       goto          wykryto_down_sprawdz_2
               03617       
               03618       ;jeżeli zmieniam ilość obsługiwanych czujników temp
               03619       ;to tu powinno być zmiana o 1 ilości kanałów 
               03620       ;i sprawdzenie czy nie przekroczyłem dopuszczalnych 8
               03621       
10A6 07A5      03622       decf        ile_kanalow,f
               03623       
10A8 0EFF      03624       movlw      0xff
               03625       
10AA 63A5      03626       cpfseq      ile_kanalow
10AC EF5A F008 03627       goto         wykryto_down_zmiana_opcji_wyswietl_kanaly
               03628       
10B0 0E08      03629       movlw       8
10B2 6FA5      03630       movwf       ile_kanalow
               03631       
10B4 03632 wykryto_down_zmiana_opcji_wyswietl_kanaly
10B4 EC32 F001 03633       call     check_busy
10B8 0E80      03634       movlw    linia_gorna
10BA 0F0C      03635       addlw       0xc
10BC ECF4 F000 03636       call      send
               03637       ;
10C0 EC32 F001 03638       call     check_busy
10C4 51A5      03639       movf        ile_kanalow,w
10C6 0F30      03640       addlw       0x30
10C8 EC05 F001 03641       call        write_lcd
               03642       
10CC EF4E F009 03643       goto        wykryto_down_exit
               03644       
10D0 03645 wykryto_down_sprawdz_2
10D0 0E02      03646       movlw       opcja_odstep
10D2 63E1      03647       cpfseq      numer_opcji
10D4 EF78 F008 03648       goto        wykryto_down_sprawdz_3
               03649 
10D8 07A7      03650       decf        odstep_pomiarowy,f
10DA 51A7      03651       movf        odstep_pomiarowy,w
10DC 6F92      03652       movwf       tmp_hex
10DE 6B93      03653       clrf        tmp_hex_H
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 85


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
10E0 6B98      03654       clrf        dec1
10E2 6B97      03655       clrf        dec10
10E4 ECEE F001 03656       call        hex2dec18
               03657 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03658       ;wyświetlam obok nazwy opcji czyli 
10E8 EC8E F00C 03659       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03660   
10EC EF4E F009 03661       goto        wykryto_down_exit
               03662       
10F0 03663 wykryto_down_sprawdz_3  
10F0 0E03      03664       movlw       opcja_srednia
10F2 63E1      03665       cpfseq      numer_opcji
10F4 EF99 F008 03666       goto        wykryto_down_sprawdz_4
               03667       
               03668       ;bsf      markers,czy_usrednianie
               03669       
               03670       ;sprawdz czy liczba próbek == 1
10F8 0E01      03671       movlw       0x1
10FA 63AF      03672       cpfseq      jak_duzo_probek
10FC EF84 F008 03673       goto        wykryto_down_sprawdz_3_zmniejsz_probki
               03674       ;zmieniam liczbe próbek na 0x80
1100 0E80      03675       movlw       0x80
1102 6FAF      03676       movwf       jak_duzo_probek
1104 EF8A F008 03677       goto        wykryto_down_3_wyswietl
               03678       
1108 03679 wykryto_down_sprawdz_3_zmniejsz_probki
               03680 ;dziele przez 2
1108 0E80      03681       movlw       0x80 
110A 03AF      03682       mulwf       jak_duzo_probek
110C 50F4      03683       movf        PRODH,w
110E 6FAF      03684       movwf       jak_duzo_probek
               03685       
1110 EC90 F003 03686       call     ustaw_wartosc_dzielenia_usredniania
               03687       
1114 03688 wykryto_down_3_wyswietl
               03689 ;sprawdz czy liczba próbek ==1
1114 919F      03690       bcf      markers,czy_usrednianie
               03691       
1116 0E01      03692       movlw       1
1118 63AF      03693       cpfseq      jak_duzo_probek
111A 819F      03694       bsf      markers,czy_usrednianie      
               03695       
111C 51AF      03696       movf        jak_duzo_probek,w
111E 6F92      03697       movwf       tmp_hex
1120 6B93      03698       clrf        tmp_hex_H
1122 6B98      03699       clrf        dec1
1124 6B97      03700       clrf        dec10
1126 ECEE F001 03701       call        hex2dec18
               03702 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03703       ;wyświetlam obok nazwy opcji czyli 
112A EC8E F00C 03704       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03705 
112E EF4E F009 03706       goto        wykryto_down_exit
               03707 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 86


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03708 
1132 03709 wykryto_down_sprawdz_4
               03710       
               03711       
1132 03712 wykryto_down_sprawdz_5
1132 0E05      03713       movlw       opcja_ustaw_temp
1134 63E1      03714       cpfseq      numer_opcji
1136 EFAD F008 03715       goto        wykryto_down_sprawdz_6
               03716       
               03717       ;wlacz pomiar pradu
               03718       ;jako test wlacz podswietlenie lub je wylacz
               03719       
               03720       ;btg   portlampka2,lampka2
               03721       
113A 07AE      03722       decf        jaka_wartosc_regulujeL,f
               03723       
113C B0D8      03724       btfsc       STATUS,C
113E EFA9 F008 03725       goto        wykryto_down_sprawdz_5_zero
               03726       ;jeżeli w H jest 0 to  umieść tam 1
1142 51AD      03727       movf       jaka_wartosc_regulujeH,w
1144 E004      03728       bz          wykryto_down_sprawdz_5_zawracanie
               03729       
1146 07AD      03730       decf        jaka_wartosc_regulujeH,f
               03731       
1148 A4D8      03732       btfss       STATUS,Z
114A EFA9 F008 03733       goto        wykryto_down_sprawdz_5_zero
114E 03734 wykryto_down_sprawdz_5_zawracanie
114E 0E01      03735       movlw       1
1150 6FAD      03736       movwf       jaka_wartosc_regulujeH
               03737       
1152 03738 wykryto_down_sprawdz_5_zero      
               03739                                                 ; movf        jaka_wartosc_regulujeL,w
               03740                                                 ; movwf       tmp_hex
               03741                                                 ; movf        jaka_wartosc_regulujeH,w
               03742                                                 ; movwf        tmp_hex_H
               03743                                                 ; clrf        dec1
               03744                                                 ; clrf        dec10
               03745                                                 ; call        hex2dec18
               03746 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03747       ;wyświetlam obok nazwy opcji czyli 
               03748                                                 ;call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03749       
               03750       
1152 ECA0 F00B 03751       call  wyswietl_temp_w_opcjach
               03752       
1156 EF4E F009 03753       goto        wykryto_down_exit
               03754       
115A 03755 wykryto_down_sprawdz_6
               03756       
115A 03757 wykryto_down_sprawdz_9
               03758 ;histereza górna
               03759 
115A 0E09      03760       movlw       opcja_histereza1
115C 63E1      03761       cpfseq      numer_opcji
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 87


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
115E EFBD F008 03762       goto        wykryto_down_sprawdz_10
               03763       
               03764       ;wlacz pomiar pradu
               03765       ;jako test wlacz podswietlenie lub je wylacz
               03766       
               03767       ;btg   portlampka2,lampka2
1162 07E6      03768       decf        histereza1,f
               03769       
1164 51E6      03770       movf        histereza1,w
1166 6F92      03771       movwf       tmp_hex
               03772       
1168 6B93      03773       clrf        tmp_hex_H
116A 6B98      03774       clrf        dec1
116C 6B97      03775       clrf        dec10
116E ECEE F001 03776       call        hex2dec18
               03777 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03778       ;wyświetlam obok nazwy opcji czyli 
1172 EC8E F00C 03779       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03780       
1176 EF4E F009 03781       goto        wykryto_down_exit     
               03782 
117A 03783 wykryto_down_sprawdz_10
               03784 ;histereza dolna
117A 0E0A      03785       movlw       opcja_histereza2
117C 63E1      03786       cpfseq      numer_opcji
117E EFCD F008 03787       goto        wykryto_down_sprawdz_11
               03788       
               03789       ;wlacz pomiar pradu
               03790       ;jako test wlacz podswietlenie lub je wylacz
               03791       
               03792       ;btg   portlampka2,lampka2
1182 07E7      03793       decf        histereza2,f
               03794       
1184 51E7      03795       movf        histereza2,w
1186 6F92      03796       movwf       tmp_hex
               03797       
1188 6B93      03798       clrf        tmp_hex_H
118A 6B98      03799       clrf        dec1
118C 6B97      03800       clrf        dec10
118E ECEE F001 03801       call        hex2dec18
               03802 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03803       ;wyświetlam obok nazwy opcji czyli 
1192 EC8E F00C 03804       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03805       
1196 EF4E F009 03806       goto        wykryto_down_exit     
               03807 
               03808 
               03809 
               03810 
               03811 
               03812 
119A 03813 wykryto_down_sprawdz_11
               03814 
               03815 ;czujnik regulatora
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 88


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03816 
119A 0E0B      03817       movlw       opcja_czujnik_regulacji
119C 63E1      03818       cpfseq      numer_opcji
119E EFE5 F008 03819       goto        wykryto_down_sprawdz12
               03820       
               03821       ;wlacz pomiar pradu
               03822       ;jako test wlacz podswietlenie lub je wylacz
               03823       
               03824       ;btg   portlampka2,lampka2
               03825       
11A2 51E9      03826       movf        ktory_czujnik_reguluje,w
11A4 A4D8      03827       btfss       STATUS,Z
11A6 EFD9 F008 03828       goto        wykryto_down_sprawdz11_nie_ma_zero
               03829       
11AA 0E07      03830       movlw       ilosc_czujnikow
               03831       
11AC 6FE9      03832       movwf       ktory_czujnik_reguluje
               03833       
11AE EFDA F008 03834       goto        wykryto_down_sprawdz11_show
11B2 03835 wykryto_down_sprawdz11_nie_ma_zero      
11B2 07E9      03836       decf        ktory_czujnik_reguluje,f
               03837       
               03838 
11B4 03839 wykryto_down_sprawdz11_show
11B4 51E9      03840       movf        ktory_czujnik_reguluje,w
11B6 6F92      03841       movwf       tmp_hex
               03842       
11B8 6B93      03843       clrf        tmp_hex_H
11BA 6B98      03844       clrf        dec1
11BC 6B97      03845       clrf        dec10
11BE ECEE F001 03846       call        hex2dec18
               03847 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03848       ;wyświetlam obok nazwy opcji czyli 
11C2 EC8E F00C 03849       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03850       
11C6 EF4E F009 03851       goto        wykryto_down_exit
               03852 
               03853 
               03854 
               03855 
11CA 03856 wykryto_down_sprawdz12
               03857 
               03858 
               03859 
               03860 
               03861 
               03862       
11CA 03863 wykryto_down_sprawdz_16
11CA 0E10      03864       movlw       opcja_ustaw_zegar
11CC 63E1      03865       cpfseq      numer_opcji
11CE EF4E F009 03866       goto        wykryto_down_sprawdz17
               03867       
               03868 ;sprawdzenie która wielkość zegara podlega zmianie
               03869 ;jeżeli dzien_10 to zmniejszam o jeden dzien_1
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 89


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03870 ;problem polega na tym, że nie mogę skorzystać z FSR2 bo  każda z wielkości
               03871 ;czasu musi być indywidualnie rozpatrywana
11D2 0ED7      03872       movlw       dzien_10
11D4 63E8      03873       cpfseq      ustawianie_czasu_co_wyswietlam
11D6 EF02 F009 03874       goto        wykryto_down_sprawdz_11_1
               03875 
               03876 ;jeżeli dzień_1 jest 0 (0x30) to jeżeli dzien_10 <> 0x30 zmniejsz dzien_10
               03877 
11DA 0E30      03878       movlw       0x30
11DC 63D8      03879       cpfseq      dzien_1
11DE EFFF F008 03880       goto        zmniejsz_dzien_1
               03881       
               03882       ;sprawdz czy dzien_10 == 0x30
11E2 0E30      03883       movlw       0x30
11E4 63D7      03884       cpfseq      dzien_10
11E6 EFFA F008 03885       goto        zapisz_do_dzien_1_99
               03886       
11EA 0E39      03887       movlw       0x39
11EC 6FD7      03888       movwf       dzien_10
11EE 6FD8      03889       movwf       dzien_1
               03890       
11F0 EF4A F009 03891       goto        wykryto_down_sprawdz_11_4
               03892       
11F4 03893 zapisz_do_dzien_1_99
11F4 0E39      03894       movlw       0x39
11F6 6FD8      03895       movwf       dzien_1
11F8 07D7      03896       decf        dzien_10,f
11FA EF4A F009 03897       goto        wykryto_down_sprawdz_11_4
               03898       
               03899       
11FE 03900 zmniejsz_dzien_1      
11FE 07D8      03901       decf        dzien_1,f
               03902       
               03903       
1200 EF4A F009 03904       goto        wykryto_down_sprawdz_11_4
               03905       
1204 03906 wykryto_down_sprawdz_11_1
1204 0ED9      03907       movlw       godziny_10
1206 63E8      03908       cpfseq      ustawianie_czasu_co_wyswietlam
1208 EF1C F009 03909       goto        wykryto_down_sprawdz_11_2
               03910       
120C 0E30      03911       movlw       0x30
120E 63DA      03912       cpfseq      godziny_1
1210 EF19 F009 03913       goto        zmniejsz_godziny_1
               03914       
               03915       ;sprawdz czy dzien_10 == 0x30
1214 0E30      03916       movlw       0x30
1216 63D9      03917       cpfseq      godziny_10
1218 EF14 F009 03918       goto        zapisz_do_godziny_1_9
               03919       
121C 0E32      03920       movlw       0x32
121E 6FD9      03921       movwf       godziny_10
1220 0E33      03922       movlw       0x33
1222 6FDA      03923       movwf       godziny_1
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 90


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03924       
1224 EF4A F009 03925       goto        wykryto_down_sprawdz_11_4
               03926       
1228 03927 zapisz_do_godziny_1_9
1228 0E39      03928       movlw       0x39
122A 6FDA      03929       movwf       godziny_1
122C 07D9      03930       decf        godziny_10,f
122E EF4A F009 03931       goto        wykryto_down_sprawdz_11_4
               03932       
               03933       
1232 03934 zmniejsz_godziny_1      
1232 07DA      03935       decf        godziny_1,f
               03936       
               03937       
1234 EF4A F009 03938       goto        wykryto_down_sprawdz_11_4
               03939       
               03940       
1238 03941 wykryto_down_sprawdz_11_2
1238 0EDB      03942       movlw       minuty_10
123A 63E8      03943       cpfseq      ustawianie_czasu_co_wyswietlam
123C EF36 F009 03944       goto        wykryto_down_sprawdz_11_3
               03945       
1240 0E30      03946       movlw       0x30
1242 63DC      03947       cpfseq      minuty_1
1244 EF33 F009 03948       goto        zmniejsz_minuty_1
               03949       
               03950       ;sprawdz czy dzien_10 == 0x30
1248 0E30      03951       movlw       0x30
124A 63DB      03952       cpfseq      minuty_10
124C EF2E F009 03953       goto        zapisz_do_minuty_1_9
               03954       
1250 0E35      03955       movlw       0x35
1252 6FDB      03956       movwf       minuty_10
1254 0E39      03957       movlw       0x39
1256 6FDC      03958       movwf       minuty_1
               03959       
1258 EF4A F009 03960       goto        wykryto_down_sprawdz_11_4
               03961       
125C 03962 zapisz_do_minuty_1_9
125C 0E39      03963       movlw       0x39
125E 6FDC      03964       movwf       minuty_1
1260 07DB      03965       decf        minuty_10,f
1262 EF4A F009 03966       goto        wykryto_down_sprawdz_11_4
               03967       
               03968       
1266 03969 zmniejsz_minuty_1      
1266 07DC      03970       decf        minuty_1,f
               03971       
1268 EF4A F009 03972       goto        wykryto_down_sprawdz_11_4
               03973       
126C 03974 wykryto_down_sprawdz_11_3     
126C 0E30      03975       movlw       0x30
126E 63DE      03976       cpfseq      sekundy_1
1270 EF49 F009 03977       goto        zmniejsz_sekundy_1
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 91


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03978       
               03979       ;sprawdz czy dzien_10 == 0x30
1274 0E30      03980       movlw       0x30
1276 63DD      03981       cpfseq      sekundy_10
1278 EF44 F009 03982       goto        zapisz_do_sekundy_1_9
               03983       
127C 0E35      03984       movlw       0x35
127E 6FDD      03985       movwf       sekundy_10
1280 0E39      03986       movlw       0x39
1282 6FDE      03987       movwf       sekundy_1
               03988       
1284 EF4A F009 03989       goto        wykryto_down_sprawdz_11_4
               03990       
1288 03991 zapisz_do_sekundy_1_9
1288 0E39      03992       movlw       0x39
128A 6FDE      03993       movwf       sekundy_1
128C 07DD      03994       decf        sekundy_10,f
128E EF4A F009 03995       goto        wykryto_down_sprawdz_11_4
               03996       
               03997       
1292 03998 zmniejsz_sekundy_1      
1292 07DE      03999       decf        sekundy_1,f
               04000       
1294 04001 wykryto_down_sprawdz_11_4            
               04002 
1294 ECBB F00C 04003       call        procedura_wyswietlania_kolejnych_liczb_zegara
               04004       
1298 EF4E F009 04005       goto        wykryto_down_exit           
               04006 ;       call     check_busy
               04007 ;       movlw    linia_czwarta
               04008 ;       call      send
               04009 ;         
               04010 ;       call     check_busy
               04011 ; ;czy gasze czy wyswietlam      
               04012 ;       btfsc       markers,test
               04013 ;       goto        zamaz_D
               04014 ; napisz_D
               04015 ;       bsf   markers,test
               04016 ;       movlw       _d
               04017 ;       goto  wykryto_down_pisz
               04018 ; zamaz_D      
               04019 ;       bcf   markers,test
               04020 ;       movlw       _puste
               04021 ;       
               04022 ; wykryto_down_pisz
               04023 ;       call     write_lcd
               04024 
               04025       
               04026       
               04027       
               04028       
               04029       
               04030       
               04031       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 92


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04032       
               04033       
               04034       
               04035       
               04036       
               04037       
129C 04038 wykryto_down_sprawdz17      
               04039 
               04040 
               04041 
               04042 
               04043 
               04044 
               04045 
               04046 
               04047 
129C 04048 wykryto_down_exit
               04049 ;jeżeli jest opuszczenie procedury w trakcie przyciskania kończ w inny sposób
               04050 
129C B59E      04051       btfsc   znaczniki,czy_moge_juz_zmieniac
129E EF55 F009 04052       goto    wykryto_down_exit_trzymanie
               04053       
12A2 9BA1      04054       bcf   markers3,dzialanie_po_klawiszu
12A4 6B99      04055       clrf  stan_key
12A6 EFF1 F00D 04056       goto  LOOP11
               04057  
12AA 04058 wykryto_down_exit_trzymanie
12AA 959E      04059       bcf     znaczniki,czy_moge_juz_zmieniac
12AC 0012      04060       return
               04061  
               04062                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                UP
12AE 04063 wykryto_up
               04064       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz up
               04065       
12AE BFE0      04066       btfsc       pozycja_menu,zmiana_opcji
12B0 EFF6 F009 04067       goto        wykryto_up_zmiana_opcji
               04068       
12B4 51E0      04069       movf        pozycja_menu,w
12B6 E10A      04070       bnz         wykryto_up_sprawdz_czy_wyswietlam_kolejne_opcje
               04071 ;jezeli pozycja menu ==0 to po nacisnieciu klawisza zmien wskazania temperatury
               04072 
12B8 EC32 F001 04073       call        check_busy
12BC 0E01      04074       movlw       display_clear
12BE ECF4 F000 04075       call        send
12C2 EC32 F001 04076       call        check_busy
12C6 7FA1      04077       btg         markers3,pokazuje_temperatury_47
               04078       ;tzn pozwala obejrzec temperatury 0-3 lub 4-7 (zawsze 4)
12C8 EFEF F00A 04079       goto        wykryto_up_exit
               04080       
               04081 
               04082       
12CC 04083 wykryto_up_sprawdz_czy_wyswietlam_kolejne_opcje
               04084       ;movlw       1
               04085       ;cpfseq      pozycja_menu
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 93


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04086       ;goto        sprawdz_czy_wyswietlam_zmiane_opcji
               04087       
               04088       ; polozenie gwiazdki przechowuje liczbe wskazującą aktualny adres polozenia
               04089       ;gwiazdki w 
               04090       ;tablicy_gwiazdki
               04091       ;
               04092       
12CC 0E1B      04093       movlw       HIGH tablica_gwiazdki
12CE 6EF7      04094       movwf       TBLPTRH
               04095       
12D0 0EA6      04096       movlw       LOW tablica_gwiazdki
12D2 6EF6      04097       movwf       TBLPTRL
               04098       
               04099       ;poniewaz najpierw zmniejszam polozenie
12D4 07E2      04100       decf        polozenie_gwiazdki,f
12D6 51E2      04101       movf       polozenie_gwiazdki,w
               04102       
12D8 26F6      04103       addwf       TBLPTRL,f
               04104       
               04105        ;a nastepnie czytam to uzywam polecenia
12DA 0008      04106       TBLRD *
12DC 50F5      04107       movf        TABLAT,w
               04108 ;jezeli odczytano 0 tzn ze bylem na gorze ekranu (pierwsze polecenie)
               04109 ; i następuje przeskok do ekranu menu 0 lub 1 
12DE E16C      04110       bnz         wykryto_up_zmiana_polozenia_gwiazdki
               04111       ;polozenie_gwiazdki == 4 bo gwiazdka jest na dole opcji ekranu poprzedniego
12E0 0E04      04112       movlw       4
12E2 6FE2      04113       movwf       polozenie_gwiazdki
               04114       
               04115       
12E4 07E1      04116       decf        numer_opcji,f
               04117       ;czyszczenie ekranu
12E6 EC32 F001 04118       call        check_busy
12EA 0E01      04119       movlw       display_clear
12EC ECF4 F000 04120       call        send
12F0 EC32 F001 04121       call        check_busy
               04122       
               04123            
               04124       
               04125       ;zaznaczam ze wyświetlam kolejny ekran opcji
               04126       
               04127       
12F4 B1E0      04128       btfsc       pozycja_menu,menu_opcje1 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu koncowego)
12F6 EFC4 F009 04129       goto        wykryto_up_wyswietl_opcje_tablicy_end
               04130       
               04131       
               04132       
               04133       
               04134       
12FA 90D8      04135       bcf         STATUS,C
12FC 33E0      04136       rrcf       pozycja_menu,f
               04137       
               04138 ;########################################## WAZNE
               04139 ;jeżeli będzie więcej ekrnów opcji menu, to tu należy dodać procedurę wykrywania adres której tablicy jest używany do wyświetlania opcji
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 94


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04140        
               04141       ;gdy wyświetlam opcje ekranu 2 - tzn gwiazdka byla na górze opcji linii pierwszej ekranu 2
               04142       
               04143       ;jeżeli po przesunięciu zaznaczony jest bit menu_opcje1 to wyswietl menu_opcje1
12FE B1E0      04144       btfsc       pozycja_menu,menu_opcje1 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu 0)
1300 EF88 F009 04145       goto        wykryto_up_wyswietl_opcje_tablicy_pierwsza
               04146       
               04147       
1304 B3E0      04148       btfsc       pozycja_menu,menu_opcje2 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu 0)
1306 EF9C F009 04149       goto        wykryto_up_wyswietl_opcje_tablicy_dwa
               04150 
130A B5E0      04151       btfsc       pozycja_menu,menu_opcje3 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu 0)
130C EFB0 F009 04152       goto        wykryto_up_wyswietl_opcje_tablicy_trzy
               04153       
               04154       
1310 04155 wykryto_up_wyswietl_opcje_tablicy_pierwsza
1310 0E1B      04156       movlw       HIGH tablica_pierwsza
1312 6EF7      04157       movwf       TBLPTRH
               04158       
1314 0E00      04159       movlw       LOW tablica_pierwsza
1316 6EF6      04160       movwf       TBLPTRL
               04161       
1318 ECF8 F00A 04162       call        wyswietl_opcje_menu
               04163       
               04164       ;wyswietlam gwiazdke na linii ostatniej poprzedniego ekranu
131C EC32 F001 04165       call        check_busy
1320 0ED0      04166       movlw       linia_czwarta
               04167       
1322 ECF4 F000 04168       call        send
1326 EC32 F001 04169       call        check_busy
132A 0E2A      04170       movlw       _star
132C EC05 F001 04171       call        write_lcd
1330 EC32 F001 04172       call        check_busy
               04173       
1334 EFEF F00A 04174       goto        wykryto_up_exit
               04175       
               04176            
1338 04177 wykryto_up_wyswietl_opcje_tablicy_dwa
               04178       ;tu jest przeskok z numeru opcji 1 do ostatniej możliwej czyli 8
               04179       
               04180       ;wyświetlam opcje ekranu 2
               04181       
               04182       
1338 0E1B      04183       movlw       HIGH tablica_druga
133A 6EF7      04184       movwf       TBLPTRH
               04185       
133C 0E22      04186       movlw       LOW tablica_druga
133E 6EF6      04187       movwf       TBLPTRL
               04188       
1340 ECF8 F00A 04189       call        wyswietl_opcje_menu
               04190       
               04191       ;wyswietlam gwiazdke na linii ostatniej poprzedniego ekranu
1344 EC32 F001 04192       call        check_busy
1348 0ED0      04193       movlw       linia_czwarta
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 95


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
134A ECF4 F000 04194       call        send
               04195       
134E EC32 F001 04196       call        check_busy
1352 0E2A      04197       movlw       _star
1354 EC05 F001 04198       call        write_lcd
1358 EC32 F001 04199       call        check_busy
               04200       
135C EFEF F00A 04201       goto        wykryto_up_exit
               04202 
               04203 
1360 04204 wykryto_up_wyswietl_opcje_tablicy_trzy
               04205       
1360 0E1B      04206       movlw       HIGH tablica_trzecia
1362 6EF7      04207       movwf       TBLPTRH
               04208       
1364 0E42      04209       movlw       LOW tablica_trzecia
1366 6EF6      04210       movwf       TBLPTRL
               04211             
1368 ECF8 F00A 04212       call        wyswietl_opcje_menu
               04213       
136C EC32 F001 04214       call        check_busy
1370 0ED0      04215       movlw       linia_czwarta      
1372 ECF4 F000 04216       call        send
               04217       
1376 EC32 F001 04218       call        check_busy
137A 0E2A      04219       movlw       _star
137C EC05 F001 04220       call        write_lcd
1380 EC32 F001 04221       call        check_busy
               04222       
1384 EF4E F009 04223       goto        wykryto_down_exit
               04224       
1388 04225 wykryto_up_wyswietl_opcje_tablicy_end
1388 0E10      04226       movlw       numer_opcji_koncowej    
138A 6FE1      04227       movwf       numer_opcji
138C 6BE0      04228       clrf            pozycja_menu
138E 87E0      04229       bsf            pozycja_menu,(menu_opcje_end-1)
               04230 
1390 0E1B      04231       movlw       HIGH tablica_czwarta
1392 6EF7      04232       movwf       TBLPTRH
               04233       
1394 0E72      04234       movlw       LOW tablica_czwarta
1396 6EF6      04235       movwf       TBLPTRL
               04236       
               04237       
1398 ECF8 F00A 04238       call        wyswietl_opcje_menu
               04239       
139C EC32 F001 04240       call        check_busy
13A0 0ED0      04241       movlw       linia_czwarta      
13A2 ECF4 F000 04242       call        send
               04243       
13A6 EC32 F001 04244       call        check_busy
13AA 0E2A      04245       movlw       _star
13AC EC05 F001 04246       call        write_lcd
13B0 EC32 F001 04247       call        check_busy
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 96


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04248       
13B4 EF4E F009 04249       goto        wykryto_down_exit
               04250       
               04251       
13B8 04252 wykryto_up_zmiana_polozenia_gwiazdki
               04253       ;opcje zmnieniaja się o tą położoną wyżej
13B8 07E1      04254       decf        numer_opcji,f
               04255       
               04256       ;nowa gwiazdka jest rysowana w miejscu odczytanym z tablicy
               04257       
13BA EC32 F001 04258       call     check_busy
13BE 50F5      04259       movf        TABLAT,w
13C0 ECF4 F000 04260       call        send
               04261       
13C4 EC32 F001 04262       call     check_busy
13C8 0E2A      04263       movlw       _star
13CA EC05 F001 04264       call        write_lcd
13CE EC32 F001 04265       call     check_busy
               04266       ;gwiazdka poprzednia jest kasowana - tzn znow czytam z tablicy ale tym razem polozenie poprzednie
               04267       
               04268       
13D2 2AF6      04269       incf        TBLPTRL,f
13D4 0008      04270       TBLRD *
13D6 50F5      04271       movf        TABLAT,w
13D8 ECF4 F000 04272       call        send
13DC EC32 F001 04273       call     check_busy
13E0 0E20      04274       movlw       _puste
13E2 EC05 F001 04275       call        write_lcd
               04276       
13E6 06F6      04277       decf        TBLPTRL,f
               04278       
13E8 EFEF F00A 04279       goto        wykryto_up_exit
               04280 
               04281 
               04282       
               04283 ;#########################################KLAWISZ UP
               04284 ;ZMIANA Opcji
13EC 04285 wykryto_up_zmiana_opcji
               04286 ;sprawdz którą opcję zmieniam
13EC 0E01      04287       movlw       opcja_czujniki
13EE 63E1      04288       cpfseq      numer_opcji
13F0 EF0E F00A 04289       goto          wykryto_up_sprawdz_2
               04290       
               04291       ;jeżeli zmieniam ilość obsługiwanych czujników temp
               04292       ;to tu powinno być zmiana o 1 ilości kanałów 
               04293       ;i sprawdzenie czy nie przekroczyłem dopuszczalnych 8
13F4 2BA5      04294       incf        ile_kanalow,f
13F6 0E09      04295       movlw      9
               04296       
13F8 63A5      04297       cpfseq      ile_kanalow
13FA EF00 F00A 04298       goto         wykryto_up_zmiana_opcji_wyswietl_kanaly
               04299       
13FE 6BA5      04300       clrf              ile_kanalow
               04301       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 97


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1400 04302 wykryto_up_zmiana_opcji_wyswietl_kanaly
1400 EC32 F001 04303       call     check_busy
1404 0E80      04304       movlw    linia_gorna
1406 0F0C      04305       addlw       0xc
1408 ECF4 F000 04306       call      send
               04307       ;
140C EC32 F001 04308       call     check_busy
1410 51A5      04309       movf        ile_kanalow,w
1412 0F30      04310       addlw       0x30
1414 EC05 F001 04311       call        write_lcd
               04312       
1418 EFEF F00A 04313       goto        wykryto_up_exit
               04314       
141C 04315 wykryto_up_sprawdz_2
141C 0E02      04316       movlw       opcja_odstep
141E 63E1      04317       cpfseq      numer_opcji
1420 EF1E F00A 04318       goto        wykryto_up_sprawdz_3
               04319 
1424 2BA7      04320       incf        odstep_pomiarowy,f
1426 51A7      04321       movf        odstep_pomiarowy,w
               04322       
1428 6F92      04323       movwf       tmp_hex
142A 6B93      04324       clrf        tmp_hex_H
142C 6B98      04325       clrf        dec1
142E 6B97      04326       clrf        dec10
1430 ECEE F001 04327       call        hex2dec18
               04328 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04329       ;wyświetlam obok nazwy opcji czyli 
1434 EC8E F00C 04330       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04331       
               04332       
1438 EFEF F00A 04333       goto        wykryto_up_exit
               04334       
143C 04335 wykryto_up_sprawdz_3
143C 0E03      04336       movlw       opcja_srednia
143E 63E1      04337       cpfseq      numer_opcji
1440 EF3D F00A 04338       goto        wykryto_up_sprawdz_4
               04339       
               04340       ;sprawdz czy liczba próbek == 128 (0x80)
1444 0E80      04341       movlw       0x80
1446 63AF      04342       cpfseq      jak_duzo_probek
1448 EF2B F00A 04343       goto        wykryto_up_sprawdz_3_zwieksz_probki
               04344       ;zmieniam liczbe próbek na 1
144C 0E01      04345       movlw       1
144E 6FAF      04346       movwf       jak_duzo_probek
1450 919F      04347       bcf      markers,czy_usrednianie
               04348       
1452 EF32 F00A 04349       goto        wykryto_up_3_wyswietl
               04350       
1456 04351 wykryto_up_sprawdz_3_zwieksz_probki
1456 819F      04352       bsf      markers,czy_usrednianie
1458 0E02      04353       movlw       0x02
145A 03AF      04354       mulwf       jak_duzo_probek
145C 50F3      04355       movf        PRODL,w
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 98


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
145E 6FAF      04356       movwf       jak_duzo_probek
               04357       
1460 EC90 F003 04358       call     ustaw_wartosc_dzielenia_usredniania      
               04359       
1464 04360 wykryto_up_3_wyswietl
1464 51AF      04361       movf        jak_duzo_probek,w
1466 6F92      04362       movwf       tmp_hex
1468 6B93      04363       clrf        tmp_hex_H
146A 6B98      04364       clrf        dec1
146C 6B97      04365       clrf        dec10
146E ECEE F001 04366       call        hex2dec18
               04367 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04368       ;wyświetlam obok nazwy opcji czyli 
1472 EC8E F00C 04369       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04370       
1476 EFEF F00A 04371       goto        wykryto_up_exit
               04372             
               04373 
147A 04374 wykryto_up_sprawdz_4
147A 04375 wykryto_up_sprawdz_5
147A 0E05      04376       movlw       opcja_ustaw_temp
147C 63E1      04377       cpfseq      numer_opcji
147E EF4D F00A 04378       goto        wykryto_up_sprawdz_6
               04379       
               04380             
1482 2BAE      04381       incf        jaka_wartosc_regulujeL,f
               04382       
1484 E306      04383       bnc         wykryto_up_sprawdz_5_dalej
               04384       ;czy  przekroczono 0x200
               04385             
1486 2BAD      04386       incf        jaka_wartosc_regulujeH,f
               04387       
1488 0E02      04388       movlw       0x02
148A 63AD      04389       cpfseq      jaka_wartosc_regulujeH
148C EF49 F00A 04390       goto        wykryto_up_sprawdz_5_dalej
               04391       
               04392       
               04393       ;jeżeli w H jest 3 to wyzeruj 
1490 6BAD      04394       clrf       jaka_wartosc_regulujeH
               04395       
               04396       
1492 04397 wykryto_up_sprawdz_5_dalej
               04398                                                 ; movf        jaka_wartosc_regulujeL,w
               04399                                                 ; movwf       tmp_hex
               04400                                                 ; movf        jaka_wartosc_regulujeH,w
               04401                                                 ; movwf        tmp_hex_H
               04402                                                 ; clrf        dec1
               04403                                                 ; clrf        dec10
               04404                                                 ; call        hex2dec18
               04405                                           ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04406                                            ;     wyświetlam obok nazwy opcji czyli 
               04407                                                 ; call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04408       
1492 ECA0 F00B 04409       call  wyswietl_temp_w_opcjach
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 99


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04410       
               04411       
1496 EF4E F009 04412       goto        wykryto_down_exit
149A 04413 wykryto_up_sprawdz_6
               04414 
               04415 
149A 04416 wykryto_up_sprawdz_9
               04417 ;górna histereza 
149A 0E09      04418       movlw       opcja_histereza1
149C 63E1      04419       cpfseq      numer_opcji
149E EF5D F00A 04420       goto        wykryto_up_sprawdz_10
               04421       
               04422       ;wlacz pomiar pradu
               04423       ;jako test wlacz podswietlenie lub je wylacz
               04424       
               04425       ;btg   portlampka2,lampka2
14A2 2BE6      04426       incf        histereza1,f
               04427       
14A4 51E6      04428       movf        histereza1,w
14A6 6F92      04429       movwf       tmp_hex
               04430       
14A8 6B93      04431       clrf        tmp_hex_H
14AA 6B98      04432       clrf        dec1
14AC 6B97      04433       clrf        dec10
14AE ECEE F001 04434       call        hex2dec18
               04435 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04436       ;wyświetlam obok nazwy opcji czyli 
14B2 EC8E F00C 04437       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04438       
14B6 EFEF F00A 04439       goto        wykryto_up_exit     
               04440       
14BA 04441 wykryto_up_sprawdz_10
               04442 ;dolna histereza 
14BA 0E0A      04443       movlw       opcja_histereza2
14BC 63E1      04444       cpfseq      numer_opcji
14BE EF6D F00A 04445       goto        wykryto_up_sprawdz_11
               04446       
               04447       ;wlacz pomiar pradu
               04448       ;jako test wlacz podswietlenie lub je wylacz
               04449       
               04450       ;btg   portlampka2,lampka2
14C2 2BE7      04451       incf        histereza2,f
               04452       
14C4 51E7      04453       movf        histereza2,w
14C6 6F92      04454       movwf       tmp_hex
               04455       
14C8 6B93      04456       clrf        tmp_hex_H
14CA 6B98      04457       clrf        dec1
14CC 6B97      04458       clrf        dec10
14CE ECEE F001 04459       call        hex2dec18
               04460 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04461       ;wyświetlam obok nazwy opcji czyli 
14D2 EC8E F00C 04462       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04463       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 100


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
14D6 EFEF F00A 04464       goto        wykryto_up_exit     
               04465 
               04466       
               04467       
               04468       
               04469       
               04470       
               04471       
               04472       
14DA 04473 wykryto_up_sprawdz_11
14DA 0E0B      04474       movlw      opcja_czujnik_regulacji 
14DC 63E1      04475       cpfseq      numer_opcji
14DE EF84 F00A 04476       goto        wykryto_up_sprawdz_12
               04477       
               04478       ;jezeli juz jest ustawiona ilosc czujnikow to zeruj
               04479       
14E2 0E07      04480       movlw       ilosc_czujnikow
14E4 63E9      04481       cpfseq      ktory_czujnik_reguluje
14E6 EF78 F00A 04482       goto        wykryto_up_sprawdz11_increase
               04483       
14EA 6BE9      04484       clrf        ktory_czujnik_reguluje
14EC EF79 F00A 04485       goto        wykryto_up_sprawdz11_show
               04486       
14F0 04487 wykryto_up_sprawdz11_increase      
14F0 2BE9      04488       incf        ktory_czujnik_reguluje,f
               04489       
               04490       
14F2 04491 wykryto_up_sprawdz11_show      
14F2 51E9      04492       movf        ktory_czujnik_reguluje,w
14F4 6F92      04493       movwf       tmp_hex
               04494       
14F6 6B93      04495       clrf        tmp_hex_H
14F8 6B98      04496       clrf        dec1
14FA 6B97      04497       clrf        dec10
14FC ECEE F001 04498       call        hex2dec18
               04499 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04500       ;wyświetlam obok nazwy opcji czyli 
1500 EC8E F00C 04501       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04502       
1504 EFEF F00A 04503       goto        wykryto_up_exit       
               04504       
               04505       
               04506       
               04507       
               04508       
               04509       
               04510       
               04511       
               04512       
               04513       
               04514       
               04515       
               04516       
               04517 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 101


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04518       
1508 04519 wykryto_up_sprawdz_12
               04520      
               04521 
               04522 
               04523 
1508 04524 wykryto_up_sprawdz_16
               04525 ;ustawienia zegara
1508 0E10      04526       movlw       opcja_ustaw_zegar
150A 63E1      04527       cpfseq      numer_opcji
150C EFEF F00A 04528       goto        wykryto_up_sprawdz_17
               04529       
               04530 ;sprawdzenie która wielkość zegara podlega zmianie
               04531 ;jeżeli dzien_10 to zmniejszam o jeden dzien_1
               04532 ;problem polega na tym, że nie mogę skorzystać z FSR2 bo  każda z wielkości
               04533 ;czasu musi być indywidualnie rozpatrywana
1510 0ED7      04534       movlw       dzien_10
1512 63E8      04535       cpfseq      ustawianie_czasu_co_wyswietlam
1514 EFA1 F00A 04536       goto        wykryto_up_sprawdz_11_1
               04537 
               04538 ;jeżeli dzień_1 jest 9 (0x39) to jeżeli dzien_10 <> 0x39 zwieksz dzien_10
               04539 
1518 0E39      04540       movlw       0x39
151A 63D8      04541       cpfseq      dzien_1
151C EF9E F00A 04542       goto        zwieksz_dzien_1
               04543       
               04544       ;sprawdz czy dzien_10 == 0x39
1520 0E39      04545       movlw       0x39
1522 63D7      04546       cpfseq      dzien_10
1524 EF99 F00A 04547       goto        zapisz_do_dzien_1_0
               04548       
1528 0E30      04549       movlw       0x30 
152A 6FD8      04550       movwf       dzien_1            
152C 6FD7      04551       movwf       dzien_10
               04552       
152E EFEB F00A 04553       goto        wykryto_up_sprawdz_11_4
               04554       
1532 04555 zapisz_do_dzien_1_0
1532 0E30      04556       movlw       0x30
1534 6FD8      04557       movwf       dzien_1
1536 2BD7      04558       incf        dzien_10,f
1538 EFEB F00A 04559       goto        wykryto_up_sprawdz_11_4
               04560       
               04561       
153C 04562 zwieksz_dzien_1      
153C 2BD8      04563       incf        dzien_1,f
               04564       
               04565       
153E EFEB F00A 04566       goto        wykryto_up_sprawdz_11_4
               04567       
1542 04568 wykryto_up_sprawdz_11_1
1542 0ED9      04569       movlw       godziny_10
1544 63E8      04570       cpfseq      ustawianie_czasu_co_wyswietlam
1546 EFBE F00A 04571       goto        wykryto_up_sprawdz_11_2
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 102


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04572       
               04573       ;najpierw sprawdze czy godziny_1 i godziny_10 == 23 godzina bo wtedy wpisuje 00
154A 0E33      04574       movlw       0x33
154C 63DA      04575       cpfseq      godziny_1
154E EFB2 F00A 04576       goto        sprawdz_zwiekszanie_godzin_normalnie
1552 0E32      04577       movlw       0x32
1554 63D9      04578       cpfseq      godziny_10
1556 EFB2 F00A 04579       goto        sprawdz_zwiekszanie_godzin_normalnie
               04580       
               04581 ;jest godzina 23 => zapisz do godzin 00      
155A 0E30      04582       movlw       0x30
155C 6FD9      04583       movwf       godziny_10      
155E 6FDA      04584       movwf       godziny_1
1560 EFEB F00A 04585       goto        wykryto_up_sprawdz_11_4
               04586       
1564 04587 sprawdz_zwiekszanie_godzin_normalnie      
1564 0E39      04588       movlw       0x39
1566 63DA      04589       cpfseq      godziny_1
1568 EFBB F00A 04590       goto        zwieksz_godziny_1      
               04591 
156C 0E30      04592       movlw       0x30
156E 6FDA      04593       movwf       godziny_1
1570 2BD9      04594       incf        godziny_10,f
1572 EFEB F00A 04595       goto        wykryto_up_sprawdz_11_4
               04596             
1576 04597 zwieksz_godziny_1      
1576 2BDA      04598       incf        godziny_1,f
               04599       
               04600       
1578 EFEB F00A 04601       goto        wykryto_up_sprawdz_11_4
               04602       
               04603       
157C 04604 wykryto_up_sprawdz_11_2
157C 0EDB      04605       movlw       minuty_10
157E 63E8      04606       cpfseq      ustawianie_czasu_co_wyswietlam
1580 EFD7 F00A 04607       goto        wykryto_up_sprawdz_11_3
               04608       
               04609       
1584 0E39      04610       movlw       0x39
1586 63DC      04611       cpfseq      minuty_1
1588 EFD4 F00A 04612       goto        zwieksz_minuty_1
               04613      
158C 0E35      04614       movlw       0x35
158E 63DB      04615       cpfseq      minuty_10
1590 EFCF F00A 04616       goto        zapisz_do_minuty_1_0
               04617       
1594 0E30      04618       movlw       0x30
1596 6FDB      04619       movwf       minuty_10
1598 6FDC      04620       movwf       minuty_1
               04621       
159A EFEB F00A 04622       goto        wykryto_up_sprawdz_11_4
               04623       
159E 04624 zapisz_do_minuty_1_0
159E 0E30      04625       movlw       0x30
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 103


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
15A0 6FDC      04626       movwf       minuty_1
15A2 2BDB      04627       incf        minuty_10,f
15A4 EFEB F00A 04628       goto        wykryto_up_sprawdz_11_4
               04629       
               04630       
15A8 04631 zwieksz_minuty_1      
15A8 2BDC      04632       incf        minuty_1,f
               04633       
15AA EFEB F00A 04634       goto        wykryto_up_sprawdz_11_4
               04635       
15AE 04636 wykryto_up_sprawdz_11_3     
15AE 0E30      04637       movlw       0x30
15B0 63DE      04638       cpfseq      sekundy_1
15B2 EFEA F00A 04639       goto        zwieksz_sekundy_1
               04640       
               04641       ;sprawdz czy dzien_10 == 0x30
15B6 0E30      04642       movlw       0x30
15B8 63DD      04643       cpfseq      sekundy_10
15BA EFE5 F00A 04644       goto        zapisz_do_sekundy_1_0
               04645       
15BE 0E35      04646       movlw       0x35
15C0 6FDD      04647       movwf       sekundy_10
15C2 0E39      04648       movlw       0x39
15C4 6FDE      04649       movwf       sekundy_1
               04650       
15C6 EFEB F00A 04651       goto        wykryto_up_sprawdz_11_4
               04652       
15CA 04653 zapisz_do_sekundy_1_0
15CA 0E30      04654       movlw       0x30
15CC 6FDE      04655       movwf       sekundy_1
15CE 2BDD      04656       incf        sekundy_10,f
15D0 EFEB F00A 04657       goto        wykryto_up_sprawdz_11_4
               04658       
               04659       
15D4 04660 zwieksz_sekundy_1      
15D4 2BDE      04661       incf        sekundy_1,f
               04662       
15D6 04663 wykryto_up_sprawdz_11_4            
               04664 
15D6 ECBB F00C 04665       call        procedura_wyswietlania_kolejnych_liczb_zegara
15DA EFEF F00A 04666       goto        wykryto_up_exit
               04667 
               04668      
               04669 
               04670      
               04671      
15DE 04672 wykryto_up_sprawdz_17
               04673      
               04674 
               04675      
15DE 04676 wykryto_up_exit
15DE B59E      04677       btfsc   znaczniki,czy_moge_juz_zmieniac
15E0 EFF6 F00A 04678       goto    wykryto_up_exit_trzymanie
15E4 9BA1      04679       bcf   markers3,dzialanie_po_klawiszu
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 104


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
15E6 6B99      04680       clrf  stan_key
15E8 EFF1 F00D 04681       goto  LOOP11
               04682  
15EC 04683 wykryto_up_exit_trzymanie
15EC 959E      04684       bcf     znaczniki,czy_moge_juz_zmieniac
15EE 0012      04685       return      
               04686  
               04687 
               04688 
               04689 
               04690 
               04691 ;############################################
               04692 ;#####
               04693 ;######PISZ na ekranie słowa z tablicy opcji menu
               04694 
               04695 
15F0 04696 wyswietl_opcje_menu
15F0 EC32 F001 04697       call        check_busy
15F4 0E80      04698       movlw       linia_gorna
15F6 0F01      04699       addlw       1        
15F8 ECF4 F000 04700       call        send
15FC EC32 F001 04701       call        check_busy
1600 04702 czytam_pierwsza_linie
               04703       
               04704       ;czytam aktualny adres i zwiekszam
1600 0009      04705       TBLRD       *+
               04706       
1602 50F5      04707       movf        TABLAT,w
               04708       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
1604 E006      04709       bz          czytam_druga_linie
1606 EC05 F001 04710       call        write_lcd
160A EC32 F001 04711       call        check_busy
160E EF00 F00B 04712       goto        czytam_pierwsza_linie
               04713       
1612 04714 czytam_druga_linie
               04715       
1612 0EC0      04716       movlw       linia_dolna
1614 0F01      04717       addlw       1        
1616 ECF4 F000 04718       call        send
161A EC32 F001 04719       call        check_busy
               04720       
161E 04721 czytam_druga_linie2
               04722       ;czytam aktualny adres i zwiekszam
161E 0009      04723       TBLRD       *+
               04724       
1620 50F5      04725       movf        TABLAT,w
               04726       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
1622 E006      04727       bz          czytam_trzecia_linie
1624 EC05 F001 04728       call        write_lcd
1628 EC32 F001 04729       call        check_busy
               04730       
162C EF0F F00B 04731       goto        czytam_druga_linie2
               04732       
1630 04733 czytam_trzecia_linie
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 105


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1630 0E90      04734       movlw       linia_trzecia
1632 0F01      04735       addlw       1        
1634 ECF4 F000 04736       call        send
1638 EC32 F001 04737       call        check_busy
163C 04738 czytam_trzecia_linie2      
163C 0009      04739       TBLRD       *+
               04740       
163E 50F5      04741       movf        TABLAT,w
               04742       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
1640 E006      04743       bz          czytam_4_linie
1642 EC05 F001 04744       call        write_lcd
1646 EC32 F001 04745       call        check_busy
               04746       
164A EF1E F00B 04747       goto        czytam_trzecia_linie2
               04748       
164E 04749 czytam_4_linie
164E 0ED0      04750       movlw       linia_czwarta
1650 0F01      04751       addlw       1        
1652 ECF4 F000 04752       call        send
1656 EC32 F001 04753       call        check_busy
               04754       
165A 04755 czytam_4_linie2
165A 0009      04756       TBLRD       *+
               04757       
165C 50F5      04758       movf        TABLAT,w
               04759       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
165E E006      04760       bz          czytam_4_linie3
1660 EC05 F001 04761       call        write_lcd
1664 EC32 F001 04762       call        check_busy
               04763       
1668 EF2D F00B 04764       goto        czytam_4_linie2
               04765       
166C 04766 czytam_4_linie3
166C 0012      04767       return 
               04768  
               04769  
               04770  
               04771 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                ENTER
166E 04772 wykryto_enter
               04773       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz enter
               04774       
166E BFE0      04775       btfsc       pozycja_menu,zmiana_opcji
1670 EF2B F00C 04776       goto        wykryto_enter_zmiana_opcji
               04777       
1674 51E0      04778       movf        pozycja_menu,w
1676 E121      04779       bnz         sprawdz_czy_wchodze_do_zmiany_opcji
               04780 ;jezeli pozycja menu ==0 to po nacisnieciu klawisza enter wyswietlane sa napisy ekranu menu 0 i gwiazdka w linii pierwszej przy pierwszej opcji
               04781       
               04782       ;wylaczam wskazywanie temperatur i czasu
1678 9B9F      04783       bcf         markers,czy_wyswietlam_temp
167A 95A1      04784       bcf         markers3,czy_zegar_wyswietlac
               04785       
               04786       
               04787       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 106


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
167C EC32 F001 04788       call        check_busy
1680 0E01      04789       movlw       display_clear
1682 ECF4 F000 04790       call        send
1686 EC32 F001 04791       call        check_busy
               04792       
168A 0E01      04793       movlw       1
168C 6FE0      04794       movwf       pozycja_menu
168E 6FE2      04795       movwf       polozenie_gwiazdki
               04796       
1690 6FE1      04797       movwf        numer_opcji
               04798             
1692 EC32 F001 04799       call        check_busy
1696 0E80      04800       movlw       linia_gorna
               04801       
1698 ECF4 F000 04802       call        send
169C EC32 F001 04803       call        check_busy
16A0 0E2A      04804       movlw       _star
16A2 EC05 F001 04805       call        write_lcd
16A6 EC32 F001 04806       call        check_busy
               04807       
               04808       
16AA 0E1B      04809       movlw       HIGH tablica_pierwsza
16AC 6EF7      04810       movwf       TBLPTRH
               04811       
16AE 0E00      04812       movlw       LOW tablica_pierwsza
16B0 6EF6      04813       movwf       TBLPTRL
               04814       
16B2 ECF8 F00A 04815       call  wyswietl_opcje_menu
               04816       
16B6 EF7F F00C 04817       goto        wykryto_enter_exit     
               04818       
               04819       
               04820       
               04821       
               04822       
               04823       
               04824       
               04825       
               04826       
16BA 04827 sprawdz_czy_wchodze_do_zmiany_opcji
16BA 0E01      04828       movlw       opcja_czujniki
16BC 63E1      04829       cpfseq      numer_opcji
16BE EF70 F00B 04830       goto        wykryto_enter_sprawdz_opcje2
               04831       ;obok nazwy opcji wypisuje aktualna ilosc mierzonych temperatur
               04832       ;naciskanie klawiszy gora/ dół to zmiana ilości kanałów mierzonych
               04833       ;klawisz enter lub back powoduje zatwierdzenie pomiarów 
               04834       
               04835       ;opcja wyboru jest umieszczona na pierwszej linii ekranu
               04836       ;
               04837       ;*pomiar t   2
               04838       ;na 12 znaku linii pierwszej piszemy aktualną cyfrę kanałów
16C2 EC32 F001 04839       call     check_busy
16C6 0E80      04840       movlw    linia_gorna
16C8 0F0C      04841       addlw       0xc
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 107


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
16CA ECF4 F000 04842       call      send
               04843       ;
16CE EC32 F001 04844       call     check_busy
16D2 51A5      04845       movf        ile_kanalow,w
16D4 0F30      04846       addlw       0x30
16D6 EC05 F001 04847       call        write_lcd
               04848             
               04849       ;zaznaczam ze jest zmiana opcji
16DA 8FE0      04850       bsf         pozycja_menu,zmiana_opcji
               04851       
16DC EF7F F00C 04852       goto        wykryto_enter_exit
               04853       
               04854       
               04855       
               04856       
               04857       
               04858       
               04859       
               04860       
               04861       
               04862       
               04863       
               04864       
               04865       
               04866       
               04867       
               04868       
               04869       
               04870       
16E0 04871 wykryto_enter_sprawdz_opcje2
               04872 
16E0 0E02      04873       movlw       opcja_odstep
16E2 63E1      04874       cpfseq      numer_opcji
16E4 EF80 F00B 04875       goto        wykryto_enter_sprawdz_opcje3
               04876 
               04877       ;pokaz na ekranie ustawienie aktualne odstępu w s.
16E8 51A7      04878       movf        odstep_pomiarowy,w
16EA 6F92      04879       movwf       tmp_hex
16EC 6B93      04880       clrf        tmp_hex_H
16EE 6B98      04881       clrf        dec1
16F0 6B97      04882       clrf        dec10
16F2 ECEE F001 04883       call        hex2dec18
               04884 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04885       ;wyświetlam obok nazwy opcji czyli 
16F6 EC8E F00C 04886       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04887       
               04888       ;zaznaczam ze jest zmiana opcji
16FA 8FE0      04889       bsf         pozycja_menu,zmiana_opcji
               04890       
16FC EF7F F00C 04891       goto        wykryto_enter_exit
               04892       
               04893       
               04894       
               04895       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 108


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04896       
               04897       
               04898       
               04899       
               04900       
               04901       
               04902       
               04903       
               04904       
               04905       
               04906       
               04907       
               04908       
1700 04909 wykryto_enter_sprawdz_opcje3
               04910 ;ustaw srednia
1700 0E03      04911       movlw       opcja_srednia
1702 63E1      04912       cpfseq      numer_opcji
1704 EF90 F00B 04913       goto        wykryto_enter_sprawdz_opcje4
               04914 
               04915       ;pokaz na ekranie ustawienie aktualne odstępu w s.
1708 51AF      04916       movf        jak_duzo_probek,w
170A 6F92      04917       movwf       tmp_hex
170C 6B93      04918       clrf        tmp_hex_H
170E 6B98      04919       clrf        dec1
1710 6B97      04920       clrf        dec10
1712 ECEE F001 04921       call        hex2dec18
               04922 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04923       ;wyświetlam obok nazwy opcji czyli 
1716 EC8E F00C 04924       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04925       
171A 8FE0      04926       bsf         pozycja_menu,zmiana_opcji
               04927       
171C EF7F F00C 04928       goto        wykryto_enter_exit
               04929       
               04930       
               04931       
               04932       
               04933       
               04934       
               04935       
1720 04936 wykryto_enter_sprawdz_opcje4
1720 0E04      04937       movlw       opcja_regulacja
1722 63E1      04938       cpfseq      numer_opcji
1724 EF97 F00B 04939       goto        wykryto_enter_sprawdz_opcje5
               04940       
1728 7DA0      04941       btg         markers2,reguluj
               04942       
172A EF7F F00C 04943       goto        wykryto_enter_exit
               04944       
               04945       
               04946       
               04947       
               04948       
               04949       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 109


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04950       
               04951       
               04952       
               04953       
172E 04954 wykryto_enter_sprawdz_opcje5
172E 0E05      04955       movlw       opcja_ustaw_temp
1730 63E1      04956       cpfseq      numer_opcji
1732 EFBA F00B 04957       goto        wykryto_enter_sprawdz_opcje6
               04958       
               04959       
               04960       
               04961                                           ;movf        jaka_wartosc_regulujeL,w      
               04962                                           ;movwf       tmp_hex
               04963                                           ;movf        jaka_wartosc_regulujeH,w
               04964                                           ;movwf        tmp_hex_H
               04965                                           ;clrf        dec1
               04966                                           ;clrf        dec10
               04967                                           ;call        hex2dec18
               04968                                           ;call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04969                                           
1736 ECA0 F00B 04970       call  wyswietl_temp_w_opcjach
               04971       
173A 8FE0      04972       bsf         pozycja_menu,zmiana_opcji
               04973       
173C EF7F F00C 04974       goto        wykryto_enter_exit
               04975       
1740 04976 wyswietl_temp_w_opcjach      
1740 51AE      04977       movf        jaka_wartosc_regulujeL,w
               04978            ;dziele przez 4
1742 0D40      04979       mullw       0x40
               04980       
1744 50F3      04981       movf        PRODL,w
1746 6F9D      04982       movwf       wynik01
               04983       
               04984       ;temperatura jest w bajcie starszym
1748 50F4      04985       movf        PRODH,w
174A 6F92      04986       movwf       tmp_hex
               04987       
174C 51AD      04988       movf        jaka_wartosc_regulujeH,w
174E 6F93      04989       movwf        tmp_hex_H
               04990       
1750 ECEE F001 04991          call     hex2dec18
               04992          
1754 0E1B      04993          movlw       HIGH tablica_gwiazdki
1756 6EF7      04994       movwf       TBLPTRH
               04995       
1758 0EA6      04996       movlw       LOW tablica_gwiazdki
175A 6EF6      04997       movwf       TBLPTRL
               04998       
               04999       ;poniewaz najpierw zmniejszam polozenie
               05000       
175C 51E2      05001       movf       polozenie_gwiazdki,w
               05002       
175E 26F6      05003       addwf       TBLPTRL,f
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 110


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05004       
               05005       
               05006       
1760 EC32 F001 05007       call        check_busy
               05008        ;a nastepnie czytam to uzywam polecenia
1764 0008      05009       TBLRD *
1766 50F5      05010       movf        TABLAT,w
               05011   ;teraz należy do adresu lini dodać miejsce położenia cyfry 100
               05012   
               05013 
1768 0F09      05014       addlw       0x09
176A ECF4 F000 05015       call        send
               05016          
176E EC5B F005 05017        call     wyswietl_cyfry_temperatury
               05018       
1772 0012      05019       return
               05020 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               05021       ;wyświetlam obok nazwy opcji czyli 
               05022       
               05023       
               05024       
               05025       
               05026       
               05027       
               05028       
               05029       
               05030       
               05031       
               05032       
               05033       
               05034       
               05035       
               05036       
               05037       
               05038       
               05039       
1774 05040 wykryto_enter_sprawdz_opcje6 
1774 0E06      05041       movlw       opcja_pomiar_i
1776 63E1      05042       cpfseq      numer_opcji
1778 EFC4 F00B 05043       goto        wykryto_enter_sprawdz_opcje7
               05044       
177C 0E02      05045       movlw       2
177E 6FD5      05046       movwf       jak_duzo_kanalow_pradu
1780 6BD6      05047       clrf        ktory_aktualnie_kanal_pradu
               05048       
1782 71A1      05049       btg   markers3,pomiary_pradu
               05050       
               05051       
1784 EF7F F00C 05052       goto        wykryto_enter_exit
               05053      
               05054      
               05055      
               05056      
               05057      
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 111


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05058      
               05059      
               05060      
               05061      
               05062      
               05063      
               05064      
               05065      
               05066      
               05067      
               05068      
               05069      
               05070      
               05071      
               05072      
               05073      
               05074      
               05075      
               05076      
1788 05077 wykryto_enter_sprawdz_opcje7
               05078 
1788 0E07      05079       movlw       opcja_wlacz_1
178A 63E1      05080       cpfseq      numer_opcji
178C EFCB F00B 05081       goto        wykryto_enter_sprawdz_opcje8
               05082       
1790 7081      05083       btg   port_triak,triak1
               05084       
               05085       
               05086       
1792 EF7F F00C 05087       goto        wykryto_enter_exit
               05088       
               05089       
               05090       
               05091       
               05092       
               05093       
               05094       
               05095       
               05096       
               05097       
               05098       
               05099       
               05100       
               05101       
               05102       
               05103       
               05104       
1796 05105 wykryto_enter_sprawdz_opcje8
1796 0E08      05106       movlw       opcja_wlacz_2
1798 63E1      05107       cpfseq      numer_opcji
179A EFD2 F00B 05108       goto        wykryto_enter_sprawdz_opcje9
               05109       
179E 7281      05110       btg   port_triak,triak2
               05111       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 112


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05112       
               05113       
17A0 EF7F F00C 05114       goto        wykryto_enter_exit
               05115       
               05116       
               05117       
               05118       
               05119       
               05120       
               05121       
               05122       
               05123       
               05124       
               05125       
               05126       
               05127       
               05128       
               05129       
17A4 05130 wykryto_enter_sprawdz_opcje9
17A4 0E09      05131       movlw       opcja_histereza1
17A6 63E1      05132       cpfseq      numer_opcji
17A8 EFE2 F00B 05133       goto        wykryto_enter_sprawdz_opcje10
               05134       
               05135       ;wlacz pomiar pradu
               05136       ;jako test wlacz podswietlenie lub je wylacz
               05137       
               05138       ;btg   portlampka2,lampka2
17AC 51E6      05139       movf        histereza1,w
17AE 6F92      05140       movwf       tmp_hex
               05141       
17B0 6B93      05142       clrf        tmp_hex_H
17B2 6B98      05143       clrf        dec1
17B4 6B97      05144       clrf        dec10
17B6 ECEE F001 05145       call        hex2dec18
               05146 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               05147       ;wyświetlam obok nazwy opcji czyli 
17BA EC8E F00C 05148       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               05149       
17BE 8FE0      05150       bsf         pozycja_menu,zmiana_opcji
               05151       
17C0 EF7F F00C 05152       goto        wykryto_enter_exit
               05153 
               05154       
               05155       
               05156       
               05157       
               05158       
               05159       
17C4 05160 wykryto_enter_sprawdz_opcje10
17C4 0E0A      05161          movlw       opcja_histereza2
17C6 63E1      05162       cpfseq      numer_opcji
17C8 EFF2 F00B 05163       goto        wykryto_enter_sprawdz_opcje11
               05164       
               05165       ;wlacz pomiar pradu
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 113


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05166       ;jako test wlacz podswietlenie lub je wylacz
               05167       
               05168       ;btg   portlampka2,lampka2
17CC 51E7      05169       movf        histereza2,w
17CE 6F92      05170       movwf       tmp_hex
               05171       
17D0 6B93      05172       clrf        tmp_hex_H
17D2 6B98      05173       clrf        dec1
17D4 6B97      05174       clrf        dec10
17D6 ECEE F001 05175       call        hex2dec18
               05176 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               05177       ;wyświetlam obok nazwy opcji czyli 
17DA EC8E F00C 05178       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               05179       
17DE 8FE0      05180       bsf         pozycja_menu,zmiana_opcji
               05181       
17E0 EF7F F00C 05182       goto        wykryto_enter_exit
               05183       
               05184       
               05185     
               05186     
               05187     
               05188     
               05189     
               05190     
               05191     
17E4 05192 wykryto_enter_sprawdz_opcje11
17E4 0E0B      05193           movlw       opcja_czujnik_regulacji
17E6 63E1      05194       cpfseq      numer_opcji
17E8 EF02 F00C 05195       goto        wykryto_enter_sprawdz_opcje12
               05196       
               05197       ;wlacz pomiar pradu
               05198       ;jako test wlacz podswietlenie lub je wylacz
               05199       
               05200       ;btg   portlampka2,lampka2
17EC 51E9      05201       movf        ktory_czujnik_reguluje ,w
17EE 6F92      05202       movwf       tmp_hex
               05203       
17F0 6B93      05204       clrf        tmp_hex_H
17F2 6B98      05205       clrf        dec1
17F4 6B97      05206       clrf        dec10
17F6 ECEE F001 05207       call        hex2dec18
               05208 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               05209       ;wyświetlam obok nazwy opcji czyli 
17FA EC8E F00C 05210       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               05211       
17FE 8FE0      05212       bsf         pozycja_menu,zmiana_opcji
               05213       
1800 EF7F F00C 05214       goto        wykryto_enter_exit
               05215 
               05216       
               05217        
               05218 
               05219 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 114


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05220      
1804 05221 wykryto_enter_sprawdz_opcje12
1804 0E0C      05222       movlw       opcja_ustaw_serial
1806 63E1      05223       cpfseq      numer_opcji
1808 EF09 F00C 05224       goto        wykryto_enter_sprawdz_opcje13
               05225       
180C 799F      05226       btg         markers,czy_wysylac_pomiary_serial      
               05227       
               05228            
180E EF7F F00C 05229       goto        wykryto_enter_exit
               05230       
               05231       
               05232        
               05233       
1812 05234 wykryto_enter_sprawdz_opcje13      
               05235 
1812 0E0D      05236       movlw       opcja_wyswietl_zegar
1814 63E1      05237       cpfseq      numer_opcji
1816 EF10 F00C 05238       goto        wykryto_enter_sprawdz_opcje14
               05239       
181A 739E      05240       btg   znaczniki,czy_ponownie_wlaczyc_zegar
               05241       
181C EF7F F00C 05242       goto        wykryto_enter_exit
               05243       
               05244       
               05245       
               05246       
               05247       
               05248       
1820 05249 wykryto_enter_sprawdz_opcje14
               05250 
1820 0E0E      05251       movlw       opcja_wyswietl_temp
1822 63E1      05252       cpfseq      numer_opcji
1824 EF17 F00C 05253       goto        wykryto_enter_sprawdz_opcje15
               05254       
1828 719E      05255       btg   znaczniki,czy_ponownie_wlaczyc_temp
               05256       
182A EF7F F00C 05257       goto        wykryto_enter_exit
               05258 
               05259       
               05260       
               05261       
               05262       
               05263       
182E 05264 wykryto_enter_sprawdz_opcje15
               05265 
182E 0E0F      05266       movlw       opcja_podswietlenie
1830 63E1      05267       cpfseq      numer_opcji
1832 EF1E F00C 05268       goto        wykryto_enter_sprawdz_opcje16
               05269       
1836 7881      05270       btg   portlampka2,lampka2
               05271       
1838 EF7F F00C 05272       goto        wykryto_enter_exit
               05273 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 115


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05274       
               05275       
               05276       
               05277      
183C 05278 wykryto_enter_sprawdz_opcje16
183C 0E10      05279       movlw       opcja_ustaw_zegar
183E 63E1      05280       cpfseq      numer_opcji
1840 EF29 F00C 05281       goto        wykryto_enter_sprawdz_opcje17
               05282       ;czyszcze rejestr przechowujący wyświetlaną liczbę
1844 0ED7      05283       movlw       dzien_10
1846 6FE8      05284       movwf        ustawianie_czasu_co_wyswietlam
1848 8FE0      05285       bsf         pozycja_menu,zmiana_opcji
               05286       
184A ECBB F00C 05287       call        procedura_wyswietlania_kolejnych_liczb_zegara
               05288       
               05289       
184E EF7F F00C 05290       goto        wykryto_enter_exit
               05291             
               05292       
               05293       
               05294  
               05295       
               05296       
               05297       
               05298       
1852 05299 wykryto_enter_sprawdz_opcje17      
1852 EF7F F00C 05300       goto        wykryto_enter_exit
               05301       
               05302       
               05303       
               05304       
               05305       
               05306       
               05307       
               05308       
               05309       
               05310       
               05311       
               05312       
1856 05313 wykryto_enter_zmiana_opcji
1856 0E01      05314       movlw       opcja_czujniki
1858 63E1      05315       cpfseq      numer_opcji
185A EF3D F00C 05316       goto          wykryto_enter_wyjscie_opcje2
               05317       
               05318       
185E ECAE F00C 05319       call     enter_back_wyjsc_z_opcji_czujniki
               05320       
               05321       ;jeżeli zmieniam ilość obsługiwanych czujników temp
               05322       ;to tu powinno być wyjście z opcji włączania czujników
               05323       ;czyli jeżeli ile_kanalow > 0 to włącz pomiary
               05324       
1862 51A5      05325       movf         ile_kanalow,w
1864 E04C      05326       bz          wykryto_enter_exit
               05327       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 116


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05328       
1866 6FA6      05329       movwf    ktory_kanal_mierze
               05330       
               05331       
1868 51A7      05332       movf    odstep_pomiarowy,w
               05333       
186A 6FA8      05334       movwf    aktualny_odstep
               05335       
               05336       
186C 85A0      05337       bsf      markers2,pomiary
186E 859F      05338       bsf      markers,pomiary_zrobione
1870 819F      05339       bsf       markers,czy_usrednianie
               05340       ;włączyć trzeba moduł A/D
1872 0E01      05341       movlw    b'00000001'
1874 6EC2      05342       movwf    ADCON0
               05343       ;bsf      markers,czy_wyswietlam_temp
1876 EF7F F00C 05344       goto        wykryto_enter_exit
               05345             
               05346       
187A 05347 wykryto_enter_wyjscie_opcje2
               05348 ;opcja z liczbą      
187A 0E02      05349       movlw       opcja_odstep
187C 63E1      05350       cpfseq      numer_opcji
187E EF45 F00C 05351       goto          wykryto_enter_wyjscie_opcje3
1882 ECEC F00C 05352       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05353       
               05354       ;call  wykryto_enter_back_wyjsc_z_opcji_skasuj_liczbe
               05355       
               05356       
               05357       
1886 EF7F F00C 05358       goto        wykryto_enter_exit
               05359       
188A 05360 wykryto_enter_wyjscie_opcje3
               05361       
188A 0E03      05362       movlw       opcja_srednia
188C 63E1      05363       cpfseq      numer_opcji
188E EF4D F00C 05364       goto          wykryto_enter_wyjscie_opcje4
1892 ECEC F00C 05365       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05366       
               05367      ; bcf        pozycja_menu,zmiana_opcji
               05368       
1896 EF7F F00C 05369       goto        wykryto_enter_exit
               05370       
               05371 
189A 05372 wykryto_enter_wyjscie_opcje4
               05373 
189A 05374 wykryto_enter_wyjscie_opcje5
               05375 
189A 0E05      05376       movlw       opcja_ustaw_temp
189C 63E1      05377       cpfseq      numer_opcji
189E EF55 F00C 05378       goto          wykryto_enter_wyjscie_opcje6
18A2 ECEC F00C 05379       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05380       
               05381       ;bcf        pozycja_menu,zmiana_opcji
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 117


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05382       
18A6 EF7F F00C 05383       goto        wykryto_enter_exit
               05384       
18AA 05385 wykryto_enter_wyjscie_opcje6
               05386 
18AA 05387 wykryto_enter_wyjscie_opcje9
               05388 
18AA 0E09      05389       movlw       opcja_histereza1
18AC 63E1      05390       cpfseq      numer_opcji
18AE EF5D F00C 05391       goto          wykryto_enter_wyjscie_opcje10
18B2 ECEC F00C 05392       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05393       
               05394       ;bcf        pozycja_menu,zmiana_opcji
               05395       
18B6 EF7F F00C 05396       goto        wykryto_enter_exit
               05397 
               05398 
18BA 05399 wykryto_enter_wyjscie_opcje10
18BA 0E0A      05400          movlw       opcja_histereza2
18BC 63E1      05401       cpfseq      numer_opcji
18BE EF65 F00C 05402       goto          wykryto_enter_wyjscie_opcje11
18C2 ECEC F00C 05403       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05404       
               05405       ;bcf        pozycja_menu,zmiana_opcji
               05406       
18C6 EF7F F00C 05407       goto        wykryto_enter_exit
               05408 
               05409 
               05410 
18CA 05411 wykryto_enter_wyjscie_opcje11
18CA 0E0B      05412       movlw       opcja_czujnik_regulacji
18CC 63E1      05413       cpfseq      numer_opcji
18CE EF6D F00C 05414       goto          wykryto_enter_wyjscie_opcje12
18D2 ECEC F00C 05415       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05416       
               05417       ;bcf        pozycja_menu,zmiana_opcji
               05418       
18D6 EF7F F00C 05419       goto        wykryto_enter_exit      
               05420       
               05421       
18DA 05422 wykryto_enter_wyjscie_opcje12      
               05423 
               05424 
               05425 
               05426 
               05427 
               05428 
               05429 
18DA 05430 wykryto_enter_wyjscie_opcje16
18DA 0E10      05431       movlw       opcja_ustaw_zegar
18DC 63E1      05432       cpfseq      numer_opcji
18DE EF7F F00C 05433       goto        wykryto_enter_wyjscie_opcje17
               05434 
               05435       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 118


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05436       
               05437       ; movlw       dzien_10
               05438       ; cpfseq      ustawianie_czasu_co_wyswietlam
               05439       ; goto        wykryto_enter_wyjscie_opcje11_D
               05440       
               05441       ; movlw       godziny_10
               05442       ; cpfseq      ustawianie_czasu_co_wyswietlam
               05443       ; goto        wykryto_enter_wyjscie_opcje11_H
               05444       
               05445       
18E2 0EDD      05446       movlw      sekundy_10
18E4 63E8      05447       cpfseq      ustawianie_czasu_co_wyswietlam
18E6 EF79 F00C 05448       goto        wykryto_enter_wyjscie_opcje11_1
               05449       
               05450       ;jezeli jest w tej chwili sekundy_10 tzn ze wychodze z wyswietlania ustawien zegara
               05451             
18EA ECEC F00C 05452       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05453       
               05454             
18EE EF7F F00C 05455       goto        wykryto_enter_exit
               05456       
               05457 
               05458 ; wykryto_enter_wyjscie_opcje11_D
               05459 
               05460       ; movlw       godziny_10
               05461       ; movwf       ustawianie_czasu_co_wyswietlam
               05462       
               05463       ; call        procedura_wyswietlania_kolejnych_liczb_zegara
               05464       ; goto        wykryto_enter_exit
               05465       
               05466 
               05467 ; wykryto_enter_wyjscie_opcje11_H
               05468       ; movlw       minuty_10
               05469       ; movwf       ustawianie_czasu_co_wyswietlam
               05470       ; call        procedura_wyswietlania_kolejnych_liczb_zegara
               05471       ; goto        wykryto_enter_exit
               05472       
               05473 
               05474       
18F2 05475 wykryto_enter_wyjscie_opcje11_1
18F2 0E02      05476       movlw       2
18F4 27E8      05477       addwf       ustawianie_czasu_co_wyswietlam,f
18F6 ECBB F00C 05478       call        procedura_wyswietlania_kolejnych_liczb_zegara
18FA EF7F F00C 05479       goto        wykryto_enter_exit
               05480 
               05481 
               05482 
               05483 
               05484 
               05485 
               05486 
18FE 05487 wykryto_enter_wyjscie_opcje17
               05488 
               05489 ;             
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 119


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05490 ;       call     check_busy
               05491 ;       movlw    linia_czwarta
               05492 ;       call      send
               05493 ;         
               05494 ;       call     check_busy
               05495 ; ;czy gasze czy wyswietlam      
               05496 ;       btfsc       markers,test
               05497 ;       goto        zamaz_E
               05498 ; napisz_E
               05499 ;       bsf   markers,test
               05500 ;       movlw       _E
               05501 ;       goto  wykryto_back_pisz
               05502 ; zamaz_E
               05503 ;       bcf   markers,test
               05504 ;       movlw       _puste
               05505 ;       
               05506 ; wykryto_enter_pisz
               05507 ;       call     write_lcd
               05508       
               05509       
               05510       
18FE 05511 wykryto_enter_exit 
18FE 9BA1      05512       bcf   markers3,dzialanie_po_klawiszu
1900 6B99      05513       clrf  stan_key
1902 EFF1 F00D 05514       goto  LOOP11
               05515  
               05516 ;wykryto_enter_back_wyjsc_z_opcji_skasuj_liczbe
               05517 ;odczytaj_polozenie_gwiazdki_wybierz_linie
               05518  
1906 05519 odczytaj_adres_polozenia_gwiazdki
1906 0E1B      05520       movlw       HIGH tablica_gwiazdki
1908 6EF7      05521       movwf       TBLPTRH
               05522       
190A 0EA6      05523       movlw       LOW tablica_gwiazdki
190C 6EF6      05524       movwf       TBLPTRL
               05525       
               05526       ;poniewaz najpierw zmniejszam polozenie
               05527       
190E 51E2      05528       movf       polozenie_gwiazdki,w
               05529       
1910 26F6      05530       addwf       TBLPTRL,f
               05531       
               05532       
               05533       
1912 EC32 F001 05534       call        check_busy
               05535        ;a nastepnie czytam to uzywam polecenia
1916 0008      05536       TBLRD *
1918 50F5      05537       movf        TABLAT,w
               05538 ;na zakończenie procedury adres linii z gwiazdką jest umieszczany w rejestrze W
191A 0012      05539       return
               05540       
               05541       
191C 05542 wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               05543 ;aby liczba wyświetlana znalazła się obok swojej opcji w menu, należy wcześniej odczytać aktualne położenie gwiazdki
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 120


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05544 ;z tablicy
               05545 ;dzięki temu uniknięte zostanie wielokrotne powtarzanie procedur wyświetlania liczb w zależności od opcji przy której umieszczona ma być wartośc liczby
               05546 ;poza tym w wypadku zmiany położenia opcji w tablicy opcji menu ( z linii 2 na 3) to zmiana nastąpi automatycznie
               05547 ;gdyż to położenie gwiazdki decyduje o położeniu cyfr
191C 0E1B      05548       movlw       HIGH tablica_gwiazdki
191E 6EF7      05549       movwf       TBLPTRH
               05550       
1920 0EA6      05551       movlw       LOW tablica_gwiazdki
1922 6EF6      05552       movwf       TBLPTRL
               05553       
               05554       ;poniewaz najpierw zmniejszam polozenie
               05555       
1924 51E2      05556       movf       polozenie_gwiazdki,w
               05557       
1926 26F6      05558       addwf       TBLPTRL,f
               05559       
               05560       
               05561       
1928 EC32 F001 05562       call        check_busy
               05563        ;a nastepnie czytam to uzywam polecenia
192C 0008      05564       TBLRD *
192E 50F5      05565       movf        TABLAT,w
               05566   ;teraz należy do adresu lini dodać miejsce położenia cyfry 100
               05567   
               05568 
1930 0F0D      05569       addlw       0x0d       
1932 ECF4 F000 05570       call        send
1936 EC32 F001 05571       call        check_busy
               05572  
               05573  ;i wyswietlic wszystkie cyfry
193A 5196      05574       movf        dec100,w
193C 0F30      05575       addlw       0x30
193E EC05 F001 05576       call        write_lcd      
1942 EC32 F001 05577       call        check_busy
               05578       
1946 5197      05579       movf        dec10,w      
1948 0F30      05580       addlw       0x30
194A EC05 F001 05581       call        write_lcd      
               05582       
194E EC32 F001 05583       call        check_busy
1952 5198      05584       movf        dec1,w
1954 0F30      05585       addlw       0x30
1956 EC05 F001 05586       call        write_lcd      
               05587       
195A 0012      05588       return
               05589       
               05590 
               05591 
               05592 
               05593 
               05594       
195C 05595 enter_back_wyjsc_z_opcji_czujniki
               05596 
               05597       ;czysc ustawienia opcji i zgas bit zmiana_opcji
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 121


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05598        
195C 9FE0      05599        bcf        pozycja_menu,zmiana_opcji
195E EC32 F001 05600        call     check_busy
1962 0E80      05601       movlw    linia_gorna
1964 0F0C      05602       addlw       0xc
1966 ECF4 F000 05603       call      send
               05604       ;
               05605       
196A EC32 F001 05606       call     check_busy
196E 0E20      05607       movlw       _puste
1970 EC05 F001 05608       call        write_lcd
               05609       
1974 0012      05610       return
               05611        
               05612        
               05613        
               05614        
               05615        
               05616        
               05617        
               05618        
               05619        
               05620        
               05621        
               05622        
               05623        
               05624        
               05625        
               05626        
               05627        
               05628        
               05629        
               05630        
               05631        
1976 05632 procedura_wyswietlania_kolejnych_liczb_zegara
               05633 
1976 EC83 F00C 05634       call  odczytaj_adres_polozenia_gwiazdki
197A 0F0C      05635       addlw       0x0c
197C ECF4 F000 05636       call        send
               05637       
1980 EC32 F001 05638       call        check_busy
               05639       
               05640 ;która litera jest wyświetlana obok cyfr = D - day, H - hours, M - minute, S- seconds      
1984 0ED7      05641       movlw       dzien_10
1986 63E8      05642       cpfseq      ustawianie_czasu_co_wyswietlam
1988 EFC9 F00C 05643       goto        procedura_wyswietlania_kolejnych_liczb_zegara_1
198C 0E44      05644       movlw       _D
198E EFD8 F00C 05645       goto        procedura_wyswietlania_kolejnych_liczb_zegara_4
               05646 
               05647 
               05648 
               05649 
               05650       
1992 05651 procedura_wyswietlania_kolejnych_liczb_zegara_1
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 122


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05652 
1992 0ED9      05653       movlw       godziny_10
1994 63E8      05654       cpfseq      ustawianie_czasu_co_wyswietlam
1996 EFD0 F00C 05655       goto        procedura_wyswietlania_kolejnych_liczb_zegara_2
199A 0E48      05656       movlw       _H
199C EFD8 F00C 05657       goto        procedura_wyswietlania_kolejnych_liczb_zegara_4
               05658       
               05659 
               05660 
               05661 
               05662       
19A0 05663 procedura_wyswietlania_kolejnych_liczb_zegara_2
               05664 
19A0 0EDB      05665       movlw       minuty_10
19A2 63E8      05666       cpfseq      ustawianie_czasu_co_wyswietlam
19A4 EFD7 F00C 05667       goto        procedura_wyswietlania_kolejnych_liczb_zegara_3
19A8 0E4D      05668       movlw       _M
19AA EFD8 F00C 05669       goto        procedura_wyswietlania_kolejnych_liczb_zegara_4
               05670 
               05671 
               05672 
               05673 
               05674       
19AE 05675 procedura_wyswietlania_kolejnych_liczb_zegara_3     
               05676 
               05677       ; movlw       sekundy_10
               05678       ; cpfseq      ustawianie_czasu_co_wyswietlam
               05679       ; goto        procedura_wyswietlania_kolejnych_liczb_zegara_1
19AE 0E53      05680       movlw       _S
               05681 
               05682 
               05683 
               05684 
               05685       
19B0 05686 procedura_wyswietlania_kolejnych_liczb_zegara_4            
               05687       
19B0 EC05 F001 05688       call        write_lcd
               05689       
19B4 6ADA      05690       clrf        FSR2H
19B6 51E8      05691       movf        ustawianie_czasu_co_wyswietlam,w
19B8 6ED9      05692       movwf      FSR2L      
               05693       
19BA EC32 F001 05694       call        check_busy
19BE 50DF      05695       movf        INDF2,w      
19C0 EC05 F001 05696       call        write_lcd
               05697       
19C4 EC32 F001 05698       call        check_busy
               05699       
19C8 2AD9      05700       incf        FSR2L,f
19CA 50DF      05701       movf        INDF2,w      
19CC EC05 F001 05702       call        write_lcd
               05703       
19D0 EC32 F001 05704       call        check_busy
               05705       
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 123


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
19D4 2AD9      05706       incf        FSR2L,f       
               05707        
19D6 0012      05708       return
               05709 
               05710 
               05711 
               05712 
               05713 
               05714 
               05715 
               05716 
               05717 
               05718 
               05719 
               05720 
               05721 
               05722 
               05723 
               05724 
               05725 
               05726       
               05727 
19D8 05728 enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05729 
               05730 ;procedrura analogiczna to tej związanej z obsługą wyświetlania rejestru
19D8 0E1B      05731       movlw       HIGH tablica_gwiazdki
19DA 6EF7      05732       movwf       TBLPTRH
               05733       
19DC 0EA6      05734       movlw       LOW tablica_gwiazdki
19DE 6EF6      05735       movwf       TBLPTRL
               05736       
               05737       ;poniewaz najpierw zmniejszam polozenie
               05738       
19E0 51E2      05739       movf       polozenie_gwiazdki,w
               05740       
19E2 26F6      05741       addwf       TBLPTRL,f
               05742       
               05743        ;a nastepnie czytam to uzywam polecenia
19E4 0008      05744       TBLRD *
               05745       
19E6 EC32 F001 05746       call        check_busy
               05747       
19EA 50F5      05748       movf        TABLAT,w
               05749 ;teraz należy do adresu lini dodać miejsce położenia cyfry 100
19EC 0F0B      05750       addlw       0x0b 
19EE ECF4 F000 05751       call        send
               05752       
19F2 EC32 F001 05753       call        check_busy       
19F6 0E20      05754       movlw       _puste
19F8 EC05 F001 05755       call        write_lcd      
19FC EC32 F001 05756       call        check_busy
1A00 0E20      05757       movlw       _puste
1A02 EC05 F001 05758       call        write_lcd      
1A06 EC32 F001 05759       call        check_busy
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 124


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1A0A 0E20      05760       movlw       _puste
1A0C EC05 F001 05761       call        write_lcd      
1A10 EC32 F001 05762       call        check_busy       
1A14 0E20      05763       movlw       _puste
1A16 EC05 F001 05764       call        write_lcd      
1A1A EC32 F001 05765       call        check_busy
1A1E 0E20      05766       movlw       _puste
1A20 EC05 F001 05767       call        write_lcd 
1A24 9FE0      05768       bcf        pozycja_menu,zmiana_opcji
               05769       
1A26 0012      05770       return
               05771 
               05772       
               05773       
               05774       
               05775       
               05776       
               05777       
               05778       
               05779       
               05780       
               05781       
               05782       
               05783       
               05784       
               05785 ;menu wyswietlane w ten sposob, ze na jednym ekranie umieszczone sa cztery opcje
               05786 ;a do kazdej linii odnosi sie zwiazana z nia tablica nazw opcji
               05787 ;przy przejsciu do kolejnego ekranu opcji nastepuje zmiana tych opcji na kolejne
               05788 
1B00           05789       org         1b00h
1B00 05790 tablica_pierwsza
1B00 6F70 696D 05791       db   "pomiar t",0,"odstep",0,"srednia",0,"regulacja",0
     7261 7420 
     6F00 7364 
     6574 0070 
     7273 6465 
     696E 0061 
     6572 7567 
     616C 6A63 
     0061      
               05792       
1B22 05793 tablica_druga
               05794 
1B22 7375 6174 05795       db    "ustaw t",0,"pomiar i" ,0, "wlacz1" ,0, "wlacz2" ,0
     2077 0074 
     6F70 696D 
     7261 6920 
     7700 616C 
     7A63 0031 
     6C77 6361 
     327A 0000 
               05796       
1B42 05797 tablica_trzecia
1B42 6968 7473 05798       db     "histereza1",0,"histereza2",0,"czuj. reg",0,"przesyl serial",0
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 125


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
     7265 7A65 
     3161 6800 
     7369 6574 
     6572 617A 
     0032 7A63 
     6A75 202E 
     6572 0067 
     7270 657A 
     7973 206C 
     6573 6972 
     6C61 0000 
               05799       
1B72 05800 tablica_czwarta
1B72 7977 7773 05801       db     "wyswietl. zegar",0,"wyswietl. temp",0,"podswietlenie",0,"zegar",0      
     6569 6C74 
     202E 657A 
     6167 0072 
     7977 7773 
     6569 6C74 
     202E 6574 
     706D 7000 
     646F 7773 
     6569 6C74 
     6E65 6569 
     7A00 6765 
     7261 0000 
               05802 ;####################  TABLICA POLOZEN gwiazdki
               05803 
1BA6 05804 tablica_gwiazdki        
1BA6 8000 90C0 05805       db    0,linia_gorna,linia_dolna,linia_trzecia,linia_czwarta,1
     01D0      
               05806       
               05807       
               05808 
               05809 
               05810 
               05811 
               05812 
               05813 
               05814 
               05815 
               05816 
               05817 
               05818 
               05819 
               05820 
               05821 
               05822 
               05823 
               05824 
               05825 ;;;; tu jest procedura PETLI
               05826 
               05827 
               05828 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 126


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05829 
               05830 
               05831 
               05832 
               05833 
               05834 
               05835       
               05836     
1BAC 05837 LOOP
               05838 
1BAC ABA1      05839       btfss       markers3,dzialanie_po_klawiszu
1BAE EFE5 F00D 05840       goto        LOOP_sprawdz_keys        
               05841 
               05842 
               05843       
1BB2 B199      05844       btfsc   stan_key,latch_back
1BB4 EFC5 F007 05845       goto    wykryto_back
               05846                   
1BB8 B399      05847       btfsc    stan_key,latch_down
1BBA EFD8 F007 05848       goto     wykryto_down
               05849                            
1BBE B599      05850       btfsc    stan_key,latch_up
1BC0 EF57 F009 05851       goto     wykryto_up
               05852          
1BC4 B799      05853       btfsc    stan_key,latch_enter
1BC6 EF37 F00B 05854       goto     wykryto_enter 
               05855       
               05856 ;jeżeli zaznaczono że należy zmieniać już wartości to sprawdź które klawisze i które procedury wywołuję      
               05857 ;      btfss       znaczniki,czy_moge_juz_zmieniac
               05858  ;     goto        
               05859       
               05860       
               05861       
1BCA 05862 LOOP_sprawdz_keys
1BCA A083      05863       btfss   latch_keys,latch_back
1BCC EC8C F007 05864       call    wcisnieto_back
               05865                   
1BD0 A283      05866       btfss    latch_keys,latch_down
1BD2 EC93 F007 05867       call     wcisnieto_down
               05868                            
1BD6 A483      05869       btfss    latch_keys,latch_up
1BD8 EC9F F007 05870       call     wcisnieto_up
               05871          
1BDC A683      05872       btfss    latch_keys,latch_enter
1BDE ECBE F007 05873       call     wcisnieto_enter
               05874 
1BE2 05875 LOOP11      
1BE2 B7A1      05876       btfsc markers3,odswiezanie_zegara
1BE4 EF21 F002 05877       goto  napisz_czas
               05878       
1BE8 05879 LOOP_temperatury      
               05880 ;jezeli jest ustawiony bit pomiary to sprawdz 
1BE8 A5A0      05881          btfss    markers2,pomiary
1BEA EF03 F00E 05882          goto     LOOP1
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 127


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05883 
               05884          
               05885 ;jezeli ustawiony jest bit czy_wlaczyc_ponownie_temp to nawet nie sprawdzaj
1BEE B7A1      05886             btfsc      markers3,odswiezanie_zegara
1BF0 EF03 F00E 05887             goto        LOOP1   
               05888          
1BF4 B59F      05889          btfsc    markers,pomiary_zrobione
1BF6 EF03 F00E 05890          goto     LOOP1
               05891          
1BFA B79F      05892          btfsc    markers,inicjuj_pomiary
1BFC EC67 F002 05893          call     rozpocznij_pomiary
               05894                   
1C00 B9A0      05895          btfsc    markers2,wyslij_pomiar
1C02 ECFF F005 05896          call     wysylanie_pomiaru
1C06 05897 LOOP1         
1C06 B3A0      05898          btfsc    markers2,przerwanie_t1
1C08 EC7B F002 05899          call     procedura_obslugi_zegara
               05900          
1C0C B7A0      05901          btfsc    markers2,sprawdz_odebrane
1C0E ECDE F004 05902          call     sprawdz_czy_polecenie
               05903 
               05904 
               05905 ;          btfsc    markers2,wyswietl
               05906 ;          call     wyswietl_litere
               05907                   
               05908 ;        btfsc    markers2,blad_transmisji
               05909 ;        call     wyswietl_error
               05910          
               05911          
               05912          
               05913 ;        btfsc    markers2,poczatkowy_bit
               05914 ;        call     poczatek_odbioru
               05915          
1C12 05916 LOOP2    
               05917          
               05918 
1C12 EFD6 F00D 05919          goto     LOOP
               05920          
               05921 
               05922 
               05923          
               05924          
               05925          
               05926          
               05927          
               05928          
               05929          
               05930          
               05931          
               05932          
               05933          
               05934          
               05935          
               05936          
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 128


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05937          
               05938          
               05939          
               05940          
               05941          
               05942          
               05943          
               05944          
               05945          
               05946          
               05947          
               05948          
               05949          
               05950          
               05951          
               05952          
               05953          
               05954          
               05955          
               05956          
               05957          
               05958 ;tu sa procedury inicjacyjne!
               05959 
               05960 
               05961 
               05962 
               05963 
               05964 
               05965 
               05966          
               05967 ; org    800h
               05968 ;ta funkcja zlicza nacisniecia klawisza rb0ółńżą
               05969 ;funkcja odczekuj?ca
               05970 
               05971 
               05972 
               05973          
               05974 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
               05975 
               05976 ;POCZATEK
               05977 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;       
               05978          ;org      0800h    
               05979 
               05980 
               05981                 
1C16 05982 inicjacja
               05983          ;ulamek 0,25 - tzn 1 
               05984           ;movlw    0x0
               05985           ;movlw   numer_opcji_koncowej
               05986           ;movwf   
               05987           ;movwf    tmp
               05988           ;decf    tmp,f
               05989           ;bsf   tmp,(menu_opcje_end)
               05990           ;btfss   STATUS,C
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 129


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05991           ;incf    tmp,f
               05992 ;          
               05993 ;          addlw    0xc3
               05994          ;movwf    tmp7
               05995          ;mnoze 2,5 * 0x30 tzn 
               05996          ;movlw    0x30
               05997          ;ulamek
               05998          ;mulwf    tmp
               05999          ;movf     PRODH,w
               06000          ;movwf    dec10
               06001          ;movf    PRODL,w
               06002          ;movwf    dec1
               06003          
               06004          ;movlw    0x30
               06005          
               06006          
               06007          ;mulwf    tmp7
               06008          
               06009          
1C16 6AD8      06010          clrf    STATUS ;czyszcze status
               06011          ;movlw    
               06012          ;clrf    czas;
1C18 6A80      06013          clrf     PORTA
1C1A 6A81      06014          clrf     PORTB
1C1C 6A82      06015          clrf     PORTC
1C1E 6A83      06016           clrf     PORTD
1C20 6A84      06017          clrf     PORTE
1C22 6A89      06018          clrf     LATA
1C24 6A8A      06019          clrf     LATB
1C26 6A8B      06020          clrf     LATC
1C28 6A8C      06021          clrf     LATD
1C2A 6A8D      06022          clrf     LATE
               06023 ;przerwania kompatybilne z 16fxx
1C2C 8ED0      06024          bsf      RCON,IPEN         
               06025          
               06026 ;ustawiam TMR1
               06027                                     ;Timer 1 ustawiony jako 1/16 sekundy
1C2E 0E01      06028          movlw    b'00000001'
1C30 6ECD      06029          movwf    T1CON
               06030 ;pzrerwania
1C32 6AF2      06031          clrf     INTCON
1C34 8EF2      06032          bsf      INTCON,GIE
1C36 8CF2      06033          bsf      INTCON,PEIE
               06034          
               06035          
1C38 6AF0      06036          clrf     INTCON3
1C3A 0E80      06037          movlw    b'10000000'
1C3C 6EF1      06038          movwf    INTCON2
1C3E 9AF2      06039          bcf     INTCON,TMR0IE
1C40 9896      06040          bcf      TRISE,PSPMODE
1C42 9AC6      06041          bcf      SSPCON1,SSPEN
1C44 9EAB      06042          BCF      RCSTA,SPEN
               06043          
               06044          ;ustawienia comparatora
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 130


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1C46 0E00      06045          movlw    b'00000000'
1C48 6EB5      06046          movwf    CVRCON
               06047          ;komparator wylaczony
1C4A 0E07      06048          movlw    b'00000111'
1C4C 6EB4      06049          movwf    CMCON
               06050          ;movlw   b'00000000'       ;wszystkie linie na wysoko
               06051          ;ovwf    PORTB
               06052          
1C4E 06053 CCP_init         
1C4E 0E00      06054          movlw    0
1C50 6EBD      06055          movwf    CCP1CON
1C52 6EBA      06056          movwf    CCP2CON
               06057          ;BCF     
1C54 6ACC      06058          clrf     TMR2
               06059          
1C56 06060 Timer3_init                                                 ;ustawienie zegara tmr3
1C56 0E61      06061             movlw       b'01100001'
1C58 6EB1      06062             movwf       T3CON
               06063          
               06064          
1C5A 06065 BEGIN2lcd_init
               06066          ;bsf      STATUS,RP0        ;bank 1
1C5A 6A9D      06067          clrf     PIE1
1C5C 6AA0      06068          clrf     PIE2
1C5E 809D      06069          bsf      PIE1,TMR1IE
               06070          
               06071      ;ustawiam na wyjscia 1 -wejscie
               06072         ;movlw   b'11111111'
               06073          
1C60 0E3F      06074          movlw    b'00111111'
1C62 6E92      06075          movwf    TRISA
               06076          
               06077 IF (czy_ekran==1)
1C64 0EE0      06078          movlw   b'11100000'
1C66 6E93      06079          movwf    TRISB
               06080 ENDIF
               06081 
               06082 IF (czy_ekran==0)
               06083          movlw   b'11111111'
               06084          movwf    TRISB
               06085 ENDIF
               06086 
1C68 0EA0      06087         movlw   b'10100000'
1C6A 6E94      06088          movwf    TRISC
               06089          
               06090 ;tu sie zminienia dla kabli
               06091         ;movlw   b'11111111'
               06092 IF (czy_ekran==1)        
1C6C 0E0F      06093          movlw    normalne_ustawienie_tris_lcd
1C6E 6E95      06094          movwf    TRISD
               06095 ENDIF
               06096          
               06097 IF (czy_ekran==0)
               06098          movlw    0x0F
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 131


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               06099          movwf    TRISD
               06100 ENDIF
               06101          
1C70 0E07      06102          movlw   b'00000111'
1C72 6E96      06103          movwf    TRISE
               06104          
               06105          
               06106 ;ustawienia timera 0
1C74 0EC7      06107          movlw    b'11000111'
1C76 6ED5      06108          movwf    T0CON
               06109  ;dopiero teraz w??cz zegar
               06110          
               06111 
               06112 
               06113 ;90  czyli 5a
               06114 ;50      32
               06115 ;210(200us) d2
               06116 ;196(190us) c4    
               06117 ;        movlw    b'11010010'
1C78 0E80      06118          movlw    0x80
1C7A 6ECB      06119          movwf    PR2
               06120          
               06121 ;bank 0
               06122          ;bcf      STATUS,RP0
               06123 ;        movlw    b'01000000'
               06124 ;        movwf    ADCON0
               06125          
               06126 ;ustawiam TMR2 z licznikiem 1:1
               06127          
               06128 ;wyczyscic trzeba pamiec na zmienne
               06129 ;jezeli tego nie zrobie to
               06130 ;po wlaczeniu zasilani moga pojawic
               06131 ; sie problemy bo moga tam byc losowe dane
               06132 ;od 000 do f7f
1C7C 0E80      06133          movlw    0x80
1C7E 6EE9      06134          movwf    FSR0L
1C80 6AEA      06135          clrf     FSR0H
1C82 06136 next
               06137          ;movlw   0
1C82 6AEF      06138          clrf     INDF0
1C84 2AE9      06139          INCF     FSR0L,f
               06140          ;movlw    0ffh
               06141          
1C86 A0D8      06142          btfss    STATUS,C
1C88 EF41 F00E 06143          goto     next
               06144          
1C8C 2AEA      06145          incf     FSR0H,f
1C8E 0E02      06146          movlw    b'00000010' ;02 banki
1C90 18EA      06147          xorwf    FSR0H,w
1C92 A4D8      06148          BTFSS    STATUS,Z
               06149          ;btfss    FSR0H,4
1C94 EF41 F00E 06150          goto     next
               06151          
1C98 EF81 F00E 06152          goto     test_koniec
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 132


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               06153 ;w przyadku testowania
               06154 
1C9C 0E00      06155          movlw    dane_odebraneL
1C9E 6EE9      06156          movwf    FSR0L
1CA0 0E01      06157          movlw    dane_odebraneH
1CA2 6EEA      06158          movwf    FSR0H
               06159          
               06160         
1CA4 0E1C      06161         movlw      HIGH(tab_test)
1CA6 6EFA      06162         movwf     PCLATH
1CA8 06163 test_petla        
               06164          
               06165          
               06166         
               06167         ;movf      PCLATH,w,0
1CA8 5191      06168          movf     tmp,w
1CAA EC61 F00E 06169          call     tab_test
               06170          
               06171          
               06172          
1CAE 6EEF      06173          movwf    INDF0
1CB0 0A00      06174          xorlw    0
1CB2 B4D8      06175          btfsc    STATUS,Z
1CB4 EF69 F00E 06176          goto     test_regulator
1CB8 2B91      06177          incf     tmp,f
1CBA 2B91      06178          incf     tmp,f
1CBC 2AE9      06179          incf     FSR0L,f
1CBE EF54 F00E 06180          goto     test_petla
               06181          
               06182          
1CC2 06183 tab_test
1CC2 26F9      06184          addwf    PCL,f
               06185          ;retlw    0x2a
               06186          
               06187          ;retlw    0x43
               06188          ;retlw    0x46
               06189          ;retlw    0x0d
1CC4 0C2A      06190          retlw    _star
               06191          ;retlw    _wiekszosci
               06192          ;retlw    _P     
1CC6 0C70      06193          retlw    _p
               06194          ;retlw    _1
               06195          
1CC8 0C30      06196          retlw    0x30
               06197          ;retlw    _
               06198          
               06199          ;retlw    _F
               06200          ;retlw    _
               06201          ;retlw    _F
1CCA 0C32      06202          retlw    0x32
               06203          ;retlw    _kropka
1CCC 0C30      06204          retlw    0x30
1CCE 0C36      06205          retlw    0x36
               06206          ;retlw    _e
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 133


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               06207          ;retlw    0x34
               06208          ;retlw    0x30
               06209          ;retlw    _A
               06210          ;retlw    0x30
               06211          ;retlw    0x37
1CD0 0C00      06212          retlw    0
               06213          
               06214          
1CD2 06215 test_regulator
               06216       ;bsf      markers2,sprawdz_odebrane
               06217          ;goto     test_koniec
               06218          
1CD2 0E01      06219          movlw    1
1CD4 6FA5      06220          movwf    ile_kanalow
               06221          
1CD6 0E00      06222          movlw    0
1CD8 6FA6      06223          movwf    ktory_kanal_mierze
               06224          
               06225          ;movwf     ktore_dzielenie_przez2
               06226          
1CDA 0E01      06227          movlw    0x01
1CDC 6FAF      06228          movwf    jak_duzo_probek
               06229          
1CDE 0E04      06230          movlw    0x04
1CE0 6FA7      06231          movwf    odstep_pomiarowy
1CE2 0E04      06232          movlw    0x04
1CE4 6FA8      06233         movwf    aktualny_odstep
               06234          
               06235          
1CE6 819F      06236          bsf       markers,czy_usrednianie
1CE8 85A0      06237          bsf      markers2,pomiary
1CEA 859F      06238          bsf      markers,pomiary_zrobione
1CEC 8B9F      06239          bsf      markers,czy_wyswietlam_temp
               06240          ;
1CEE 0E01      06241          movlw    0x01
1CF0 6EC2      06242          movwf    ADCON0   
               06243                
1CF2 0E0F      06244          movlw    0xf
1CF4 6F8D      06245          movwf    odebrano_liter
1CF6 0EFF      06246          movlw    0xff
1CF8 6F86      06247          movwf    linia1
1CFA 0EF0      06248          movlw    0xf0
1CFC 6F87      06249          movwf    linia2
1CFE 0E11      06250          movlw    0x11
1D00 6F9E      06251          movwf    znaczniki
               06252          
               06253          
               06254          
               06255          
1D02 06256 test_koniec
               06257          
               06258          ;bcf      PCLATH,3
               06259          ;bcf      PCLATH,4
1D02 6AFA      06260          clrf     PCLATH
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 134


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1D04 EF9C F001 06261          goto    Start
               06262                   
               06263 ;test ustawiania probkowania
               06264 ;0x2a 0x93 probka         
               06265 
               06266 
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 135


SYMBOL TABLE
  LABEL                             VALUE 

A                                 00000000
ACCESS                            00000000
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACQT0                             00000003
ACQT1                             00000004
ACQT2                             00000005
ADCON0                            00000FC2
ADCON1                            00000FC1
ADCON2                            00000FC0
ADCS0                             00000000
ADCS1                             00000001
ADCS2                             00000002
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADIP                              00000006
ADON                              00000000
ADRESH                            00000FC4
ADRESL                            00000FC3
AN0                               00000000
AN1                               00000001
AN10                              00000001
AN11                              00000004
AN12                              00000000
AN2                               00000002
AN3                               00000003
AN4                               00000005
AN5                               00000000
AN6                               00000001
AN7                               00000002
AN8                               00000002
AN9                               00000003
BANKED                            00000001
BCLIE                             00000003
BCLIF                             00000003
BCLIP                             00000003
BEGIN                             00000000
BEGIN2lcd_init                    00001C5A
BF                                00000000
BOR                               00000000
BRGH                              00000002
BSR                               00000FE0
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1                              00000002
CCP1CON                           00000FBD
CCP1IE                            00000002
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 136


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
CCP1IF                            00000002
CCP1IP                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP2                              00000001
CCP2A                             00000003
CCP2CON                           00000FBA
CCP2IE                            00000000
CCP2IF                            00000000
CCP2IP                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCPR1H                            00000FBF
CCPR1L                            00000FBE
CCPR2H                            00000FBC
CCPR2L                            00000FBB
CCP_init                          00001C4E
CFGS                              00000006
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CIS                               00000003
CK                                00000006
CKE                               00000006
CKP                               00000004
CLKI                              00000007
CLKO                              00000006
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             00000FB4
CMIE                              00000006
CMIF                              00000006
CMIP                              00000006
CREN                              00000004
CS                                00000002
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            00000FB5
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DC1B0                             00000004
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 137


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DONE                              00000001
D_A                               00000005
ECCPAS                            00000FB6
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             00000FA9
EECON1                            00000FA6
EECON2                            00000FA7
EEDATA                            00000FA8
EEIE                              00000004
EEIF                              00000004
EEIP                              00000004
EEPGD                             00000007
FAST                              00000001
FERR                              00000002
FLTS                              00000002
FREE                              00000004
FSR0                              00000000
FSR0H                             00000FEA
FSR0L                             00000FE9
FSR1                              00000001
FSR1H                             00000FE2
FSR1L                             00000FE1
FSR2                              00000002
FSR2H                             00000FDA
FSR2L                             00000FD9
GCEN                              00000007
GIE                               00000007
GIEH                              00000007
GIEL                              00000006
GO                                00000001
GO_DONE                           00000001
I2C_DAT                           00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
IDLEN                             00000007
INDF0                             00000FEF
INDF1                             00000FE7
INDF2                             00000FDF
INT0                              00000000
INT0IE                            00000004
INT0IF                            00000001
INT1                              00000001
INT1IE                            00000003
INT1IF                            00000000
INT1IP                            00000006
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 138


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
INT2                              00000002
INT2IE                            00000004
INT2IF                            00000001
INT2IP                            00000007
INTCON                            00000FF2
INTCON2                           00000FF1
INTCON3                           00000FF0
INTEDG0                           00000006
INTEDG1                           00000005
INTEDG2                           00000004
IOFS                              00000002
IPEN                              00000007
IPR1                              00000F9F
IPR2                              00000FA2
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRVST                             00000005
LATA                              00000F89
LATB                              00000F8A
LATC                              00000F8B
LATD                              00000F8C
LATE                              00000F8D
LOOP                              00001BAC
LOOP1                             00001C06
LOOP11                            00001BE2
LOOP2                             00001C12
LOOP_sprawdz_keys                 00001BCA
LOOP_temperatury                  00001BE8
LVDCON                            00000FD2
LVDEN                             00000004
LVDIE                             00000002
LVDIF                             00000002
LVDIN                             00000005
LVDIP                             00000002
LVDL0                             00000000
LVDL1                             00000001
LVDL2                             00000002
LVDL3                             00000003
MCLR                              00000003
N                                 00000004
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000002
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RI                            00000004
NOT_T1SYNC                        00000002
NOT_T3SYNC                        00000002
NOT_TO                            00000003
NOT_W                             00000002
NOT_WRITE                         00000002
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 139


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
OBF                               00000006
OERR                              00000001
OSC1                              00000007
OSC2                              00000006
OSCCON                            00000FD3
OSCFIE                            00000007
OSCFIF                            00000007
OSCFIP                            00000007
OSCTUNE                           00000F9B
OSTS                              00000003
OV                                00000003
P                                 00000004
P1A                               00000002
P1B                               00000005
P1C                               00000006
P1D                               00000007
P1M0                              00000006
P1M1                              00000007
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000FF9
PCLATH                            00000FFA
PCLATU                            00000FFB
PD                                00000002
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PEN                               00000002
PIE1                              00000F9D
PIE2                              00000FA0
PIN_HI                            0000077E
PIN_LO                            00000782
PIR1                              00000F9E
PIR2                              00000FA1
PLUSW0                            00000FEB
PLUSW1                            00000FE3
PLUSW2                            00000FDB
POR                               00000001
PORTA                             00000F80
PORTB                             00000F81
PORTC                             00000F82
PORTD                             00000F83
PORTE                             00000F84
POSTDEC0                          00000FED
POSTDEC1                          00000FE5
POSTDEC2                          00000FDD
POSTINC0                          00000FEE
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 140


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
POSTINC1                          00000FE6
POSTINC2                          00000FDE
PR2                               00000FCB
PREINC0                           00000FEC
PREINC1                           00000FE4
PREINC2                           00000FDC
PRODH                             00000FF4
PRODL                             00000FF3
PRSEN                             00000007
PSA                               00000003
PSP0                              00000000
PSP1                              00000001
PSP2                              00000002
PSP3                              00000003
PSP4                              00000004
PSP5                              00000005
PSP6                              00000006
PSP7                              00000007
PSPIE                             00000007
PSPIF                             00000007
PSPIP                             00000007
PSPMODE                           00000004
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PWM1CON                           00000FB7
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RBIP                              00000000
RBPU                              00000007
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 141


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
RC6                               00000006
RC7                               00000007
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCIP                              00000005
RCON                              00000FD0
RCREG                             00000FAE
RCSTA                             00000FAB
RD                                00000000
RD0                               00000000
RD1                               00000001
RD16                              00000007
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
RE3                               00000003
READ_WRITE                        00000002
RI                                00000004
RSEN                              00000001
RX                                00000007
RX9                               00000006
RX9D                              00000000
RXD                               00000007
R_W                               00000002
S                                 00000003
SCK                               00000003
SCL                               00000003
SCS0                              00000000
SCS1                              00000001
SDA                               00000004
SDI                               00000004
SDO                               00000005
SEN                               00000000
SMP                               00000007
SPBRG                             00000FAF
SPEN                              00000007
SREN                              00000005
SS                                00000005
SSPADD                            00000FC8
SSPBUF                            00000FC9
SSPCON1                           00000FC6
SSPCON2                           00000FC5
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPIP                             00000003
SSPM0                             00000000
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 142


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000FC7
STATUS                            00000FD8
STKFUL                            00000007
STKPTR                            00000FFC
STKUNF                            00000006
SWDTEN                            00000000
SYNC                              00000004
Start                             00000338
T08BIT                            00000006
T0CKI                             00000004
T0CON                             00000FD5
T0CS                              00000005
T0IP                              00000002
T0PS0                             00000000
T0PS1                             00000001
T0PS2                             00000002
T0SE                              00000004
T1CKI                             00000000
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000FCD
T1OSCEN                           00000003
T1OSI                             00000001
T1OSO                             00000000
T1RUN                             00000006
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000FCA
T3CCP1                            00000003
T3CCP2                            00000006
T3CKPS0                           00000004
T3CKPS1                           00000005
T3CON                             00000FB1
T3SYNC                            00000002
TABLAT                            00000FF5
TBLPTRH                           00000FF7
TBLPTRL                           00000FF6
TBLPTRU                           00000FF8
TMR0H                             00000FD7
TMR0IE                            00000005
TMR0IF                            00000002
TMR0IP                            00000002
TMR0L                             00000FD6
TMR0ON                            00000007
TMR1CS                            00000001
TMR1H                             00000FCF
TMR1IE                            00000000
TMR1IF                            00000000
TMR1IP                            00000000
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 143


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TMR1L                             00000FCE
TMR1ON                            00000000
TMR2                              00000FCC
TMR2IE                            00000001
TMR2IF                            00000001
TMR2IP                            00000001
TMR2ON                            00000002
TMR3CS                            00000001
TMR3H                             00000FB3
TMR3IE                            00000001
TMR3IF                            00000001
TMR3IP                            00000001
TMR3L                             00000FB2
TMR3ON                            00000000
TMR_nie_pusty                     00000556
TO                                00000003
TOSH                              00000FFE
TOSL                              00000FFD
TOSU                              00000FFF
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000F92
TRISB                             00000F93
TRISC                             00000F94
TRISD                             00000F95
TRISE                             00000F96
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
TX                                00000006
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXIP                              00000004
TXREG                             00000FAD
TXREG_nie_pusty                   0000055C
TXSTA                             00000FAC
Tab_zle_polecenie                 00000676
Timer3_init                       00001C56
UA                                00000001
VCFG0                             00000004
VCFG1                             00000005
VREFM                             00000002
VREFP                             00000003
W                                 00000000
WCOL                              00000007
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 144


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
WDTCON                            00000FD1
WR                                00000001
WREG                              00000FE8
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_0                                00000030
_1                                00000031
_2                                00000032
_3                                00000033
_4                                00000034
_5                                00000035
_6                                00000036
_7                                00000037
_8                                00000038
_9                                00000039
_A                                00000041
_B                                00000042
_BORV_20_2L                       000000FF
_BORV_27_2L                       000000FB
_BORV_42_2L                       000000F7
_BORV_45_2L                       000000F3
_BOR_OFF_2L                       000000FD
_BOR_ON_2L                        000000FF
_C                                00000043
_CCP2MX_B3_3H                     000000FE
_CCP2MX_C1_3H                     000000FF
_CCP2MX_OFF_3H                    000000FE
_CCP2MX_ON_3H                     000000FF
_CONFIG1H                         00300001
_CONFIG2H                         00300003
_CONFIG2L                         00300002
_CONFIG3H                         00300005
_CONFIG4L                         00300006
_CONFIG5H                         00300009
_CONFIG5L                         00300008
_CONFIG6H                         0030000B
_CONFIG6L                         0030000A
_CONFIG7H                         0030000D
_CONFIG7L                         0030000C
_CP0_OFF_5L                       000000FF
_CP0_ON_5L                        000000FE
_CP1_OFF_5L                       000000FF
_CP1_ON_5L                        000000FD
_CP2_OFF_5L                       000000FF
_CP2_ON_5L                        000000FB
_CP3_OFF_5L                       000000FF
_CP3_ON_5L                        000000F7
_CPB_OFF_5H                       000000FF
_CPB_ON_5H                        000000BF
_CPD_OFF_5H                       000000FF
_CPD_ON_5H                        0000007F
_D                                00000044
_DEBUG_OFF_4L                     000000FF
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 145


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_DEBUG_ON_4L                      0000007F
_DEVID1                           003FFFFE
_DEVID2                           003FFFFF
_E                                00000045
_EBTR0_OFF_7L                     000000FF
_EBTR0_ON_7L                      000000FE
_EBTR1_OFF_7L                     000000FF
_EBTR1_ON_7L                      000000FD
_EBTR2_OFF_7L                     000000FF
_EBTR2_ON_7L                      000000FB
_EBTR3_OFF_7L                     000000FF
_EBTR3_ON_7L                      000000F7
_EBTRB_OFF_7H                     000000FF
_EBTRB_ON_7H                      000000BF
_ECIO_OSC_1H                      000000F5
_EC_OSC_1H                        000000F4
_F                                00000046
_FSCM_OFF_1H                      000000BF
_FSCM_ON_1H                       000000FF
_G                                00000047
_H                                00000048
_HSPLL_OSC_1H                     000000F6
_HS_OSC_1H                        000000F2
_I                                00000049
_IDLOC0                           00200000
_IDLOC1                           00200001
_IDLOC2                           00200002
_IDLOC3                           00200003
_IDLOC4                           00200004
_IDLOC5                           00200005
_IDLOC6                           00200006
_IDLOC7                           00200007
_IESO_OFF_1H                      0000007F
_IESO_ON_1H                       000000FF
_INTIO1_OSC_1H                    000000F9
_INTIO2_OSC_1H                    000000F8
_J                                0000004A
_K                                0000004B
_L                                0000004C
_LP_OSC_1H                        000000F0
_LVP_OFF_4L                       000000FB
_LVP_ON_4L                        000000FF
_M                                0000004D
_MCLRE_OFF_3H                     0000007F
_MCLRE_ON_3H                      000000FF
_N                                0000004E
_O                                0000004F
_P                                00000050
_PBAD_ANA_3H                      000000FF
_PBAD_DIG_3H                      000000FD
_PWRT_OFF_2L                      000000FF
_PWRT_ON_2L                       000000FE
_Q                                00000051
_R                                00000052
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 146


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_RCIO_OSC_1H                      000000F7
_RC_OSC_1H                        000000FF
_S                                00000053
_STVR_OFF_4L                      000000FE
_STVR_ON_4L                       000000FF
_T                                00000054
_U                                00000055
_V                                00000056
_W                                00000057
_WDTPS_128_2H                     000000EF
_WDTPS_16K_2H                     000000FD
_WDTPS_16_2H                      000000E9
_WDTPS_1K_2H                      000000F5
_WDTPS_1_2H                       000000E1
_WDTPS_256_2H                     000000F1
_WDTPS_2K_2H                      000000F7
_WDTPS_2_2H                       000000E3
_WDTPS_32K_2H                     000000FF
_WDTPS_32_2H                      000000EB
_WDTPS_4K_2H                      000000F9
_WDTPS_4_2H                       000000E5
_WDTPS_512_2H                     000000F3
_WDTPS_64_2H                      000000ED
_WDTPS_8K_2H                      000000FB
_WDTPS_8_2H                       000000E7
_WDT_OFF_2H                       000000FE
_WDT_ON_2H                        000000FF
_WRT0_OFF_6L                      000000FF
_WRT0_ON_6L                       000000FE
_WRT1_OFF_6L                      000000FF
_WRT1_ON_6L                       000000FD
_WRT2_OFF_6L                      000000FF
_WRT2_ON_6L                       000000FB
_WRT3_OFF_6L                      000000FF
_WRT3_ON_6L                       000000F7
_WRTB_OFF_6H                      000000FF
_WRTB_ON_6H                       000000BF
_WRTC_OFF_6H                      000000FF
_WRTC_ON_6H                       000000DF
_WRTD_OFF_6H                      000000FF
_WRTD_ON_6H                       0000007F
_X                                00000058
_XT_OSC_1H                        000000F1
_Y                                00000059
_Z                                0000005A
__18F4320                         00000001
_a                                00000061
_b                                00000062
_c                                00000063
_d                                00000064
_dwukropek                        0000003A
_e                                00000065
_f                                00000066
_g                                00000067
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 147


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_h                                00000068
_i                                00000069
_j                                0000006A
_k                                0000006B
_kropka                           0000002E
_l                                0000006C
_linia_pionowa                    0000007C
_m                                0000006D
_minus                            0000002D
_mniejszosci                      0000003C
_n                                0000006E
_o                                0000006F
_p                                00000070
_plus                             0000002B
_przecinek                        0000002C
_puste                            00000020
_q                                00000071
_r                                00000072
_s                                00000073
_star                             0000002A
_stopni                           000000DF
_t                                00000074
_u                                00000075
_up                               0000005E
_v                                00000076
_w                                00000077
_wiekszosci                       0000003E
_x                                00000078
_y                                00000079
_z                                0000007A
aktualny_odstep                   000000A8
bajt_ds                           000000CA
bez_wlaczania_pomiarow            000004F6
bez_wyswietlania_pradu            00000D46
bez_wyswietlania_pradu2           00000D82
bez_wyswietlania_temp1            00000C78
bez_wyswietlania_temp2            00000D02
bit                               0000008C
blad_inicjacji_ds                 000007E4
bsr_temp                          00000083
check                             00000272
check_busy                        00000264
check_if_write                    00000316
clear_line                        00000246
clear_line_old                    00000218
clear_line_old2                   0000022C
clear_line_petla                  0000024C
cmd_off                           00000214
cyfry_0_9                         0000060A
czekam_na_kolejny_bit             000008BC
czujnik_ds1820                    00000005
czy_ekran                         00000001
czy_moge_juz_zmieniac             00000002
czy_pomiary_na_ekran              00000001
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 148


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
czy_ponownie_wlaczyc_temp         00000000
czy_ponownie_wlaczyc_zegar        00000001
czy_usrednianie                   00000000
czy_wlaczyc_ponownie_temp         00000006
czy_wyswietlam_temp               00000005
czy_wysylac_pomiary_serial        00000004
czy_wysylanie                     00000001
czy_zegar_wyswietlac              00000002
czytaj_eeprom                     0000030C
czytam_4_linie                    0000164E
czytam_4_linie2                   0000165A
czytam_4_linie3                   0000166C
czytam_druga_linie                00001612
czytam_druga_linie2               0000161E
czytam_pierwsza_linie             00001600
czytam_trzecia_linie              00001630
czytam_trzecia_linie2             0000163C
dana                              00000003
dane_lcd                          000000A2
dane_odebraneH                    00000001
dane_odebraneL                    00000000
dd_addres_set                     00000080
dec1                              00000098
dec10                             00000097
dec100                            00000096
disp_home                         00000002
display1_4b                       00000000
display2_4b                       0000000F
display_2                         0000000F
display_clear                     00000001
display_clear1_4b                 00000000
display_clear2_4b                 00000001
display_off                       00000008
display_on                        0000000C
dlugosc_oczekiwania_na_zmiane     00000004
do_sekundy                        000000DF
dzialanie_po_klawiszu             00000005
dzien_1                           000000D8
dzien_10                          000000D7
enable                            00000003
enter_back_wyjsc_z_opcji_czujniki  0000195C
enter_back_wyjsc_z_opcji_wyswietlanie_liczby  000019D8
entry                             00000006
entry1_4b                         00000000
entry2_4b                         0000000C
fsrh1_temp                        000000E5
fsrh_temp                         00000085
fsrl1_temp                        000000E4
fsrl_temp                         00000084
function_set1_4b                  00000003
function_set2                     00000008
function_set2_4b                  00000008
godziny_1                         000000DA
godziny_10                        000000D9
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 149


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
hex2_dec_koniec                   00000440
hex2dec18                         000003DC
hex2dec18_brak_setek              00000412
hex2dec18_nie_przekroczono_1      00000400
hex2dec_temperatur_popraw_o_128   00000430
hex2dec_temperatur_popraw_o_64    00000424
histereza1                        000000E6
histereza2                        000000E7
ile_kanalow                       000000A5
ile_znakow                        00000010
ilosc_czujnikow                   00000007
inicjacja                         00001C16
inicjacja_ds1820                  000007B6
inicjacja_ok                      0000080C
inicjuj_pomiar                    00000696
inicjuj_pomiary                   00000003
init_4bit                         0000002A
init_8bit                         00000030
jak_duzo_bajtow_odbieram_z_ds     000000B5
jak_duzo_kanalow_pradu            000000D5
jak_duzo_probek                   000000AF
jak_duzo_zliczen_tmr1_na_sekunde  00000010
jaka_wartosc_regulujeH            000000AD
jaka_wartosc_regulujeL            000000AE
juz_wysylac_znak_LF               00000EAC
kalibracja                        00000000
kb_change                         00000004
kb_cofnij                         00000005
kb_enter                          00000006
kb_minus                          00000007
koncz_z_moca                      00000E32
koniec_mierzenia                  00000E36
koniec_pomiarow                   00000EBC
koniec_wyswietlania               00000AB0
kopiuj_liczbe_przeslana           000005E2
ktora_probka                      000000B0
ktore_bity_lcd_tris               000000F0
ktore_bity_uzywane_na_lcd         0000000F
ktory_aktualnie_kanal_pradu       000000D6
ktory_czujnik_reguluje            000000E9
ktory_kanal                       000000B1
ktory_kanal_mierze                000000A6
ktory_rejestr_zapisuje            000000A9
lampka                            00000004
lampka2                           00000004
latch_back                        00000000
latch_down                        00000001
latch_enter                       00000003
latch_keys                        00000F83
latch_lcd                         00000F8C
latch_lcd_e                       00000F8B
latch_lcd_rs                      00000F8A
latch_lcd_rw                      00000F8A
latch_moc                         00000F8A
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 150


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
latch_multiplekser                00000F8B
latch_up                          00000002
lcd_init                          00000298
letter                            0000008A
liczba1                           0000008E
liczba2                           0000008F
liczba3                           00000090
linia1                            00000086
linia2                            00000087
linia3                            00000088
linia4                            00000089
linia_czwarta                     000000D0
linia_dolna                       000000C0
linia_druga                       000000C0
linia_gorna                       00000080
linia_pierwsza                    00000080
linia_trzecia                     00000090
ma                                00000002
mamy_back                         00000000
mamy_down                         00000001
mamy_enter                        00000003
mamy_up                           00000002
markers                           0000009F
markers2                          000000A0
markers3                          000000A1
mb                                00000001
mc                                00000000
menu_opcje1                       00000000
menu_opcje2                       00000001
menu_opcje3                       00000002
menu_opcje4                       00000003
menu_opcje_end                    00000004
minuty_1                          000000DC
minuty_10                         000000DB
n                                 0000008B
napisz_czas                       00000442
napisz_minus                      00000006
napisz_wartosc_temperatury        00000CD6
next                              00001C82
nie                               00000001
nie_czysc_rejestru_polozenia      00000C8A
nie_przekroczono_bajtu_ulamka     00000BEA
normalne_ustawienie_tris_lcd      0000000F
numer_opcji                       000000E1
numer_opcji_koncowej              00000010
odczytaj_adres_polozenia_gwiazdki  00001906
odebrano_liter                    0000008D
odejmij_512_od_wyniku_sredniej    00000B9E
odstep_pomiarowy                  000000A7
odswiezanie_zegara                00000003
odznacz_by_znow_mierzyc           000004BC
opcja_czujnik_regulacji           0000000B
opcja_czujniki                    00000001
opcja_histereza1                  00000009
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 151


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
opcja_histereza2                  0000000A
opcja_odstep                      00000002
opcja_podswietlenie               0000000F
opcja_pomiar_i                    00000006
opcja_regulacja                   00000004
opcja_srednia                     00000003
opcja_ustaw_serial                0000000C
opcja_ustaw_temp                  00000005
opcja_ustaw_zegar                 00000010
opcja_wlacz_1                     00000007
opcja_wlacz_2                     00000008
opcja_wyswietl_temp               0000000E
opcja_wyswietl_zegar              0000000D
pclath_temp                       00000082
petla_czy_jest_0                  00000896
petla_dzielenia                   00000BB8
petla_inicjacji1                  000007CC
petla_inicjacji2                  000007D8
petla_inicjacji3                  00000800
petla_napisz_czas                 00000482
petla_napisz_czas_dwukropek       00000478
petla_odbioru_ds1820              0000088C
petla_odczytu_poprawek_z_eeprom   00000344
petla_send0                       000007AA
petla_send1                       00000796
petla_sending                     0000085A
petla_wysylania_odebranych_bajtow  000008DA
pin_A                             00000000
pin_B                             00000001
pin_C                             00000002
pin_e_4724                        00000001
pisz_cyfre_1                      00000B20
pisz_cyfre_10                     00000B14
pisz_cyfre_100                    00000B08
pisz_ulamek_00                    00000B46
pisz_ulamek_25                    00000B5C
pisz_ulamek_50                    00000B72
pisz_ulamek_75                    00000B88
pokaz_rejestr                     0000061C
pokazuje_temperatury_47           00000007
polecenie_wysylane                000000B4
polozenie_danych_lcd              00000001
polozenie_gwiazdki                000000E2
polozenie_liczby_menu             0000000C
pomiar0H                          000000B6
pomiar0L                          000000B7
pomiar1H                          000000B8
pomiar1L                          000000B9
pomiar2H                          000000BA
pomiar2L                          000000BB
pomiar3H                          000000BC
pomiar3L                          000000BD
pomiar4H                          000000BE
pomiar4L                          000000BF
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 152


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
pomiar5H                          000000C0
pomiar5L                          000000C1
pomiar6H                          000000C2
pomiar6L                          000000C3
pomiar7H                          000000C4
pomiar7L                          000000C5
pomiarH                           000000AA
pomiarL                           000000AB
pomiar_prad1                      00000002
pomiar_prad1H                     000000C6
pomiar_prad1L                     000000C7
pomiar_prad2                      00000004
pomiar_prad2H                     000000C8
pomiar_prad2L                     000000C9
pomiar_ulamek                     000000AC
pomiary                           00000002
pomiary_pradu                     00000000
pomiary_zrobione                  00000002
poprawka0                         000000CB
poprawka0_ee                      00000000
poprawka1                         000000CC
poprawka1_ee                      00000001
poprawka2                         000000CD
poprawka2_ee                      00000002
poprawka3                         000000CE
poprawka3_ee                      00000003
poprawka4                         000000CF
poprawka4_ee                      00000004
poprawka5                         000000D0
poprawka5_ee                      00000005
poprawka6                         000000D1
poprawka6_ee                      00000006
poprawka7                         000000D2
poprawka7_ee                      00000007
poprawka_prad1                    000000D3
poprawka_prad1_ee                 00000008
poprawka_prad2                    000000D4
poprawka_prad2_ee                 00000009
port_CTS                          00000F82
port_RTS                          00000F82
port_ds1820                       00000F82
port_keys                         00000F83
port_lcd                          00000F83
port_lcd_e                        00000F82
port_lcd_rs                       00000F81
port_lcd_rw                       00000F81
port_multiplekser                 00000F82
port_serial                       00000F81
port_triak                        00000F81
portlampka2                       00000F81
powrot_z_polecen                  00000A52
pozycja_menu                      000000E0
procedura_obslugi_zegara          000004F6
procedura_regulacji_dwustawnej    00000D86
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 153


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
procedura_sumowania_wyniku        00000BD8
procedura_wyswietlania_kolejnych_liczb_zegara  00001976
procedura_wyswietlania_kolejnych_liczb_zegara_1  00001992
procedura_wyswietlania_kolejnych_liczb_zegara_2  000019A0
procedura_wyswietlania_kolejnych_liczb_zegara_3  000019AE
procedura_wyswietlania_kolejnych_liczb_zegara_4  000019B0
procek                            018F4320
przerwanie                        00000008
przerwanie_1                      0000002E
przerwanie_2                      0000003A
przerwanie_3                      00000046
przerwanie_4                      00000052
przerwanie_5                      0000005E
przerwanie_6                      00000064
przerwanie_7                      00000070
przerwanie_pomiaru                0000018A
przerwanie_t0                     00000000
przerwanie_t1                     00000001
przerwanie_wysylania              00000176
rcsta_temp                        000000A4
regulacja_dwu_moc_OFF             00000DB8
regulacja_dwu_moc_ON              00000DD0
regulacja_dwu_moc_ON_wylacz       00000DE2
reguluj                           00000006
rozkaz_rejestracji_poprawki_pomiaru_temperatury  00000970
rozkaz_wysylania_znaku_na_lcd     00000766
rozkazy_ds1820                    0000092A
rozpocznij_pomiary                000004CE
rs                                00000003
rw                                00000002
sa_rowne_nic_nie_rob              00000DE8
sa_rowne_sprawdz_Lbajt            00000DB2
sekundy_1                         000000DE
sekundy_10                        000000DD
send                              000001E8
send4bit_petla                    000001EE
send_0                            0000079E
send_1                            00000788
set_4bit                          00000028
set_8bit                          0000003C
sprawdz_10                        00000AC0
sprawdz_RTS_prad                  00000E3C
sprawdz_czy_ds1820_wysyla         00000884
sprawdz_czy_mam_dalej_mierzyc     00000DF0
sprawdz_czy_mam_dalej_mierzyc_prad  00000E02
sprawdz_czy_mam_wyswietlac_47     00000CA4
sprawdz_czy_mozna_wysylac         00000556
sprawdz_czy_odebrano_litere       000005AA
sprawdz_czy_odebrano_mala_litere  000005CA
sprawdz_czy_polecenie             000009BC
sprawdz_czy_wchodze_do_zmiany_opcji  000016BA
sprawdz_czy_wlaczyc_szybka_zmiane  00000F56
sprawdz_czy_wlaczyc_szybka_zmiane2  00000F62
sprawdz_czy_wlaczyc_szybka_zmiane3  00000F6E
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 154


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
sprawdz_dzien                     000000E2
sprawdz_godziny                   000000FC
sprawdz_ktore_polecenie           000009CE
sprawdz_odebrane                  00000003
sprawdz_zwiekszanie_godzin_normalnie  00001564
stan2_key                         0000009A
stan_key                          00000099
status_temp                       00000081
sumuj_liczby                      00000506
sumuj_liczby_do_kropki            0000050A
szybka_zmiana_wartosci            000000E3
tab_test                          00001CC2
tablica_czwarta                   00001B72
tablica_druga                     00001B22
tablica_gwiazdki                  00001BA6
tablica_pierwsza                  00001B00
tablica_trzecia                   00001B42
test_koniec                       00001D02
test_petla                        00001CA8
test_regulator                    00001CD2
tmp                               00000091
tmp6                              00000094
tmp7                              00000095
tmp_hex                           00000092
tmp_hex_H                         00000093
tmp_lcd                           000000A3
triak1                            00000000
triak2                            00000001
tris_lcd                          00000F95
trzymanie_klawisza                00000007
usrednianie_przez_co_mnoze        000000B2
usrednianie_wartosci              00000BB4
ustaw_linie_druga                 00000CC6
ustaw_linie_trzecia               00000CB6
ustaw_probki                      00000740
ustaw_regulator                   00000702
ustaw_spbrg                       00000610
ustaw_sprawdzanie_szybkiej_zmiany  00000F72
ustaw_wartosc_dzielenia_usredniania  00000720
ustaw_wyswietlanie_czasu_na_lcd   00000108
ustawianie_czasu_co_wyswietlam    000000E8
ustawienie_liczby_odbieranych_bajtow  0000090A
ustawienie_liczby_odbieranych_bajtow_zero  00000922
w_temp                            00000080
wait                              000001DA
wait_petla                        000001DC
wcisnieto_back                    00000F18
wcisnieto_down                    00000F26
wcisnieto_enter                   00000F7C
wcisnieto_klawisz                 00000004
wcisnieto_up                      00000F3E
wlacz_przerwanie_tmr3             00000F0C
wlaczenie_rejestracji_pradu       0000094E
write                             00000040
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 155


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
write_4bit                        00000010
write_lcd                         0000020A
wybor_czujnika_regulatora         000009A0
wybrano_czujnik_regulatora_wiekszy_od_7  000009B4
wyjscie_przerwanie                00000070
wykonano_pomiary_wszystkich_kanalow  00000E16
wykryto_back                      00000F8A
wykryto_back_exit                 00000FA8
wykryto_back_nic_nie_rob          00000FA8
wykryto_blad                      00000184
wykryto_down                      00000FB0
wykryto_down_3_wyswietl           00001114
wykryto_down_exit                 0000129C
wykryto_down_exit_trzymanie       000012AA
wykryto_down_sprawdz11_nie_ma_zero  000011B2
wykryto_down_sprawdz11_show       000011B4
wykryto_down_sprawdz12            000011CA
wykryto_down_sprawdz17            0000129C
wykryto_down_sprawdz_10           0000117A
wykryto_down_sprawdz_11           0000119A
wykryto_down_sprawdz_11_1         00001204
wykryto_down_sprawdz_11_2         00001238
wykryto_down_sprawdz_11_3         0000126C
wykryto_down_sprawdz_11_4         00001294
wykryto_down_sprawdz_16           000011CA
wykryto_down_sprawdz_2            000010D0
wykryto_down_sprawdz_3            000010F0
wykryto_down_sprawdz_3_zmniejsz_probki  00001108
wykryto_down_sprawdz_4            00001132
wykryto_down_sprawdz_5            00001132
wykryto_down_sprawdz_5_zawracanie  0000114E
wykryto_down_sprawdz_5_zero       00001152
wykryto_down_sprawdz_6            0000115A
wykryto_down_sprawdz_9            0000115A
wykryto_down_sprawdz_czy_wyswietlam_kolejne_opcje  00000FCE
wykryto_down_wyswietl_opcje_tablicy_cztery  0000105A
wykryto_down_wyswietl_opcje_tablicy_druga  0000103A
wykryto_down_wyswietl_opcje_tablicy_trzy  0000104A
wykryto_down_zmiana_opcji         0000109E
wykryto_down_zmiana_opcji_wyswietl_kanaly  000010B4
wykryto_down_zmiana_polozenia_gwiazdki  0000106A
wykryto_enter                     0000166E
wykryto_enter_exit                000018FE
wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa  0000191C
wykryto_enter_sprawdz_opcje10     000017C4
wykryto_enter_sprawdz_opcje11     000017E4
wykryto_enter_sprawdz_opcje12     00001804
wykryto_enter_sprawdz_opcje13     00001812
wykryto_enter_sprawdz_opcje14     00001820
wykryto_enter_sprawdz_opcje15     0000182E
wykryto_enter_sprawdz_opcje16     0000183C
wykryto_enter_sprawdz_opcje17     00001852
wykryto_enter_sprawdz_opcje2      000016E0
wykryto_enter_sprawdz_opcje3      00001700
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 156


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
wykryto_enter_sprawdz_opcje4      00001720
wykryto_enter_sprawdz_opcje5      0000172E
wykryto_enter_sprawdz_opcje6      00001774
wykryto_enter_sprawdz_opcje7      00001788
wykryto_enter_sprawdz_opcje8      00001796
wykryto_enter_sprawdz_opcje9      000017A4
wykryto_enter_wyjscie_opcje10     000018BA
wykryto_enter_wyjscie_opcje11     000018CA
wykryto_enter_wyjscie_opcje11_1   000018F2
wykryto_enter_wyjscie_opcje12     000018DA
wykryto_enter_wyjscie_opcje16     000018DA
wykryto_enter_wyjscie_opcje17     000018FE
wykryto_enter_wyjscie_opcje2      0000187A
wykryto_enter_wyjscie_opcje3      0000188A
wykryto_enter_wyjscie_opcje4      0000189A
wykryto_enter_wyjscie_opcje5      0000189A
wykryto_enter_wyjscie_opcje6      000018AA
wykryto_enter_wyjscie_opcje9      000018AA
wykryto_enter_zmiana_opcji        00001856
wykryto_odbior                    00000132
wykryto_odbior_CR                 00000162
wykryto_odbior_odczyt             00000132
wykryto_oerr                      0000017A
wykryto_rb                        00000116
wykryto_t0                        00000122
wykryto_t1                        0000008C
wykryto_t1_wyjscie                00000110
wykryto_t2                        0000012C
wykryto_t3                        000001A6
wykryto_t3_nie_puszczono          000001BE
wykryto_up                        000012AE
wykryto_up_3_wyswietl             00001464
wykryto_up_exit                   000015DE
wykryto_up_exit_trzymanie         000015EC
wykryto_up_sprawdz11_increase     000014F0
wykryto_up_sprawdz11_show         000014F2
wykryto_up_sprawdz_10             000014BA
wykryto_up_sprawdz_11             000014DA
wykryto_up_sprawdz_11_1           00001542
wykryto_up_sprawdz_11_2           0000157C
wykryto_up_sprawdz_11_3           000015AE
wykryto_up_sprawdz_11_4           000015D6
wykryto_up_sprawdz_12             00001508
wykryto_up_sprawdz_16             00001508
wykryto_up_sprawdz_17             000015DE
wykryto_up_sprawdz_2              0000141C
wykryto_up_sprawdz_3              0000143C
wykryto_up_sprawdz_3_zwieksz_probki  00001456
wykryto_up_sprawdz_4              0000147A
wykryto_up_sprawdz_5              0000147A
wykryto_up_sprawdz_5_dalej        00001492
wykryto_up_sprawdz_6              0000149A
wykryto_up_sprawdz_9              0000149A
wykryto_up_sprawdz_czy_wyswietlam_kolejne_opcje  000012CC
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 157


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
wykryto_up_wyswietl_opcje_tablicy_dwa  00001338
wykryto_up_wyswietl_opcje_tablicy_end  00001388
wykryto_up_wyswietl_opcje_tablicy_pierwsza  00001310
wykryto_up_wyswietl_opcje_tablicy_trzy  00001360
wykryto_up_zmiana_opcji           000013EC
wykryto_up_zmiana_opcji_wyswietl_kanaly  00001400
wykryto_up_zmiana_polozenia_gwiazdki  000013B8
wylacz_moc                        00000007
wylacz_pomiary                    000006E6
wylacz_regulator                  000006FA
wylaczam_moc                      00000E30
wylaczenie_rejestarcji_pradu      0000096A
wynik                             0000009C
wynik01                           0000009D
wynik_to_po_prostu_L              00000BB2
wynikh                            0000009B
wyslij_na_ekran_to_co_odebralem   00000A5C
wyslij_pomiar                     00000004
wyslij_znak                       00000564
wyslij_znak_koniec                00000584
wyslij_znak_petla                 0000056C
wyswietl_1                        00000494
wyswietl_cyfry_temperatury        00000AB6
wyswietl_cyfry_temperatury2       00000ACA
wyswietl_litere_petla             00000A72
wyswietl_litere_petla2            00000A8C
wyswietl_litere_petla3            00000AAA
wyswietl_opcje_menu               000015F0
wyswietl_puste                    00000492
wyswietl_temp_w_opcjach           00001740
wysylanie_bajtu_rozkazu           0000084C
wysylanie_danych                  0000083A
wysylanie_danych_rozkaz           00000840
wysylanie_pomiaru                 00000BFE
zalacz_grzanie                    00000DAA
zalacz_moc                        00000005
zamien_na_hex                     000005F8
zapal_lampke                      00000500
zapis_do_pamieci_prad             00000D06
zapis_do_pamieci_temperatury      00000C16
zapis_eeprom                      00000316
zapisz_do_dzien_1_0               00001532
zapisz_do_dzien_1_99              000011F4
zapisz_do_godziny_1_9             00001228
zapisz_do_minuty_1_0              0000159E
zapisz_do_minuty_1_9              0000125C
zapisz_do_pamieci                 00000C10
zapisz_do_pamieci_czy_mam_send    00000C2E
zapisz_do_pamieci_juz_po_SERIAL   00000C66
zapisz_do_pamieci_nie_sprawdzaj_przekroczenia  00000C2E
zapisz_do_sekundy_1_0             000015CA
zapisz_do_sekundy_1_9             00001288
zla_dana_wez_0                    000005DE
zle_polecenie                     00000654
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 158


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
zle_polecenie_petla               00000656
zmiana_opcji                      00000007
zmierz_nastepny_czujnik_temperatury  00000ED6
zmierz_nastepny_kanal             00000EE2
zmierz_nastepny_nie_3             00000EFA
zmierz_prad                       00000ECC
zmniejsz_dzien_1                  000011FE
zmniejsz_godziny_1                00001232
zmniejsz_minuty_1                 00001266
zmniejsz_sekundy_1                00001292
znacznik_CTS                      00000004
znacznik_RTS                      00000005
znacznik_pomiaru_pradu            00000001
znaczniki                         0000009E
znaczniki_ds                      000000B3
znak_I                            000000CC
znak_cr                           0000000D
znak_lf                           0000000A
znow_kaz_mierzyc                  00000BF8
zwieksz_dzien_1                   0000153C
zwieksz_godziny_1                 00001576
zwieksz_minuty_1                  000015A8
zwieksz_sekundy_1                 000015D4
﻿                               00000000
ADRES                             ADRESH
CCP1X                             DC1B1
CCP1Y                             DC1B0
CCP2X                             DC2B1
CCP2Y                             DC2B0
DDRA                              TRISA
DDRB                              TRISB
DDRC                              TRISC
DDRD                              TRISD
DDRE                              TRISE
INTE                              INT0IE
INTF                              INT0IF
SCS                               SCS0


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

00000000 : XXXX----XXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000000c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000001c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000002c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 159


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00000340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000003c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000004c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000005c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000006c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000780 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000007c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000008c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000009c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000a00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000a40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000a80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000ac0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000b00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000b40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000b80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000bc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000c00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000c40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000c80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000cc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000d00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000d40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000d80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000dc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000e00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000e40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000e80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000ec0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000f00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000f40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000f80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000fc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
gpasm-0.13.7 beta               serial_1regulator.asm10-7-2011  15:03:15          PAGE 160


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
000010c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000011c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000012c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000013c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000014c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000015c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000016c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001780 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000017c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000018c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000019c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001a00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXX-------- ----------------
00001b00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001bc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001cc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001d00 : XXXXXXXX-------- ---------------- ---------------- ----------------
00300000 : XXXXXXXX-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used: 3610


Errors   :       0
Warnings :       0 reported,       0 suppressed
Messages :       0 reported,       0 suppressed

