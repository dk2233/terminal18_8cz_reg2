gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0000 00001 ﻿; w tej wersji wartosci temperatur sa wysylane zaraz po pomiarze
               00002 
               00003 
               00004 ;program dopasowany do wspolpracy z ukladem 
               00005 ;z pracy statutowej2007
               00006 ;tzn tylko rejestracja danych
               00007 
               00008 ;procek = 18f4320
               00009 
               00010 ;procek = 18f442
               00011 
               00012 
               00013 ;dodano  prezentacja  
               00014 ;poprawa 
  00000010     00015 jak_duzo_zliczen_tmr1_na_sekunde    equ   0x10
               00016 
  018F4320     00017 procek = 18f4320
               00018 
               00019 IF (procek == 18f442)
               00020 list p=18f442
               00021 include  "p18f442.inc"
               00022 
               00023          __CONFIG _CONFIG1H, _OSCS_OFF_1H & _XT_OSC_1H 
               00024          __CONFIG _CONFIG2L, _BOR_OFF_2L & _PWRT_ON_2L
               00025          __CONFIG _CONFIG2H, _WDT_OFF_2H
               00026          
               00027          __CONFIG _CONFIG4L, _DEBUG_ON_4L & _LVP_OFF_4L & _STVR_OFF_4L
               00028         
               00029 ENDIF
               00030 
               00031 IF (procek==18f4320)
               00032 list p=18f4320
               00033 include  "p18f4320.inc"
               00001         LIST
               00002 ; P18F4320.INC  Standard Header File, Version 1.0   Microchip Technology, Inc.
               01095         LIST
               00034 
300000 71FF    00035          __CONFIG _CONFIG1H, _IESO_OFF_1H & _XT_OSC_1H 
               00036          __CONFIG _CONFIG2L, _BOR_ON_2L & _BORV_45_2L & _PWRT_ON_2L
300002 FEF2    00037          __CONFIG _CONFIG2H, _WDT_OFF_2H
300004 FDFF    00038          __CONFIG _CONFIG3H, _PBAD_DIG_3H & _MCLRE_ON_3H
300006 FF7A    00039          __CONFIG _CONFIG4L, _DEBUG_ON_4L & _LVP_OFF_4L & _STVR_OFF_4L
               00040 ENDIF
               00041          
               00042          ;__CONFIG _XT_OSC & _WDT_OFF & _PWRTE_ON & _BODEN_OFF & _LVP_OFF & _CPD_OFF & _WRT_OFF & _CP_OFF & _DEBUG_OFF
               00043 
               00044 ;definicje są w odzielnym pliku
               00045 
               00046 include "def_var.h"
               00001 
               00002 
               00003          
               00004 
               00005 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00006 
               00007          cblock   80h
               00008          w_temp
               00009          status_temp
               00010          pclath_temp
               00011          bsr_temp
               00012          fsrl_temp
               00013          fsrh_temp
               00014          linia1
               00015          linia2
               00016          linia3
               00017          linia4
               00018          letter
               00019          n
               00020          bit
               00021          odebrano_liter
               00022          liczba1
               00023          liczba2
               00024          liczba3
               00025          tmp                       ; uzywany w odbiorze danych i procedurach poleceń
               00026          tmp_hex                    ;uzywany w procedurze hex2dec
               00027          tmp_hex_H                  ;starszy bajt 
               00028          tmp6                       ; uzywany w poprawce temp
               00029          tmp7                        ; uzywany do odbioru danych z rs232
               00030          dec100
               00031          dec10
               00032          dec1
               00033          stan_key
               00034          stan2_key
               00035          wynikh
               00036          wynik
               00037          wynik01
               00038          znaczniki ;0x09a
               00039          markers
               00040          markers2
               00041          markers3
               00042          dane_lcd
               00043          tmp_lcd              ; używany w procedurach lcd
               00044          rcsta_temp
               00045          ile_kanalow ;0x09f
               00046            ktory_kanal_mierze ; 0x0a0
               00047          odstep_pomiarowy
               00048          aktualny_odstep
               00049           ktory_rejestr_zapisuje
               00050           pomiarH
               00051           pomiarL
               00052           pomiar_ulamek
               00053            
               00054           jaka_wartosc_regulujeH
               00055           jaka_wartosc_regulujeL
               00056           jak_duzo_probek ; 0x0a9
               00057           
               00058           ktora_probka
               00059           ktory_kanal
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00060           usrednianie_przez_co_mnoze
               00061           znaczniki_ds
               00062           polecenie_wysylane
               00063          jak_duzo_bajtow_odbieram_z_ds
               00064          
               00065          pomiar0H
               00066          pomiar0L
               00067          pomiar1H
               00068          pomiar1L
               00069          pomiar2H
               00070          pomiar2L
               00071          pomiar3H
               00072          pomiar3L
               00073          pomiar4H
               00074          pomiar4L
               00075          pomiar5H
               00076          pomiar5L
               00077          pomiar6H
               00078          pomiar6L
               00079          pomiar7H
               00080          pomiar7L
               00081          pomiar_prad1H
               00082          pomiar_prad1L
               00083          pomiar_prad2H
               00084          pomiar_prad2L
               00085          bajt_ds
               00086          poprawka0
               00087          poprawka1
               00088          poprawka2
               00089          poprawka3
               00090          poprawka4
               00091          poprawka5
               00092          poprawka6
               00093          poprawka7
               00094          poprawka_prad1
               00095          poprawka_prad2
               00096          jak_duzo_kanalow_pradu
               00097          ktory_aktualnie_kanal_pradu
               00098          
               00099          dzien_10
               00100          dzien_1
               00101          godziny_10
               00102          godziny_1
               00103          minuty_10
               00104          minuty_1
               00105          sekundy_10
               00106          sekundy_1
               00107          
               00108          do_sekundy
               00109          pozycja_menu    
               00110          numer_opcji
               00111          polozenie_gwiazdki
               00112          szybka_zmiana_wartosci
               00113          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00114          fsrl1_temp
               00115          fsrh1_temp
               00116          histereza1
               00117          histereza2
               00118          
               00119          ustawianie_czasu_co_wyswietlam
               00120          ktory_czujnik_reguluje
               00121          endc
               00122 ;0xbe                           
               00123         
               00124          
               00125 ;        cblock 100h
               00126                   
               00127 ;        endc
               00128 
               00129 ;eeprom                  
               00130          cblock   0
               00131          poprawka0_ee
               00132          poprawka1_ee
               00133          poprawka2_ee
               00134          poprawka3_ee
               00135          poprawka4_ee
               00136          poprawka5_ee
               00137          poprawka6_ee
               00138          poprawka7_ee
               00139          poprawka_prad1_ee
               00140          poprawka_prad2_ee
               00141          
               00142          endc
               00143 ;rejestry nieuzywane wykorzystuje jako dane
               00144 
               00145 ;        equ      TMR1L
               00146 
               00147 ;        equ      TMR1H
               00148 
               00149 ;                 equ      CCPR1H
               00150 ;linia            equ      CCPR1L
               00151                   
               00152          
  00000004     00153 lampka            equ      4
  00000004     00154 lampka2           equ      4
               00155 
  00000005     00156 czujnik_ds1820    equ      5                  
               00157 
  00000F81     00158 portlampka2       equ      PORTB
  00000F82     00159 port_ds1820       equ      PORTC
  00000F82     00160 port_CTS      equ      PORTC                  
  00000F82     00161 port_RTS      equ          PORTC 
               00162          
  00000004     00163 znacznik_CTS      equ      4
  00000005     00164 znacznik_RTS      equ      5
               00165 ;klawisze
               00166 
               00167 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00168 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;markers
               00169 ;/*wyswietl */     
  00000000     00170 czy_usrednianie   equ      0
  00000001     00171 czy_wysylanie     equ      1
  00000002     00172 pomiary_zrobione  equ      2  ;znacznik tego czy pomiary zostaly skonczone
  00000003     00173 inicjuj_pomiary   equ         3
  00000004     00174 czy_wysylac_pomiary_serial    equ       4
  00000005     00175 czy_wyswietlam_temp     equ   5  
  00000006     00176 czy_wlaczyc_ponownie_temp    equ    6
  00000007     00177 trzymanie_klawisza            equ   7
               00178              
               00179 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;markers2
               00180 
  00000000     00181 przerwanie_t0     equ      0
  00000001     00182 przerwanie_t1     equ      1
  00000002     00183 pomiary           equ      2
  00000003     00184 sprawdz_odebrane  equ      3
  00000004     00185 wyslij_pomiar     equ      4
  00000005     00186 zalacz_moc        equ      5
  00000006     00187 reguluj           equ      6
  00000007     00188 wylacz_moc        equ      7
               00189 
               00190 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;markers3
               00191 
  00000000     00192 pomiary_pradu           equ   0
  00000001     00193 znacznik_pomiaru_pradu  equ   1
  00000002     00194 czy_zegar_wyswietlac    equ   2
  00000003     00195 odswiezanie_zegara      equ   3
  00000004     00196 wcisnieto_klawisz       equ   4
  00000005     00197 dzialanie_po_klawiszu   equ    5
  00000006     00198 napisz_minus            equ   6
  00000007     00199 pokazuje_temperatury_47       equ   7
               00200 
               00201 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;znaczniki
  00000000     00202 czy_ponownie_wlaczyc_temp     equ   0
  00000001     00203 czy_ponownie_wlaczyc_zegar    equ   1
  00000002     00204 czy_moge_juz_zmieniac         equ   2 ; dotyczy momentu w którym trzymanie klawisza trwa 1 s -> zmiana wartości
               00205 
               00206 
               00207 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;pozycja_menu
               00208 ;jezeli jest 0 to ekran główny
               00209 ;ekran_glowny      equ   0
  00000000     00210 menu_opcje1       equ   0
  00000001     00211 menu_opcje2       equ   1
  00000002     00212 menu_opcje3       equ   2
  00000003     00213 menu_opcje4       equ   3
               00214 
  00000007     00215 zmiana_opcji      equ   7
  00000004     00216 menu_opcje_end    equ   4
  00000010     00217 numer_opcji_koncowej    equ   0x10
               00218 
               00219 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;numery opcji
  00000001     00220 opcja_czujniki            equ        1
  00000002     00221 opcja_odstep            equ         2
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000003     00222 opcja_srednia                  equ       3
  00000004     00223 opcja_regulacja                equ        4
  00000005     00224 opcja_ustaw_temp              equ   5
  00000006     00225 opcja_pomiar_i             equ   6
  00000007     00226 opcja_wlacz_1                 equ   7
  00000008     00227 opcja_wlacz_2                 equ   8
  00000009     00228 opcja_histereza1               equ   9
  0000000A     00229 opcja_histereza2              equ  0xa
               00230 
  0000000B     00231 opcja_czujnik_regulacji            equ   0xb
  0000000C     00232 opcja_ustaw_serial                   equ   0xc
  0000000D     00233 opcja_wyswietl_zegar          equ   0xd
  0000000E     00234 opcja_wyswietl_temp           equ   0xe
  0000000F     00235 opcja_podswietlenie           equ   0xf
  00000010     00236 opcja_ustaw_zegar             equ   0x10           
               00237 ;;
               00238 ;poprawki_czuj           equ   
               00239 
  0000000C     00240 polozenie_liczby_menu         equ   0xc
               00241 
               00242 ;;;
  00000001     00243 nie      equ      1
  00000010     00244 ile_znakow        equ      10h
               00245 
               00246 
               00247 ;znaczniki
  00000000     00248 kalibracja        equ 0
               00249 
               00250 
  00000F81     00251 port_serial       equ      PORTB
  00000007     00252 RXD               equ      7
               00253 
               00254 
               00255 ;
  00000002     00256 ma       equ      2
  00000001     00257 mb       equ      1
  00000000     00258 mc       equ      0
  00000003     00259 dana     equ      3        
  00000004     00260 kb_change         equ      4
  00000005     00261 kb_cofnij         equ      5
  00000006     00262 kb_enter    equ      6
  00000007     00263 kb_minus    equ      7
               00264 
               00265 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;klawisze
  00000004     00266 dlugosc_oczekiwania_na_zmiane       equ   4
  00000F83     00267 latch_keys        equ      PORTD
  00000F83     00268 port_keys         equ      PORTD
  00000000     00269 latch_back        equ   0
  00000001     00270 latch_down        equ   1
  00000002     00271 latch_up          equ   2
  00000003     00272 latch_enter       equ   3
               00273 
               00274 ;stan_key
  00000000     00275 mamy_back    equ   0
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000001     00276 mamy_down   equ   1
  00000002     00277 mamy_up     equ   2
  00000003     00278 mamy_enter  equ   3
               00279 
               00280 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
               00281 
               00282 
               00283 
               00284 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;LCD
               00285 
  00000028     00286 set_4bit          equ   b'00101000'
  0000000C     00287 display_on        equ   b'00001100'
  0000002A     00288 init_4bit          equ      b'00101010' ;ustawia 2 linie i 5x8 font
               00289 
  00000F8C     00290 latch_lcd          equ      LATD
  00000F8B     00291 latch_lcd_e        equ      LATC
  00000F8A     00292 latch_lcd_rw       equ      LATB
  00000F8A     00293 latch_lcd_rs       equ      LATB
               00294 
               00295 ;definicja bitow uzywanych w 4 bitowym przesylaniu 0 - uzywany 1 - nieuzywany
               00296 ;zwiazane z opcja kasowania
  0000000F     00297 ktore_bity_uzywane_na_lcd     equ   0x0f
  000000F0     00298 ktore_bity_lcd_tris           equ   0xf0
  0000000F     00299 normalne_ustawienie_tris_lcd  equ   0x0f
               00300 
               00301 
  00000F83     00302 port_lcd          equ      PORTD
               00303 
  00000F82     00304 port_lcd_e      equ     PORTC
  00000F81     00305 port_lcd_rw     equ     PORTB
  00000F81     00306 port_lcd_rs     equ     PORTB
               00307 
  00000F95     00308 tris_lcd          equ      TRISD
               00309 ;0 to pomiar
               00310 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
               00311 
  00000001     00312 pin_e_4724        equ      1
               00313 
               00314 ;3 to ref+
               00315 
               00316 
  00000003     00317 enable          equ     3
  00000003     00318 rs              equ     3
  00000002     00319 rw              equ     2
               00320 
               00321 ;znaki transmisyjne
  0000000D     00322 znak_cr           equ      0dh
  0000000A     00323 znak_lf           equ      0ah
  000000CC     00324 znak_I            equ      0cch
               00325 
               00326 ;znaczniki_ds
               00327                   ;inicjacja         equ      0
               00328                   ;skip_rom          equ      1             
  00000001     00329 dane_odebraneH    equ      1
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  00000000     00330 dane_odebraneL    equ      0   
               00331 
               00332  
               00333 
  00000F81     00334 port_triak        equ      PORTB
  00000F8A     00335 latch_moc         equ       LATB
               00336 
  00000000     00337 triak1            equ      0
  00000001     00338 triak2            equ      1
               00339 
  00000002     00340 pomiar_prad1      equ      2
  00000004     00341 pomiar_prad2      equ      4
               00342 
               00343 ;histereza         equ   4
  00000F82     00344 port_multiplekser equ   PORTC
  00000F8B     00345 latch_multiplekser equ   LATC
  00000000     00346 pin_A                  equ    0
  00000001     00347 pin_B                   equ   1
  00000002     00348 pin_C                   equ   2
               00349 
               00350 
               00351 
               00352 ;ustawienia czujników
               00353 
  00000007     00354 ilosc_czujnikow            equ      7      
               00047 
  00000001     00048 czy_ekran         equ      1
  00000001     00049 czy_pomiary_na_ekran       equ      1
  00000001     00050 polozenie_danych_lcd equ 1
               00051 ;2007-06-07
               00052 ;
               00053 ;dodano obsluge ds1820
               00054 ;poprawiono bledy
               00055 ;ten program odbiera dane korzystajac z modulu obslugi USART
               00056 ;w procesorze
               00057 
               00058 ;jest to "karta" zbioru danych z 2 czujników temp
               00059 ;LM35 i
               00060 ;
               00061 ;
               00062 ;PORTD -0 -Klawisz Back
               00063 ;PORTD -1 -Klawisz down
               00064 ;PORTD -2 - klawisz up
               00065 ;PORTD -3 -Klawisz enter
               00066 ;PORTD -4 - LCD Data
               00067 ;PORTD -5 - Lcd Data
               00068 ;PORTD -6 - Lcd Data
               00069 ;PORTD -7 - Lcd Data
               00070 
               00071 ;PORTB -0 -Triak 1 
               00072 ;PORTB -1 -Triak 2
               00073 ;PORTB -2 -R/W
               00074 ;PORTB -3 - RS
               00075 ;PORTB -4 -
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00076 ;PORTB -5 -
               00077 ;PORTB -6 - 
               00078 ;PORTB -7 -
               00079          
               00080 ;PORTC - 0 -  A 4051
               00081 ;PORTC - 1 -   B 4051
               00082 ;PORTC-  2 -  C 4051
               00083 ;POrtc - 3 -   Enable
               00084 ;POrtc - 4 -  CTS (czyli ze procek wysyla) (dane z procka)
               00085 ;POrtc - 5 - RTS (czyli znacznik ze komputer cos wysyla) (dane do procka)
               00086 ;POrtc - 6 - transmit
               00087 ;POrtc - 7 - receive
               00088 
               00089 ;PORTA - 0 - Anlog - 8 wejsc lm35 przez mulitplesker
               00090 ;PORTA - 1 - 
               00091 ;PORTA - 2 - pomiar pradu 1
               00092 ;PORTA - 3 - REferencyjne+2,560 V
               00093 ;PORTA - 4 - 
               00094 ;PORTA - 5 - pomiar pradu 2 
               00095 ;PORTE - 0 - 
               00096 ;PORTE - 1 - 
               00097 ;PORTE - 2 - 
               00098 
               00099 ;TMR0L - czekanie miedzy kanalami analoga na pomiar
               00100 ;tmr1  - odliczanie sekund pomiaru
               00101 ;tmr2  - ewentualnie ds1820
               00102 ;tmr3  -zegar systemowy (przyciski systemu)
               00103 
               00104 ;bledy przy pomiarach - tzn gdzies sie wiesza gdy wylaczy sie pomiary
               00105 ;zaczyna wyrzucac na ekran wszystkie pomiary nie usredniajac  
               00106 ;to wynika z faktu ze przy wysylaniu danych pojawia sie powrotne wysylania
               00107 
               00108 ;okazuje sie ze wlaczenie odbioru "cat /dev/ttyS0" powoduje przeskok RTS w stan 0 (tzn informacja o nadawaniu)
               00109 
               00110 ;trzeba zrobic tak by odczyt przez komputer byl tylko w czasie wysylania danych tzn 
               00111 ;gdy CTS jest na wysoko poza tym powinien byc brak odczytu
               00112 
               00113 ;INDF0 (FSR0L i FSR0H) - uzywane tylko w odbiorze danych, tzn w komunikacji z portem szeregowym, oraz w poleceniach 
               00114 ;INDF1   - uzywane w operacjach Analog oraz w procedurze obróbki danej zmierzonej przez A/D
               00115 ;INDF2  - używany w procedurach czasu, oraz w 
               00116 
               00117 
               00118 ;2008.03.01
               00119 ;dodano obsluge zegara i jego wyswietlanie
               00120 ;brak procedury miganie :zamieniona na procedura_obslugi_zegara
               00121 
               00122 ;program działa zupełnie nieźle, jednak wiesza się przy większej liczbie czujników
               00123 
               00124 ;2008.03.31
               00125 
               00126 
               00127 
               00128 ;2008.04.14
               00129 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00130 ;wciąż się wiesza podczas pomiarów temperatury  - próba wyłączania wskazania zegara w trakcie pomiarów nie wpłynęła na poprawę pracy
               00131 ;wyłączanie wskazywania temperatur również nie wpłynęło na stabilność pracy
               00132 
               00133 ;poprawa czyszczenia ekranu kiedy zmieniam wskazania temp na ekranie głównym
               00134 
               00135 ;poprawa pracy pokazywania zawartości rejestru
               00136 ;
               00137 ;obsługa  wpisywania histerezy, temperatury regulowanej, średniej, ilości próbek,
               00138                                                                                                                                                                                                                                               
               00139 ;2008.04.15
               00140 ;wieszanie programu w trakcie pomiarów wynikają z błędów w algorytmie uśredniania wyników
               00141 ;po zmniejszeniu średniej do 32 próbek nie następuje wieszanie
               00142 ;wyraźnie na błędy wpływa ilość próbek 64 i 128
               00143 
               00144 ;próba zmiany algorytmu uśredniania uzyskanego wyniku
               00145 ;uśrednianie liczb:
               00146 ;0x80 (128 próbek) to mnożenie przez 0x02 (2/256)
               00147 ;0x40 (64 próbki) 0x04
               00148 ;0x20 (32)  0x08
               00149 ;0x10 (16)   0x10
               00150 ;0x08 (8)    0x20 
               00151 ;0x04 (4 próbki) 0x64
               00152 ;0x02 (2 próbki) 0x80 (128/256 czyli 0.5) 
               00153 
               00154 ;usunięcie procedury przesuwania
               00155 ;2008.04.16
               00156 ;poprawiony algorytm usredniania pomiarow
               00157 ;
               00158 ;dodano możliwość zmiany wartości przez trzymanie przycisku
               00159 ;ustaw temp, odstep, 
               00160 
               00161 ;2008.04.17
               00162 ;ostatecznie poprawiłem wieszanie układu, poprawiłem błędy podczas wyświetlania danych na ekranie -> błędy były przy powrocie z
               00163 ;procedur przerwań, tzn W z W_temp wracał najpierw, a potem jeszcze do W zapisywane były inne wartości
               00164 ;poza tym błędy były przy wywoływaniu procedur klawisza. Otóż każde naciśnięcie klawisza wywoływało przeskok do procedury
               00165 ;w przypadku gdy trzymany był klawisz i procedury wykryły że należy zmieniać wskazanie liczby, następował przekok do procedur wykrycia klawisza up lub down,
               00166 ;jednak powrót następował za pomocą procedury "goto". Stąd problem, bowiem wywołanie funkcji trzymania klawisza są za pomocą call. To powodowało brak
               00167 ;powrotu z funkcji call, i w końcu zapchanie stosu.
               00168 ;układowi brakuje wciąż:
               00169 ;           - zmiany ustawień zegara
               00170 ;           - wybór wartości mocy dostarczanej do układu
               00171 ;           - błędy - przy wyświetlaniu prądu triaka 2 jego wartosć jest dodawana do wskazania temperatury 1, 
               00172 ;           - dodać wybór wskazania który czujnik temperatury jest czujnikiem regulatora
               00173 ;           - dodać  procedurę regulatora P
               00174 ;           - regulator PID
               00175 ;           - dodać przeliczanie wartości zmierzonej prądu na wskazanie amperów
               00176 ;Poprawić procedurę liczenia średniej wartości pomiarów z pewnego czasu - mieszać ze sobą pomiary w postaci
               00177 ; pomiar czujnika 1,2,3,4,5 - dłuższa przerwa, 1,2,3,4,5, dłuższa przerwa, etc
               00178 
               00179 ;2008.04.26
               00180 ;błędne działanie procedur pomiaru temperatury - zły pomiar temperatur ujemnych 
               00181 ;zamiast poprawnej wartości ujemnych po osiągnięciu 0 oC wyświetlana jest wartość -64 oC.
               00182 ;poza tym zamiast 0 wyświetlane były temperatury na poziomie 1.25 - 1.5 oC. 
               00183 ;Zważywszy że czujnik był wyskalowany dla temperatur 23 - 20 C, wskazuje to na nierównomierną
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00184 ;skalę błędu - zmiana być może liniowa - należy to sprawdzić
               00185 
               00186 ;2008.04.27
               00187 ;dodano ustawianie wartości zegara
               00188 ;
               00189 ;2009.04.22
               00190 ;poprawa działania histerezy regulacji dwustawnej
               00191 
               00192 
               00193 ;2011.05.09 
               00194 ;dalej jest problem z praca regulacji dwustawnej i pomiarami temperatury w punkcie 5
               00195 
               00196 
0000           00197          org      0000h
0000 00198 BEGIN
               00199          ;bsf      PCLATH,3
               00200          ;bcf      PCLATH,4
               00201          
0000 EF0B F00E 00202          goto     inicjacja
               00203                   
               00204          
0008           00205          org      0008h
               00206          
0008 00207 przerwanie
               00208 ;zachowuje rejestr W
0008 CFD8 F081 00209       movff    STATUS,status_temp
000C 6F80      00210          movwf    w_temp
               00211 ;zachowuje rejestr STATUS
               00212          
000E CFE0 F083 00213          movff    BSR,bsr_temp
               00214          
0012 50E9      00215          movf     FSR0L,w
0014 6F84      00216          movwf    fsrl_temp
0016 50EA      00217          movf     FSR0H,w
0018 6F85      00218          movwf    fsrh_temp
               00219          
001A 50E1      00220          movf     FSR1L,w
001C 6FE4      00221          movwf    fsrl1_temp
001E 50E2      00222          movf     FSR1H,w
0020 6FE5      00223          movwf    fsrh1_temp
               00224          
               00225 ;po to by wszystkie ustawienia banki itd byly na 0    
               00226          ;bsf      STATUS,RP0
0022 AA9D      00227          btfss    PIE1,RCIE
0024 EF17 F000 00228          goto     przerwanie_1
               00229          
               00230          ;bcf      STATUS,RP0
0028 BA9E      00231          btfsc    PIR1,RCIF
002A EF99 F000 00232          goto     wykryto_odbior    
               00233 
002E 00234 przerwanie_1
               00235          ;bsf      STATUS,RP0
               00236          
002E A09D      00237          btfss    PIE1,TMR1IE
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0030 EF1D F000 00238          goto     przerwanie_2
               00239          
               00240          ;bcf      STATUS,RP0
0034 B09E      00241          btfsc    PIR1,TMR1IF
0036 EF46 F000 00242          goto     wykryto_t1
               00243 
003A 00244 przerwanie_2      
               00245         
               00246          
003A A89D      00247          btfss    PIE1,TXIE
003C EF23 F000 00248          goto     przerwanie_3
               00249          
               00250          ;bcf      STATUS,RP0
0040 B89E      00251          btfsc    PIR1,TXIF
0042 EFBB F000 00252          goto     przerwanie_wysylania
               00253          
0046 00254 przerwanie_3      
               00255          
               00256          
0046 AC9D      00257          btfss    PIE1,ADIE
0048 EF29 F000 00258          goto     przerwanie_4
               00259          
               00260          ;bcf      STATUS,RP0
004C BC9E      00261          btfsc    PIR1,ADIF
004E EFC5 F000 00262          goto     przerwanie_pomiaru
               00263          
0052 00264 przerwanie_4
               00265          
               00266          
0052 A29D      00267          btfss    PIE1,TMR2IE
0054 EF2F F000 00268          goto     przerwanie_5
               00269          
               00270          ;bcf      STATUS,RP0
0058 B29E      00271          btfsc    PIR1,TMR2IF
005A EF96 F000 00272          goto     wykryto_t2
005E 00273 przerwanie_5
               00274          
               00275 ;        goto     wykryto_rb
               00276         
               00277         
005E B4F2      00278         btfsc    INTCON,TMR0IF
0060 EF91 F000 00279         goto     wykryto_t0
               00280 
0064 00281 przerwanie_6
0064 A2A0      00282         btfss    PIE2,TMR3IE
0066 EF38 F000 00283         goto     przerwanie_7
               00284          
               00285         
006A B2A1      00286         btfsc    PIR2,TMR3IF
006C EFD3 F000 00287         goto     wykryto_t3   
               00288         
0070 00289 przerwanie_7        
               00290 ;        btfsc    PIR1,TMR2IF
               00291 ;        goto     wykryto_t2
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00292          
               00293 ;        btfsc    PIR1,TMR2IF
               00294 ;        goto     wykryto_t2
               00295          
0070 00296 wyjscie_przerwanie
               00297 
0070 C083 FFE0 00298          movff    bsr_temp,BSR
               00299          
               00300          
0074 5184      00301          movf     fsrl_temp,w
0076 6EE9      00302          movwf    FSR0L
0078 5185      00303          movf     fsrh_temp,w
007A 6EEA      00304          movwf    FSR0H
               00305          
007C 51E4      00306          movf     fsrl1_temp,w
007E 6EE1      00307          movwf    FSR1L
0080 51E5      00308          movf     fsrh1_temp,w
0082 6EE2      00309          movwf    FSR1H
               00310          
0084 5180      00311          movf     w_temp,w
0086 C081 FFD8 00312          movff    status_temp,STATUS
               00313 
008A 0010      00314          retfie
               00315          
               00316          
               00317          
008C 00318 wykryto_t1
               00319 
               00320                                                       ;Procedury obslugi czasu
008C 909E      00321       bcf      PIR1,TMR1IF
               00322       
               00323       
               00324          ;czy minelo 16 sekund
008E 83A0      00325       bsf      markers2,przerwanie_t1   
               00326          
0090 0E10      00327       movlw jak_duzo_zliczen_tmr1_na_sekunde
0092 19DF      00328       xorwf do_sekundy,w
               00329 ;jezeli    nie  0 w wyniku to skok do procedury 
0094 E13D      00330       bnz   wykryto_t1_wyjscie      
               00331 ;jezeli 0 to zwiększ sekunda o 1      
               00332       
0096 6BDF      00333       clrf  do_sekundy
0098 2BDE      00334       incf  sekundy_1,f
               00335            
               00336 ;sprawdz czy cyfra jednosci nie przekroczyla 9 sekund
009A 0E3A      00337       movlw 0x3a
009C 19DE      00338       xorwf sekundy_1,w
009E E134      00339       bnz   ustaw_wyswietlanie_czasu_na_lcd
               00340 ;czyszcze    liczbe jednosci i zwiekszam o jeden liczbe 
00A0 0E30      00341       movlw 0x30
00A2 6FDE      00342       movwf  sekundy_1
00A4 2BDD      00343       incf  sekundy_10,f
               00344       
00A6 0E36      00345       movlw 0x36
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00A8 19DD      00346       xorwf sekundy_10,w
00AA E12E      00347       bnz   ustaw_wyswietlanie_czasu_na_lcd
00AC 0E30      00348       movlw 0x30
00AE 6FDD      00349       movwf  sekundy_10
               00350       
00B0 2BDC      00351       incf  minuty_1,f
               00352 ;sprawdzam czy nie przekroczylem  
               00353       
00B2 0E3A      00354       movlw 0x3a
00B4 19DC      00355       xorwf minuty_1,w
               00356       
00B6 E128      00357       bnz   ustaw_wyswietlanie_czasu_na_lcd
00B8 0E30      00358       movlw 0x30
00BA 6FDC      00359       movwf minuty_1
00BC 2BDB      00360       incf  minuty_10,f
               00361       
00BE 0E36      00362       movlw 0x36
00C0 19DB      00363       xorwf minuty_10,w
00C2 E122      00364       bnz   ustaw_wyswietlanie_czasu_na_lcd
00C4 0E30      00365       movlw 0x30
00C6 6FDB      00366       movwf minuty_10
               00367                                           ;godziny      
00C8 2BDA      00368       incf  godziny_1,f
               00369 ;sprawdz czy jezeli jest 4 czy nie ma 2 na godziny_10
00CA 0E34      00370       movlw       0x34
00CC 63DA      00371       cpfseq      godziny_1
00CE EF7E F000 00372       goto        sprawdz_godziny
00D2 0E32      00373       movlw       0x32
00D4 63D9      00374       cpfseq      godziny_10
00D6 EF7E F000 00375       goto        sprawdz_godziny
00DA 0E30      00376       movlw       0x30
00DC 6FD9      00377       movwf godziny_10
00DE 6FDA      00378       movwf godziny_1
00E0 2BD8      00379       incf  dzien_1,f
               00380       
               00381             
00E2 00382 sprawdz_dzien
00E2 0E3A      00383       movlw 0x3a
00E4 19D8      00384       xorwf dzien_1,w
00E6 E110      00385       bnz   ustaw_wyswietlanie_czasu_na_lcd
00E8 0E30      00386       movlw 0x30
00EA 6FD8      00387       movwf  dzien_1
00EC 2BD7      00388       incf  dzien_10,f
               00389       
00EE 0E3A      00390       movlw 0x3a
00F0 19D9      00391       xorwf godziny_10,w
00F2 E10A      00392       bnz   ustaw_wyswietlanie_czasu_na_lcd
00F4 0E30      00393       movlw 0x30
00F6 6FD7      00394       movwf dzien_10
               00395       
00F8 EF84 F000 00396       goto  ustaw_wyswietlanie_czasu_na_lcd
00FC 00397 sprawdz_godziny      
00FC 0E3A      00398       movlw 0x3a
00FE 19DA      00399       xorwf godziny_1,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0100 E103      00400       bnz   ustaw_wyswietlanie_czasu_na_lcd
0102 0E30      00401       movlw 0x30
0104 6FDA      00402       movwf godziny_1
0106 2BD9      00403       incf  godziny_10,f
               00404       
               00405       
               00406       
               00407 
               00408 
0108 00409 ustaw_wyswietlanie_czasu_na_lcd
               00410       ;czy system obsluguje zegar, bo nie musi i nie powinien przy bardzo częstym pomiarze i wysyłaniu danych
               00411       ;czyli co 1/16
               00412       
0108 A5A1      00413       btfss markers3,czy_zegar_wyswietlac
010A EF88 F000 00414       goto  wykryto_t1_wyjscie 
               00415       
               00416       ;a jezeli ma odswiezyc wszystkie znaki:
010E 87A1      00417       bsf   markers3,odswiezanie_zegara
               00418       
               00419       ;jezeli mam odswiezyc zegar to wylaczam na chwilke pomiary i dopiero po wyswietleniu 
               00420       ;sprawdz czy byly wlaczone pomiary
               00421       ;btfss       markers2,pomiary
               00422       ;goto        wykryto_t1_wyjscie 
               00423       
               00424       
               00425       ;bsf   markers,pomiary_zrobione
               00426       ;i zaznacz zeby je jeszcze raz wlaczyl po wyswietleniu czasu
               00427       ;bsf   markers,czy_wlaczyc_ponownie_temp
               00428       
               00429       
               00430       
0110 00431 wykryto_t1_wyjscie  
0110 2BDF      00432       incf     do_sekundy,f
               00433       
0112 EF38 F000 00434       goto     wyjscie_przerwanie                  
               00435          
0116 00436 wykryto_rb
               00437 ;wlaczam przerwanie tmr2 i ustawiam przy pomocy TMR2 na 100us tzn 
               00438 ;
               00439 ;
               00440          
0116 90F2      00441          bcf      INTCON,RBIF
               00442          
               00443 ;        btfsc    markers2,odbior
               00444 ;        goto     wyjscie_przerwanie
               00445          
0118 BE81      00446          btfsc    port_serial,RXD
011A EF38 F000 00447          goto     wyjscie_przerwanie         
               00448 ;        btfsc    bit,7
               00449 ;        goto     wylaczam_odbior
               00450 ;        bsf      markers2,poczatkowy_bit
               00451          
011E EF38 F000 00452          goto     wyjscie_przerwanie
               00453 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0122 00454 wykryto_t0
               00455 ;uzywam do wykrywania czy juz zrobic pomiar
               00456 IF (procek == 18f442)
               00457          bcf      INTCON,T0IF
               00458          bcf      INTCON,T0IE
               00459          
               00460 ENDIF
               00461 
               00462 IF (procek == 18f4320)
0122 94F2      00463          bcf      INTCON,TMR0IF
0124 9AF2      00464          bcf      INTCON,TMR0IE
               00465          
               00466 ENDIF
               00467          
0126 82C2      00468          bsf      ADCON0,GO 
               00469          ;clrf     pomiarH
               00470          ;clrf     pomiarL
               00471          ;clrf     pomiar_ulamek        
0128 EF38 F000 00472          goto     wyjscie_przerwanie
               00473          
012C 00474 wykryto_t2
               00475 ;uzywam do odmierzania czasu dla DS1820
               00476 ;1 - 
               00477 ;oczekuje kolejne max 480 us. jezeli po tym czasie nie wystapi jeden to napisz blad
               00478 
               00479 ;
               00480 
               00481 ;
012C 929E      00482          bcf      PIR1,TMR2IF
               00483          
               00484 ;jezeli tesuje czas     
               00485 ;          bcf     PORTC,2         
               00486          ;bsf      STATUS,RP0
012E 929D      00487          bcf     PIE1,TMR2IE
               00488          ;bcf      STATUS,RP0
0130 94CA      00489          bcf      T2CON,TMR2ON
               00490              
               00491          
               00492          
               00493 ;        btfss    markers2,
               00494 ;        goto     wyjscie_przerwanie
               00495          
               00496 ;        bsf      markers2,odbierz_bit
               00497         
               00498 
0132 00499 wykryto_odbior
               00500 ;        btfsc    odebrano_liter,4
               00501          ;call     miganie
               00502 ;czytanie rcsta go kasuje
0132 00503 wykryto_odbior_odczyt
               00504 ;jezeli mam ustawione na ekran to nic nie odbieraj    
0132 B7A0      00505          btfsc    markers2,sprawdz_odebrane
0134 EF38 F000 00506          goto     wyjscie_przerwanie
               00507 ;wylacz inne przerwania
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00508 ;        bsf      STATUS,RP0
               00509 ;        bcf      PIE1,TMR1IE
               00510 ;        bcf      STATUS,RP0
               00511          
               00512 ;          bcf      markers2,blad_transmisji
               00513 ;czy jest framing error
0138 B4AB      00514          btfsc    RCSTA,FERR
013A EFC2 F000 00515          goto     wykryto_blad
               00516 ;        bsf      markers2,blad_transmisji
               00517          
013E B2AB      00518          btfsc    RCSTA,OERR
0140 EFBD F000 00519          goto     wykryto_oerr
               00520          
               00521          
0144 518D      00522          movf     odebrano_liter,w
0146 0F00      00523          addlw    dane_odebraneL
0148 6EE9      00524          movwf    FSR0L
014A 0E01      00525          movlw    dane_odebraneH
014C 6EEA      00526          movwf    FSR0H
               00527          
014E 50AE      00528          movf     RCREG,w
0150 6EEF      00529          movwf    INDF0
               00530 ;jezeli blad transmisji to nie zapamietuj         
               00531 ;          btfsc    markers2,blad_transmisji
               00532 ;          goto     wykryto_odbior_odczyt_dalej  
               00533 ;                    
               00534          
               00535          
               00536          
0152 0E0A      00537          movlw    0x0a
0154 18EF      00538          xorwf    INDF0,w
0156 B4D8      00539          btfsc    STATUS,Z
0158 EFB1 F000 00540          goto     wykryto_odbior_CR
               00541          
               00542 ;        movlw    0x0a
               00543 ;        xorwf    INDF0,w
               00544 ;        btfss    STATUS,Z
015C 2B8D      00545         incf     odebrano_liter,f
               00546          
015E EF38 F000 00547          goto     wyjscie_przerwanie
               00548 ;        goto     wykryto_odbior_wyjscie
               00549 ;        
               00550          
               00551 ;        movlw    0x0A
               00552 ;        xorwf    INDF0,w
               00553 ;        btfss    STATUS,Z
               00554 ;        goto     wykryto_odbior_wyjscie
               00555          
               00556                   
0162 00557 wykryto_odbior_CR 
               00558 ;sprawdz czy pierwszym znakiem jest *
               00559          
0162 87A0      00560          bsf      markers2,sprawdz_odebrane
               00561 ;        clrf     odebrano_liter
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00562 ;        movf     RCREG,w
               00563 ;        movwf    INDF0
               00564 ;        
               00565 ;        czysc dwa bwyswietlajty na zero -> znacznik konca wyswietlania         
               00566 ;        
               00567          
0164 0E0D      00568         movlw     0x0d
0166 6EEF      00569          movwf    INDF0
               00570           
0168 2AE9      00571         incf    FSR0L,f
016A 6EEF      00572         movwf    INDF0
016C 2AE9      00573         incf    FSR0L,f
016E 6AEF      00574         clrf     INDF0
0170 2AE9      00575          incf    FSR0L,f
0172 6AEF      00576         clrf     INDF0
               00577 ;wylaczam szeregowy odbior
0174 98AB      00578          bcf      RCSTA,CREN        
               00579 
0176 00580 przerwanie_wysylania       
0176 EF38 F000 00581          goto     wyjscie_przerwanie
               00582 
017A 00583 wykryto_oerr      
017A 98AB      00584          bcf      RCSTA,CREN        
017C 0000      00585          nop
017E 88AB      00586          bsf      RCSTA,CREN
               00587                                     
0180 EF38 F000 00588          goto     wyjscie_przerwanie
0184 00589 wykryto_blad
0184 50AE      00590          movf     RCREG,w
0186 EF38 F000 00591          goto     wyjscie_przerwanie
               00592 
018A 00593 przerwanie_pomiaru
018A 9C9E      00594          bcf      PIR1,ADIF
               00595 ;kopiuje pomiar do rejestru
               00596 ;sprawdz czy ustawiono 1 lub 0 - wtedy nic nie dziele 
               00597          
018C 0E9B      00598          movlw    wynikh
018E A19F      00599          btfss    markers,czy_usrednianie
0190 0EAA      00600          movlw    pomiarH
               00601 ;        addwf    ktory_rejestr_zapisuje,w
0192 6EE1      00602          movwf    FSR1L
0194 6AE2      00603          clrf     FSR1H
               00604          
0196 50C4      00605          movf     ADRESH,w
0198 6EE7      00606          movwf    INDF1
019A 2AE1      00607          incf     FSR1L,f
               00608 
019C 50C3      00609          movf     ADRESL,w
               00610 
019E 6EE7      00611          movwf    INDF1
01A0 89A0      00612          bsf      markers2,wyslij_pomiar
               00613 ;nastepnym razem zapisze do kolejnego rejestru        
               00614 ;        incf     ktory_rejestr_zapisuje,f
01A2 EF38 F000 00615          goto     wyjscie_przerwanie
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00616    
               00617 
01A6 00618 wykryto_t3
               00619 
01A6 92A1      00620       bcf   PIR2,TMR3IF
               00621       ;sprawdzam czy klawisz jest dalej wcisniety
               00622       
               00623       ;robie and z zawartoscia stan_key
               00624       ;jezeli jest w wyniku 0 (tzn ze klawisz wciaz jest trzymany
               00625       ;np dla klawisza back stan latch_keys:  xxxx1110 - jezeli wcisniety 
               00626       ;                                      stan_keys          xxxx001  
               00627       ;w wyniku 0 chyba że klawisz puszczono i jest 1
01A8 5199      00628       movf        stan_key,w
01AA 1483      00629       andwf       latch_keys,w
               00630 ;tzn ze wciaz przycisk jest wcisniety
               00631       ;i nic nie robie czyli wychodze
01AC B4D8      00632       btfsc       STATUS,Z
01AE EFDF F000 00633       goto         wykryto_t3_nie_puszczono
               00634       
               00635       ;natomiast jezeli wyszlo 1 to sprawdz ktory przycisk zostal puszczony  
               00636       ;i wymus sprawdzenie i dalsze podprogramy zwiazane z danym klawiszem
01B2 99A1      00637       bcf         markers3,wcisnieto_klawisz
01B4 9F9F      00638       bcf         markers,trzymanie_klawisza
01B6 959E      00639       bcf         znaczniki,czy_moge_juz_zmieniac
               00640       
               00641       ;wylacz przerwanie tmr3
01B8 8BA1      00642       bsf         markers3,dzialanie_po_klawiszu
01BA EF38 F000 00643       goto        wyjscie_przerwanie
               00644       
01BE 00645 wykryto_t3_nie_puszczono
               00646 ;jeżeli zaznaczony jest bit trzymanie_klawisza to pozwól na szybką zmianę wartości w trakcie 
               00647 ;trzymania przycisku
               00648 
               00649 ;jeżeli już zaznaczono ze moge zmieniac to nie sprawdzaj miniecia sekundy
01BE B59E      00650       btfsc       znaczniki,czy_moge_juz_zmieniac
01C0 EF38 F000 00651       goto        wyjscie_przerwanie
               00652 
01C4 AF9F      00653       btfss       markers,trzymanie_klawisza
01C6 EF38 F000 00654       goto        wyjscie_przerwanie
               00655 ;szybka zmiana dopiero po sekundzie - czyli dwa zliczenia
01CA 2FE3      00656       decfsz      szybka_zmiana_wartosci,f
01CC EF38 F000 00657       goto        wyjscie_przerwanie
               00658 
01D0 0E01      00659       movlw       1
01D2 6FE3      00660       movwf       szybka_zmiana_wartosci
               00661 ;jeżeli już jest 0 to pozwól na zmianę       
01D4 859E      00662       bsf         znaczniki,czy_moge_juz_zmieniac
01D6 EF38 F000 00663       goto        wyjscie_przerwanie
               00664       
               00665 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;KOniec Przerwan   
               00666 ;;;;;;;;;;;;;;;;;;;;;;;;
               00667 ;;;PROGRAM
               00668 ;;;;;;;;;;;;;;;;;;;;;;;;;
               00669 include  "../libs/lcd.h"
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00001  ;;ten dokument zawiera definicje wszystkich funkcji
               00002 ;;uytych do wywietlania danych na LCD
               00003 ;;wywietlanie 8 bitowe
               00004 
               00005 ;def lcd
               00006 ;cay port RB0-RB7 uyty jako dane do LCD
               00007 ;init
               00008 ;to idzie na port zwizany z danymi
               00009 
               00010 
               00011 
  00000030     00012 init_8bit       equ     b'00110000'
  0000003C     00013 set_8bit        equ     b'00111100' ; 8bit, 2 linie,font 5x8
  00000008     00014 function_set2   equ     b'00001000' ;ustawia 2 linie i 5x8 font
               00015 ;init_4bit          equ      b'00100010' ;ustawia 2 linie i 5x8 font
               00016 
  00000008     00017 display_off     equ     b'00001000' ;ustawia blinking,cursor,
  00000006     00018 entry           equ     b'00000110' ;increment
  00000080     00019 dd_addres_set   equ     b'10000000' ;od rb6 do rb0 wstawi�adres
               00020 
  00000001     00021 display_clear   equ     b'00000001'
  0000000C     00022 display_on      equ     b'00001100';bez kursora
  0000000F     00023 display_2       equ     b'00001111'
  00000010     00024 write_4bit      equ     b'00010000' ;pisz na ekranie
  00000040     00025 write           equ     b'01000000' ;zacz rd6 - rs
               00026 
  00000002     00027 disp_home       equ     b'00000010'
               00028 
               00029 
               00030 ;;dla 4bit�
  00000003     00031 function_set1_4b        equ     b'00000011' ;- ustawia 4 bit
  00000008     00032 function_set2_4b        equ     b'00001000' ;ustawia 2 linie i 5x8 font
  00000000     00033 display1_4b     equ     b'00000000'
  0000000F     00034 display2_4b     equ     b'00001111' ;ustawia blinking,cursor,
  00000000     00035 entry1_4b               equ     b'00000000'
  0000000C     00036 entry2_4b               equ     b'00001100' ;increment
  00000000     00037 display_clear1_4b       equ     b'00000000'
  00000001     00038 display_clear2_4b       equ     b'00000001'
               00039 
               00040 
  00000030     00041 _0              equ     b'00110000'
  00000031     00042 _1              equ     b'00110001'
  00000032     00043 _2              equ     b'00110010'
  00000033     00044 _3              equ     b'00110011'
  00000034     00045 _4              equ     b'00110100'
  00000035     00046 _5              equ     b'00110101'
  00000036     00047 _6              equ     b'00110110'
  00000037     00048 _7              equ     b'00110111'
  00000038     00049 _8              equ     b'00111000'
  00000039     00050 _9              equ     b'00111001'
  0000003A     00051 _dwukropek      equ     b'00111010'
  00000020     00052 _puste          equ     b'00100000'
  0000002E     00053 _kropka         equ     b'00101110'
  000000DF     00054 _stopni         equ     b'11011111'
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  0000002D     00055 _minus          equ     0x2d
  0000002B     00056 _plus           equ     0x2b
  00000041     00057 _A              equ     b'01000001'
  00000042     00058 _B              equ     b'01000010'
  00000043     00059 _C              equ     b'01000011'
  00000044     00060 _D              equ     b'01000100'
  00000045     00061 _E              equ     b'01000101'
  00000046     00062 _F              equ     b'01000110'
  00000047     00063 _G              equ     b'01000111'
  00000048     00064 _H              equ     b'01001000'
  00000049     00065 _I              equ     b'01001001'
  0000004A     00066 _J              equ     b'01001010'
  0000004B     00067 _K              equ     b'01001011'
  0000004C     00068 _L              equ     b'01001100'
  0000004D     00069 _M              equ     b'01001101'
  0000004E     00070 _N              equ     b'01001110'
  0000004F     00071 _O              equ     b'01001111'
  00000050     00072 _P              equ     b'01010000'
  00000051     00073 _Q              equ     b'01010001'
  00000052     00074 _R              equ     b'01010010'
  00000053     00075 _S              equ     b'01010011'
  00000054     00076 _T              equ     b'01010100'
  00000055     00077 _U              equ     b'01010101'
  00000056     00078 _V              equ     b'01010110'
  00000057     00079 _W              equ     b'01010111'
  00000058     00080 _X              equ     b'01011000'
  00000059     00081 _Y              equ     b'01011001'
  0000005A     00082 _Z              equ     b'01011010'
               00083 
  00000061     00084 _a              equ     b'01100001'
  00000062     00085 _b              equ     b'01100010'
  00000063     00086 _c              equ     b'01100011'
  00000064     00087 _d              equ     b'01100100'
  00000065     00088 _e              equ     b'01100101'
  00000066     00089 _f              equ     b'01100110'
  00000067     00090 _g              equ     b'01100111'
  00000068     00091 _h              equ     b'01101000'
  00000069     00092 _i              equ     b'01101001'
  0000006A     00093 _j              equ     b'01101010'
  0000006B     00094 _k              equ     b'01101011'
  0000006C     00095 _l              equ     b'01101100'
  0000006D     00096 _m              equ     b'01101101'
  0000006E     00097 _n              equ     b'01101110'
  0000006F     00098 _o              equ     b'01101111'
  00000070     00099 _p              equ     b'01110000'
  00000071     00100 _q              equ     b'01110001'
  00000072     00101 _r              equ     b'01110010'
  00000073     00102 _s              equ     b'01110011'
  00000074     00103 _t              equ     b'01110100'
  00000075     00104 _u              equ     b'01110101'
  00000076     00105 _v              equ     b'01110110'
  00000077     00106 _w              equ     b'01110111'
  00000078     00107 _x              equ     b'01111000'
  00000079     00108 _y              equ     b'01111001'
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
  0000007A     00109 _z              equ     b'01111010'
               00110 
  0000002A     00111 _star           equ     0x2a
  0000005E     00112 _up             equ     b'01011110'
  0000002C     00113 _przecinek      equ     0x2c
  0000003C     00114 _mniejszosci      equ      0x3c
  0000003E     00115 _wiekszosci       equ      0x3e
  0000007C     00116 _linia_pionowa    equ         0x7c
               00117 
               00118 
  00000080     00119 linia_pierwsza  equ     0x80
  00000080     00120 linia_gorna     equ     0x80
               00121 
  000000C0     00122 linia_dolna     equ     0xc0
  000000C0     00123 linia_druga     equ     0xc0
               00124 
  00000090     00125 linia_trzecia   equ     0x90
  000000D0     00126 linia_czwarta   equ     0xd0
               00127 ;
               00128 
               00670 
               00671 include  "../libs/lcd4bit18.asm"
               00001 ;wersja 2007-12-07
               00002 ;dla prockow serji 18fxxx
               00003 ;do odczekania 64ms uzywam komendy cpfsgt
               00004 ;zmienne
               00005 ;ktore_bity_uzywane_na_lcd - ktore porty ekranu sa uzywane jako dane
               00006 ;ktore_bity_lcd_tris   - definiuje ktore bity maja byc zamieniane na wejscie podczas check busy
               00007 ;tris_lcd   -definiuje ktory tris wplywa na tris lcd
               00008 ;set_4bit   - ustawienia dla lcd
               00009 ;tmp_lcd - tymczasowa zmienna uywana tylko w procedurach lcd
               00010 
01DA 00011 wait
               00012          
               00013         ;bsf      portlampka,lampka              
               00014 IF (procek == 18f442)
               00015         bcf     INTCON,T0IF
               00016 wait_petla                   
               00017         btfss   INTCON,T0IF      
               00018         goto    wait_petla
               00019         bcf     INTCON,T0IF            
               00020 ENDIF
               00021 
               00022 IF (procek == 18f4320)
01DA 94F2      00023          bcf     INTCON,TMR0IF
01DC 00024 wait_petla         
01DC A4F2      00025         btfss   INTCON,TMR0IF      
01DE EFEE F000 00026         goto    wait_petla
01E2 94F2      00027         bcf     INTCON,TMR0IF
01E4 9AF2      00028         bcf      INTCON,TMR0IE
               00029               
               00030 ENDIF        
               00031         ;bcf      portlampka,lampka              
01E6 0012      00032         return
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00033         
               00034          
               00035 ;funkcja wysy?aj?ca 4 bitowa
               00036 ;LCD
               00037 ;;;;;;;;;;;;;;;;;;;;;;;;;
               00038 
01E8 00039 send
               00040 ;np PORTA bity 0-3  sa uzywane przez 4 bitowy ekran lcd
               00041 ;najpierw wysylane sa 4bity gorne
01E8 6FA2      00042          movwf    dane_lcd
01EA 0E02      00043          movlw    2
01EC 6FA3      00044          movwf    tmp_lcd
01EE 00045 send4bit_petla
               00046          
               00047 ;przenosze PORTA tak aby gorne bity nieulegly zmianie
01EE 0E0F      00048          movlw    ktore_bity_uzywane_na_lcd
01F0 168C      00049          andwf    latch_lcd,f
               00050                           
               00051 IF (polozenie_danych_lcd == 0)        
               00052 ;jesli na gorze bitow port d
               00053          
               00054          swapf    dane_lcd,f
               00055 ENDIF
               00056 
               00057          
01F2 0EF0      00058          movlw    ktore_bity_lcd_tris
01F4 15A2      00059          andwf    dane_lcd,w
01F6 268C      00060          addwf    latch_lcd,f
               00061          
01F8 8682      00062          bsf      port_lcd_e,enable
01FA 0000      00063          nop
01FC 0000      00064          nop
01FE 9682      00065          bcf      port_lcd_e,enable
               00066 IF (polozenie_danych_lcd == 1)        
               00067 ;jesli na gorze bitow port d
               00068          
0200 3BA2      00069          swapf    dane_lcd,f
               00070 ENDIF
               00071             
0202 2FA3      00072          decfsz   tmp_lcd,f
0204 EFF7 F000 00073          goto     send4bit_petla
0208 0012      00074          return
               00075          ;movwf    latch_lcd
               00076          
               00077          
               00078 ;funkcja pisz?ca na ekranie
020A 00079 write_lcd
               00080 
               00081          
020A 868A      00082          bsf      latch_lcd_rs,rs
               00083          ;bsf      PORTB,rs
               00084          
020C ECF4 F000 00085          call     send
               00086          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0210 968A      00087          bcf      latch_lcd_rs,rs    
               00088          ;bcf      PORTB,rs
0212 0012      00089          return
               00090 
               00091 ;funkcja czyszcz?ca ekran
               00092 
               00093 ;funkcja czyszcz?ca ekran
               00094 
0214 00095 cmd_off
               00096 
               00097          
0214 968A      00098          bcf      latch_lcd_rs,rs
               00099          
               00100          
0216 0012      00101         return
               00102          
               00103 
               00104 
               00105 ;funkcja czysci cala linie
               00106 ; przed jej wywolaniem w W umi#1esc adres linii
               00107 ;po zakonczeniu z powrotem w niej umieszcza adres
               00108 ;stara wersja - dziala na cala linie
               00109 
0218 00110 clear_line_old
0218 6F8B      00111          movwf    n
021A 9681      00112          bcf      port_lcd_rs,rs
               00113          
021C 518B      00114          movf     n,w
021E 6FA2      00115          movwf    dane_lcd
0220 ECF4 F000 00116          call     send
0224 0E10      00117          movlw    ile_znakow
0226 6F95      00118          movwf    tmp7
0228 0FFF      00119          addlw    0xff
022A 6FA3      00120          movwf    tmp_lcd
022C 00121 clear_line_old2
022C EC32 F001 00122          call     check_busy
0230 0E20      00123          movlw    _puste
0232 6FA2      00124          movwf    dane_lcd
0234 EC05 F001 00125          call     write_lcd
               00126          
0238 2F95      00127          decfsz   tmp7,f
023A EF16 F001 00128          goto     clear_line_old2
               00129          
023E EC0A F001 00130          call     cmd_off
0242 518B      00131          movf     n,w
0244 0012      00132          return
               00133          
0246 00134 clear_line
               00135 ;przed wywolaniem do n trzeba wrzucic ilosc kasowanych znakow
               00136 ;a w W musi byc adres linii         
0246 6FA2      00137          movwf    dane_lcd
0248 ECF4 F000 00138          call     send
               00139          
024C 00140 clear_line_petla
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
024C EC32 F001 00141          call     check_busy
0250 0E20      00142          movlw    _puste
0252 6FA2      00143          movwf    dane_lcd
0254 EC05 F001 00144          call     write_lcd
               00145          
0258 2F8B      00146          decfsz   n,f
025A EF26 F001 00147          goto     clear_line_petla
               00148          
025E EC0A F001 00149          call     cmd_off
               00150         
0262 0012      00151          return
               00152 
               00153          
               00154          
0264 00155 check_busy
               00156 
               00157 IF (polozenie_danych_lcd == 1)        
               00158 ;jesli na gorze bitow port d
0264 0E0F      00159          movlw    0x0f
               00160          
0266 168C      00161          andwf    latch_lcd,f
               00162 ENDIF
               00163 
               00164 IF (polozenie_danych_lcd == 0)        
               00165 ;jesli w dolnej polowce  bajtu rejestru  portd
               00166          movlw    0xf0
               00167          
               00168          andwf    latch_lcd,f
               00169 ENDIF
               00170          
               00171          ;clrf     port_lcd
               00172          ;clrf     PORTD
               00173 ;przesylam dane np tris 00000001
               00174 ;chce zrobic tak by bylo 
               00175 ;  11110001
               00176        
0268 5095      00177          movf     tris_lcd,w
026A 09F0      00178          iorlw    ktore_bity_lcd_tris
026C 6E95      00179          movwf    tris_lcd    
               00180          
               00181       
               00182          
               00183          
               00184                   
026E 848A      00185          bsf      latch_lcd_rw,rw
0270 968A      00186          bcf      latch_lcd_rs,rs
               00187 
0272 00188 check
               00189          
0272 868B      00190          bsf      latch_lcd_e,enable
               00191          
               00192  IF (polozenie_danych_lcd == 0) 
               00193 ;jezli dolne bity portud 
               00194          swapf    port_lcd,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00195 ENDIF
               00196             
               00197 IF (polozenie_danych_lcd == 1)        
               00198 ;jesli na gorze bitow port d
               00199             
0274 5083      00200          movf    port_lcd,w
               00201 ENDIF
0276 0BF0      00202          andlw    0xf0
               00203          
0278 6FA3      00204          movwf    tmp_lcd
               00205          
027A 968B      00206          bcf      latch_lcd_e,enable
               00207             
027C 0000      00208          nop 
               00209          
027E 868B      00210          bsf      latch_lcd_e,enable
               00211          
               00212 IF (polozenie_danych_lcd == 1) 
               00213 ;jesli na gorze bitow port d
0280 3883      00214          swapf    port_lcd,w
               00215 ENDIF
               00216             
               00217 IF (polozenie_danych_lcd == 0)        
               00218 
               00219             
               00220          movf    port_lcd,w
               00221 ENDIF         
               00222      
0282 0B0F      00223          andlw    0x0f
               00224          
0284 27A3      00225          addwf    tmp_lcd,f
               00226          
0286 968B      00227          bcf      latch_lcd_e,enable    
               00228             
0288 BFA3      00229          btfsc    tmp_lcd,7
028A EF39 F001 00230          goto     check
               00231          
028E 0E0F      00232          movlw   normalne_ustawienie_tris_lcd
0290 6E95      00233          movwf    tris_lcd
               00234          
               00235          
0292 948A      00236          bcf      latch_lcd_rw,rw
0294 968A      00237          bcf      latch_lcd_rs,rs
0296 0012      00238          return
               00239 
               00240 
               00241 
               00242 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                           
               00243 ;poczatek dzialania 4 bitowego ekranu
               00244 
0298 00245 lcd_init
0298 EC0A F001 00246          call     cmd_off
               00247          
               00248 IF (polozenie_danych_lcd == 1)        
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00249 ;jesli na gorze bitow port d
029C 0E0F      00250          movlw    0x0f         
029E 168C      00251          andwf    latch_lcd,f
               00252 ENDIF
               00253 
               00254 IF (polozenie_danych_lcd == 0)        
               00255 ;jesli w dolnej polowce  bajtu rejestru  portd
               00256          movlw    0xf0         
               00257          andwf    latch_lcd,f
               00258 ENDIF
               00259 
               00260 
02A0 948A      00261          bcf      latch_lcd_rw,rw
02A2 968B      00262          bcf      latch_lcd_e,enable
               00263 ;wylaczam przerwanie         
               00264         
02A4 6AD6      00265          clrf     TMR0L
               00266 IF (procek == 18f442)
               00267          bcf      INTCON,T0IE
               00268          
               00269 ENDIF
               00270 IF (procek == 18f4320)
02A6 9AF2      00271          bcf      INTCON,TMR0IE
               00272          
               00273          
               00274 ENDIF         
               00275          
               00276 ;wylaczam przerwania tmr0         
               00277         
02A8 ECED F000 00278          call     wait     ;64ms
               00279 
02AC 0E2A      00280          movlw    init_4bit
02AE 0BF0      00281          andlw    ktore_bity_lcd_tris
               00282 ;teraz w W mam postac 0011 w tym nibbles ktory jest port lcd , jezeli gorne to 00110000
02B0 128C      00283          iorwf    latch_lcd,f
               00284          
02B2 868B      00285          bsf     latch_lcd_e,enable
02B4 0000      00286          nop
02B6 968B      00287          bcf     latch_lcd_e,enable
               00288          ;call     send    ;zalaczam
02B8 6AD6      00289          clrf     TMR0L ;64 ms
02BA ECED F000 00290          call     wait
               00291          
02BE 0E2A      00292          movlw    init_4bit
02C0 0BF0      00293          andlw    ktore_bity_lcd_tris
               00294 ;teraz w W mam postac 0011 w tym nibbles ktory jest port lcd , jezeli gorne to 00110000
02C2 128C      00295          iorwf    latch_lcd,f
               00296          
02C4 868B      00297          bsf     latch_lcd_e,enable
02C6 0000      00298          nop
02C8 968B      00299          bcf     latch_lcd_e,enable
               00300          ;call     send    ;zalaczam
02CA 6AD6      00301          clrf     TMR0L ;64 ms
02CC ECED F000 00302          call     wait
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00303          
02D0 0E2A      00304          movlw    init_4bit
02D2 0BF0      00305          andlw    ktore_bity_lcd_tris
               00306 ;teraz w W mam postac 0011 w tym nibbles ktory jest port lcd , jezeli gorne to 00110000
02D4 128C      00307          iorwf    latch_lcd,f
               00308          
02D6 868B      00309          bsf     latch_lcd_e,enable
02D8 0000      00310          nop
02DA 968B      00311          bcf     latch_lcd_e,enable
               00312          ;call     send    ;zalaczam
02DC 6AD6      00313          clrf     TMR0L ;64 ms
02DE ECED F000 00314          call     wait
               00315          
02E2 0E28      00316          movlw    set_4bit
02E4 ECF4 F000 00317          call     send
               00318          
02E8 EC32 F001 00319          call     check_busy
               00320          
02EC 0E01      00321          movlw    display_clear
               00322          ;movwf    port_lcd,ACCESS
02EE ECF4 F000 00323          call     send
02F2 EC32 F001 00324          call     check_busy
               00325          
02F6 0E0C      00326          movlw   display_on
               00327          ;movwf    port_lcd,ACCESS
02F8 ECF4 F000 00328          call     send
               00329          
               00330          ;clrf   TMR0L;64 ms
               00331          ;call     wait
02FC EC32 F001 00332          call     check_busy
               00333          
               00334         
               00335         ;clrf   TMR0L;64 ms
               00336          ;call     wait
               00337 
               00338          ;call    check_busy
0300 0E06      00339          movlw   entry
               00340         ;movwf   port_lcd,ACCESS
0302 ECF4 F000 00341         call    send
0306 EC32 F001 00342         call     check_busy
030A 0012      00672 
               00673 ;include  "../../libs/dziel_przez2_18.asm"
               00674 
               00675 include  "../libs/eeprom18.asm"
030C 00001 czytaj_eeprom
               00002 
               00003        
               00004 ;IF procek==1         
030C 6EA9      00005          movwf    EEADR
               00006 ;ENDIF         
               00007 ;IF procek==2
               00008  ;        movwf    EEADRL
               00009 ;ENDIF         
               00010            
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
030E 9EA6      00011          bcf      EECON1,EEPGD
0310 80A6      00012          bsf      EECON1,RD
               00013          
               00014        
               00015 
0312 50A8      00016          movf     EEDATA,w
               00017 
0314 0012      00018          return
               00019          
0316 00020 zapis_eeprom
               00021 ;do w adres pod ktory zapisuje
               00022 ;do FSR (INDF) co zapisuje         
               00023 ;poprawka ze zapisuje dana spod INDF1         
               00024          
0316 00025 check_if_write
0316 B2A6      00026          btfsc    EECON1,WR
0318 EF8B F001 00027          goto     check_if_write
               00028     
               00029  
               00030          
               00031 ;IF procek==1         
031C 6EA9      00032          movwf    EEADR
               00033 ;ENDIF         
               00034 
               00035        
031E 50E7      00036          movf     INDF1,w
               00037         
0320 6EA8      00038          movwf     EEDATA
               00039       
0322 9EA6      00040          bcf      EECON1,EEPGD
0324 84A6      00041          bsf      EECON1,WREN
               00042   ;bez przerwan       
0326 9EF2      00043          bcf      INTCON,GIE
               00044          
0328 0E55      00045          movlw    55h
032A 6EA7      00046          movwf    EECON2
032C 0EAA      00047          movlw    0aah
032E 6EA7      00048          movwf    EECON2
               00049          
0330 82A6      00050          bsf      EECON1,WR                  
               00051          
0332 8EF2      00052          bsf      INTCON,GIE
0334 94A6      00053          bcf      EECON1,WREN
               00054          
               00055          
               00056                   
0336 0012      00676 
0338 00677 Start
               00678 ;odczytuje wartosci poprawek czujnikow temperatury
0338 0E00      00679       movlw     poprawka0_ee
033A 6EE9      00680       movwf      FSR0L
033C 6AEA      00681       clrf       FSR0H
033E 0ECB      00682       movlw      poprawka0
0340 6EE1      00683       movwf      FSR1L
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0342 6AE2      00684       clrf       FSR1H
               00685       
0344 00686 petla_odczytu_poprawek_z_eeprom
0344 50E9      00687       movf       FSR0L,w
0346 EC86 F001 00688       call        czytaj_eeprom
034A 6EE7      00689       movwf      INDF1
               00690       
034C 2AE9      00691       incf       FSR0L,f
034E 2AE1      00692       incf       FSR1L,f
0350 0E0A      00693       movlw      0x0a
0352 18E9      00694       xorwf      FSR0L,w
0354 A4D8      00695       btfss      STATUS,Z
0356 EFA2 F001 00696       goto        petla_odczytu_poprawek_z_eeprom
               00697       
               00698       
               00699 
               00700 IF  (czy_ekran==1)
035A EC4C F001 00701          call     lcd_init
035E EC32 F001 00702          call     check_busy
0362 EC0A F001 00703          call    cmd_off
               00704          
               00705          
               00706 ;        call     check_busy
0366 0E80      00707          movlw   linia_gorna
0368 ECF4 F000 00708          call    send
036C EC32 F001 00709          call     check_busy
0370 0E45      00710          movlw    _E
0372 EC05 F001 00711          call     write_lcd
               00712 ENDIF
               00713          
               00714 ;konfiguruje port szeregowy
               00715 ;ustawiam baud rate
               00716          ;bsf      STATUS,RP0
               00717          ;bcf      STATUS,RP1
               00718 ;        movlw    0x1a
               00719 ;         movlw    0x1a
               00720 ;         movlw    0x1a
0376 0E0C      00721          movlw    0x0c
0378 6EAF      00722          movwf    SPBRG
037A 6AAC      00723          clrf     TXSTA
037C 84AC      00724          bsf      TXSTA,BRGH
037E 8AAC      00725          bsf      TXSTA,TXEN
               00726          
               00727 
               00728          
               00729 ;wlaczam przerwanie szeregu
0380 8A9D      00730          bsf      PIE1,RCIE
               00731 ;        bsf      PIE1,TXIE
               00732          ;bcf      STATUS,RP0
0382 0E90      00733          movlw    b'10010000'
0384 6EAB      00734          movwf    RCSTA
               00735          
               00736          
               00737 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0386 0E00      00738          movlw    0
0388 6FA9      00739          movwf    ktory_rejestr_zapisuje
               00740                   
               00741          
               00742          
038A 6FB0      00743          movwf   ktora_probka
               00744          
               00745 
038C 0E08      00746          movlw    8
038E 6FB5      00747          movwf    jak_duzo_bajtow_odbieram_z_ds
               00748          
0390 8882      00749          bsf      port_CTS,znacznik_CTS
               00750          
               00751          
               00752          ;tu ustawiam napiecia referencyjne jako AN3 i Vss 
               00753 ;wszystkie 
               00754 IF  (procek==18f442)
               00755          movlw    b'10000001'
               00756          movwf    ADCON1
               00757 ENDIF         
               00758 IF  (procek==18f4320)         
0392 0E1A      00759          movlw    b'00011010'
0394 6EC1      00760          movwf    ADCON1
               00761          
0396 0EA6      00762          movlw    b'10100110'
0398 6EC0      00763          movwf    ADCON2
               00764 ENDIF
               00765 
039A 85A1      00766       bsf   markers3,czy_zegar_wyswietlac
               00767 
039C 0E30      00768          movlw    0x30
039E 6FD7      00769          movwf    dzien_10
03A0 6FD8      00770          movwf    dzien_1
03A2 6FD9      00771          movwf    godziny_10
03A4 6FDA      00772          movwf    godziny_1
03A6 6FDB      00773          movwf    minuty_10
03A8 6FDC      00774          movwf    minuty_1
03AA 6FDD      00775          movwf    sekundy_10
03AC 6FDE      00776          movwf    sekundy_1
               00777          
               00778          
               00779          ;ustawienie opcji pomiarowych dla menu
03AE 0E00      00780          movlw          0
03B0 6FA5      00781          movwf          ile_kanalow
03B2 0E20      00782          movlw          0x20
03B4 6FA7      00783          movwf          odstep_pomiarowy
03B6 0E80      00784          movlw          0x80
03B8 6FAF      00785          movwf          jak_duzo_probek
               00786          
03BA EC90 F003 00787          call           ustaw_wartosc_dzielenia_usredniania
               00788          
03BE 819F      00789          bsf            markers,czy_usrednianie
               00790          
03C0 0E00      00791          movlw    0
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
03C2 6FAD      00792          movwf    jaka_wartosc_regulujeH
03C4 0E80      00793          movlw    0x80
03C6 6FAE      00794          movwf    jaka_wartosc_regulujeL
               00795          
03C8 0E02      00796          movlw    2
03CA 6FE6      00797          movwf    histereza1
               00798          
03CC 0E02      00799          movlw    2
03CE 6FE7      00800          movwf    histereza2
               00801          
               00802          ;włączam znaczniki sprawiające że przy opuszczeniu menu następuje ponowne włączenie
               00803 ;zegara oraz pokazywania temperatury
               00804 ;z poziomu menu można zmienić te znaczniki tak by nie nastąpiło ponowne wyświetlanie zegara i temperatur
03D0 0E00      00805          movlw    0
03D2 6FE9      00806          movwf    ktory_czujnik_reguluje
               00807          
03D4 839E      00808          bsf            znaczniki,czy_ponownie_wlaczyc_zegar
03D6 819E      00809          bsf            znaczniki,czy_ponownie_wlaczyc_temp
               00810          
03D8 EFD6 F00D 00811          goto     LOOP
               00812   
               00813          
03DC 00814 hex2dec18
               00815       ;zamiana wartosci szesnastkowej na dziesietne
               00816       ;dziele przez 10 tzn mnoze przez 0x1a/256 (0x26) lub przez 0x19/256 (25)
               00817 ;      i wynik jednosci w PRODH, a ulamek w ProdL
               00818       ;w młodszym bajcie wyniku jest ułamek
               00819       ;należy przed uruchomieniem procedury 
               00820       ; umieścić liczbę dzieloną w rejestrze  
               00821       ;tmp_hex
               00822       ;bajt starszy w tmp_hex_H
               00823       
               00824       
               00825       ;clrf        dec1
               00826       ;clrf        dec10
03DC 6B96      00827       clrf        dec100
               00828       
               00829       ;dziele przez 5
               00830       ;mullw       0x33
               00831       ;wynik jest w starszym bajcie
               00832       ;movf        PRODH,w
               00833       ;dzielę przez 2 - 0x80
               00834       ;dzielę przez 0.0976 - mnoże przez 0x19
03DE 5192      00835       movf        tmp_hex,w
03E0 0D19      00836       mullw       0x19
03E2 50F4      00837       movf        PRODH,w
               00838       
03E4 6F97      00839       movwf       dec10
03E6 0D0A      00840       mullw       0xa
03E8 50F3      00841       movf        PRODL,w
               00842       ;tmp_hex - dec10*10 = liczba jednosci
03EA 5D92      00843       subwf       tmp_hex,w
03EC 6F98      00844       movwf       dec1
               00845 ;sprawdzam czy liczba jedności nie przekracza 10, czyli czy nie jest większa > 9
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
03EE 0E09      00846       movlw       0x9
03F0 6598      00847       cpfsgt      dec1  
03F2 EF00 F002 00848       goto        hex2dec18_nie_przekroczono_1
               00849       
03F6 0E0A      00850       movlw       0xa
03F8 5F98      00851       subwf       dec1,f
03FA 2B97      00852       incf        dec10,f
               00853       
03FC B0D8      00854       btfsc       STATUS,C
03FE 2B96      00855       incf        dec100,f
               00856       
               00857       
0400 00858 hex2dec18_nie_przekroczono_1
               00859 ;sprawdz czy liczba dziesiatek  nie przekracza liczby 10 tzn podziel liczbę przez 10 (mnożę przez 0x1a)
               00860       ;przez 5
0400 5197      00861       movf       dec10,w
               00862       ;mullw       0x33
               00863       
               00864       ;movf        PRODH,w
               00865       ;dzielę przez 26
0402 0D1A      00866       mullw       0x1a
               00867       
0404 50F4      00868       movf        PRODH,w
               00869 ;jezeli jest 0 to skocz dalej
0406 E005      00870       bz          hex2dec18_brak_setek
               00871 ;jezeli brak 0 tzn ze w wyniku mamy jakies liczby setek
0408 6F96      00872       movwf       dec100
               00873       ;a ile zostalo liczb 10 - 
040A 0E0A      00874       movlw       0xa
040C 0396      00875       mulwf       dec100
               00876       ;mnoze dec100*100 i wynik odejmuje od liczby 10
040E 50F3      00877       movf        PRODL,w
0410 5F97      00878       subwf       dec10,f
               00879 ; i juz mam ilosc dziesiatek i setek i jednosci z wyniku zamiany jednego bajta na postać dziesiętną
               00880       
0412 00881 hex2dec18_brak_setek
               00882 ;teraz sprawdzam czy w starszym bajcie liczby dzielonej stoi jakas wartość jezeli tak to zwiekszam ilosc setek i dziesiatek
               00883 ;jezeli w starszym bajcie stoi cos:
               00884       
0412 5193      00885       movf       tmp_hex_H,w
               00886             
               00887       
               00888       ;jezeli 0 to koncz prace procedury
0414 E015      00889       bz          hex2_dec_koniec
               00890       ;jezeli nie to popraw wyniki o poprawke
0416 0A01      00891       xorlw       0x01
0418 E005      00892       bz          hex2dec_temperatur_popraw_o_64
               00893       
041A 5193      00894       movf       tmp_hex_H,w
041C 0A02      00895       xorlw       0x02
041E E008      00896       bz          hex2dec_temperatur_popraw_o_128
               00897 
0420 EF20 F002 00898       goto        hex2_dec_koniec
               00899       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0424 00900 hex2dec_temperatur_popraw_o_64
0424 0E06      00901       movlw       0x06
0426 2797      00902       addwf       dec10,f
0428 0E04      00903       movlw       0x04
042A 2798      00904       addwf       dec1,f
042C EF20 F002 00905       goto        hex2_dec_koniec
               00906       
0430 00907 hex2dec_temperatur_popraw_o_128
0430 0E01      00908       movlw       0x01
0432 2796      00909       addwf       dec100,f
0434 0E02      00910       movlw       0x02
0436 2797      00911       addwf       dec10,f
0438 0E08      00912       movlw       0x08
043A 2798      00913       addwf       dec1,f
043C EF20 F002 00914       goto        hex2_dec_koniec
               00915       
0440 00916 hex2_dec_koniec
0440 0012      00917       return
               00918 
               00919 
               00920                                                                                                 ;ZEGAR    Systemowy  
               00921  
               00922 
0442 00923 napisz_czas
0442 97A1      00924       bcf   markers3,odswiezanie_zegara
               00925       ;wyswietlam wszyskie wielkosci czasowe na 1 linii ekranu
0444 EC32 F001 00926       call     check_busy
0448 0E80      00927       movlw   linia_gorna
044A ECF4 F000 00928       call    send
044E EC32 F001 00929       call     check_busy
               00930       
0452 0E20      00931      movlw  _puste 
               00932      ;jeżeli praca w trybie regulacji to pisz r
0454 BDA0      00933      btfsc  markers2,reguluj
0456 0E72      00934      movlw  _r
0458 EC05 F001 00935      call   write_lcd
               00936      
045C EC32 F001 00937      call     check_busy
               00938      
               00939      ;jeżeli praca w trybie transferu szeregowego
0460 0E20      00940      movlw  _puste 
0462 B99F      00941      btfsc  markers,czy_wysylac_pomiary_serial
0464 0E73      00942      movlw  _s
0466 EC05 F001 00943      call   write_lcd
046A EC32 F001 00944      call     check_busy 
               00945       
               00946       
               00947       
               00948       ;addlw 2
               00949       
               00950       
               00951             
046E 0ED7      00952       movlw       dzien_10
0470 6ED9      00953       movwf       FSR2L      
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0472 6ADA      00954       clrf        FSR2H
0474 EF41 F002 00955       goto        petla_napisz_czas
               00956       
0478 00957 petla_napisz_czas_dwukropek      
               00958 ;po kazdych dwóch cyfrach pisz dwukropek
0478 0E3A      00959       movlw       _dwukropek
047A EC05 F001 00960       call        write_lcd
047E EC32 F001 00961       call        check_busy
               00962             
               00963 ;w FSR2l umieszczam adres komorki dzien_10, zwiekszajac ten adres o 1 mam dostep po kolei do wszystkich wartosci 
               00964 ;czasowych
0482 00965 petla_napisz_czas
               00966 ;sprawdz czy cyfra 10 jest 0 - jezeli tak to wyswietl puste
0482 0E30      00967       movlw 0x30
0484 18D9      00968       xorwf FSR2L,w
0486 B4D8      00969       btfsc STATUS,Z
0488 EF49 F002 00970       goto  wyswietl_puste
               00971 ;jezeli wyswietlam zawartosc rejestru      
048C 50DF      00972       movf  INDF2,w
048E EF4A F002 00973       goto  wyswietl_1
               00974       
0492 00975 wyswietl_puste
0492 0E20      00976       movlw _puste
               00977       
0494 00978 wyswietl_1      
               00979       
               00980       
0494 EC05 F001 00981       call  write_lcd
0498 EC32 F001 00982       call  check_busy
               00983       
049C 2AD9      00984       incf  FSR2L,f
049E 50DF      00985       movf  INDF2,w
04A0 EC05 F001 00986       call  write_lcd
04A4 EC32 F001 00987       call  check_busy
               00988       
04A8 2AD9      00989       incf  FSR2L,f
               00990       
04AA 0EDF      00991       movlw       sekundy_1+1
04AC 18D9      00992       xorwf       FSR2L,w
04AE E1E4      00993       bnz         petla_napisz_czas_dwukropek
               00994       
               00995       ;po wyswietleniu zegara znow kaz mierzyc
               00996       
04B0 AD9F      00997       btfss       markers,czy_wlaczyc_ponownie_temp
04B2 EFD6 F00D 00998       goto        LOOP 
               00999       
               01000       
               01001       ;bcf   markers,pomiary_zrobione
               01002       ;i zaznacz zeby je jeszcze raz wlaczyl po wyswietleniu czasu
04B6 9D9F      01003       bcf   markers,czy_wlaczyc_ponownie_temp
               01004       
04B8 EFD6 F00D 01005       goto  LOOP
               01006       ;sprawdz czy INDF2 ==    sekundy_1 + 1
               01007       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01008       
               01009  
               01010 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                                 SPRAWDZANIE CZY nastapilo 0  
04BC 01011 odznacz_by_znow_mierzyc
               01012                                     ;sprawdz czy odstep miedzy pomiarami juz minal
               01013       
               01014       ;incf  aktualny_odstep,w
               01015       
               01016       ;movf  aktualny_odstep,w
               01017       ;bnz   bez_wlaczania_pomiarow
               01018       
04BC 2FA8      01019          decfsz   aktualny_odstep,f
04BE 0012      01020          return                
               01021          
04C0 51A7      01022          movf     odstep_pomiarowy,w
04C2 6FA8      01023          movwf    aktualny_odstep
               01024          
04C4 A59F      01025          btfss    markers,pomiary_zrobione
04C6 0012      01026          return
               01027          
04C8 959F      01028          bcf      markers,pomiary_zrobione
04CA 879F      01029          bsf      markers,inicjuj_pomiary
04CC 0012      01030          return
               01031 
               01032 
               01033 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;  KAZDE ROZPOCZEcie POMIAROW         
04CE 01034 rozpocznij_pomiary         
               01035 ;dokonuj pomiaru  na pierwszym kanale
               01036 ;wlaczam tez przerwanie analogowego pomiaru
               01037          
               01038 ;wlacz przerwanie jak skonczy mierzyc zeby wyslac
               01039 ;wystarczy ze 000 do bitow kanalu
04CE 6B87      01040       clrf  linia2
04D0 6B89      01041       clrf  linia4
04D2 99A0      01042          bcf      markers2,wyslij_pomiar 
               01043          ;
04D4 51A5      01044          movf     ile_kanalow,w
04D6 6FA6      01045          movwf    ktory_kanal_mierze 
               01046          
04D8 51AF      01047          movf    jak_duzo_probek,w
04DA 6FB0      01048          movwf   ktora_probka
04DC 6BB1      01049          clrf     ktory_kanal
               01050          
               01051          ;movwf   ktore_dzielenie_przez2
               01052          
04DE 5082      01053          movf     port_multiplekser,w
               01054 ;czyszcze aktualne ustawienia multipleksera
               01055 ;jezeli byl tu b'01010001'     
04E0 0BF8      01056          andlw    b'11111000'
               01057 ;w wyniku mamy b'01010000'      
04E2 6E8B      01058          movwf    latch_multiplekser   
               01059          
04E4 50C2      01060          movf     ADCON0,w
               01061          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01062          ;bsf      STATUS,RP0
               01063          ;bcf      STATUS,RP1
               01064 ;        movlw    0x1a
               01065          
               01066          ;bcf      STATUS,RP0    
               01067          ;clrf     TMR0L
               01068 IF (procek == 18f442)
               01069          ;bcf      INTCON,T0IF
               01070          ;bsf      INTCON,T0IE
               01071          andlw    b'11000111'
               01072          movwf    ADCON0
               01073          
               01074 ENDIF
               01075 IF (procek == 18f4320)
               01076          ;bcf      INTCON,TMR0IF
               01077          ;bsf      INTCON,TMR0IE
04E6 0BC3      01078          andlw    b'11000011'
04E8 6EC2      01079          movwf    ADCON0
               01080          
               01081 ENDIF
               01082          
               01083          ;jezeli mam wykonywac pomiary to zapisz z rejestru ile mam robic pomiarow
04EA B1A1      01084          btfsc    markers3,pomiary_pradu
04EC 6BD6      01085          clrf     ktory_aktualnie_kanal_pradu
               01086          
04EE 979F      01087          bcf      markers,inicjuj_pomiary
               01088          
04F0 82C2      01089          bsf      ADCON0,GO
04F2 8C9D      01090          bsf      PIE1,ADIE
               01091          
04F4 0012      01092         return             
               01093 
               01094          
04F6 01095 bez_wlaczania_pomiarow
               01096 
               01097          
               01098       
04F6 01099 procedura_obslugi_zegara
               01100 ;najpierw sprawdz czy minelo 16 zliczen?
               01101       
               01102 
               01103 
               01104       ;jezeli pomiary to cy je robic?
04F6 B5A0      01105          btfsc    markers2,pomiary
04F8 EC5E F002 01106          call     odznacz_by_znow_mierzyc
               01107       ;odznacz    
04FC 93A0      01108          bcf      markers2,przerwanie_t1
               01109       
               01110       
               01111          ;btfss    portlampka,lampka
               01112          ;goto     zapal    
               01113          ;bcf      portlampka,lampka
               01114                   
04FE 0012      01115          return
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01116 ;zapal    
               01117  ;        bsf      portlampka,lampka
               01118   ;       return
               01119 
0500 01120 zapal_lampke
0500 7881      01121          btg    portlampka2,lampka2
               01122          
               01123          ; goto     zapal_lampke2
               01124          ; bcf      portlampka2,lampka2
               01125                   
               01126          ; goto     powrot_z_polecen
               01127 ; zapal_lampke2
               01128          ; bsf      portlampka2,lampka2
               01129          
0502 EF29 F005 01130           goto     powrot_z_polecen
               01131 
               01132 
               01133 
0506 01134 sumuj_liczby
0506 6B8F      01135          clrf     liczba2
0508 6B8E      01136          clrf     liczba1
               01137          
               01138          ;incf     FSR0L,f
               01139          
050A 01140 sumuj_liczby_do_kropki
               01141          
050A ECF1 F002 01142          call     kopiuj_liczbe_przeslana
050E C091 F08E 01143          movff    tmp,liczba1
               01144                            
               01145 ;sprawdz czy przekroczono bajt
               01146          ;btfsc    STATUS,C
               01147          ;incf     liczba2,f
               01148          ;                  
               01149          ;incf     FSR0L,f
               01150          ;movlw    _kropka
               01151          ;xorwf    INDF0,w
               01152          ;btfsc    STATUS,Z
               01153          ;incf     FSR0L,f
               01154          
               01155          ;movlw    0x0a
               01156          ;xorwf    INDF0,w
               01157          ;btfss    STATUS,Z
               01158          ;goto     sumuj_liczby_do_kropki     
0512 ECF1 F002 01159          call     kopiuj_liczbe_przeslana
0516 C091 F08F 01160          movff     tmp,liczba2
               01161          
               01162          
051A 38F4      01163          swapf    PRODH,w
051C 0B0F      01164          andlw    0x0f
051E ECFC F002 01165          call     zamien_na_hex
0522 6EAD      01166          movwf    TXREG
               01167          
0524 ECAB F002 01168          call     sprawdz_czy_mozna_wysylac
               01169          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0528 50F4      01170          movf     PRODH,w
               01171 ;robiac taka operacje kasuje starszy bajt na 3 a mlodszy bez zmian      
052A 0B0F      01172          andlw    0x0f
052C ECFC F002 01173          call     zamien_na_hex
0530 6EAD      01174          movwf    TXREG
0532 ECAB F002 01175          call     sprawdz_czy_mozna_wysylac
               01176          
0536 38F3      01177          swapf    PRODL,w
0538 0B0F      01178          andlw    0x0f
053A ECFC F002 01179          call     zamien_na_hex
053E 6EAD      01180          movwf    TXREG
               01181          
0540 ECAB F002 01182          call     sprawdz_czy_mozna_wysylac
               01183          
0544 50F3      01184          movf     PRODL,w
               01185 ;robiac taka operacje kasuje starszy bajt na 3 a mlodszy bez zmian      
0546 0B0F      01186          andlw    0x0f
0548 ECFC F002 01187          call     zamien_na_hex
054C 6EAD      01188          movwf    TXREG
               01189          
054E ECAB F002 01190          call     sprawdz_czy_mozna_wysylac
               01191 ;zapisz  cyfra
               01192          
               01193          ;call     wyswietlanie_liczby
0552 EF29 F005 01194          goto     powrot_z_polecen
               01195 
0556 01196 sprawdz_czy_mozna_wysylac
               01197          ;bsf      STATUS,RP0
0556 01198 TMR_nie_pusty     
0556 A2AC      01199          btfss    TXSTA,TRMT
0558 EFAB F002 01200          goto     TMR_nie_pusty     
               01201          ;bcf      STATUS,RP0
055C 01202 TXREG_nie_pusty   
055C A89E      01203          btfss    PIR1,TXIF
055E EFAE F002 01204          goto     TXREG_nie_pusty
0562 0012      01205          return   
               01206          
0564 01207 wyslij_znak
               01208 ;sprawdz czy USART transmit buffer jest pusty
0564 0E00      01209          movlw    dane_odebraneL
               01210          
0566 6EE9      01211          movwf    FSR0L
0568 0E01      01212          movlw    dane_odebraneH
056A 6EEA      01213          movwf    FSR0H
               01214          
056C 01215 wyslij_znak_petla 
056C ECAB F002 01216          call     sprawdz_czy_mozna_wysylac
               01217 ;laduje dane do wyslania   
0570 2AE9      01218          incf     FSR0L,f
               01219          
               01220 ;        movf     INDF0,w
               01221 ;        call     write_lcd
               01222 ;        call     check_busy
               01223          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0572 0E0D      01224          movlw    0x0d
0574 18EF      01225         xorwf    INDF0,w
0576 B4D8      01226          btfsc    STATUS,Z
0578 EFC2 F002 01227          goto     wyslij_znak_koniec
               01228          
057C 50EF      01229          movf    INDF0,w
057E 6EAD      01230          movwf    TXREG
0580 EFB6 F002 01231          goto     wyslij_znak_petla
0584 01232 wyslij_znak_koniec
0584 ECAB F002 01233          call     sprawdz_czy_mozna_wysylac
0588 0E20      01234          movlw    _puste
058A 6EAD      01235          movwf    TXREG
058C ECAB F002 01236          call     sprawdz_czy_mozna_wysylac
0590 0E3A      01237          movlw    _dwukropek
0592 6EAD      01238          movwf    TXREG
0594 ECAB F002 01239          call     sprawdz_czy_mozna_wysylac
0598 0E2D      01240          movlw    _minus
059A 6EAD      01241          movwf    TXREG
059C ECAB F002 01242          call     sprawdz_czy_mozna_wysylac
05A0 0E0A      01243          movlw    znak_lf
05A2 6EAD      01244          movwf    TXREG
               01245          
05A4 06E9      01246          decf     FSR0L,f
               01247 ;        call     sprawdz_czy_mozna_wysylac
               01248 ;        movlw    znak_lf
               01249 ;        movwf    TXREG
               01250          
05A6 EF29 F005 01251          goto     powrot_z_polecen
               01252          
05AA 01253 sprawdz_czy_odebrano_litere
05AA 0E30      01254          movlw    0x30
05AC 5CEF      01255          subwf    INDF0,w
05AE 6F95      01256          movwf    tmp7
               01257 ;sprawdzam czy zostaly jakies bity w gornej polowce bajtu
               01258          
05B0 0BF0      01259          andlw    0xf0 
05B2 B4D8      01260          btfsc    STATUS,Z
05B4 0012      01261          return
               01262 ;jezeli odebrano litere duza (A,B,C,D,E,F) to po odjeciu 0x41 nic nie powinno zostac w                    
05B6 0E41      01263          movlw    0x41
05B8 5CEF      01264          subwf    INDF0,w
05BA 6F95      01265          movwf    tmp7
               01266 
05BC 0BF0      01267          andlw    0xf0 
05BE A4D8      01268          btfss    STATUS,Z
05C0 EFE5 F002 01269          goto     sprawdz_czy_odebrano_mala_litere
               01270 ;zasada taka to co zostalo po odjeciu 0x41 to 0 dla A 1 dla B etc
               01271 ;aby miec prawdziwy znak dodaje do tego 0x0a         
05C4 0E0A      01272          movlw    0x0A
05C6 2795      01273          addwf    tmp7,f
05C8 0012      01274          return
05CA 01275 sprawdz_czy_odebrano_mala_litere
05CA 0E61      01276          movlw    0x61
05CC 5CEF      01277          subwf    INDF0,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
05CE 6F95      01278          movwf    tmp7
05D0 0BF0      01279          andlw    0xf0 
05D2 A4D8      01280          btfss    STATUS,Z
05D4 EFEF F002 01281          goto     zla_dana_wez_0
05D8 0E0A      01282          movlw    0x0A
05DA 2795      01283          addwf    tmp7,f
05DC 0012      01284          return
05DE 01285 zla_dana_wez_0
05DE 6B95      01286          clrf     tmp7
05E0 0012      01287          return
               01288          
05E2 01289 kopiuj_liczbe_przeslana
               01290 ;procedura dziala na tej zasadzie
               01291 ;ze znaki 0123456789;:<=>?
               01292 ;wysłane na ekran 
               01293 ;po odjeciu 0x30 sa 4bitami liczby
               01294 ;pierwszy znak jest wyzszym bajtem
               01295 ;drugi znak nizszym
               01296 
               01297 ;dodano obsluge literek a,b,c,d,e,f
               01298 ;zamiast znakow ;:<=>?
05E2 2AE9      01299          incf     FSR0L,f
               01300          
05E4 ECD5 F002 01301          call   sprawdz_czy_odebrano_litere  
               01302          
               01303          
05E8 3995      01304          swapf    tmp7,w
05EA 6F91      01305          movwf    tmp
               01306          
05EC 2AE9      01307          incf     FSR0L,f
05EE ECD5 F002 01308          call     sprawdz_czy_odebrano_litere
05F2 5195      01309          movf     tmp7,w
05F4 2791      01310          addwf    tmp,f
               01311          
05F6 0012      01312          return
               01313                   
05F8 01314 zamien_na_hex
               01315 ;jezeli po odjeciu 0a jest niezanaczony bit C
               01316 ;to znaczy ze dodaj 
05F8 6F95      01317          movwf    tmp7
05FA 0E0A      01318          movlw    0x0a
05FC 5D95      01319          subwf    tmp7,w
05FE A0D8      01320          btfss    STATUS,C
0600 EF05 F003 01321          goto     cyfry_0_9
0604 5195      01322          movf     tmp7,w
0606 0F37      01323          addlw    0x37
0608 0012      01324          return
060A 01325 cyfry_0_9         
060A 5195      01326          movf     tmp7,w
060C 0F30      01327          addlw    0x30
060E 0012      01328          return
               01329          
0610 01330 ustaw_spbrg
               01331          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01332          
0610 ECF1 F002 01333          call     kopiuj_liczbe_przeslana
0614 5191      01334          movf     tmp,w
               01335 ;zmieniam SPBRG
               01336          ;bsf      STATUS,RP0
               01337          ;bcf      STATUS,RP1
               01338 ;        movlw    0x1a
0616 6EAF      01339          movwf    SPBRG    
               01340          ;bcf      STATUS,RP0
0618 EF29 F005 01341          goto     powrot_z_polecen
               01342 
061C 01343 pokaz_rejestr     
               01344          
061C ECF1 F002 01345          call     kopiuj_liczbe_przeslana
               01346          
               01347 ;przechowuje FSR0L gdzies    
               01348          
               01349          
0620 5191      01350          movf     tmp,w
0622 6EDA      01351          movwf    FSR2H
0624 ECF1 F002 01352          call     kopiuj_liczbe_przeslana
0628 5191      01353          movf     tmp,w
062A 6ED9      01354          movwf    FSR2L
               01355 ;        movf     INDF0,w
               01356 ;teraz rodzielam bajt na 4 bity starsze i 4 bity mlodsze
062C 38DF      01357          swapf    INDF2,w
062E 0B0F      01358          andlw    0x0f
0630 ECFC F002 01359          call     zamien_na_hex
0634 6EAD      01360          movwf    TXREG
               01361          
0636 ECAB F002 01362          call     sprawdz_czy_mozna_wysylac
               01363          
063A 50DF      01364          movf     INDF2,w
               01365 ;robiac taka operacje kasuje starszy bajt na 3 a mlodszy bez zmian      
063C 0B0F      01366          andlw    0x0f
063E ECFC F002 01367          call     zamien_na_hex
0642 6EAD      01368          movwf    TXREG
0644 ECAB F002 01369          call     sprawdz_czy_mozna_wysylac
0648 0E0A      01370          movlw    znak_lf
064A 6EAD      01371          movwf    TXREG
064C ECAB F002 01372          call     sprawdz_czy_mozna_wysylac
               01373          
0650 EF29 F005 01374          goto     powrot_z_polecen
               01375 
               01376 
               01377 ;inicjuje pomiar co ile sekund na ktoryms z kanalow     
0654 01378 zle_polecenie
0654 6B91      01379          clrf     tmp
0656 01380 zle_polecenie_petla
               01381 ;jestem w pamieci gdzie skok musi byc wykonany w  
               01382 ;250 komorce stad do 
               01383 ;PCLATH musze zaladowac 0x2
0656 0E02      01384          movlw    0x02
0658 6EFA      01385          movwf    PCLATH
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
065A 5191      01386          movf     tmp,w
065C EC3B F003 01387         call    Tab_zle_polecenie
0660 6AFA      01388         clrf      PCLATH
               01389 ;je?eli przeczytał 0 to kończ wyświetlanie
0662 0A00      01390          xorlw    0
0664 B4D8      01391          btfsc    STATUS,Z
0666 EF29 F005 01392          goto     powrot_z_polecen
066A ECAB F002 01393          call     sprawdz_czy_mozna_wysylac
066E 6EAD      01394          movwf    TXREG
0670 2B91      01395          incf     tmp,f
0672 EF2B F003 01396          goto    zle_polecenie_petla
               01397          
0676 01398 Tab_zle_polecenie         
0676 26F9      01399          addwf    PCL,f
0678 0C7A      01400          retlw    _z
067A 0C6C      01401          retlw    _l
067C 0C65      01402          retlw    _e
067E 0C20      01403          retlw    _puste
0680 0C70      01404          retlw    _p
0682 0C6F      01405          retlw    _o
0684 0C6C      01406          retlw    _l
0686 0C65      01407          retlw    _e
0688 0C63      01408          retlw    _c
068A 0C65      01409          retlw    _e
068C 0C6E      01410          retlw    _n
068E 0C69      01411          retlw    _i
0690 0C65      01412          retlw    _e
0692 0C0D      01413          retlw    znak_cr
0694 0C00      01414          retlw    0
               01415          
0696 01416 inicjuj_pomiar
               01417 ;odbierz cyfre ile mam wlaczyc portow analogowych
               01418          
               01419 ;do pomiarow potrzebuje rejestr TMR2         
0696 2AE9      01420          incf     FSR0L,f
0698 50EF      01421          movf     INDF0,w
069A B4D8      01422          btfsc    STATUS,Z
069C EF73 F003 01423          goto     wylacz_pomiary
               01424          
06A0 0E30      01425          movlw    0x30
06A2 5CEF      01426          subwf    INDF0,w
06A4 B4D8      01427          btfsc    STATUS,Z
06A6 EF73 F003 01428          goto     wylacz_pomiary
06AA 6FA5      01429          movwf    ile_kanalow
               01430          
06AC 6FA6      01431          movwf    ktory_kanal_mierze
               01432          
               01433             
               01434 ;sprawdz czy liczba kanalow nie jest wieksza od 8
               01435 ;jezeli od ile_kanalow odejme 8 i nie wyjdzie bit C
               01436 ;tzn pozyczki to przyjmij 0x07
06AE 0808      01437          sublw    0x08
06B0 A0D8      01438          btfss    STATUS,C
06B2 EF2A F003 01439          goto     zle_polecenie
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01440 ;jezeli nie ma kropki to koncz
06B6 2AE9      01441          incf     FSR0L,f
06B8 0E2E      01442          movlw    _kropka
06BA 18EF      01443          xorwf    INDF0,w
06BC A4D8      01444          btfss    STATUS,Z
06BE EF29 F005 01445          goto     powrot_z_polecen
               01446 ;odbierz kolejne cyfry
               01447         
06C2 ECF1 F002 01448          call     kopiuj_liczbe_przeslana
06C6 5191      01449          movf     tmp,w
06C8 6FA7      01450          movwf    odstep_pomiarowy
06CA 6FA8      01451          movwf    aktualny_odstep
               01452 ;wlacz analog/cyfre
06CC 0E01      01453          movlw    b'00000001'
06CE 6EC2      01454          movwf    ADCON0
06D0 85A0      01455          bsf      markers2,pomiary
               01456          ;bcf      portlampka2,lampka2
               01457          ;clrf     TMR2
               01458          ;movlw    b'00000000'
               01459          ;movwf    T2CON
06D2 51AF      01460          movf    jak_duzo_probek,w
               01461          
06D4 6FB0      01462          movwf   ktora_probka
06D6 5082      01463          movf     port_multiplekser,w
               01464          
               01465 ;czyszcze aktualne ustawienia 
               01466 ;jezeli byl tu b'01010001'     
06D8 0BF8      01467          andlw    b'11111000'
               01468 ;w wyniku mamy b'01010000'      
06DA 6E8B      01469          movwf    latch_multiplekser
               01470          
               01471 ;IF  (czy_ekran==1)
               01472 ;         
               01473 ;         movlw   linia_gorna+4
               01474 ;         call    send
               01475  ;        call     check_busy
               01476 ;         movlw    _B
               01477 ;         call     write_lcd
               01478 ;ENDIF
06DC 8B9F      01479          bsf      markers,czy_wyswietlam_temp
06DE 859F      01480          bsf      markers,pomiary_zrobione
06E0 899F      01481          bsf   markers,czy_wysylac_pomiary_serial
               01482          
06E2 EF29 F005 01483          goto     powrot_z_polecen    
               01484 
06E6 01485 wylacz_pomiary
06E6 999F      01486       bcf   markers,czy_wysylac_pomiary_serial
06E8 0E00      01487          movlw    b'00000000'
06EA 6EC2      01488          movwf    ADCON0
06EC 95A0      01489          bcf      markers2,pomiary
06EE 99A0      01490          bcf     markers2,wyslij_pomiar
06F0 9881      01491          bcf     portlampka2,lampka2
06F2 9DA0      01492          bcf      markers2,reguluj
               01493          ;bcf      markers2,
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
06F4 9B9F      01494          bcf      markers,czy_wyswietlam_temp
06F6 EF29 F005 01495          goto     powrot_z_polecen                      
               01496 ;polecenie ustawia regulator -> pokazuje wzgledem ktorego pomiaru ma regulowac wyjscie regulatora wybrane arbitralnie np PORTC0
               01497 ;i do tego portu podlaczam wyjscie na przekaznik lub triac     
               01498 ;
               01499 ;*Rx.yyyy
06FA 01500 wylacz_regulator
06FA 9DA0      01501          bcf      markers2,reguluj
06FC 9881      01502          bcf      portlampka2,lampka2
06FE EF29 F005 01503          goto     powrot_z_polecen              
0702 01504 ustaw_regulator
               01505 ;jezeli nie wlaczylem wczesniej analoga to nie wlaczam regulatora
               01506 
0702 A5A0      01507          btfss    markers2,pomiary
0704 EF7D F003 01508          goto     wylacz_regulator
               01509          
0708 2AE9      01510          incf     FSR0L,f
070A ECD5 F002 01511          call     sprawdz_czy_odebrano_litere
070E 5195      01512          movf     tmp7,w
               01513 ;         btfsc    STATUS,Z
               01514 ;         goto     wylacz_regulator
               01515          
0710 6FAD      01516         movwf    jaka_wartosc_regulujeH
0712 ECF1 F002 01517          call     kopiuj_liczbe_przeslana
0716 5191      01518          movf     tmp,w 
0718 6FAE      01519          movwf    jaka_wartosc_regulujeL
               01520          
071A 8DA0      01521          bsf      markers2,reguluj
071C EF29 F005 01522          goto     powrot_z_polecen    
               01523 
               01524          
0720 01525 ustaw_wartosc_dzielenia_usredniania         
               01526 ;sprawdzam    który bit jest ustawiony
               01527 ;jeżeli jak_duzo_probek == 0x80 to ustawiony jest bit 7
0720 BFAF      01528       btfsc       jak_duzo_probek,7
0722 0E02      01529       movlw       0x02
               01530 ;bit 6 = 0x40   
0724 BDAF      01531       btfsc       jak_duzo_probek,6
0726 0E04      01532       movlw       0x04
               01533       
0728 BBAF      01534       btfsc       jak_duzo_probek,5
072A 0E08      01535       movlw       0x08
               01536 ;0x10      
072C B9AF      01537       btfsc       jak_duzo_probek,4
072E 0E10      01538       movlw       0x10
               01539 ;0x20      
0730 B7AF      01540       btfsc       jak_duzo_probek,3
0732 0E20      01541       movlw       0x20
               01542 ;0x40      
0734 B5AF      01543       btfsc       jak_duzo_probek,2
0736 0E40      01544       movlw       0x40
               01545       
               01546 ;2 próbki      
0738 B3AF      01547       btfsc       jak_duzo_probek,1
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
073A 0E80      01548       movlw       0x80
               01549       
073C 6FB2      01550       movwf       usrednianie_przez_co_mnoze
               01551       
073E 0012      01552       return
               01553       
0740 01554 ustaw_probki                              ;                 PROBKI
0740 6BAA      01555          clrf     pomiarH
0742 6BAB      01556          clrf     pomiarL
0744 6BAC      01557          clrf     pomiar_ulamek
0746 6B9B      01558          clrf     wynikh
0748 6B9C      01559          clrf     wynik
               01560 ;zawsze wyłącz na początku usrednianie
074A 919F      01561          bcf      markers,czy_usrednianie
               01562          
074C ECF1 F002 01563          call     kopiuj_liczbe_przeslana
0750 5191      01564          movf     tmp,w
0752 6FAF      01565          movwf    jak_duzo_probek
               01566          
               01567          ;movwf   ktora_probka
               01568          
               01569 ;sprawdz czy usredniamy czy nie tzn czy wartosc jak_duzo_probek < 2
0754 0801      01570          sublw    1
0756 B0D8      01571          btfsc    STATUS,C
0758 EF29 F005 01572          goto     powrot_z_polecen
075C 819F      01573          bsf      markers,czy_usrednianie
               01574 ;ustaw wartość liczby przez którą mnoże każdy z pomiarów -> tzn przez ile dzielę
               01575          
075E EC90 F003 01576          call     ustaw_wartosc_dzielenia_usredniania
               01577          
0762 EF29 F005 01578          goto     powrot_z_polecen
               01579 
0766 01580 rozkaz_wysylania_znaku_na_lcd
0766 ECF1 F002 01581          call     kopiuj_liczbe_przeslana
076A 5191      01582          movf     tmp,w
076C ECF4 F000 01583          call     send
0770 ECF1 F002 01584          call     kopiuj_liczbe_przeslana
0774 5191      01585          movf     tmp,w
0776 EC05 F001 01586          call     write_lcd
077A EF29 F005 01587          goto     powrot_z_polecen
               01588 
               01589                                                                   ;*                                  *************************POLecenie DS1820
077E 01590 PIN_HI
               01591         
077E 8A94      01592         BSF     TRISC, czujnik_ds1820           ; high impedance
               01593         
               01594         
0780 0012      01595         RETURN
               01596 
0782 01597 PIN_LO
0782 9A82      01598         BCF     port_ds1820,czujnik_ds1820
               01599         
0784 9A94      01600         BCF     TRISC, czujnik_ds1820           ; low impedance zero
               01601         
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01602         
0786 0012      01603         RETURN
0788 01604 send_1
0788 6ACC      01605          clrf     TMR2
078A 929E      01606          bcf      PIR1,TMR2IF
078C ECC1 F003 01607          call     PIN_LO
0790 0000      01608          nop
0792 ECBF F003 01609          call     PIN_HI
               01610          ;bcf      port_ds1820,czujnik_ds1820
               01611          ;nop
               01612          ;nop
               01613          ;nop
               01614          ;nop
               01615          ;nop
               01616          ;nop
               01617          ;bsf      port_ds1820,czujnik_ds1820
0796 01618 petla_send1
0796 A29E      01619          btfss    PIR1,TMR2IF        
0798 EFCB F003 01620          goto     petla_send1
               01621          
079C 0012      01622          return
               01623 
079E 01624 send_0
               01625          ;bsf      port_ds1820,czujnik_ds1820
079E ECC1 F003 01626          call     PIN_LO
07A2 6ACC      01627          clrf     TMR2
07A4 0000      01628          nop
               01629          
07A6 929E      01630          bcf      PIR1,TMR2IF
               01631          
07A8 9A82      01632          bcf      port_ds1820,czujnik_ds1820
07AA 01633 petla_send0
07AA A29E      01634          btfss    PIR1,TMR2IF        
07AC EFD5 F003 01635          goto     petla_send0
07B0 ECBF F003 01636          call     PIN_HI
               01637          
07B4 0012      01638          return
               01639 
               01640 
               01641 
07B6 01642 inicjacja_ds1820
               01643 ;wysyla 0 na linie danych do ds1820 przez 
               01644 ;inicjalizacja 0 na wyjsciu okolo 480us tzn dla ustawienia 1:2 
               01645 ;        dokladnie 256 z liczeniem TMR2 co 2, pozniej otwarcie portu na wejscie przejscie do 1 i po kilkunastu us otwarcie portu na wejscie
               01646 ;        powinien byc obecny sygnal 0 do okolo 240 us.
               01647 ;otwieram port na wyjscie
07B6 98AB      01648          bcf      RCSTA,CREN
               01649          
07B8 9A94      01650          bcf      TRISC,czujnik_ds1820
               01651          
               01652 ;ustawiam tmr2 na zliczanie 2 
07BA 0EFF      01653          movlw    0xff
               01654          
07BC 6ECB      01655          movwf    PR2
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01656          
               01657          
07BE 0E0C      01658          movlw    b'00001100'
07C0 6ECA      01659          movwf    T2CON
07C2 929E      01660          bcf      PIR1,TMR2IF
               01661 ;wlaczam przerwanie Tmr2
               01662          ;bsf      STATUS,RP0
               01663          ;bsf      PIE1,TMR2IE2
               01664          ;bcf      STATUS,RP0         
07C4 ECBF F003 01665          call     PIN_HI
07C8 ECC1 F003 01666          call     PIN_LO
               01667 ;daje znacznik ze dotyczy to inicjacji ds1820
               01668          ;bsf      znaczniki_ds,inicjacja
               01669 ;petla czekania na koniec inicjacji
07CC 01670 petla_inicjacji1
               01671          
07CC A29E      01672          btfss    PIR1,TMR2IF
07CE EFE6 F003 01673          goto     petla_inicjacji1
               01674 ;teraz przelaczam sie na odbior danych z ds1820
               01675          
07D2 8A94      01676          bsf      TRISC,czujnik_ds1820
               01677          
07D4 0000      01678          nop
07D6 929E      01679          bcf      PIR1,TMR2IF
               01680 ;sprawdzam czy w ciagu 480us pojawilo sie 0 na porcie czujnika
07D8 01681 petla_inicjacji2
07D8 AA82      01682          btfss    port_ds1820,czujnik_ds1820
07DA EF00 F004 01683          goto     petla_inicjacji3
07DE A29E      01684          btfss    PIR1,TMR2IF
07E0 EFEC F003 01685          goto     petla_inicjacji2
               01686          
07E4 01687 blad_inicjacji_ds
07E4 ECAB F002 01688          call    sprawdz_czy_mozna_wysylac
07E8 0E0A      01689          movlw    znak_lf
07EA 6EAD      01690          movwf   TXREG
07EC ECAB F002 01691          call    sprawdz_czy_mozna_wysylac
07F0 0E35      01692          movlw    0x35
               01693          
07F2 6EAD      01694          movwf   TXREG
07F4 ECAB F002 01695          call    sprawdz_czy_mozna_wysylac
07F8 0E0A      01696          movlw    znak_lf
07FA 6EAD      01697          movwf   TXREG
07FC EF29 F005 01698          goto     powrot_z_polecen   
0800 01699 petla_inicjacji3
0800 BA82      01700          btfsc    port_ds1820,czujnik_ds1820
0802 EF06 F004 01701          goto     inicjacja_ok
0806 A29E      01702          btfss    PIR1,TMR2IF
0808 EF00 F004 01703          goto     petla_inicjacji3
               01704          
080C 01705 inicjacja_ok
080C B39F      01706          btfsc    markers,czy_wysylanie
080E EF20 F004 01707          goto     wysylanie_danych_rozkaz
               01708          
0812 ECAB F002 01709          call    sprawdz_czy_mozna_wysylac
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0816 0E0A      01710          movlw    znak_lf
0818 6EAD      01711          movwf   TXREG
081A ECAB F002 01712          call    sprawdz_czy_mozna_wysylac
081E 0E4F      01713          movlw    _O
               01714          
0820 6EAD      01715          movwf   TXREG
0822 ECAB F002 01716          call    sprawdz_czy_mozna_wysylac
0826 0E4B      01717          movlw    _K
0828 6EAD      01718          movwf   TXREG
082A ECAB F002 01719          call    sprawdz_czy_mozna_wysylac
082E 0E0A      01720          movlw    znak_lf
0830 6EAD      01721          movwf   TXREG
0832 ECAB F002 01722          call    sprawdz_czy_mozna_wysylac
               01723          
0836 EF29 F005 01724          goto     powrot_z_polecen
               01725          
               01726          
               01727              
               01728 ;jezeli otrzyma 1 to na ekran wysyla informacje 'ds ok'         
               01729 
               01730 
083A 01731 wysylanie_danych
083A 839F      01732          bsf      markers,czy_wysylanie
083C EFDB F003 01733          goto     inicjacja_ds1820
0840 01734 wysylanie_danych_rozkaz
0840 939F      01735          bcf      markers,czy_wysylanie
               01736          
               01737         
               01738 ;ustawiam tmr2 na 60us bo tyle trwa jeden bit  
0842 0E3C      01739          movlw    0x3c
               01740          
0844 6ECB      01741          movwf    PR2
               01742          
               01743          ;bcf      TRISC,czujnik_ds1820
               01744         
               01745          ;bcf      STATUS,RP0
               01746 ;zliczanie 1:1         
0846 0E04      01747          movlw    b'00000100'
0848 6ECA      01748          movwf    T2CON
084A 929E      01749          bcf      PIR1,TMR2IF
               01750 ;wlaczam przerwanie Tmr2
               01751          
084C 01752 wysylanie_bajtu_rozkazu
               01753 ;zczytuje dana do wyslania
084C ECF1 F002 01754         call      kopiuj_liczbe_przeslana
0850 5191      01755         movf      tmp,w
0852 6FB4      01756         movwf     polecenie_wysylane
0854 6ACC      01757         clrf      TMR2
0856 0E08      01758         movlw     8
0858 6F8B      01759         movwf     n
085A 01760 petla_sending        
               01761 ;jezeli 0 to wyslij   0
085A A1B4      01762         btfss     polecenie_wysylane,0
085C ECCF F003 01763         call      send_0
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0860 B1B4      01764         btfsc     polecenie_wysylane,0
0862 ECC4 F003 01765         call      send_1
0866 8A82      01766         bsf       port_ds1820,czujnik_ds1820
0868 90D8      01767         bcf       STATUS,C
086A 33B4      01768         rrcf       polecenie_wysylane,f
               01769         ;bcf       STATUS,C
               01770         ;movf      polecenie_wysylane,w
               01771         ;btfss     STATUS,Z
086C 2F8B      01772         decfsz    n,f
086E EF2D F004 01773         goto      petla_sending
               01774         
               01775 ;sprawdzam czy kolejny bajt jest 0x0d        
0872 2AE9      01776         incf     FSR0L,f
0874 50EF      01777         movf      INDF0,w
0876 0A0D      01778         xorlw     0x0d
0878 B4D8      01779         btfsc     STATUS,Z
087A EF42 F004 01780         goto     sprawdz_czy_ds1820_wysyla
               01781         
087E 06E9      01782         decf      FSR0L,f
0880 EF26 F004 01783         goto      wysylanie_bajtu_rozkazu
               01784         
               01785         
0884 01786 sprawdz_czy_ds1820_wysyla
0884 0ECA      01787          movlw    bajt_ds
0886 6EE9      01788          movwf    FSR0L
0888 51B5      01789          movf     jak_duzo_bajtow_odbieram_z_ds,w
088A 6F8E      01790          movwf    liczba1
               01791             
               01792         ;goto     powrot_z_polecen
               01793 ;procedura sprawdza czy ds1820 cos wysyla jezeli tak to sprawdza przez 60 us czy jest choc na chwile 0
               01794 ;normalnie jezeli ds1820 nic nie wysyla to jest caly czas 1 bez rzadnych zmian
088C 01795 petla_odbioru_ds1820
088C 0E08      01796         movlw     8
088E 6F8B      01797         movwf     n
0890 6ACC      01798         clrf      TMR2
0892 6AEF      01799         clrf      INDF0
0894 929E      01800         bcf       PIR1,TMR2IF
               01801         
0896 01802 petla_czy_jest_0
0896 ECC1 F003 01803          call     PIN_LO
089A 0000      01804          nop
089C ECBF F003 01805          call     PIN_HI
08A0 0000      01806          nop
08A2 0000      01807          nop
08A4 0000      01808          nop
08A6 0000      01809          nop
08A8 0000      01810          nop
08AA 0000      01811          nop
08AC 0000      01812          nop
08AE 5082      01813          movf     port_ds1820,w
08B0 6F8F      01814          movwf    liczba2
08B2 AB8F      01815          btfss    liczba2,czujnik_ds1820
08B4 90D8      01816          bcf      STATUS,C
08B6 BB8F      01817          btfsc    liczba2,czujnik_ds1820
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
08B8 80D8      01818          bsf      STATUS,C
08BA 32EF      01819          rrcf      INDF0,f
               01820          
08BC 01821 czekam_na_kolejny_bit
08BC A29E      01822         btfss    PIR1,TMR2IF
08BE EF5E F004 01823         goto      czekam_na_kolejny_bit
08C2 929E      01824         bcf       PIR1,TMR2IF
               01825         
08C4 2F8B      01826         decfsz    n,f
08C6 EF4B F004 01827         goto      petla_czy_jest_0
08CA 2AE9      01828         incf      FSR0L,f
               01829 ;czy juz przeszly wszystkie linie (4 bajty odebrano)  
08CC 2F8E      01830         decfsz    liczba1,f
08CE EF46 F004 01831         goto      petla_odbioru_ds1820
               01832         
               01833 ;jezeli minelo 60us i nic sie nie dzialo to przerwij odbieranie 
               01834         ;btfsc    PIR1,TMR2IF
08D2 51B5      01835         movf     jak_duzo_bajtow_odbieram_z_ds,w
08D4 6F8B      01836         movwf     n
08D6 0ECA      01837         movlw    bajt_ds
08D8 6EE9      01838         movwf    FSR0L
08DA 01839 petla_wysylania_odebranych_bajtow        
08DA ECAB F002 01840         call    sprawdz_czy_mozna_wysylac
               01841          
08DE 38EF      01842          swapf    INDF0,w
08E0 0B0F      01843          andlw    0x0f
08E2 ECFC F002 01844          call     zamien_na_hex
08E6 6EAD      01845          movwf   TXREG
               01846          
08E8 ECAB F002 01847          call    sprawdz_czy_mozna_wysylac
               01848          
08EC 50EF      01849          movf     INDF0,w
08EE 0B0F      01850          andlw    0x0f
08F0 ECFC F002 01851          call     zamien_na_hex
08F4 6EAD      01852          movwf   TXREG     
08F6 2AE9      01853          incf     FSR0L,f
08F8 2F8B      01854          decfsz   n,f
08FA EF6D F004 01855          goto     petla_wysylania_odebranych_bajtow
               01856          
08FE ECAB F002 01857          call    sprawdz_czy_mozna_wysylac
0902 0E0A      01858          movlw    znak_lf
0904 6EAD      01859          movwf   TXREG   
0906 EF29 F005 01860         goto     powrot_z_polecen
               01861         
090A 01862 ustawienie_liczby_odbieranych_bajtow
               01863          
090A 2AE9      01864          incf     FSR0L,f
090C ECD5 F002 01865          call     sprawdz_czy_odebrano_litere
0910 5195      01866          movf     tmp7,w
0912 080B      01867          sublw    0x0b
0914 A0D8      01868          btfss    STATUS,C
0916 EF91 F004 01869          goto     ustawienie_liczby_odbieranych_bajtow_zero
               01870          
091A 5195      01871          movf     tmp7,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
091C 6FB5      01872          movwf    jak_duzo_bajtow_odbieram_z_ds
091E EF29 F005 01873          goto     powrot_z_polecen
               01874          
0922 01875 ustawienie_liczby_odbieranych_bajtow_zero
0922 0E04      01876          movlw    0x04
0924 6FB5      01877          movwf    jak_duzo_bajtow_odbieram_z_ds
0926 EF29 F005 01878          goto     powrot_z_polecen
               01879          
               01880 ;zarejestrowalem 0
               01881         
               01882 ;tzn czy przez czas 8  bitow cos         
092A 01883 rozkazy_ds1820
092A 2AE9      01884         incf     FSR0L,f
092C 0E69      01885         movlw    _i
092E 18EF      01886         xorwf    INDF0,w
0930 B4D8      01887         btfsc    STATUS,Z 
0932 EFDB F003 01888         goto      inicjacja_ds1820
               01889         
0936 0E73      01890         movlw    _s
0938 18EF      01891         xorwf    INDF0,w
093A B4D8      01892         btfsc    STATUS,Z 
093C EF1D F004 01893         goto     wysylanie_danych
               01894         
0940 0E62      01895         movlw    _b
0942 18EF      01896         xorwf    INDF0,w
0944 B4D8      01897         btfsc    STATUS,Z 
0946 EF85 F004 01898         goto     ustawienie_liczby_odbieranych_bajtow
               01899         
094A EF29 F005 01900         goto     powrot_z_polecen
               01901         
               01902 ;*********KOniec ds1820
094E 01903 wlaczenie_rejestracji_pradu
094E ECF1 F002 01904       call     kopiuj_liczbe_przeslana
               01905       
0952 5191      01906       movf     tmp,w
               01907       
               01908 ;sprawdzenie czy nie podano liczby większej od 2 (mniejszą od 3)
0954 0E03      01909       movlw       3
0956 6191      01910       cpfslt    tmp
               01911 ;jezeli wyszlo C tzn ze przekroczono
0958 EF29 F005 01912       goto        powrot_z_polecen
               01913       
095C 5191      01914       movf     tmp,w
095E E005      01915       bz       wylaczenie_rejestarcji_pradu
0960 6FD5      01916       movwf       jak_duzo_kanalow_pradu
               01917       
0962 81A1      01918       bsf   markers3,pomiary_pradu
0964 6BD6      01919       clrf        ktory_aktualnie_kanal_pradu
               01920       
0966 EF29 F005 01921       goto        powrot_z_polecen
               01922       
096A 01923 wylaczenie_rejestarcji_pradu
096A 91A1      01924       bcf   markers3,pomiary_pradu
096C EF29 F005 01925       goto        powrot_z_polecen
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01926       
0970 01927 rozkaz_rejestracji_poprawki_pomiaru_temperatury
               01928       ;incf     FSR0L,f   
0970 ECF1 F002 01929       call     kopiuj_liczbe_przeslana
               01930 
               01931         
0974 5191      01932       movf     tmp,w
               01933 ;tmp6 przechowuje pod ktory adres zapisac poprawke      
0976 6F94      01934       movwf    tmp6
0978 0809      01935       sublw    9
               01936 ;jezeli wyszlo C tzn ze przekroczono a kanalow mamy tylko 8 + 2 pradowe
097A A0D8      01937       btfss       STATUS,C
097C EF29 F005 01938       goto        powrot_z_polecen
               01939       
               01940       
               01941 ;sprawdz czy przeslana dana nie jest wieksza od 7 jezeli jest to przerwij
               01942 ;odbierz kolejna liczbe
               01943       ;incf     FSR0L,f
0980 ECF1 F002 01944       call     kopiuj_liczbe_przeslana
               01945 
               01946       ;jest w tmp  poprawka
0984 0ECB      01947       movlw    poprawka0
               01948       ;dec100 przechowuje ktorego czujnika to dotyczy
0986 2594      01949       addwf    tmp6,w
0988 6EE1      01950       movwf    FSR1L
098A 6AE2      01951       clrf     FSR1H
               01952       ;zapisuje do rejestru poprawek
098C 5191      01953       movf     tmp,w
098E 6EE7      01954       movwf    INDF1
               01955       ;movwf    poprawka
0990 0E91      01956       movlw       tmp
0992 6EE1      01957       movwf    FSR1L
               01958       
0994 0E00      01959       movlw poprawka0_ee
0996 2594      01960       addwf tmp6,w
0998 EC8B F001 01961       call  zapis_eeprom
099C EF29 F005 01962       goto        powrot_z_polecen
               01963 
09A0 01964 wybor_czujnika_regulatora
09A0 ECF1 F002 01965       call     kopiuj_liczbe_przeslana
               01966       
               01967       
               01968       ;sprawdzam czy nie jest większe od 7
09A4 0E08      01969       movlw    8
09A6 6191      01970       cpfslt   tmp
09A8 EFDA F004 01971       goto     wybrano_czujnik_regulatora_wiekszy_od_7
               01972       
09AC 5191      01973       movf     tmp,w
               01974       
09AE 6FE9      01975       movwf    ktory_czujnik_reguluje
               01976       
09B0 EF29 F005 01977       goto        powrot_z_polecen
               01978 
09B4 01979 wybrano_czujnik_regulatora_wiekszy_od_7
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
09B4 0E00      01980       movlw       0
09B6 6FE9      01981       movwf       ktory_czujnik_reguluje
09B8 EF29 F005 01982       goto        powrot_z_polecen
               01983       
09BC 01984 sprawdz_czy_polecenie                  
               01985 ;sprawdz czy odebrano 'znak_cr'
09BC 0E00      01986          movlw    0x00
09BE 6EE9      01987          movwf    FSR0L
09C0 0E01      01988          movlw    1
09C2 6EEA      01989          movwf    FSR0H
               01990          
09C4 0E2A      01991          movlw    _star
09C6 18EF      01992          xorwf    INDF0,w
09C8 A4D8      01993          btfss    STATUS,Z
               01994 IF (czy_ekran==1)         
09CA EF2E F005 01995          goto     wyslij_na_ekran_to_co_odebralem
               01996 ENDIF         
               01997 IF       (czy_ekran==0)
               01998         goto     powrot_z_polecen
               01999 ENDIF         
               02000    
               02001 
               02002 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;         
09CE 02003 sprawdz_ktore_polecenie
               02004 ;polecenia:
               02005 ;
               02006 ;        *L-zapal lub zgas lampke lampke
               02007 ;        *Px.y - pomiar kanal x wyrzucany na port szeregowy co y czasu (y to 1/2 sekundy)
               02008 ;                 konfiguruje kanal 0 i referencyjne zasilajace
               02009 ;        *P - puste przerywa pomiary
               02010 ;        *Cx - czysci x linie ekranu i zeruje kursor
               02011 ;        *Ryyy    - reguluj odczyt x(ktory kanal) na poziom y ustawienia w ilosc odczytanej cyfry
               02012 ;        *+x.y - dodaje x + y i wynik na 4 linii ekranu
               02013 ;        *>x      przeslij znak x
               02014 ;        **xx   ustaw zegar szeregowego xxx->do SPBRG 
               02015 ;        xx -> zapis szesnastkowy tzn **:: ustawia SPBRG na 0xaa
               02016 ;        *#xxxx - pokaz zawartosc rejestru xxxx (podobnie jak powyzej) - podaje dwa bajty np 0fff
               02017 ;        *S00 - ustawienie ilosci probek na jeden pomiar
               02018 ;        
               02019 ;        *Di  -  inicjuje ds1820
               02020 ;        *Dr  -read rom (only one ds)
               02021 ;        *Ds      -skip rom (whitout rom identification)
               02022 
               02023 ;        *exxyy  - na ekran w miejscu xx wyrzuc znak yy
               02024 ;        *p0xyy  - poprawka kanalu x o yy
               02025 ;           *i0x - pomiar pradu z kanalow 2     
               02026 ;           *A    - który czujnik użyty jest w regulacji
               02027 ;zacznij robic
               02028 ;sprawdzam czy
09CE 2AE9      02029          incf     FSR0L,f
               02030          
09D0 0E4C      02031          movlw    _L
09D2 18EF      02032          xorwf    INDF0,w
09D4 B4D8      02033          btfsc    STATUS,Z
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
09D6 EF80 F002 02034          goto     zapal_lampke
               02035          
               02036          
               02037          
09DA 0E2B      02038          movlw    _plus
09DC 18EF      02039          xorwf    INDF0,w
09DE B4D8      02040          btfsc    STATUS,Z
09E0 EF83 F002 02041          goto     sumuj_liczby
               02042 ;*> - znak wysylania
09E4 0E3E      02043          movlw    0x3e
09E6 18EF      02044          xorwf    INDF0,w
09E8 B4D8      02045          btfsc    STATUS,Z
09EA EFB2 F002 02046          goto     wyslij_znak
               02047 ;**         
09EE 0E2A      02048          movlw    _star
09F0 18EF      02049          xorwf    INDF0,w
09F2 B4D8      02050          btfsc    STATUS,Z
09F4 EF08 F003 02051          goto     ustaw_spbrg
               02052 ;*# - pokaz komorke pamieci         
09F8 0E23      02053          movlw    0x23
09FA 18EF      02054          xorwf    INDF0,w
09FC B4D8      02055          btfsc    STATUS,Z
09FE EF0E F003 02056          goto     pokaz_rejestr
               02057 ;*P -> pomiar     
0A02 0E50      02058          movlw    _P
0A04 18EF      02059          xorwf    INDF0,w
0A06 B4D8      02060          btfsc    STATUS,Z
0A08 EF4B F003 02061          goto     inicjuj_pomiar
               02062 
               02063 
               02064 ;*r ->Reguluj
0A0C 0E52      02065          movlw    _R
0A0E 18EF      02066          xorwf    INDF0,w
0A10 B4D8      02067          btfsc    STATUS,Z
0A12 EF81 F003 02068          goto     ustaw_regulator
               02069          
               02070 ;*S ->probki
0A16 0E53      02071          movlw    _S
0A18 18EF      02072          xorwf    INDF0,w
0A1A B4D8      02073          btfsc    STATUS,Z
0A1C EFA0 F003 02074          goto     ustaw_probki
               02075 ;*D rozkazy Ds1820
0A20 0E44      02076          movlw    _D
0A22 18EF      02077          xorwf    INDF0,w
0A24 B4D8      02078          btfsc    STATUS,Z
0A26 EF95 F004 02079          goto     rozkazy_ds1820
               02080 ;*e 
0A2A 0E65      02081          movlw    _e
0A2C 18EF      02082          xorwf    INDF0,w
0A2E B4D8      02083          btfsc    STATUS,Z
0A30 EFB3 F003 02084          goto     rozkaz_wysylania_znaku_na_lcd
               02085          
               02086          
               02087 ;*p - poprawka  czujnika temperatury i o ile np: *p0009 czyli 0 o 9 (ujemne to uzupelnienia czyli *p00fe to poprawka o -1
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0A34 0E70      02088          movlw    _p
0A36 18EF      02089          xorwf    INDF0,w
0A38 B4D8      02090          btfsc    STATUS,Z
0A3A EFB8 F004 02091          goto     rozkaz_rejestracji_poprawki_pomiaru_temperatury
               02092          
               02093 ;*i - pomiar pradu np *i0x
               02094          
0A3E 0E69      02095          movlw    _i
0A40 18EF      02096          xorwf    INDF0,w
0A42 B4D8      02097          btfsc    STATUS,Z
0A44 EFA7 F004 02098          goto     wlaczenie_rejestracji_pradu
               02099          
0A48 0E41      02100          movlw    _A
0A4A 18EF      02101          xorwf    INDF0,w
0A4C B4D8      02102          btfsc    STATUS,Z
0A4E EFD0 F004 02103          goto     wybor_czujnika_regulatora
               02104          
               02105 ;ustaw szybkosc portu szeregowego
               02106 ;ustawienie jest zapisane do EEPROM i w momencie startu urzadzenia stamtad czytane
               02107 ;mozliwe ustawienia:
               02108 ;0x1a - 11200 baudow
               02109 ;0x0c - 19200 baudow
               02110 ;
               02111          
               02112                            
0A52 02113 powrot_z_polecen
               02114 ;        movlw    _up
0A52 2AE9      02115          incf     FSR0L,f
0A54 97A0      02116          bcf      markers2,sprawdz_odebrane
0A56 6B8D      02117          clrf     odebrano_liter
0A58 88AB      02118          bsf      RCSTA,CREN
               02119 ;        clrf     FSR0L
               02120 ;        movwf    INDF
0A5A 0012      02121          return
               02122          
               02123          
0A5C 02124 wyslij_na_ekran_to_co_odebralem
0A5C EC32 F001 02125       call     check_busy
0A60 0EC0      02126          movlw    linia_dolna
0A62 ECF4 F000 02127          call     send
0A66 EC32 F001 02128          call     check_busy
0A6A 0E00      02129          movlw    dane_odebraneL
0A6C 6EE9      02130          movwf    FSR0L      
0A6E 0E01      02131          movlw    dane_odebraneH
0A70 6EEA      02132          movwf    FSR0H      
               02133          
0A72 02134 wyswietl_litere_petla
               02135          
0A72 0E0D      02136          movlw    0x0d
0A74 18EF      02137          xorwf    INDF0,w
0A76 B4D8      02138          btfsc    STATUS,Z
0A78 EF58 F005 02139          goto     koniec_wyswietlania
               02140          
               02141 ;sprawdz czy odebrano pusty znak...
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02142 ;        movlw    0x0a
               02143 ;        xorwf    INDF,w
               02144 ;        btfsc    STATUS,Z
               02145 ;        goto     koniec_wyswietlania        
               02146          
0A7C 50EF      02147          movf     INDF0,w
0A7E B4D8      02148          btfsc    STATUS,Z
0A80 EF58 F005 02149          goto     koniec_wyswietlania
               02150 
               02151 
0A84 518D      02152          movf     odebrano_liter,w
0A86 A4D8      02153          btfss    STATUS,Z
0A88 EF46 F005 02154          goto     wyswietl_litere_petla2
               02155          
               02156          
               02157 ;        goto     koniec_wyswietlania
               02158 
0A8C 02159 wyswietl_litere_petla2
               02160          ;movlw    linia_dolna
               02161          ;addwf    linia2,w
               02162          ;call     send
               02163          ;call     check_busy
               02164          
0A8C 50EF      02165          movf     INDF0,w
0A8E EC05 F001 02166          call     write_lcd
0A92 EC32 F001 02167          call     check_busy
               02168 ;        clrf     odebrana_litera
0A96 2B87      02169          incf     linia2,f
               02170          
               02171 ;        movlw    0A
               02172 ;        xorwf    linia2
0A98 A987      02173          btfss    linia2,4
0A9A EF55 F005 02174          goto     wyswietl_litere_petla3
               02175          
0A9E 6B87      02176          clrf     linia2
0AA0 0E0F      02177          movlw    0x0f
0AA2 6F8B      02178          movwf    n
0AA4 0EC0      02179          movlw    linia_dolna
0AA6 EC23 F001 02180          call     clear_line
               02181          
0AAA 02182 wyswietl_litere_petla3
0AAA 2AE9      02183          incf     FSR0L,f
               02184 ;        decfsz   odebrano_liter,f
0AAC EF39 F005 02185          goto     wyswietl_litere_petla
               02186          
0AB0 02187 koniec_wyswietlania        
               02188          ;clrf     odebrano_liter
               02189          ;bcf      markers2,wyswietl
0AB0 88AB      02190          bsf      RCSTA,CREN
0AB2 EF29 F005 02191          goto     powrot_z_polecen
               02192 
               02193          
               02194          
               02195          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02196          
               02197          
               02198 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                                     ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;  
               02199 
               02200 
               02201 ; tu sa procedury pomiaru
               02202 
               02203 
               02204 
               02205 
               02206                                                    ;POMIARY!!!!!!!!!!!!!!!!!!!!!!!         
               02207 
               02208                                                    
               02209                                                    
               02210                                                    
               02211                                                    
               02212                                                    
               02213                                                    
               02214                                                    
               02215                                                    
               02216 ;;;;;;;;;;;;;;;
               02217 
               02218 
               02219             
0AB6 02220 wyswietl_cyfry_temperatury
               02221       ;sprawdz czy rzadna z cyfr nie przekracza 10
0AB6 0E0A      02222       movlw       0x0a
0AB8 5D98      02223       subwf       dec1,w
0ABA E302      02224       bnc         sprawdz_10
0ABC 6F98      02225       movwf       dec1
0ABE 2B97      02226       incf        dec10,f
               02227       
0AC0 02228 sprawdz_10
0AC0 0E0A      02229      movlw       0x0a
0AC2 5D97      02230       subwf       dec10,w
0AC4 E302      02231       bnc         wyswietl_cyfry_temperatury2
0AC6 6F97      02232       movwf       dec10
0AC8 2B96      02233       incf        dec100,f
               02234   
0ACA 02235 wyswietl_cyfry_temperatury2  
0ACA EC32 F001 02236          call     check_busy
0ACE 51B1      02237         movf        ktory_kanal,w
               02238          
0AD0 0F30      02239       addlw       0x30
               02240       ;movlw       _plus
0AD2 EC05 F001 02241       call        write_lcd
               02242       
0AD6 EC32 F001 02243       call     check_busy
0ADA 0E20      02244       movlw       _puste
               02245       
               02246       
               02247       
               02248       
               02249       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0ADC BDA1      02250       btfsc       markers3,napisz_minus
0ADE 0E2D      02251       movlw       _minus
0AE0 EC05 F001 02252       call        write_lcd
               02253       
               02254       
               02255          
0AE4 EC32 F001 02256       call     check_busy
0AE8 5196      02257       movf     dec100,w
0AEA E10E      02258       bnz       pisz_cyfre_100
               02259       
0AEC 0E20      02260       movlw    _puste
0AEE EC05 F001 02261       call     write_lcd
0AF2 EC32 F001 02262       call     check_busy
0AF6 5197      02263       movf     dec10,w
0AF8 E10D      02264       bnz      pisz_cyfre_10
               02265       
0AFA 0E20      02266       movlw    _puste
0AFC EC05 F001 02267       call     write_lcd
0B00 EC32 F001 02268       call     check_busy
0B04 EF90 F005 02269       goto     pisz_cyfre_1
               02270       
0B08 02271 pisz_cyfre_100
0B08 5196      02272       movf        dec100,w
0B0A 0F30      02273       addlw       0x30
0B0C EC05 F001 02274       call     write_lcd
0B10 EC32 F001 02275       call     check_busy
               02276 
0B14 02277 pisz_cyfre_10
0B14 5197      02278       movf        dec10,w
0B16 0F30      02279       addlw       0x30
0B18 EC05 F001 02280       call     write_lcd
0B1C EC32 F001 02281       call     check_busy
               02282       
0B20 02283 pisz_cyfre_1
0B20 5198      02284       movf        dec1,w
0B22 0F30      02285       addlw       0x30
0B24 EC05 F001 02286       call     write_lcd
0B28 EC32 F001 02287       call     check_busy
               02288       
0B2C 0E2E      02289       movlw    _kropka
0B2E EC05 F001 02290       call     write_lcd
               02291       
               02292       
               02293 ;sprawdz ktory ulamek
0B32 519D      02294       movf     wynik01,w
0B34 E008      02295       bz       pisz_ulamek_00
               02296       
0B36 0A40      02297       xorlw    0x40
0B38 E011      02298       bz       pisz_ulamek_25
               02299       
0B3A 519D      02300       movf     wynik01,w
0B3C 0A80      02301       xorlw    0x80
0B3E E019      02302       bz       pisz_ulamek_50
               02303       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0B40 519D      02304       movf     wynik01,w
0B42 0AC0      02305       xorlw    0xc0
0B44 E021      02306       bz       pisz_ulamek_75
               02307       
               02308       
0B46 02309 pisz_ulamek_00
0B46 EC32 F001 02310       call     check_busy
0B4A 0E30      02311       movlw    0x30
0B4C EC05 F001 02312       call     write_lcd
0B50 EC32 F001 02313       call     check_busy
0B54 0E20      02314       movlw    _puste
0B56 EC05 F001 02315       call     write_lcd
               02316       
               02317       
0B5A 0012      02318       return
               02319 
0B5C 02320 pisz_ulamek_25
0B5C EC32 F001 02321       call     check_busy
0B60 0E32      02322       movlw    0x32
0B62 EC05 F001 02323       call     write_lcd
               02324       
0B66 EC32 F001 02325       call     check_busy
0B6A 0E35      02326       movlw    0x35
0B6C EC05 F001 02327       call     write_lcd
0B70 0012      02328       return
               02329       
0B72 02330 pisz_ulamek_50
0B72 EC32 F001 02331       call     check_busy
0B76 0E35      02332       movlw    0x35
0B78 EC05 F001 02333       call     write_lcd
0B7C EC32 F001 02334       call     check_busy
0B80 0E30      02335       movlw    0x30
0B82 EC05 F001 02336       call     write_lcd
0B86 0012      02337       return
               02338       
0B88 02339 pisz_ulamek_75
0B88 EC32 F001 02340       call     check_busy
0B8C 0E37      02341       movlw    0x37
0B8E EC05 F001 02342       call     write_lcd
0B92 EC32 F001 02343       call     check_busy
0B96 0E35      02344       movlw    0x35
0B98 EC05 F001 02345       call     write_lcd
0B9C 0012      02346       return
               02347       
               02348       
0B9E 02349 odejmij_512_od_wyniku_sredniej
               02350 
0B9E 0E02      02351          movlw    0x02
0BA0 5FAA      02352          subwf    pomiarH,f
               02353          ;jezeli jest 0 to nic wiecej nie trzeba robic
               02354          
0BA2 B4D8      02355          btfsc    STATUS,Z
0BA4 EFD9 F005 02356          goto     wynik_to_po_prostu_L
               02357          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02358        ;jezeli w wyniku nie ma bitu 7 to oznacza brak liczby ujemnej
0BA8 AFAA      02359        btfss      pomiarH,7
0BAA EFD9 F005 02360        goto       wynik_to_po_prostu_L
               02361        
               02362        
               02363        
               02364       ;w wyniku mamy np ff90 - brak 0
               02365       ;tego nie trzeba bo polecenie negf - działa z -1 przed zastosowaniem
               02366       ;decf  pomiarL,f
               02367       
               02368       ;przy odejmowaniu C jest normalnie ustawione
               02369       ;btfss STATUS,C
               02370       
               02371       ;ale to trzeba bo tak samo zadziała dla starszego bajtu, a on nie ma być -1
0BAE 2BAA      02372       incf  pomiarH,f
               02373       
               02374       ;zaznacz ze pisz minus
0BB0 8DA1      02375       bsf   markers3,napisz_minus
               02376       ;negf  pomiarL,f
               02377       ;negf  pomiarH,f
               02378 
0BB2 02379 wynik_to_po_prostu_L
0BB2 0012      02380       return
               02381 
               02382 
0BB4 02383 usrednianie_wartosci
               02384 ;oblicz srednia dzielac za pomoca ilosc probek pobieranych
               02385          
0BB4 51AF      02386         movf    jak_duzo_probek,w
               02387         
               02388         ;movwf   ktore_dzielenie_przez2
               02389         
               02390         
               02391         
               02392 
0BB6 6B9D      02393         clrf      wynik01
               02394         
0BB8 02395 petla_dzielenia
               02396                                                                     ; bcf     STATUS,C
               02397                                                                     ; call     dzielenie_przez_przesuwanie
               02398                                                                   ;mam na poczatku w ktore dzieleni_przez2 b'10000000'
               02399                                                                   ;po jednym dzieleniu mam b'01000000'
               02400                                                                     ; bcf       STATUS,C
               02401                                                                     ; rrcf     ktore_dzielenie_przez2,f
               02402                                                                     ; btfss   ktore_dzielenie_przez2,0
               02403                                                                     ; goto     petla_dzielenia
               02404                                                                      
               02405 
               02406 
0BB8 51B2      02407       movf    usrednianie_przez_co_mnoze,w
0BBA 039C      02408       mulwf     wynik
               02409       
               02410       ;w PRODH jest wartość do wynik, a w ProdL do wynik01
0BBC 50F4      02411       movf        PRODH,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0BBE 6F9C      02412       movwf       wynik
0BC0 50F3      02413       movf        PRODL,w
0BC2 6F9D      02414       movwf       wynik01
               02415       
0BC4 519B      02416       movf        wynikh,w
0BC6 E008      02417       bz          procedura_sumowania_wyniku
               02418       
0BC8 51B2      02419       movf      usrednianie_przez_co_mnoze,w
0BCA 039B      02420       mulwf     wynikh
               02421       
0BCC 50F4      02422       movf        PRODH,w
0BCE 6F9B      02423       movwf       wynikh
0BD0 50F3      02424       movf        PRODL,w
0BD2 279C      02425       addwf       wynik,f
               02426       ;jeżeli przekroczyłem bajt to zwiększ o 1
               02427       
0BD4 B0D8      02428       btfsc       STATUS,C
0BD6 2B9B      02429       incf        wynikh,f
               02430          
0BD8 02431 procedura_sumowania_wyniku
0BD8 519D      02432          movf     wynik01,w
0BDA 27AC      02433          addwf    pomiar_ulamek,f
               02434 ;jezeli przekroczono pomiarL
0BDC A0D8      02435          btfss    STATUS,C
0BDE EFF5 F005 02436          goto     nie_przekroczono_bajtu_ulamka
0BE2 0E01      02437          movlw    1
0BE4 27AB      02438          addwf    pomiarL,f
               02439 
               02440          
0BE6 B0D8      02441          btfsc    STATUS,C
0BE8 2BAA      02442          incf     pomiarH,f
               02443          
0BEA 02444 nie_przekroczono_bajtu_ulamka         
0BEA 519C      02445          movf     wynik,w
0BEC 27AB      02446          addwf    pomiarL,f
0BEE B0D8      02447          btfsc    STATUS,C
0BF0 2BAA      02448          incf     pomiarH,f
               02449         
0BF2 519B      02450          movf     wynikh,w
0BF4 27AA      02451          addwf    pomiarH,f
0BF6 0012      02452          return
               02453          
0BF8 02454 znow_kaz_mierzyc
               02455 
               02456 ;         bsf      STATUS,RP0
               02457  ;        bcf      STATUS,RP1
               02458 ;        movlw    0x1a
               02459   ;       bsf      PIE1,ADIE
               02460    ;      bcf      STATUS,RP0
               02461     ;     bsf      ADCON0,2 
               02462          ;clrf     TMR0L
               02463          ;bcf      INTCON,T0IF
               02464          ;bsf      INTCON,T0IE
               02465 IF (procek== 18f442)         
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02466          
               02467 ENDIF
               02468 IF (procek== 18f4320)         
               02469          
               02470 ENDIF
0BF8 82C2      02471          bsf      ADCON0,GO
0BFA 99A0      02472          bcf      markers2,wyslij_pomiar
               02473          
0BFC 0012      02474          return
               02475           
               02476 ;na koniec dodaj do pomiarH i pomiarL i pomiar_ulamek
               02477 
0BFE 02478 wysylanie_pomiaru
               02479 
               02480 ;jezeli na każdy pomiar wykonuje szereg pomiarów to nie wysyłaj jeszcze
0BFE 99A0      02481          bcf      markers2,wyslij_pomiar
0C00 A19F      02482          btfss    markers,czy_usrednianie
0C02 EF08 F006 02483          goto     zapisz_do_pamieci
               02484        
               02485 
0C06 ECDA F005 02486          call     usrednianie_wartosci
               02487 
0C0A 2FB0      02488          decfsz   ktora_probka,f
0C0C EFFC F005 02489          goto     znow_kaz_mierzyc
               02490          ;return        
0C10 02491 zapisz_do_pamieci
               02492 ;przed zapisem pomiaru w pamieci ulamki > 0x80 (tzn od 0.5 ) zamieniam na +1 do pomiarL 
               02493 ;w przeciwnym wypadku pomijam
               02494          ;movlw    0x81
               02495          ;subwf    pomiar_ulamek,w
               02496          ;btfss    STATUS,C
               02497          ;goto     zapisz_starszy
               02498          ;bcf      STATUS,C
               02499          ;movlw    1
               02500          ;addwf    pomiarL,f
               02501          ;btfsc    STATUS,C
               02502          ;incf     pomiarH,f
               02503 ;                                                              
               02504          
               02505          
               02506          
               02507          
0C10 B3A1      02508          btfsc    markers3,znacznik_pomiaru_pradu
0C12 EF83 F006 02509          goto     zapis_do_pamieci_prad
               02510          
0C16 02511 zapis_do_pamieci_temperatury  
               02512 
               02513                         ;                                         POPRAWKA temperatury
0C16 6AE2      02514          clrf     FSR1H
0C18 0ECB      02515          movlw    poprawka0
               02516          
               02517          
               02518          ;ktora poprawka
0C1A 6EE1      02519          movwf    FSR1L
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 64


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0C1C 51B1      02520          movf     ktory_kanal,w
0C1E 26E1      02521          addwf    FSR1L,f
0C20 50E7      02522          movf     INDF1,w
               02523          
               02524 
0C22 27AB      02525          addwf    pomiarL,f
               02526          
               02527          ;sprawdz czy poprawka jest ujemna
               02528       ;tzn czy jest zaznaczony bit 7
               02529       ;jezeli tak to nie sprawdzaj przekroczenia
0C24 BEE7      02530         btfsc     INDF1,7
0C26 EF17 F006 02531         goto      zapisz_do_pamieci_nie_sprawdzaj_przekroczenia
               02532          ;jezeli przekroczylem to
               02533          
0C2A B0D8      02534          btfsc    STATUS,C
0C2C 2BAA      02535          incf     pomiarH,f
               02536          
0C2E 02537 zapisz_do_pamieci_nie_sprawdzaj_przekroczenia
               02538                         ;koniec poprawiania wyniku o blad kanalu pomiarowego i skalowanie czujnika
               02539                         
               02540 ;dopiero teraz zamieniam na wartość -512                        
               02541 
               02542 
               02543 
               02544 ;jednak przed odjęciem 512 sprawdzam czy nie ustawiono przesylu do komputera
               02545 
0C2E 02546 zapisz_do_pamieci_czy_mam_send
0C2E A99F      02547          btfss       markers,czy_wysylac_pomiary_serial
0C30 EF33 F006 02548          goto        zapisz_do_pamieci_juz_po_SERIAL
               02549       
0C34 9882      02550          bcf      port_CTS,znacznik_CTS
               02551 
               02552                   
               02553          
               02554         
0C36 98AB      02555          bcf      RCSTA,CREN
               02556  
               02557          
0C38 ECAB F002 02558          call    sprawdz_czy_mozna_wysylac
               02559          
0C3C 51AA      02560          movf    pomiarH,w
0C3E 0F30      02561          addlw    0x30
0C40 6EAD      02562          movwf   TXREG
               02563            
0C42 ECAB F002 02564          call    sprawdz_czy_mozna_wysylac
               02565          
               02566         
0C46 39AB      02567          swapf    pomiarL,w
0C48 0B0F      02568          andlw    0x0f
0C4A ECFC F002 02569          call     zamien_na_hex
0C4E 6EAD      02570          movwf   TXREG
               02571          
               02572          
0C50 ECAB F002 02573          call    sprawdz_czy_mozna_wysylac
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 65


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02574          
0C54 51AB      02575          movf     pomiarL,w
0C56 0B0F      02576          andlw    0x0f
0C58 ECFC F002 02577          call     zamien_na_hex
0C5C 6EAD      02578          movwf   TXREG     
               02579          
               02580 
0C5E ECAB F002 02581          call    sprawdz_czy_mozna_wysylac
               02582          
0C62 0E2C      02583          movlw    _przecinek
               02584         
0C64 6EAD      02585          movwf   TXREG     
               02586          
               02587 
0C66 02588 zapisz_do_pamieci_juz_po_SERIAL        
               02589           ;                                         teraz odejmuje od starszego bajtu 0x02 
0C66 ECCF F005 02590          call     odejmij_512_od_wyniku_sredniej
               02591         
               02592         
0C6A 0EB6      02593          movlw    pomiar0H
0C6C 6EE1      02594          movwf    FSR1L
               02595                   
0C6E 51B1      02596          movf     ktory_kanal,w
0C70 26E1      02597          addwf    FSR1L,f
0C72 26E1      02598          addwf    FSR1L,f
               02599                   
0C74 51AA      02600          movf     pomiarH,w         
0C76 6EE7      02601          movwf    INDF1
               02602                               ;IF (czy_pomiary_na_ekran==1)  
               02603                               ;sprawdz czy mam wyswietlac 
               02604                               ;jezeli wszedlem do menu ekranu to nie wyswietlam temperatur
               02605                                     
               02606                                     ; btfss      markers,czy_wyswietlam_temp
               02607                                     ; goto        bez_wyswietlania_temp1
               02608 
               02609                                     
               02610                               ;         movf     INDF1,w
               02611                                        ;tu wlaczam procedurę zamiany szesnastkowej wartości na dziesiętną liczbę
               02612                                        
               02613                                        
               02614                                ;        addlw    0x30
               02615                                 ;       call     write_lcd
               02616                                  ;      incf     linia2,f
               02617                               ;ENDIF         
               02618 
0C78 02619 bez_wyswietlania_temp1
0C78 2AE1      02620          incf     FSR1L,f
0C7A 51AB      02621          movf     pomiarL,w
               02622                   
0C7C 6EE7      02623          movwf    INDF1
               02624 IF (czy_pomiary_na_ekran==1)   
               02625 
0C7E AB9F      02626       btfss      markers,czy_wyswietlam_temp
0C80 EF81 F006 02627       goto        bez_wyswietlania_temp2
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 66


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02628       
               02629             
               02630       ;sprawdz czy rejestr linia2 > 13
0C84 0E0C      02631       movlw       0x0c
               02632       ; sprawdzam                  rejestr > W
0C86 6187      02633       cpfslt      linia2      
0C88 6B87      02634       clrf        linia2
               02635       
               02636       
0C8A 02637 nie_czysc_rejestru_polozenia  
               02638   ;temperatury 0-3 na ekranie sa wyswietlane jezeli niezaznaczono bitu markers3,pokazuje_temperatury_47
               02639       ;aby to sprawdzic dokonuje operacji odjecia od 3 - ktory_kanal
               02640       
0C8A 0E04      02641       movlw       0x04
               02642       ; sprawdzam                  rejestr > W
0C8C 61B1      02643       cpfslt        ktory_kanal
0C8E EF52 F006 02644       goto          sprawdz_czy_mam_wyswietlac_47       
               02645  
               02646       ;jezeli wynik wskazuje na pomiary na kanale 0 - 3 to sprawdz czy nie wlaczony jest bit 
               02647       
0C92 BFA1      02648       btfsc       markers3,pokazuje_temperatury_47
0C94 EF81 F006 02649       goto        bez_wyswietlania_temp2
               02650       
0C98 0E01      02651       movlw 1
               02652       ;bit      0-1 ida na linie 2  -> 00000011
               02653       ; ktory_kanal   > 1 to na linii3
0C9A 65B1      02654       cpfsgt  ktory_kanal
0C9C EF63 F006 02655       goto         ustaw_linie_druga
               02656       ;jezeli kanal 2-3
0CA0 EF5B F006 02657       goto        ustaw_linie_trzecia
               02658             
               02659       
0CA4 02660 sprawdz_czy_mam_wyswietlac_47
               02661  ;jezeli wyswietlam kanal 4 -7
               02662  ; i zaznaczono ten bit tzn ze mam teraz kanal 4, ktory mam wyswietlac na ekranie (pomiary czujnikow 4-7)
               02663  
0CA4 AFA1      02664       btfss       markers3,pokazuje_temperatury_47
0CA6 EF81 F006 02665       goto        bez_wyswietlania_temp2
               02666       
0CAA 0E05      02667       movlw 5
               02668       ;bit      0-1 ida na linie 2  -> 00000011
               02669       ; ktory_kanal   > 5 to na linii3
0CAC 65B1      02670       cpfsgt  ktory_kanal
0CAE EF63 F006 02671       goto         ustaw_linie_druga
               02672       ;jezeli kanal ma wartosc 6-7
0CB2 EF5B F006 02673       goto        ustaw_linie_trzecia
               02674       
               02675       
0CB6 02676 ustaw_linie_trzecia
0CB6 EC32 F001 02677       call     check_busy
0CBA 0E90      02678          movlw    linia_trzecia
0CBC 2587      02679          addwf    linia2,w
0CBE ECF4 F000 02680          call      send      
0CC2 EF6B F006 02681          goto     napisz_wartosc_temperatury
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 67


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02682       
0CC6 02683 ustaw_linie_druga      
0CC6 EC32 F001 02684       call     check_busy
0CCA 0EC0      02685          movlw    linia_dolna
0CCC 2587      02686          addwf    linia2,w
0CCE ECF4 F000 02687          call      send
0CD2 EF6B F006 02688          goto     napisz_wartosc_temperatury
               02689          
               02690  
               02691          ;call     check_busy      
               02692          ;call     check_busy
               02693          ;swapf    INDF1,w
               02694          ;andlw    0x0f
               02695          ;call     zamien_na_hex
               02696                          
               02697          ;call     write_lcd
               02698          
               02699          ;call     check_busy
               02700          ;movf     INDF1,w
               02701          ;andlw    0x0f
               02702          ;call     zamien_na_hex
               02703          ;call     write_lcd
               02704          ;call     check_busy
               02705          ;movlw    _puste
               02706          ;call     write_lcd
               02707          
               02708          
               02709          
0CD6 02710 napisz_wartosc_temperatury         
0CD6 50E7      02711       movf        INDF1,w
0CD8 6F92      02712       movwf       tmp_hex
               02713       
0CDA 06E1      02714       decf        FSR1L,f ; - FSR1L pokazuje teraz wartosc starszego bajtu liczby zamienianej
0CDC 50E7      02715       movf        INDF1,w
               02716       
0CDE 6F93      02717       movwf       tmp_hex_H
               02718       
0CE0 BDA1      02719       btfsc       markers3,napisz_minus
0CE2 6D92      02720       negf        tmp_hex
               02721       
0CE4 BDA1      02722       btfsc       markers3,napisz_minus
0CE6 6D93      02723       negf        tmp_hex_H
               02724       
0CE8 5192      02725       movf        tmp_hex,w
               02726       ;dziele przez 4
0CEA 0D40      02727       mullw       0x40
               02728       
0CEC 50F3      02729       movf        PRODL,w
0CEE 6F9D      02730       movwf       wynik01
               02731       
               02732       ;temperatura jest w bajcie starszym
0CF0 50F4      02733       movf        PRODH,w
0CF2 6F92      02734       movwf       tmp_hex
               02735       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 68


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0CF4 ECEE F001 02736          call     hex2dec18
               02737          
0CF8 EC5B F005 02738          call     wyswietl_cyfry_temperatury
               02739          
               02740          ;call     check_busy
               02741          ;movlw    _linia_pionowa
               02742          
               02743          ;call     write_lcd
0CFC 9DA1      02744          bcf      markers3,napisz_minus
0CFE 0E08      02745          movlw    8
               02746          
0D00 2787      02747          addwf     linia2,f
               02748          ;bcf      markers3,pokazuje_temperatury_47
               02749 ENDIF         
               02750 
0D02 02751 bez_wyswietlania_temp2
               02752 
0D02 EFC3 F006 02753       goto  procedura_regulacji_dwustawnej
               02754       
0D06 02755 zapis_do_pamieci_prad
0D06 6AE2      02756       clrf     FSR1H
0D08 0ED3      02757       movlw    poprawka_prad1
               02758          
               02759          ;ktora poprawka
0D0A 6EE1      02760          movwf    FSR1L
0D0C 05D6      02761          decf     ktory_aktualnie_kanal_pradu,w
0D0E 26E1      02762          addwf    FSR1L,f
0D10 50E7      02763          movf     INDF1,w
0D12 27AB      02764          addwf    pomiarL,f
               02765          ;jezeli przekroczylem to
0D14 B0D8      02766          btfsc    STATUS,C
0D16 2BAA      02767          incf     pomiarH,f
               02768         ;movwf     
               02769 
               02770                   
0D18 0EC6      02771          movlw    pomiar_prad1H        
0D1A 6EE1      02772          movwf    FSR1L
               02773                   
0D1C 05D6      02774          decf     ktory_aktualnie_kanal_pradu,w
0D1E 26E1      02775          addwf    FSR1L,f
0D20 26E1      02776          addwf    FSR1L,f
               02777                   
0D22 51AA      02778          movf     pomiarH,w         
0D24 6EE7      02779          movwf    INDF1 
               02780 IF (czy_pomiary_na_ekran==1)  
               02781 ;sprawdz czy mam wyswietlac 
               02782 ;jezeli wszedlem do menu ekranu to nie wyswietlam temperatur
               02783       
0D26 AB9F      02784       btfss      markers,czy_wyswietlam_temp
0D28 EFA3 F006 02785       goto        bez_wyswietlania_pradu
               02786 
0D2C EC32 F001 02787       call     check_busy
0D30 0ED0      02788          movlw    linia_czwarta
0D32 2589      02789          addwf    linia4,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 69


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0D34 ECF4 F000 02790          call      send
               02791          
               02792          
               02793  
0D38 EC32 F001 02794          call     check_busy
0D3C 50E7      02795          movf     INDF1,w
               02796          ;tu wlaczam procedurę zamiany szesnastkowej wartości na dziesiętną liczbę
               02797          
               02798          
0D3E 0F30      02799          addlw    0x30
0D40 EC05 F001 02800          call     write_lcd
0D44 2B89      02801          incf     linia4,f
               02802 ENDIF         
               02803 
0D46 02804 bez_wyswietlania_pradu
               02805 
               02806          
0D46 2AE1      02807       incf     FSR1L,f
0D48 51AB      02808       movf     pomiarL,w
               02809                   
0D4A 6EE7      02810       movwf    INDF1    
               02811       
               02812 IF (czy_pomiary_na_ekran==1)
               02813 
0D4C AB9F      02814       btfss      markers,czy_wyswietlam_temp
0D4E EFC1 F006 02815       goto        bez_wyswietlania_pradu2
               02816        
0D52 EC32 F001 02817          call     check_busy
0D56 38E7      02818          swapf    INDF1,w
0D58 0B0F      02819          andlw    0x0f
0D5A ECFC F002 02820          call     zamien_na_hex
               02821                          
0D5E EC05 F001 02822          call     write_lcd
               02823          
0D62 EC32 F001 02824          call     check_busy
0D66 50E7      02825          movf     INDF1,w
0D68 0B0F      02826          andlw    0x0f
0D6A ECFC F002 02827          call     zamien_na_hex
0D6E EC05 F001 02828          call     write_lcd
0D72 EC32 F001 02829          call     check_busy
0D76 0E20      02830          movlw    _puste
0D78 EC05 F001 02831          call     write_lcd
0D7C 2B89      02832          incf     linia4,f
0D7E 2B89      02833          incf     linia4,f
0D80 2B89      02834          incf     linia4,f
               02835 ENDIF       
               02836 
0D82 02837 bez_wyswietlania_pradu2
               02838       
0D82 EF01 F007 02839       goto     sprawdz_czy_mam_dalej_mierzyc_prad
               02840       
0D86 02841 procedura_regulacji_dwustawnej         
               02842       
               02843 ;jezeli ostatni kanal to wyslij wszystkie, jezeli nie ostatni to zmierz kolejny
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 70


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0D86 ADA0      02844          btfss    markers2,reguluj
0D88 EFF8 F006 02845          goto     sprawdz_czy_mam_dalej_mierzyc
               02846 ;jezeli mierze prad to nic nie sprawdzaj
               02847 
               02848      
               02849 ;porownaj wartosc pomierzona z zadana
               02850                   
               02851 
               02852 ;regulacja z 0 kanalu
               02853          
               02854          ;movf        ktory_kanal,w
               02855          ;xorlw         0         
               02856          ;btfsc          STATUS,Z
0D8C 51E9      02857          movf    ktory_czujnik_reguluje,w
0D8E 63B1      02858          cpfseq   ktory_kanal
0D90 EFF8 F006 02859          goto           sprawdz_czy_mam_dalej_mierzyc
               02860          
               02861                   ;tu musze poprawic prace regulatora
               02862          
               02863          ;chodzi o to zeby wlaczal moc kiedy temperatura spadnie ponizej temperatury zadanej - histereza
               02864          
               02865          
               02866          ;tzn jezeli moc jest wylaczona
               02867          
               02868          ;to wlacz dopiero kiedy temperatura osiagnie wartosc t min
               02869          
               02870          
               02871          ; czy moc jest teraz wlaczona?
               02872          
               02873          ;btfsc    
               02874 
               02875          
               02876          
0D94 51AD      02877          movf     jaka_wartosc_regulujeH,w
               02878          ;pomiarh - jaka_wartosc_regulujeH
0D96 5DAA      02879          subwf    pomiarH,w
               02880 ;sprawdz czy to samo czy wieksze
0D98 B4D8      02881          btfsc    STATUS,Z
0D9A EFD9 F006 02882          goto     sa_rowne_sprawdz_Lbajt
0D9E A0D8      02883          btfss    STATUS,C 
0DA0 EFD5 F006 02884          goto     zalacz_grzanie
               02885 ;tzn reguluj<pomiaru w starszym bajcie wiec wylacz grzanie
0DA4 8FA0      02886          bsf      markers2,wylacz_moc
0DA6 EFF8 F006 02887          goto     sprawdz_czy_mam_dalej_mierzyc
               02888          
0DAA 02889 zalacz_grzanie    
               02890 ;jezeli jakikolwiek pomiar wykazal ze trzeba wylaczyc to nie wlaczaj grzania
               02891 ;        
0DAA AFA0      02892          btfss    markers2,wylacz_moc
0DAC 8BA0      02893          bsf      markers2,zalacz_moc
               02894          
0DAE EFF8 F006 02895          goto     sprawdz_czy_mam_dalej_mierzyc
               02896 
               02897                            
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 71


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0DB2 02898 sa_rowne_sprawdz_Lbajt
               02899 ;tak samo
               02900          ;movf     histereza,w
               02901          ;sprawdz czy moc wylaczona - jezeli tak to wlacz 1  stopien nizej czyli 4 nizej
               02902 ;jezeli jest wlaczona energia to dodaj wartosc histerezy tj wylacza pozniej
               02903          ;btfsc    latch_moc,lampka2
0DB2 B081      02904          btfsc    port_triak,triak1
0DB4 EFE8 F006 02905          goto     regulacja_dwu_moc_ON
               02906          
               02907          
0DB8 02908 regulacja_dwu_moc_OFF         
               02909          ;jeżeli moc jest wyłączona w tej chwili to włącz ją dopiero gdy 
               02910          ;pomiar będzie mniejszy niż temperatura zadana 
               02911          
               02912          ;histereza dolna
0DB8 51E7      02913          movf     histereza2,w
0DBA 5DAE      02914          subwf     jaka_wartosc_regulujeL,w
               02915              
               02916          
0DBC 5DAB      02917          subwf    pomiarL,w
               02918 ;sprawdz czy to samo czy wieksze
0DBE B4D8      02919          btfsc    STATUS,Z
0DC0 EFD5 F006 02920          goto     zalacz_grzanie
               02921          
               02922          
               02923 ; jeżeli po odjęciu nie ma C w Statusie, tzn że pomiarL < pomiaru-histerezy
               02924          
0DC4 A0D8      02925          btfss    STATUS,C 
0DC6 EFD5 F006 02926          goto     zalacz_grzanie
               02927 ;tzn reguluj>pomiaru w mlodszym bajcie wiec wlacz grzanie
0DCA 8FA0      02928          bsf      markers2,wylacz_moc
0DCC EFF8 F006 02929          goto     sprawdz_czy_mam_dalej_mierzyc
               02930          
               02931          
0DD0 02932 regulacja_dwu_moc_ON
               02933          ;jeżeli moc jest włączona w tej chwili to wyłącz ją dopiero gdy 
               02934          ;pomiar będzie większy niż temperatura zadana + histereza zadana
               02935          
               02936          ;histereza górna
0DD0 51E6      02937          movf     histereza1,w
0DD2 25AE      02938          addwf    jaka_wartosc_regulujeL,w
               02939          
               02940          ; w WREG jest wartosc  histereza + ustawienie wartosci regulacji
               02941          
               02942        
0DD4 5DAB      02943          subwf    pomiarL,w  
               02944          ;w WREG  jest wartosc   pomiarL  -  (histereza + ustawienie wartosci )
               02945 ;sprawdz czy to samo czy wieksze
0DD6 B4D8      02946          btfsc    STATUS,Z
0DD8 EFF1 F006 02947          goto     regulacja_dwu_moc_ON_wylacz
               02948 
               02949          
               02950          
               02951          ;C pojawia sie tylko gdy 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 72


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               02952          
0DDC A0D8      02953          btfss    STATUS,C 
0DDE EFD5 F006 02954          goto     zalacz_grzanie
               02955 ;tzn reguluj<pomiaru w mlodszym bajcie wiec wylacz grzanie
               02956 
0DE2 02957 regulacja_dwu_moc_ON_wylacz
0DE2 8FA0      02958          bsf      markers2,wylacz_moc
0DE4 EFF8 F006 02959          goto     sprawdz_czy_mam_dalej_mierzyc                         
0DE8 02960 sa_rowne_nic_nie_rob
0DE8 EFD5 F006 02961          goto     zalacz_grzanie    
0DEC EFF8 F006 02962          goto     sprawdz_czy_mam_dalej_mierzyc       
               02963 
0DF0 02964 sprawdz_czy_mam_dalej_mierzyc
               02965 ;sprawdzam tu czy mam wykonac pomiary dla kolejnego 
               02966 ;kanalu
               02967 ;tu czyszcze zawartosc rejestrow pomiaru
0DF0 6BAA      02968          clrf     pomiarH
0DF2 6BAB      02969          clrf     pomiarL
0DF4 6BAC      02970          clrf     pomiar_ulamek
               02971          
               02972          
0DF6 2FA6      02973          decfsz   ktory_kanal_mierze,f
0DF8 EF6B F007 02974          goto     zmierz_nastepny_czujnik_temperatury
               02975 
               02976 ;zmierz jeszcze prady          
               02977          
0DFC A1A1      02978          btfss    markers3,pomiary_pradu
0DFE EF0B F007 02979          goto     wykonano_pomiary_wszystkich_kanalow
               02980         
               02981         ;jeszcze mierze prady jezeli ustawiono bit pomiary_pradu
               02982          
0E02 02983 sprawdz_czy_mam_dalej_mierzyc_prad
               02984 
               02985          ;sprawdz czy rejestr przechowujący aktualne wskazanie mierzonej temperatury nie wskazuje 0
0E02 51D6      02986          movf     ktory_aktualnie_kanal_pradu,w;zwiększam o jeden żeby skala obydwu rejestrów była identyczna
               02987          
0E04 19D5      02988          xorwf    jak_duzo_kanalow_pradu,w
               02989          ;jezeli 0 tzn ze juz zmierzylem co trzeba
0E06 B4D8      02990          btfsc    STATUS,Z
0E08 EF0B F007 02991          goto     wykonano_pomiary_wszystkich_kanalow
               02992          
               02993       ;wlaczam pomiar pradu na 1 kanale
               02994       
               02995       ;do kanalu aktualnego trzeba dodać 8*2 by uzyskac kanal pradowy
               02996       ;bo aby zmierzyc 1 kanal pradu to z AN0 przeskok do AN2
               02997       ;z kanalu AN2 do AN4
               02998       
0E0C 0E08      02999       movlw    8
               03000             
0E0E 26C2      03001       addwf   ADCON0,f
0E10 2BD6      03002       incf     ktory_aktualnie_kanal_pradu,f
               03003       ;movlw    b'00111100'
               03004       ;andwf    ADCON0,w
0E12 EF66 F007 03005       goto  zmierz_prad
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 73


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03006       
               03007       ;goto     zmierz_nastepny_czujnik_temperatury   
               03008          
0E16 03009 wykonano_pomiary_wszystkich_kanalow
               03010 ;jezeli juz skonczylem wszystkie mierzyc to sprawdz czy mam wlaczyc grzanie
               03011 ;jezeli ustawiono bit o nie wlaczaniu to olej
0E16 ADA0      03012          btfss    markers2,reguluj
0E18 EF1B F007 03013          goto     koniec_mierzenia
               03014          
0E1C BFA0      03015          btfsc    markers2,wylacz_moc
0E1E EF18 F007 03016          goto    wylaczam_moc
               03017          
0E22 ABA0      03018          btfss    markers2,zalacz_moc
0E24 EF18 F007 03019          goto    wylaczam_moc
               03020          
0E28 A081      03021          btfss    port_triak,triak1
0E2A 8081      03022          bsf      port_triak,triak1
               03023          
0E2C EF19 F007 03024          goto    koncz_z_moca
0E30 03025 wylaczam_moc
0E30 9081      03026          bcf      port_triak,triak1
               03027          
0E32 03028 koncz_z_moca
0E32 9BA0      03029          bcf      markers2,zalacz_moc
0E34 9FA0      03030          bcf      markers2,wylacz_moc
               03031          
               03032          
               03033          
               03034          
               03035                                                 ;juz wszystkie kanaly i wysylaj pomiary
0E36 03036 koniec_mierzenia
               03037 
               03038  
               03039 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;koniec wysylania pomiarow 
               03040 
               03041 
               03042 
               03043 
               03044          ;jezeli mierzylem prady to sprawdz to, maxymalnie dwa prady podaje
0E36 A1A1      03045          btfss    markers3,pomiary_pradu
0E38 EF56 F007 03046          goto     juz_wysylac_znak_LF
               03047          
0E3C 03048 sprawdz_RTS_prad
               03049          ;btfss    port_RTS,znacznik_RTS
               03050          ;goto     sprawdz_RTS_prad
               03051       
               03052       ;jak duzo mialem mierzyc pradow
0E3C ECAB F002 03053          call    sprawdz_czy_mozna_wysylac
0E40 0E69      03054          movlw    _i
               03055         
0E42 6EAD      03056          movwf   TXREG    
0E44 ECAB F002 03057          call    sprawdz_czy_mozna_wysylac
               03058          
               03059          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 74


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03060          
0E48 51C6      03061          movf     pomiar_prad1H,w
0E4A 0F30      03062          addlw    0x30
0E4C 6EAD      03063          movwf   TXREG        
               03064          
0E4E ECAB F002 03065          call    sprawdz_czy_mozna_wysylac
               03066          
0E52 39C7      03067          swapf     pomiar_prad1L,w
0E54 0B0F      03068          andlw    0x0f
0E56 ECFC F002 03069          call     zamien_na_hex
0E5A 6EAD      03070          movwf   TXREG
               03071                   
0E5C ECAB F002 03072          call    sprawdz_czy_mozna_wysylac
               03073          
0E60 51C7      03074          movf    pomiar_prad1L,w
0E62 0B0F      03075          andlw    0x0f
0E64 ECFC F002 03076          call     zamien_na_hex
0E68 6EAD      03077          movwf   TXREG   
               03078          
0E6A ECAB F002 03079          call    sprawdz_czy_mozna_wysylac
               03080          
               03081          ;czy mialem mierzyc dwa prady czy tylko 1
               03082          ;movf     jak_duzo_kanalow_pradu,w
               03083          ;xorlw    2
               03084          ;btfss    STATUS,Z   
               03085          ;goto     juz_wysylac_znak_LF 
               03086 
               03087          
               03088          
0E6E 0E2C      03089          movlw    _przecinek
               03090         
0E70 6EAD      03091          movwf   TXREG    
0E72 ECAB F002 03092          call    sprawdz_czy_mozna_wysylac
               03093          
0E76 0E69      03094          movlw    _i
               03095         
0E78 6EAD      03096          movwf   TXREG    
0E7A ECAB F002 03097          call    sprawdz_czy_mozna_wysylac
               03098          
0E7E 51C8      03099          movf     pomiar_prad2H,w
0E80 0F30      03100          addlw    0x30
0E82 6EAD      03101          movwf   TXREG        
               03102          
0E84 ECAB F002 03103          call    sprawdz_czy_mozna_wysylac
               03104          
0E88 39C9      03105          swapf     pomiar_prad2L,w
0E8A 0B0F      03106          andlw    0x0f
0E8C ECFC F002 03107          call     zamien_na_hex
0E90 6EAD      03108          movwf   TXREG
               03109                   
0E92 ECAB F002 03110          call    sprawdz_czy_mozna_wysylac
               03111          
0E96 51C9      03112          movf    pomiar_prad2L,w
0E98 0B0F      03113          andlw    0x0f
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 75


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0E9A ECFC F002 03114          call     zamien_na_hex
0E9E 6EAD      03115          movwf   TXREG     
0EA0 ECAB F002 03116          call    sprawdz_czy_mozna_wysylac
               03117          
0EA4 0E2C      03118           movlw    _przecinek
               03119         
0EA6 6EAD      03120          movwf   TXREG    
0EA8 ECAB F002 03121          call    sprawdz_czy_mozna_wysylac
               03122          
               03123 ;jezeli moc zalaczona wyslij 1,
               03124 ;jezeli wylaczona wyslik 0,
               03125          
               03126          ;call    sprawdz_czy_mozna_wysylac
               03127          
               03128          ;btfsc    portlampka2,lampka2
               03129          ;movlw    0x31
               03130          
               03131          ;btfss    portlampka2,lampka2
               03132          ;movlw    0x30
               03133          
0EAC 03134 juz_wysylac_znak_LF         
               03135          ;movwf   TXREG
               03136          ;wysylam znak konca linii
0EAC ECAB F002 03137          call    sprawdz_czy_mozna_wysylac
0EB0 0E0A      03138          movlw    znak_lf
0EB2 6EAD      03139          movwf   TXREG
               03140          
0EB4 88AB      03141          bsf      RCSTA,CREN 
0EB6 0000      03142          nop
0EB8 0000      03143          nop
               03144          
0EBA 8882      03145          bsf      port_CTS,znacznik_CTS
               03146          
               03147          
0EBC 03148 koniec_pomiarow
               03149 
0EBC 6BAA      03150          clrf     pomiarH
0EBE 6BAB      03151          clrf     pomiarL
0EC0 6BAC      03152          clrf     pomiar_ulamek
               03153 
0EC2 859F      03154          bsf      markers,pomiary_zrobione
0EC4 99A0      03155          bcf      markers2,wyslij_pomiar
0EC6 93A1      03156          bcf   markers3,znacznik_pomiaru_pradu
0EC8 6B89      03157          clrf     linia4
0ECA 0012      03158          return         
               03159  
               03160 
0ECC 03161 zmierz_prad
0ECC 51AF      03162       movf     jak_duzo_probek,w
0ECE 6FB0      03163       movwf    ktora_probka
0ED0 83A1      03164       bsf   markers3,znacznik_pomiaru_pradu
0ED2 EF7D F007 03165       goto     zmierz_nastepny_nie_3
               03166       
0ED6 03167 zmierz_nastepny_czujnik_temperatury
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 76


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03168 ;tzn kanal analogowy ten sam, ale zmienia sie ustawienie multipleksera
0ED6 2BB1      03169       incf     ktory_kanal,f
0ED8 51AF      03170       movf     jak_duzo_probek,w
0EDA 6FB0      03171       movwf    ktora_probka
               03172       ;movf     port_multiplekser,w
               03173 ;czyszcze aktualne ustawienia 
               03174 ;jezeli byl tu b'01010001'     
               03175       ;andlw    b'11111000'
               03176 ;w wyniku mamy b'01010000'      
               03177       ;addwf    ktory_kanal,w
0EDC 2A8B      03178       incf  latch_multiplekser,f
               03179       ;movwf    latch_multiplekser   
0EDE EF7D F007 03180       goto     zmierz_nastepny_nie_3
               03181       
0EE2 03182 zmierz_nastepny_kanal
               03183 ;zwiekaszam na kolejne wejscie  multipleksera
               03184             
0EE2 2BB1      03185          incf     ktory_kanal,f
0EE4 51AF      03186          movf     jak_duzo_probek,w
0EE6 6FB0      03187          movwf    ktora_probka
0EE8 50C2      03188          movf     ADCON0,w
               03189 ;musze zwiekszyc o jeden ten wycinek bitowy
               03190 ;b'xx000xxx' - czyli nawet nie starszy 4 bit
               03191 ;tylko cos w srodku
               03192 ;aby to zrobic stosuje prosty wybieg + 8 do ADCON0
               03193 
               03194 ;dla 18f4x20 mamy troszke zmian
               03195 ;ADCON0  wyglada ;b'xx0000xx'
               03196 IF (procek == 18f442)
               03197          addlw    8
               03198          movwf    ADCON0
               03199          movlw    b'00111000'
               03200          andwf    ADCON0,w
               03201          xorlw    b'00011000'
               03202          bnz      zmierz_nastepny_nie_3
               03203 ;drugi raz zwiekszam ADCON0 dla pominiecia 3 kanalu         
               03204          movlw    8
               03205          addwf    ADCON0,f
               03206 ENDIF
               03207 
               03208 IF (procek == 18f4320)
0EEA 0F04      03209          addlw    4
0EEC 6EC2      03210          movwf    ADCON0
0EEE 0E3C      03211          movlw    b'00111100'
0EF0 14C2      03212          andwf    ADCON0,w
0EF2 0A0C      03213          xorlw    b'00001100'
0EF4 E102      03214          bnz      zmierz_nastepny_nie_3
               03215 ;drugi raz zwiekszam ADCON0 dla pominiecia 3 kanalu         
0EF6 0E04      03216          movlw    4
0EF8 26C2      03217          addwf    ADCON0,f
               03218 ENDIF
               03219          
0EFA 03220 zmierz_nastepny_nie_3
               03221 ;wlaczam pomiar i przerwanie
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 77


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03222          
0EFA 8C9D      03223          bsf      PIE1,ADIE
               03224          
               03225 ;rozpocznij pomiar      
               03226 ;wedlug opisu procka tu trzeba czekac okolo 20-30us  
               03227 ;dla pewnosci bede czekal 120us wykozystujac TMR2
               03228 ;czyszcze obecny TMR2
0EFC 6BAA      03229          clrf     pomiarH
0EFE 6BAB      03230          clrf     pomiarL
0F00 6BAC      03231          clrf     pomiar_ulamek
0F02 6AD6      03232          clrf     TMR0L
               03233 IF (procek == 18f442)
               03234          bcf      INTCON,T0IF
               03235          bsf      INTCON,T0IE
               03236 ENDIF
               03237 IF (procek == 18f4320)
0F04 94F2      03238          bcf      INTCON,TMR0IF
0F06 8AF2      03239          bsf      INTCON,TMR0IE
               03240 ENDIF
               03241          
               03242          ;clrf     TMR2
               03243          ;bsf    T2CON,TMR2ON
               03244         
               03245 ;tzn wlaczam przerwanie TMR2
               03246          ;bsf      STATUS,RP0
               03247          ;bsf     PIE1,TMR2IE
               03248          ;bcf      STATUS,RP0
               03249 ;przetestowanie czy dobry czas  
               03250 ;          bsf     PORTC,2         
0F08 99A0      03251          bcf      markers2,wyslij_pomiar
0F0A 0012      03252          return   
               03253     
               03254     
               03255     
               03256     
               03257     
               03258     
               03259     
               03260     
               03261 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;      ;;;;;;;;;;;;;;;;;;;;;;;;;;;;procedury klawiszy
0F0C 03262 wlacz_przerwanie_tmr3
               03263 
0F0C 92A0      03264       bcf   PIE2,TMR3IE
0F0E 6AB3      03265       clrf  TMR3H
0F10 6AB2      03266       clrf  TMR3L
0F12 92A1      03267       bcf   PIR2,TMR3IF
               03268       
0F14 82A0      03269       bsf   PIE2,TMR3IE
               03270 
0F16 0012      03271       return
               03272       
0F18 03273 wcisnieto_back
0F18 B9A1      03274       btfsc   markers3,wcisnieto_klawisz
0F1A 0012      03275       return
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 78


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03276       
0F1C 89A1      03277       bsf   markers3,wcisnieto_klawisz
0F1E 6B99      03278       clrf  stan_key
0F20 8199      03279       bsf   stan_key,mamy_back
               03280       
0F22 EF86 F007 03281       goto  wlacz_przerwanie_tmr3
               03282       
               03283       
               03284 
               03285       
               03286       
0F26 03287 wcisnieto_down
               03288 ;jeżeli zaznaczono że upłynął czas oczekiwania to wybierz procedurę zmiany      
0F26 B59E      03289       btfsc   znaczniki,czy_moge_juz_zmieniac
0F28 EFD8 F007 03290       goto  wykryto_down
               03291       
               03292       ;goto    wykryto_down_zmiana_opcji
               03293       
0F2C B9A1      03294       btfsc   markers3,wcisnieto_klawisz
0F2E 0012      03295       return
               03296       
0F30 89A1      03297       bsf   markers3,wcisnieto_klawisz
0F32 6B99      03298       clrf  stan_key
0F34 8399      03299       bsf   stan_key,mamy_down
               03300       
               03301       ;btfsc       pozycja_menu,zmiana_opcji
               03302       ;goto        sprawdz_czy_wlaczyc_szybka_zmiane
               03303       
0F36 EFB9 F007 03304       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03305       
0F3A EF86 F007 03306       goto  wlacz_przerwanie_tmr3
               03307 
               03308       
0F3E 03309 wcisnieto_up
0F3E B59E      03310       btfsc   znaczniki,czy_moge_juz_zmieniac
0F40 EF57 F009 03311       goto        wykryto_up
               03312       ;goto    wykryto_up_zmiana_opcji
               03313       
0F44 B9A1      03314       btfsc   markers3,wcisnieto_klawisz
0F46 0012      03315       return
               03316       
0F48 89A1      03317       bsf   markers3,wcisnieto_klawisz
0F4A 6B99      03318       clrf  stan_key
0F4C 8599      03319       bsf   stan_key,mamy_up
               03320       
               03321 ;jeżeli klawisz up wcisnieto w momencie gdy uzytkownik wybral juz zmiane wartosci
               03322       ;btfsc       pozycja_menu,zmiana_opcji
               03323       ;goto        sprawdz_czy_wlaczyc_szybka_zmiane
               03324       
0F4E EFB9 F007 03325       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03326       
0F52 EF86 F007 03327       goto        wlacz_przerwanie_tmr3
               03328       
0F56 03329 sprawdz_czy_wlaczyc_szybka_zmiane
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 79


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03330 ;jest w menu na pozycji     
               03331 ;opcja_odstep
               03332 ;opcja_ustaw_temp
               03333 
0F56 0E02      03334       movlw       opcja_odstep
0F58 63E1      03335       cpfseq      numer_opcji
0F5A EFB1 F007 03336       goto        sprawdz_czy_wlaczyc_szybka_zmiane2
               03337 
0F5E EFB9 F007 03338       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03339       
0F62 03340 sprawdz_czy_wlaczyc_szybka_zmiane2      
0F62 0E05      03341       movlw       opcja_ustaw_temp
0F64 63E1      03342       cpfseq      numer_opcji
0F66 EFB7 F007 03343       goto        sprawdz_czy_wlaczyc_szybka_zmiane3
               03344 
0F6A EFB9 F007 03345       goto        ustaw_sprawdzanie_szybkiej_zmiany
               03346       
0F6E 03347 sprawdz_czy_wlaczyc_szybka_zmiane3
               03348       
0F6E EF86 F007 03349       goto  wlacz_przerwanie_tmr3
               03350  
0F72 03351 ustaw_sprawdzanie_szybkiej_zmiany
               03352 ;jak długo trzymam przycisk zanim zaczne zmieniac wartości
0F72 0E04      03353       movlw       dlugosc_oczekiwania_na_zmiane
0F74 6FE3      03354       movwf       szybka_zmiana_wartosci
               03355 ;zaznaczam że procedury sprawdzają zmianę opcji w czasie trzymania przycisku      
0F76 8F9F      03356       bsf         markers,trzymanie_klawisza
0F78 EF86 F007 03357       goto  wlacz_przerwanie_tmr3
               03358  
0F7C 03359 wcisnieto_enter
0F7C B9A1      03360       btfsc   markers3,wcisnieto_klawisz
0F7E 0012      03361       return
               03362       
0F80 89A1      03363       bsf   markers3,wcisnieto_klawisz
0F82 6B99      03364       clrf  stan_key
0F84 8799      03365       bsf   stan_key,mamy_enter
               03366       
0F86 EF86 F007 03367       goto  wlacz_przerwanie_tmr3
               03368 
               03369 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                BACK
0F8A 03370 wykryto_back
               03371       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz cofnij
               03372       
               03373       ;jezeli jestem w menu to wyswietl ponownie czas i temperatury
               03374       ;movf        pozycja_menu,w
               03375       ;bz         wykryto_back_nic_nie_rob
               03376       
               03377 ;jezeli pozycja menu jest różna od 0 to po nacisnieciu klawisza back
               03378 ;następuje powrót do ekranu z pomiarami temperatury oraz z zegarem systemowym
               03379 ;oraz z prądami
               03380       ;czyszczę wszystkie linie ekranu - polecenie clear display
0F8A EC32 F001 03381       call        check_busy
0F8E 0E01      03382       movlw       display_clear
0F90 ECF4 F000 03383       call        send
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 80


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0F94 EC32 F001 03384       call        check_busy
               03385       
               03386       ;następnie włączam wyświetlanie czasu i temperatur
               03387 ;jeżeli znaczniki są ustawione to przy wyjściu
               03388       
0F98 B19E      03389       btfsc       znaczniki,czy_ponownie_wlaczyc_temp
0F9A 8B9F      03390       bsf         markers,czy_wyswietlam_temp
               03391       
0F9C B39E      03392       btfsc       znaczniki,czy_ponownie_wlaczyc_zegar
0F9E 85A1      03393       bsf         markers3,czy_zegar_wyswietlac
               03394       
0FA0 6BE0      03395       clrf       pozycja_menu
0FA2 6BE1      03396       clrf        numer_opcji
               03397       
0FA4 EFD4 F007 03398       goto  wykryto_back_exit
               03399       
               03400 
               03401      
               03402       ;jezeli w ekranie zegara to nic nie rob
               03403       
               03404       ;dla testow wyswietl na dole ekranu litere b
               03405       
               03406       
               03407 ; wykryto_back_pisz
               03408       ; call     write_lcd
0FA8 03409 wykryto_back_nic_nie_rob
0FA8 03410 wykryto_back_exit
0FA8 9BA1      03411       bcf   markers3,dzialanie_po_klawiszu
0FAA 6B99      03412       clrf  stan_key
0FAC EFF1 F00D 03413       goto  LOOP11
               03414       
               03415  
               03416 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                DOWN
0FB0 03417 wykryto_down
               03418       
               03419       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz cofnij
               03420       
0FB0 BFE0      03421       btfsc       pozycja_menu,zmiana_opcji
0FB2 EF4F F008 03422       goto        wykryto_down_zmiana_opcji
               03423       
               03424       ;jezeli jestem w menu to przeskocz na kolejną opcję gwiazdką
               03425       
               03426       
               03427       ;jezeli w ekranie zegara to pokaż kolejny zestaw czujników
0FB6 51E0      03428       movf        pozycja_menu,w
0FB8 E10A      03429       bnz         wykryto_down_sprawdz_czy_wyswietlam_kolejne_opcje
               03430 ;jezeli pozycja menu ==0 to po nacisnieciu klawisza zmien wskazania temperatury
               03431       ;najpierw czyść ekran
0FBA EC32 F001 03432       call        check_busy
0FBE 0E01      03433       movlw       display_clear
0FC0 ECF4 F000 03434       call        send
0FC4 EC32 F001 03435       call        check_busy
0FC8 7FA1      03436       btg         markers3,pokazuje_temperatury_47
               03437       ;dla testow wyswietl na dole ekranu litere b
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 81


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03438       
0FCA EF4E F009 03439        goto        wykryto_down_exit
               03440       
0FCE 03441 wykryto_down_sprawdz_czy_wyswietlam_kolejne_opcje
               03442       
               03443       ; polozenie gwiazdki przechowuje liczbe wskazującą aktualny adres polozenia
               03444       ;gwiazdki w 
               03445       ;tablicy_gwiazdki
               03446       ;
               03447       
0FCE 0E1B      03448       movlw       HIGH tablica_gwiazdki
0FD0 6EF7      03449       movwf       TBLPTRH
               03450       
0FD2 0EA6      03451       movlw       LOW tablica_gwiazdki
0FD4 6EF6      03452       movwf       TBLPTRL
               03453       
               03454       ;poniewaz najpierw zmniejszam polozenie
0FD6 2BE2      03455       incf        polozenie_gwiazdki,f
0FD8 51E2      03456       movf       polozenie_gwiazdki,w
               03457       
0FDA 26F6      03458       addwf       TBLPTRL,f
               03459       
               03460        ;a nastepnie czytam z adresu tablica_gwiazdki + polozenie_gwiazdki to uzywam polecenia
0FDC 0008      03461       TBLRD *
               03462       
0FDE 0E01      03463       movlw       1
0FE0 62F5      03464       cpfseq      TABLAT
               03465 ;jezeli odczytano 1 tzn ze gwiazdka jest polozona na 
               03466 ; dole ekranu
               03467 ; i nalezy zmienic pozycje_menu oraz wyswietlic opcje menu z kolejnego ekranu
               03468 
0FE2 EF35 F008 03469       goto         wykryto_down_zmiana_polozenia_gwiazdki
               03470       ;polozenie_gwiazdki == 1
               03471       ;tzn opcje kolejnego ekranu sa wyswietlane
0FE6 0E01      03472       movlw       1
0FE8 6FE2      03473       movwf       polozenie_gwiazdki;znow na pierwszej linii
               03474       
               03475       ;numer opcji ulega zmianie na kolejny
0FEA 2BE1      03476       incf        numer_opcji,f
               03477       ;czyszczenie ekranu
0FEC EC32 F001 03478       call        check_busy
0FF0 0E01      03479       movlw       display_clear
0FF2 ECF4 F000 03480       call        send
0FF6 EC32 F001 03481       call        check_busy
               03482       
               03483       ;zaznaczam ze wyświetlam kolejny ekran opcji
               03484       
               03485       
               03486       ;clrf        numer_opcji
               03487       
               03488       
               03489       ;call        check_busy
0FFA 0E80      03490       movlw       linia_gorna
               03491       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 82


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0FFC ECF4 F000 03492       call        send
1000 EC32 F001 03493       call        check_busy
               03494       
1004 0E2A      03495       movlw       _star
1006 EC05 F001 03496       call        write_lcd
100A EC32 F001 03497       call        check_busy      
               03498       
100E 90D8      03499       bcf         STATUS,C
1010 37E0      03500       rlcf       pozycja_menu,f
               03501       
               03502       ;btfsc       pozycja_menu,menu_opcje1
               03503       ;goto        wykryto_down_wyswietl_opcje_tablicy_jeden
               03504       
1012 B3E0      03505       btfsc       pozycja_menu,menu_opcje2
1014 EF1D F008 03506       goto        wykryto_down_wyswietl_opcje_tablicy_druga
               03507       
1018 B5E0      03508       btfsc       pozycja_menu,menu_opcje3
101A EF25 F008 03509       goto        wykryto_down_wyswietl_opcje_tablicy_trzy
               03510       
101E B7E0      03511       btfsc       pozycja_menu,menu_opcje4
1020 EF2D F008 03512       goto        wykryto_down_wyswietl_opcje_tablicy_cztery
               03513       
               03514       ;btfsc       pozycja_menu,menu_opcje_end ;(tj zaznaczono bit ekranu którego nie ma w tym wypadku są   ekrany bit 0 i 1,  2  a bit 3 oznacza ekran którego nie ma     )
               03515       ;goto        wykryto_down_wyswietl_opcje_tablicy_end
               03516       ;pisanie 
               03517       
               03518       
               03519       ;gdy wyświetlam opcje ekranu 1 - tzn gwiazdka byla na koncu opcji linii czwartej ekranu 2
1024 0E01      03520       movlw       1
1026 6FE1      03521       movwf       numer_opcji
1028 6FE0      03522       movwf       pozycja_menu
               03523       
102A 0E1B      03524       movlw       HIGH tablica_pierwsza
102C 6EF7      03525       movwf       TBLPTRH
               03526       
102E 0E00      03527       movlw       LOW tablica_pierwsza
1030 6EF6      03528       movwf       TBLPTRL
               03529       
1032 ECF8 F00A 03530       call        wyswietl_opcje_menu
               03531       
1036 EF4E F009 03532       goto        wykryto_down_exit
               03533       
               03534       
               03535       
103A 03536 wykryto_down_wyswietl_opcje_tablicy_druga
               03537       ;gdy wyświetlam opcje ekranu 2
103A 0E1B      03538       movlw       HIGH tablica_druga
103C 6EF7      03539       movwf       TBLPTRH
               03540       
103E 0E22      03541       movlw       LOW tablica_druga
1040 6EF6      03542       movwf       TBLPTRL
               03543       
               03544       
1042 ECF8 F00A 03545       call        wyswietl_opcje_menu
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 83


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03546       
1046 EF4E F009 03547       goto        wykryto_down_exit
               03548       
               03549 
               03550 
104A 03551 wykryto_down_wyswietl_opcje_tablicy_trzy
               03552       ;gdy wyświetlam opcje ekranu 3
104A 0E1B      03553       movlw       HIGH tablica_trzecia
104C 6EF7      03554       movwf       TBLPTRH
               03555       
104E 0E42      03556       movlw       LOW tablica_trzecia
1050 6EF6      03557       movwf       TBLPTRL
               03558       
               03559       
1052 ECF8 F00A 03560       call        wyswietl_opcje_menu
               03561       
1056 EF4E F009 03562       goto        wykryto_down_exit
               03563       
               03564       
               03565 ;wykryto_down_wyswietl_opcje_tablicy_end      
105A 03566 wykryto_down_wyswietl_opcje_tablicy_cztery      
105A 0E1B      03567       movlw       HIGH tablica_czwarta
105C 6EF7      03568       movwf       TBLPTRH
               03569       
105E 0E6E      03570       movlw       LOW tablica_czwarta
1060 6EF6      03571       movwf       TBLPTRL
               03572       
1062 ECF8 F00A 03573       call        wyswietl_opcje_menu
               03574       
1066 EF4E F009 03575       goto        wykryto_down_exit
               03576       
106A 03577 wykryto_down_zmiana_polozenia_gwiazdki
               03578       ;opcje zmnieniaja się o tą położoną wyżej
106A 2BE1      03579       incf        numer_opcji,f
               03580       
               03581       ;nowa gwiazdka jest rysowana w miejscu odczytanym z tablicy
106C EC32 F001 03582       call     check_busy
1070 50F5      03583       movf        TABLAT,w
1072 ECF4 F000 03584       call        send
               03585       
1076 EC32 F001 03586       call     check_busy
               03587       
107A 0E2A      03588       movlw       _star
107C EC05 F001 03589       call        write_lcd
1080 EC32 F001 03590       call     check_busy
               03591       ;gwiazdka poprzednia jest kasowana - tzn znow czytam z tablicy ale tym razem polozenie poprzednie
               03592       
               03593       
1084 06F6      03594       decf        TBLPTRL,f
1086 0008      03595       TBLRD *
1088 50F5      03596       movf        TABLAT,w
108A ECF4 F000 03597       call        send
108E EC32 F001 03598       call     check_busy
1092 0E20      03599       movlw       _puste
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 84


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1094 EC05 F001 03600       call        write_lcd
               03601       
1098 2AF6      03602       incf        TBLPTRL,f
               03603       
109A EF4E F009 03604       goto        wykryto_down_exit
               03605 
               03606       
109E 03607 wykryto_down_zmiana_opcji
109E 0E01      03608       movlw       opcja_czujniki
10A0 63E1      03609       cpfseq      numer_opcji
10A2 EF68 F008 03610       goto          wykryto_down_sprawdz_2
               03611       
               03612       ;jeżeli zmieniam ilość obsługiwanych czujników temp
               03613       ;to tu powinno być zmiana o 1 ilości kanałów 
               03614       ;i sprawdzenie czy nie przekroczyłem dopuszczalnych 8
               03615       
10A6 07A5      03616       decf        ile_kanalow,f
               03617       
10A8 0EFF      03618       movlw      0xff
               03619       
10AA 63A5      03620       cpfseq      ile_kanalow
10AC EF5A F008 03621       goto         wykryto_down_zmiana_opcji_wyswietl_kanaly
               03622       
10B0 0E08      03623       movlw       8
10B2 6FA5      03624       movwf       ile_kanalow
               03625       
10B4 03626 wykryto_down_zmiana_opcji_wyswietl_kanaly
10B4 EC32 F001 03627       call     check_busy
10B8 0E80      03628       movlw    linia_gorna
10BA 0F0C      03629       addlw       0xc
10BC ECF4 F000 03630       call      send
               03631       ;
10C0 EC32 F001 03632       call     check_busy
10C4 51A5      03633       movf        ile_kanalow,w
10C6 0F30      03634       addlw       0x30
10C8 EC05 F001 03635       call        write_lcd
               03636       
10CC EF4E F009 03637       goto        wykryto_down_exit
               03638       
10D0 03639 wykryto_down_sprawdz_2
10D0 0E02      03640       movlw       opcja_odstep
10D2 63E1      03641       cpfseq      numer_opcji
10D4 EF78 F008 03642       goto        wykryto_down_sprawdz_3
               03643 
10D8 07A7      03644       decf        odstep_pomiarowy,f
10DA 51A7      03645       movf        odstep_pomiarowy,w
10DC 6F92      03646       movwf       tmp_hex
10DE 6B93      03647       clrf        tmp_hex_H
10E0 6B98      03648       clrf        dec1
10E2 6B97      03649       clrf        dec10
10E4 ECEE F001 03650       call        hex2dec18
               03651 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03652       ;wyświetlam obok nazwy opcji czyli 
10E8 EC90 F00C 03653       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 85


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03654   
10EC EF4E F009 03655       goto        wykryto_down_exit
               03656       
10F0 03657 wykryto_down_sprawdz_3  
10F0 0E03      03658       movlw       opcja_srednia
10F2 63E1      03659       cpfseq      numer_opcji
10F4 EF99 F008 03660       goto        wykryto_down_sprawdz_4
               03661       
               03662       ;bsf      markers,czy_usrednianie
               03663       
               03664       ;sprawdz czy liczba próbek == 1
10F8 0E01      03665       movlw       0x1
10FA 63AF      03666       cpfseq      jak_duzo_probek
10FC EF84 F008 03667       goto        wykryto_down_sprawdz_3_zmniejsz_probki
               03668       ;zmieniam liczbe próbek na 0x80
1100 0E80      03669       movlw       0x80
1102 6FAF      03670       movwf       jak_duzo_probek
1104 EF8A F008 03671       goto        wykryto_down_3_wyswietl
               03672       
1108 03673 wykryto_down_sprawdz_3_zmniejsz_probki
               03674 ;dziele przez 2
1108 0E80      03675       movlw       0x80 
110A 03AF      03676       mulwf       jak_duzo_probek
110C 50F4      03677       movf        PRODH,w
110E 6FAF      03678       movwf       jak_duzo_probek
               03679       
1110 EC90 F003 03680       call     ustaw_wartosc_dzielenia_usredniania
               03681       
1114 03682 wykryto_down_3_wyswietl
               03683 ;sprawdz czy liczba próbek ==1
1114 919F      03684       bcf      markers,czy_usrednianie
               03685       
1116 0E01      03686       movlw       1
1118 63AF      03687       cpfseq      jak_duzo_probek
111A 819F      03688       bsf      markers,czy_usrednianie      
               03689       
111C 51AF      03690       movf        jak_duzo_probek,w
111E 6F92      03691       movwf       tmp_hex
1120 6B93      03692       clrf        tmp_hex_H
1122 6B98      03693       clrf        dec1
1124 6B97      03694       clrf        dec10
1126 ECEE F001 03695       call        hex2dec18
               03696 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03697       ;wyświetlam obok nazwy opcji czyli 
112A EC90 F00C 03698       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03699 
112E EF4E F009 03700       goto        wykryto_down_exit
               03701 
               03702 
1132 03703 wykryto_down_sprawdz_4
               03704       
               03705       
1132 03706 wykryto_down_sprawdz_5
1132 0E05      03707       movlw       opcja_ustaw_temp
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 86


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1134 63E1      03708       cpfseq      numer_opcji
1136 EFAD F008 03709       goto        wykryto_down_sprawdz_6
               03710       
               03711       ;wlacz pomiar pradu
               03712       ;jako test wlacz podswietlenie lub je wylacz
               03713       
               03714       ;btg   portlampka2,lampka2
               03715       
113A 07AE      03716       decf        jaka_wartosc_regulujeL,f
               03717       
113C B0D8      03718       btfsc       STATUS,C
113E EFA9 F008 03719       goto        wykryto_down_sprawdz_5_zero
               03720       ;jeżeli w H jest 0 to  umieść tam 1
1142 51AD      03721       movf       jaka_wartosc_regulujeH,w
1144 E004      03722       bz          wykryto_down_sprawdz_5_zawracanie
               03723       
1146 07AD      03724       decf        jaka_wartosc_regulujeH,f
               03725       
1148 A4D8      03726       btfss       STATUS,Z
114A EFA9 F008 03727       goto        wykryto_down_sprawdz_5_zero
114E 03728 wykryto_down_sprawdz_5_zawracanie
114E 0E01      03729       movlw       1
1150 6FAD      03730       movwf       jaka_wartosc_regulujeH
               03731       
1152 03732 wykryto_down_sprawdz_5_zero      
               03733                                                 ; movf        jaka_wartosc_regulujeL,w
               03734                                                 ; movwf       tmp_hex
               03735                                                 ; movf        jaka_wartosc_regulujeH,w
               03736                                                 ; movwf        tmp_hex_H
               03737                                                 ; clrf        dec1
               03738                                                 ; clrf        dec10
               03739                                                 ; call        hex2dec18
               03740 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03741       ;wyświetlam obok nazwy opcji czyli 
               03742                                                 ;call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03743       
               03744       
1152 ECA0 F00B 03745       call  wyswietl_temp_w_opcjach
               03746       
1156 EF4E F009 03747       goto        wykryto_down_exit
               03748       
115A 03749 wykryto_down_sprawdz_6
               03750       
115A 03751 wykryto_down_sprawdz_9
               03752 ;histereza górna
               03753 
115A 0E09      03754       movlw       opcja_histereza1
115C 63E1      03755       cpfseq      numer_opcji
115E EFBD F008 03756       goto        wykryto_down_sprawdz_10
               03757       
               03758       ;wlacz pomiar pradu
               03759       ;jako test wlacz podswietlenie lub je wylacz
               03760       
               03761       ;btg   portlampka2,lampka2
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 87


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1162 07E6      03762       decf        histereza1,f
               03763       
1164 51E6      03764       movf        histereza1,w
1166 6F92      03765       movwf       tmp_hex
               03766       
1168 6B93      03767       clrf        tmp_hex_H
116A 6B98      03768       clrf        dec1
116C 6B97      03769       clrf        dec10
116E ECEE F001 03770       call        hex2dec18
               03771 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03772       ;wyświetlam obok nazwy opcji czyli 
1172 EC90 F00C 03773       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03774       
1176 EF4E F009 03775       goto        wykryto_down_exit     
               03776 
117A 03777 wykryto_down_sprawdz_10
               03778 ;histereza dolna
117A 0E0A      03779       movlw       opcja_histereza2
117C 63E1      03780       cpfseq      numer_opcji
117E EFCD F008 03781       goto        wykryto_down_sprawdz_11
               03782       
               03783       ;wlacz pomiar pradu
               03784       ;jako test wlacz podswietlenie lub je wylacz
               03785       
               03786       ;btg   portlampka2,lampka2
1182 07E7      03787       decf        histereza2,f
               03788       
1184 51E7      03789       movf        histereza2,w
1186 6F92      03790       movwf       tmp_hex
               03791       
1188 6B93      03792       clrf        tmp_hex_H
118A 6B98      03793       clrf        dec1
118C 6B97      03794       clrf        dec10
118E ECEE F001 03795       call        hex2dec18
               03796 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03797       ;wyświetlam obok nazwy opcji czyli 
1192 EC90 F00C 03798       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               03799       
1196 EF4E F009 03800       goto        wykryto_down_exit     
               03801 
               03802       
119A 03803 wykryto_down_sprawdz_11
119A 0E10      03804       movlw       opcja_ustaw_zegar
119C 63E1      03805       cpfseq      numer_opcji
119E EF36 F009 03806       goto        wykryto_down_sprawdz12
               03807       
               03808 ;sprawdzenie która wielkość zegara podlega zmianie
               03809 ;jeżeli dzien_10 to zmniejszam o jeden dzien_1
               03810 ;problem polega na tym, że nie mogę skorzystać z FSR2 bo  każda z wielkości
               03811 ;czasu musi być indywidualnie rozpatrywana
11A2 0ED7      03812       movlw       dzien_10
11A4 63E8      03813       cpfseq      ustawianie_czasu_co_wyswietlam
11A6 EFEA F008 03814       goto        wykryto_down_sprawdz_11_1
               03815 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 88


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               03816 ;jeżeli dzień_1 jest 0 (0x30) to jeżeli dzien_10 <> 0x30 zmniejsz dzien_10
               03817 
11AA 0E30      03818       movlw       0x30
11AC 63D8      03819       cpfseq      dzien_1
11AE EFE7 F008 03820       goto        zmniejsz_dzien_1
               03821       
               03822       ;sprawdz czy dzien_10 == 0x30
11B2 0E30      03823       movlw       0x30
11B4 63D7      03824       cpfseq      dzien_10
11B6 EFE2 F008 03825       goto        zapisz_do_dzien_1_99
               03826       
11BA 0E39      03827       movlw       0x39
11BC 6FD7      03828       movwf       dzien_10
11BE 6FD8      03829       movwf       dzien_1
               03830       
11C0 EF32 F009 03831       goto        wykryto_down_sprawdz_11_4
               03832       
11C4 03833 zapisz_do_dzien_1_99
11C4 0E39      03834       movlw       0x39
11C6 6FD8      03835       movwf       dzien_1
11C8 07D7      03836       decf        dzien_10,f
11CA EF32 F009 03837       goto        wykryto_down_sprawdz_11_4
               03838       
               03839       
11CE 03840 zmniejsz_dzien_1      
11CE 07D8      03841       decf        dzien_1,f
               03842       
               03843       
11D0 EF32 F009 03844       goto        wykryto_down_sprawdz_11_4
               03845       
11D4 03846 wykryto_down_sprawdz_11_1
11D4 0ED9      03847       movlw       godziny_10
11D6 63E8      03848       cpfseq      ustawianie_czasu_co_wyswietlam
11D8 EF04 F009 03849       goto        wykryto_down_sprawdz_11_2
               03850       
11DC 0E30      03851       movlw       0x30
11DE 63DA      03852       cpfseq      godziny_1
11E0 EF01 F009 03853       goto        zmniejsz_godziny_1
               03854       
               03855       ;sprawdz czy dzien_10 == 0x30
11E4 0E30      03856       movlw       0x30
11E6 63D9      03857       cpfseq      godziny_10
11E8 EFFC F008 03858       goto        zapisz_do_godziny_1_9
               03859       
11EC 0E32      03860       movlw       0x32
11EE 6FD9      03861       movwf       godziny_10
11F0 0E33      03862       movlw       0x33
11F2 6FDA      03863       movwf       godziny_1
               03864       
11F4 EF32 F009 03865       goto        wykryto_down_sprawdz_11_4
               03866       
11F8 03867 zapisz_do_godziny_1_9
11F8 0E39      03868       movlw       0x39
11FA 6FDA      03869       movwf       godziny_1
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 89


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
11FC 07D9      03870       decf        godziny_10,f
11FE EF32 F009 03871       goto        wykryto_down_sprawdz_11_4
               03872       
               03873       
1202 03874 zmniejsz_godziny_1      
1202 07DA      03875       decf        godziny_1,f
               03876       
               03877       
1204 EF32 F009 03878       goto        wykryto_down_sprawdz_11_4
               03879       
               03880       
1208 03881 wykryto_down_sprawdz_11_2
1208 0EDB      03882       movlw       minuty_10
120A 63E8      03883       cpfseq      ustawianie_czasu_co_wyswietlam
120C EF1E F009 03884       goto        wykryto_down_sprawdz_11_3
               03885       
1210 0E30      03886       movlw       0x30
1212 63DC      03887       cpfseq      minuty_1
1214 EF1B F009 03888       goto        zmniejsz_minuty_1
               03889       
               03890       ;sprawdz czy dzien_10 == 0x30
1218 0E30      03891       movlw       0x30
121A 63DB      03892       cpfseq      minuty_10
121C EF16 F009 03893       goto        zapisz_do_minuty_1_9
               03894       
1220 0E35      03895       movlw       0x35
1222 6FDB      03896       movwf       minuty_10
1224 0E39      03897       movlw       0x39
1226 6FDC      03898       movwf       minuty_1
               03899       
1228 EF32 F009 03900       goto        wykryto_down_sprawdz_11_4
               03901       
122C 03902 zapisz_do_minuty_1_9
122C 0E39      03903       movlw       0x39
122E 6FDC      03904       movwf       minuty_1
1230 07DB      03905       decf        minuty_10,f
1232 EF32 F009 03906       goto        wykryto_down_sprawdz_11_4
               03907       
               03908       
1236 03909 zmniejsz_minuty_1      
1236 07DC      03910       decf        minuty_1,f
               03911       
1238 EF32 F009 03912       goto        wykryto_down_sprawdz_11_4
               03913       
123C 03914 wykryto_down_sprawdz_11_3     
123C 0E30      03915       movlw       0x30
123E 63DE      03916       cpfseq      sekundy_1
1240 EF31 F009 03917       goto        zmniejsz_sekundy_1
               03918       
               03919       ;sprawdz czy dzien_10 == 0x30
1244 0E30      03920       movlw       0x30
1246 63DD      03921       cpfseq      sekundy_10
1248 EF2C F009 03922       goto        zapisz_do_sekundy_1_9
               03923       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 90


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
124C 0E35      03924       movlw       0x35
124E 6FDD      03925       movwf       sekundy_10
1250 0E39      03926       movlw       0x39
1252 6FDE      03927       movwf       sekundy_1
               03928       
1254 EF32 F009 03929       goto        wykryto_down_sprawdz_11_4
               03930       
1258 03931 zapisz_do_sekundy_1_9
1258 0E39      03932       movlw       0x39
125A 6FDE      03933       movwf       sekundy_1
125C 07DD      03934       decf        sekundy_10,f
125E EF32 F009 03935       goto        wykryto_down_sprawdz_11_4
               03936       
               03937       
1262 03938 zmniejsz_sekundy_1      
1262 07DE      03939       decf        sekundy_1,f
               03940       
1264 03941 wykryto_down_sprawdz_11_4            
               03942 
1264 ECBD F00C 03943       call        procedura_wyswietlania_kolejnych_liczb_zegara
               03944       
1268 EF4E F009 03945       goto        wykryto_down_exit           
               03946 ;       call     check_busy
               03947 ;       movlw    linia_czwarta
               03948 ;       call      send
               03949 ;         
               03950 ;       call     check_busy
               03951 ; ;czy gasze czy wyswietlam      
               03952 ;       btfsc       markers,test
               03953 ;       goto        zamaz_D
               03954 ; napisz_D
               03955 ;       bsf   markers,test
               03956 ;       movlw       _d
               03957 ;       goto  wykryto_down_pisz
               03958 ; zamaz_D      
               03959 ;       bcf   markers,test
               03960 ;       movlw       _puste
               03961 ;       
               03962 ; wykryto_down_pisz
               03963 ;       call     write_lcd
126C 03964 wykryto_down_sprawdz12
               03965       
126C 03966 wykryto_down_sprawdz16      
126C 0E0B      03967       movlw       opcja_czujnik_regulacji
126E 63E1      03968       cpfseq      numer_opcji
1270 EF4E F009 03969       goto        wykryto_down_sprawdz17
               03970       
               03971       ;wlacz pomiar pradu
               03972       ;jako test wlacz podswietlenie lub je wylacz
               03973       
               03974       ;btg   portlampka2,lampka2
               03975       
1274 51E9      03976       movf        ktory_czujnik_reguluje,w
1276 A4D8      03977       btfss       STATUS,Z
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 91


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1278 EF42 F009 03978       goto               wykryto_down_sprawdz16_nie_ma_zero
               03979       
127C 0E07      03980       movlw       ilosc_czujnikow
               03981       
127E 6FE9      03982       movwf       ktory_czujnik_reguluje
               03983       
1280 EF43 F009 03984       goto        wykryto_down_sprawdz16_show
1284 03985 wykryto_down_sprawdz16_nie_ma_zero      
1284 07E9      03986       decf        ktory_czujnik_reguluje,f
               03987       
               03988 
1286 03989 wykryto_down_sprawdz16_show
1286 51E9      03990       movf        ktory_czujnik_reguluje,w
1288 6F92      03991       movwf       tmp_hex
               03992       
128A 6B93      03993       clrf        tmp_hex_H
128C 6B98      03994       clrf        dec1
128E 6B97      03995       clrf        dec10
1290 ECEE F001 03996       call        hex2dec18
               03997 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               03998       ;wyświetlam obok nazwy opcji czyli 
1294 EC90 F00C 03999       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04000       
1298 EF4E F009 04001       goto        wykryto_down_exit
               04002 
129C 04003 wykryto_down_sprawdz17      
129C 04004 wykryto_down_exit
               04005 ;jeżeli jest opuszczenie procedury w trakcie przyciskania kończ w inny sposób
               04006 
129C B59E      04007       btfsc   znaczniki,czy_moge_juz_zmieniac
129E EF55 F009 04008       goto    wykryto_down_exit_trzymanie
               04009       
12A2 9BA1      04010       bcf   markers3,dzialanie_po_klawiszu
12A4 6B99      04011       clrf  stan_key
12A6 EFF1 F00D 04012       goto  LOOP11
               04013  
12AA 04014 wykryto_down_exit_trzymanie
12AA 959E      04015       bcf     znaczniki,czy_moge_juz_zmieniac
12AC 0012      04016       return
               04017  
               04018                         ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                UP
12AE 04019 wykryto_up
               04020       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz up
               04021       
12AE BFE0      04022       btfsc       pozycja_menu,zmiana_opcji
12B0 EFF6 F009 04023       goto        wykryto_up_zmiana_opcji
               04024       
12B4 51E0      04025       movf        pozycja_menu,w
12B6 E10A      04026       bnz         wykryto_up_sprawdz_czy_wyswietlam_kolejne_opcje
               04027 ;jezeli pozycja menu ==0 to po nacisnieciu klawisza zmien wskazania temperatury
               04028 
12B8 EC32 F001 04029       call        check_busy
12BC 0E01      04030       movlw       display_clear
12BE ECF4 F000 04031       call        send
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 92


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
12C2 EC32 F001 04032       call        check_busy
12C6 7FA1      04033       btg         markers3,pokazuje_temperatury_47
               04034       ;tzn pozwala obejrzec temperatury 0-3 lub 4-7 (zawsze 4)
12C8 EFEF F00A 04035       goto        wykryto_up_exit
               04036       
               04037 
               04038       
12CC 04039 wykryto_up_sprawdz_czy_wyswietlam_kolejne_opcje
               04040       ;movlw       1
               04041       ;cpfseq      pozycja_menu
               04042       ;goto        sprawdz_czy_wyswietlam_zmiane_opcji
               04043       
               04044       ; polozenie gwiazdki przechowuje liczbe wskazującą aktualny adres polozenia
               04045       ;gwiazdki w 
               04046       ;tablicy_gwiazdki
               04047       ;
               04048       
12CC 0E1B      04049       movlw       HIGH tablica_gwiazdki
12CE 6EF7      04050       movwf       TBLPTRH
               04051       
12D0 0EA6      04052       movlw       LOW tablica_gwiazdki
12D2 6EF6      04053       movwf       TBLPTRL
               04054       
               04055       ;poniewaz najpierw zmniejszam polozenie
12D4 07E2      04056       decf        polozenie_gwiazdki,f
12D6 51E2      04057       movf       polozenie_gwiazdki,w
               04058       
12D8 26F6      04059       addwf       TBLPTRL,f
               04060       
               04061        ;a nastepnie czytam to uzywam polecenia
12DA 0008      04062       TBLRD *
12DC 50F5      04063       movf        TABLAT,w
               04064 ;jezeli odczytano 0 tzn ze bylem na gorze ekranu (pierwsze polecenie)
               04065 ; i następuje przeskok do ekranu menu 0 lub 1 
12DE E16C      04066       bnz         wykryto_up_zmiana_polozenia_gwiazdki
               04067       ;polozenie_gwiazdki == 4 bo gwiazdka jest na dole opcji ekranu poprzedniego
12E0 0E04      04068       movlw       4
12E2 6FE2      04069       movwf       polozenie_gwiazdki
               04070       
               04071       
12E4 07E1      04072       decf        numer_opcji,f
               04073       ;czyszczenie ekranu
12E6 EC32 F001 04074       call        check_busy
12EA 0E01      04075       movlw       display_clear
12EC ECF4 F000 04076       call        send
12F0 EC32 F001 04077       call        check_busy
               04078       
               04079            
               04080       
               04081       ;zaznaczam ze wyświetlam kolejny ekran opcji
               04082       
               04083       
12F4 B1E0      04084       btfsc       pozycja_menu,menu_opcje1 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu koncowego)
12F6 EFC4 F009 04085       goto        wykryto_up_wyswietl_opcje_tablicy_end
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 93


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04086       
               04087       
               04088       
               04089       
               04090       
12FA 90D8      04091       bcf         STATUS,C
12FC 33E0      04092       rrcf       pozycja_menu,f
               04093       
               04094 ;########################################## WAZNE
               04095 ;jeżeli będzie więcej ekrnów opcji menu, to tu należy dodać procedurę wykrywania adres której tablicy jest używany do wyświetlania opcji
               04096        
               04097       ;gdy wyświetlam opcje ekranu 2 - tzn gwiazdka byla na górze opcji linii pierwszej ekranu 2
               04098       
               04099       ;jeżeli po przesunięciu zaznaczony jest bit menu_opcje1 to wyswietl menu_opcje1
12FE B1E0      04100       btfsc       pozycja_menu,menu_opcje1 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu 0)
1300 EF88 F009 04101       goto        wykryto_up_wyswietl_opcje_tablicy_pierwsza
               04102       
               04103       
1304 B3E0      04104       btfsc       pozycja_menu,menu_opcje2 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu 0)
1306 EF9C F009 04105       goto        wykryto_up_wyswietl_opcje_tablicy_dwa
               04106 
130A B5E0      04107       btfsc       pozycja_menu,menu_opcje3 ;(tj zaznaczony jet bit wskazujący na pokazywanie opcji ekranu 1, czyli przeskok do ekranu 0)
130C EFB0 F009 04108       goto        wykryto_up_wyswietl_opcje_tablicy_trzy
               04109       
               04110       
1310 04111 wykryto_up_wyswietl_opcje_tablicy_pierwsza
1310 0E1B      04112       movlw       HIGH tablica_pierwsza
1312 6EF7      04113       movwf       TBLPTRH
               04114       
1314 0E00      04115       movlw       LOW tablica_pierwsza
1316 6EF6      04116       movwf       TBLPTRL
               04117       
1318 ECF8 F00A 04118       call        wyswietl_opcje_menu
               04119       
               04120       ;wyswietlam gwiazdke na linii ostatniej poprzedniego ekranu
131C EC32 F001 04121       call        check_busy
1320 0ED0      04122       movlw       linia_czwarta
               04123       
1322 ECF4 F000 04124       call        send
1326 EC32 F001 04125       call        check_busy
132A 0E2A      04126       movlw       _star
132C EC05 F001 04127       call        write_lcd
1330 EC32 F001 04128       call        check_busy
               04129       
1334 EFEF F00A 04130       goto        wykryto_up_exit
               04131       
               04132            
1338 04133 wykryto_up_wyswietl_opcje_tablicy_dwa
               04134       ;tu jest przeskok z numeru opcji 1 do ostatniej możliwej czyli 8
               04135       
               04136       ;wyświetlam opcje ekranu 2
               04137       
               04138       
1338 0E1B      04139       movlw       HIGH tablica_druga
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 94


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
133A 6EF7      04140       movwf       TBLPTRH
               04141       
133C 0E22      04142       movlw       LOW tablica_druga
133E 6EF6      04143       movwf       TBLPTRL
               04144       
1340 ECF8 F00A 04145       call        wyswietl_opcje_menu
               04146       
               04147       ;wyswietlam gwiazdke na linii ostatniej poprzedniego ekranu
1344 EC32 F001 04148       call        check_busy
1348 0ED0      04149       movlw       linia_czwarta
134A ECF4 F000 04150       call        send
               04151       
134E EC32 F001 04152       call        check_busy
1352 0E2A      04153       movlw       _star
1354 EC05 F001 04154       call        write_lcd
1358 EC32 F001 04155       call        check_busy
               04156       
135C EFEF F00A 04157       goto        wykryto_up_exit
               04158 
               04159 
1360 04160 wykryto_up_wyswietl_opcje_tablicy_trzy
               04161       
1360 0E1B      04162       movlw       HIGH tablica_trzecia
1362 6EF7      04163       movwf       TBLPTRH
               04164       
1364 0E42      04165       movlw       LOW tablica_trzecia
1366 6EF6      04166       movwf       TBLPTRL
               04167             
1368 ECF8 F00A 04168       call        wyswietl_opcje_menu
               04169       
136C EC32 F001 04170       call        check_busy
1370 0ED0      04171       movlw       linia_czwarta      
1372 ECF4 F000 04172       call        send
               04173       
1376 EC32 F001 04174       call        check_busy
137A 0E2A      04175       movlw       _star
137C EC05 F001 04176       call        write_lcd
1380 EC32 F001 04177       call        check_busy
               04178       
1384 EF4E F009 04179       goto        wykryto_down_exit
               04180       
1388 04181 wykryto_up_wyswietl_opcje_tablicy_end
1388 0E10      04182       movlw       numer_opcji_koncowej    
138A 6FE1      04183       movwf       numer_opcji
138C 6BE0      04184       clrf            pozycja_menu
138E 87E0      04185       bsf            pozycja_menu,(menu_opcje_end-1)
               04186 
1390 0E1B      04187       movlw       HIGH tablica_czwarta
1392 6EF7      04188       movwf       TBLPTRH
               04189       
1394 0E6E      04190       movlw       LOW tablica_czwarta
1396 6EF6      04191       movwf       TBLPTRL
               04192       
               04193       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 95


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1398 ECF8 F00A 04194       call        wyswietl_opcje_menu
               04195       
139C EC32 F001 04196       call        check_busy
13A0 0ED0      04197       movlw       linia_czwarta      
13A2 ECF4 F000 04198       call        send
               04199       
13A6 EC32 F001 04200       call        check_busy
13AA 0E2A      04201       movlw       _star
13AC EC05 F001 04202       call        write_lcd
13B0 EC32 F001 04203       call        check_busy
               04204       
13B4 EF4E F009 04205       goto        wykryto_down_exit
               04206       
               04207       
13B8 04208 wykryto_up_zmiana_polozenia_gwiazdki
               04209       ;opcje zmnieniaja się o tą położoną wyżej
13B8 07E1      04210       decf        numer_opcji,f
               04211       
               04212       ;nowa gwiazdka jest rysowana w miejscu odczytanym z tablicy
               04213       
13BA EC32 F001 04214       call     check_busy
13BE 50F5      04215       movf        TABLAT,w
13C0 ECF4 F000 04216       call        send
               04217       
13C4 EC32 F001 04218       call     check_busy
13C8 0E2A      04219       movlw       _star
13CA EC05 F001 04220       call        write_lcd
13CE EC32 F001 04221       call     check_busy
               04222       ;gwiazdka poprzednia jest kasowana - tzn znow czytam z tablicy ale tym razem polozenie poprzednie
               04223       
               04224       
13D2 2AF6      04225       incf        TBLPTRL,f
13D4 0008      04226       TBLRD *
13D6 50F5      04227       movf        TABLAT,w
13D8 ECF4 F000 04228       call        send
13DC EC32 F001 04229       call     check_busy
13E0 0E20      04230       movlw       _puste
13E2 EC05 F001 04231       call        write_lcd
               04232       
13E6 06F6      04233       decf        TBLPTRL,f
               04234       
13E8 EFEF F00A 04235       goto        wykryto_up_exit
               04236 
               04237 
               04238       
               04239 ;#########################################KLAWISZ UP
               04240 ;ZMIANA Opcji
13EC 04241 wykryto_up_zmiana_opcji
               04242 ;sprawdz którą opcję zmieniam
13EC 0E01      04243       movlw       opcja_czujniki
13EE 63E1      04244       cpfseq      numer_opcji
13F0 EF0E F00A 04245       goto          wykryto_up_sprawdz_2
               04246       
               04247       ;jeżeli zmieniam ilość obsługiwanych czujników temp
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 96


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04248       ;to tu powinno być zmiana o 1 ilości kanałów 
               04249       ;i sprawdzenie czy nie przekroczyłem dopuszczalnych 8
13F4 2BA5      04250       incf        ile_kanalow,f
13F6 0E09      04251       movlw      9
               04252       
13F8 63A5      04253       cpfseq      ile_kanalow
13FA EF00 F00A 04254       goto         wykryto_up_zmiana_opcji_wyswietl_kanaly
               04255       
13FE 6BA5      04256       clrf              ile_kanalow
               04257       
1400 04258 wykryto_up_zmiana_opcji_wyswietl_kanaly
1400 EC32 F001 04259       call     check_busy
1404 0E80      04260       movlw    linia_gorna
1406 0F0C      04261       addlw       0xc
1408 ECF4 F000 04262       call      send
               04263       ;
140C EC32 F001 04264       call     check_busy
1410 51A5      04265       movf        ile_kanalow,w
1412 0F30      04266       addlw       0x30
1414 EC05 F001 04267       call        write_lcd
               04268       
1418 EFEF F00A 04269       goto        wykryto_up_exit
               04270       
141C 04271 wykryto_up_sprawdz_2
141C 0E02      04272       movlw       opcja_odstep
141E 63E1      04273       cpfseq      numer_opcji
1420 EF1E F00A 04274       goto        wykryto_up_sprawdz_3
               04275 
1424 2BA7      04276       incf        odstep_pomiarowy,f
1426 51A7      04277       movf        odstep_pomiarowy,w
               04278       
1428 6F92      04279       movwf       tmp_hex
142A 6B93      04280       clrf        tmp_hex_H
142C 6B98      04281       clrf        dec1
142E 6B97      04282       clrf        dec10
1430 ECEE F001 04283       call        hex2dec18
               04284 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04285       ;wyświetlam obok nazwy opcji czyli 
1434 EC90 F00C 04286       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04287       
               04288       
1438 EFEF F00A 04289       goto        wykryto_up_exit
               04290       
143C 04291 wykryto_up_sprawdz_3
143C 0E03      04292       movlw       opcja_srednia
143E 63E1      04293       cpfseq      numer_opcji
1440 EF3D F00A 04294       goto        wykryto_up_sprawdz_4
               04295       
               04296       ;sprawdz czy liczba próbek == 128 (0x80)
1444 0E80      04297       movlw       0x80
1446 63AF      04298       cpfseq      jak_duzo_probek
1448 EF2B F00A 04299       goto        wykryto_up_sprawdz_3_zwieksz_probki
               04300       ;zmieniam liczbe próbek na 1
144C 0E01      04301       movlw       1
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 97


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
144E 6FAF      04302       movwf       jak_duzo_probek
1450 919F      04303       bcf      markers,czy_usrednianie
               04304       
1452 EF32 F00A 04305       goto        wykryto_up_3_wyswietl
               04306       
1456 04307 wykryto_up_sprawdz_3_zwieksz_probki
1456 819F      04308       bsf      markers,czy_usrednianie
1458 0E02      04309       movlw       0x02
145A 03AF      04310       mulwf       jak_duzo_probek
145C 50F3      04311       movf        PRODL,w
145E 6FAF      04312       movwf       jak_duzo_probek
               04313       
1460 EC90 F003 04314       call     ustaw_wartosc_dzielenia_usredniania      
               04315       
1464 04316 wykryto_up_3_wyswietl
1464 51AF      04317       movf        jak_duzo_probek,w
1466 6F92      04318       movwf       tmp_hex
1468 6B93      04319       clrf        tmp_hex_H
146A 6B98      04320       clrf        dec1
146C 6B97      04321       clrf        dec10
146E ECEE F001 04322       call        hex2dec18
               04323 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04324       ;wyświetlam obok nazwy opcji czyli 
1472 EC90 F00C 04325       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04326       
1476 EFEF F00A 04327       goto        wykryto_up_exit
               04328             
               04329 
147A 04330 wykryto_up_sprawdz_4
147A 04331 wykryto_up_sprawdz_5
147A 0E05      04332       movlw       opcja_ustaw_temp
147C 63E1      04333       cpfseq      numer_opcji
147E EF4D F00A 04334       goto        wykryto_up_sprawdz_6
               04335       
               04336             
1482 2BAE      04337       incf        jaka_wartosc_regulujeL,f
               04338       
1484 E306      04339       bnc         wykryto_up_sprawdz_5_dalej
               04340       ;czy  przekroczono 0x200
               04341             
1486 2BAD      04342       incf        jaka_wartosc_regulujeH,f
               04343       
1488 0E02      04344       movlw       0x02
148A 63AD      04345       cpfseq      jaka_wartosc_regulujeH
148C EF49 F00A 04346       goto        wykryto_up_sprawdz_5_dalej
               04347       
               04348       
               04349       ;jeżeli w H jest 3 to wyzeruj 
1490 6BAD      04350       clrf       jaka_wartosc_regulujeH
               04351       
               04352       
1492 04353 wykryto_up_sprawdz_5_dalej
               04354                                                 ; movf        jaka_wartosc_regulujeL,w
               04355                                                 ; movwf       tmp_hex
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 98


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04356                                                 ; movf        jaka_wartosc_regulujeH,w
               04357                                                 ; movwf        tmp_hex_H
               04358                                                 ; clrf        dec1
               04359                                                 ; clrf        dec10
               04360                                                 ; call        hex2dec18
               04361                                           ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04362                                            ;     wyświetlam obok nazwy opcji czyli 
               04363                                                 ; call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04364       
1492 ECA0 F00B 04365       call  wyswietl_temp_w_opcjach
               04366       
               04367       
1496 EF4E F009 04368       goto        wykryto_down_exit
149A 04369 wykryto_up_sprawdz_6
               04370 
               04371 
149A 04372 wykryto_up_sprawdz_9
               04373 ;górna histereza 
149A 0E09      04374       movlw       opcja_histereza1
149C 63E1      04375       cpfseq      numer_opcji
149E EF5D F00A 04376       goto        wykryto_up_sprawdz_10
               04377       
               04378       ;wlacz pomiar pradu
               04379       ;jako test wlacz podswietlenie lub je wylacz
               04380       
               04381       ;btg   portlampka2,lampka2
14A2 2BE6      04382       incf        histereza1,f
               04383       
14A4 51E6      04384       movf        histereza1,w
14A6 6F92      04385       movwf       tmp_hex
               04386       
14A8 6B93      04387       clrf        tmp_hex_H
14AA 6B98      04388       clrf        dec1
14AC 6B97      04389       clrf        dec10
14AE ECEE F001 04390       call        hex2dec18
               04391 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04392       ;wyświetlam obok nazwy opcji czyli 
14B2 EC90 F00C 04393       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04394       
14B6 EFEF F00A 04395       goto        wykryto_up_exit     
               04396       
14BA 04397 wykryto_up_sprawdz_10
               04398 ;dolna histereza 
14BA 0E0A      04399       movlw       opcja_histereza2
14BC 63E1      04400       cpfseq      numer_opcji
14BE EF6D F00A 04401       goto        wykryto_up_sprawdz_11
               04402       
               04403       ;wlacz pomiar pradu
               04404       ;jako test wlacz podswietlenie lub je wylacz
               04405       
               04406       ;btg   portlampka2,lampka2
14C2 2BE7      04407       incf        histereza2,f
               04408       
14C4 51E7      04409       movf        histereza2,w
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 99


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
14C6 6F92      04410       movwf       tmp_hex
               04411       
14C8 6B93      04412       clrf        tmp_hex_H
14CA 6B98      04413       clrf        dec1
14CC 6B97      04414       clrf        dec10
14CE ECEE F001 04415       call        hex2dec18
               04416 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04417       ;wyświetlam obok nazwy opcji czyli 
14D2 EC90 F00C 04418       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04419       
14D6 EFEF F00A 04420       goto        wykryto_up_exit     
               04421 
14DA 04422 wykryto_up_sprawdz_11
               04423 ;ustawienia zegara
14DA 0E10      04424       movlw       opcja_ustaw_zegar
14DC 63E1      04425       cpfseq      numer_opcji
14DE EFD8 F00A 04426       goto        wykryto_up_sprawdz12
               04427       
               04428 ;sprawdzenie która wielkość zegara podlega zmianie
               04429 ;jeżeli dzien_10 to zmniejszam o jeden dzien_1
               04430 ;problem polega na tym, że nie mogę skorzystać z FSR2 bo  każda z wielkości
               04431 ;czasu musi być indywidualnie rozpatrywana
14E2 0ED7      04432       movlw       dzien_10
14E4 63E8      04433       cpfseq      ustawianie_czasu_co_wyswietlam
14E6 EF8A F00A 04434       goto        wykryto_up_sprawdz_11_1
               04435 
               04436 ;jeżeli dzień_1 jest 9 (0x39) to jeżeli dzien_10 <> 0x39 zwieksz dzien_10
               04437 
14EA 0E39      04438       movlw       0x39
14EC 63D8      04439       cpfseq      dzien_1
14EE EF87 F00A 04440       goto        zwieksz_dzien_1
               04441       
               04442       ;sprawdz czy dzien_10 == 0x39
14F2 0E39      04443       movlw       0x39
14F4 63D7      04444       cpfseq      dzien_10
14F6 EF82 F00A 04445       goto        zapisz_do_dzien_1_0
               04446       
14FA 0E30      04447       movlw       0x30 
14FC 6FD8      04448       movwf       dzien_1            
14FE 6FD7      04449       movwf       dzien_10
               04450       
1500 EFD4 F00A 04451       goto        wykryto_up_sprawdz_11_4
               04452       
1504 04453 zapisz_do_dzien_1_0
1504 0E30      04454       movlw       0x30
1506 6FD8      04455       movwf       dzien_1
1508 2BD7      04456       incf        dzien_10,f
150A EFD4 F00A 04457       goto        wykryto_up_sprawdz_11_4
               04458       
               04459       
150E 04460 zwieksz_dzien_1      
150E 2BD8      04461       incf        dzien_1,f
               04462       
               04463       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 100


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1510 EFD4 F00A 04464       goto        wykryto_up_sprawdz_11_4
               04465       
1514 04466 wykryto_up_sprawdz_11_1
1514 0ED9      04467       movlw       godziny_10
1516 63E8      04468       cpfseq      ustawianie_czasu_co_wyswietlam
1518 EFA7 F00A 04469       goto        wykryto_up_sprawdz_11_2
               04470       
               04471       ;najpierw sprawdze czy godziny_1 i godziny_10 == 23 godzina bo wtedy wpisuje 00
151C 0E33      04472       movlw       0x33
151E 63DA      04473       cpfseq      godziny_1
1520 EF9B F00A 04474       goto        sprawdz_zwiekszanie_godzin_normalnie
1524 0E32      04475       movlw       0x32
1526 63D9      04476       cpfseq      godziny_10
1528 EF9B F00A 04477       goto        sprawdz_zwiekszanie_godzin_normalnie
               04478       
               04479 ;jest godzina 23 => zapisz do godzin 00      
152C 0E30      04480       movlw       0x30
152E 6FD9      04481       movwf       godziny_10      
1530 6FDA      04482       movwf       godziny_1
1532 EFD4 F00A 04483       goto        wykryto_up_sprawdz_11_4
               04484       
1536 04485 sprawdz_zwiekszanie_godzin_normalnie      
1536 0E39      04486       movlw       0x39
1538 63DA      04487       cpfseq      godziny_1
153A EFA4 F00A 04488       goto        zwieksz_godziny_1      
               04489 
153E 0E30      04490       movlw       0x30
1540 6FDA      04491       movwf       godziny_1
1542 2BD9      04492       incf        godziny_10,f
1544 EFD4 F00A 04493       goto        wykryto_up_sprawdz_11_4
               04494             
1548 04495 zwieksz_godziny_1      
1548 2BDA      04496       incf        godziny_1,f
               04497       
               04498       
154A EFD4 F00A 04499       goto        wykryto_up_sprawdz_11_4
               04500       
               04501       
154E 04502 wykryto_up_sprawdz_11_2
154E 0EDB      04503       movlw       minuty_10
1550 63E8      04504       cpfseq      ustawianie_czasu_co_wyswietlam
1552 EFC0 F00A 04505       goto        wykryto_up_sprawdz_11_3
               04506       
               04507       
1556 0E39      04508       movlw       0x39
1558 63DC      04509       cpfseq      minuty_1
155A EFBD F00A 04510       goto        zwieksz_minuty_1
               04511      
155E 0E35      04512       movlw       0x35
1560 63DB      04513       cpfseq      minuty_10
1562 EFB8 F00A 04514       goto        zapisz_do_minuty_1_0
               04515       
1566 0E30      04516       movlw       0x30
1568 6FDB      04517       movwf       minuty_10
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 101


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
156A 6FDC      04518       movwf       minuty_1
               04519       
156C EFD4 F00A 04520       goto        wykryto_up_sprawdz_11_4
               04521       
1570 04522 zapisz_do_minuty_1_0
1570 0E30      04523       movlw       0x30
1572 6FDC      04524       movwf       minuty_1
1574 2BDB      04525       incf        minuty_10,f
1576 EFD4 F00A 04526       goto        wykryto_up_sprawdz_11_4
               04527       
               04528       
157A 04529 zwieksz_minuty_1      
157A 2BDC      04530       incf        minuty_1,f
               04531       
157C EFD4 F00A 04532       goto        wykryto_up_sprawdz_11_4
               04533       
1580 04534 wykryto_up_sprawdz_11_3     
1580 0E30      04535       movlw       0x30
1582 63DE      04536       cpfseq      sekundy_1
1584 EFD3 F00A 04537       goto        zwieksz_sekundy_1
               04538       
               04539       ;sprawdz czy dzien_10 == 0x30
1588 0E30      04540       movlw       0x30
158A 63DD      04541       cpfseq      sekundy_10
158C EFCE F00A 04542       goto        zapisz_do_sekundy_1_0
               04543       
1590 0E35      04544       movlw       0x35
1592 6FDD      04545       movwf       sekundy_10
1594 0E39      04546       movlw       0x39
1596 6FDE      04547       movwf       sekundy_1
               04548       
1598 EFD4 F00A 04549       goto        wykryto_up_sprawdz_11_4
               04550       
159C 04551 zapisz_do_sekundy_1_0
159C 0E30      04552       movlw       0x30
159E 6FDE      04553       movwf       sekundy_1
15A0 2BDD      04554       incf        sekundy_10,f
15A2 EFD4 F00A 04555       goto        wykryto_up_sprawdz_11_4
               04556       
               04557       
15A6 04558 zwieksz_sekundy_1      
15A6 2BDE      04559       incf        sekundy_1,f
               04560       
15A8 04561 wykryto_up_sprawdz_11_4            
               04562 
15A8 ECBD F00C 04563       call        procedura_wyswietlania_kolejnych_liczb_zegara
15AC EFEF F00A 04564       goto        wykryto_up_exit
               04565       
15B0 04566 wykryto_up_sprawdz12
               04567      
15B0 04568 wykryto_up_sprawdz16
15B0 0E0B      04569       movlw      opcja_czujnik_regulacji 
15B2 63E1      04570       cpfseq      numer_opcji
15B4 EF5D F00A 04571       goto        wykryto_up_sprawdz_10
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 102


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04572       
               04573       ;jezeli juz jest ustawiona ilosc czujnikow to zeruj
               04574       
15B8 0E07      04575       movlw       ilosc_czujnikow
15BA 63E9      04576       cpfseq      ktory_czujnik_reguluje
15BC EFE3 F00A 04577       goto        wykryto_up_sprawdz16_increase
               04578       
15C0 6BE9      04579       clrf        ktory_czujnik_reguluje
15C2 EFE4 F00A 04580       goto        wykryto_up_sprawdz16_show
               04581       
15C6 04582 wykryto_up_sprawdz16_increase      
15C6 2BE9      04583       incf        ktory_czujnik_reguluje,f
               04584       
               04585       
15C8 04586 wykryto_up_sprawdz16_show      
15C8 51E9      04587       movf        ktory_czujnik_reguluje,w
15CA 6F92      04588       movwf       tmp_hex
               04589       
15CC 6B93      04590       clrf        tmp_hex_H
15CE 6B98      04591       clrf        dec1
15D0 6B97      04592       clrf        dec10
15D2 ECEE F001 04593       call        hex2dec18
               04594 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04595       ;wyświetlam obok nazwy opcji czyli 
15D6 EC90 F00C 04596       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04597       
15DA EFEF F00A 04598       goto        wykryto_up_exit          
               04599       
               04600       
15DE 04601 wykryto_up_exit
15DE B59E      04602       btfsc   znaczniki,czy_moge_juz_zmieniac
15E0 EFF6 F00A 04603       goto    wykryto_up_exit_trzymanie
15E4 9BA1      04604       bcf   markers3,dzialanie_po_klawiszu
15E6 6B99      04605       clrf  stan_key
15E8 EFF1 F00D 04606       goto  LOOP11
               04607  
15EC 04608 wykryto_up_exit_trzymanie
15EC 959E      04609       bcf     znaczniki,czy_moge_juz_zmieniac
15EE 0012      04610       return      
               04611  
               04612 
               04613 
               04614 
               04615 
               04616 ;############################################
               04617 ;#####
               04618 ;######PISZ na ekranie słowa z tablicy opcji menu
               04619 
               04620 
15F0 04621 wyswietl_opcje_menu
15F0 EC32 F001 04622       call        check_busy
15F4 0E80      04623       movlw       linia_gorna
15F6 0F01      04624       addlw       1        
15F8 ECF4 F000 04625       call        send
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 103


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
15FC EC32 F001 04626       call        check_busy
1600 04627 czytam_pierwsza_linie
               04628       
               04629       ;czytam aktualny adres i zwiekszam
1600 0009      04630       TBLRD       *+
               04631       
1602 50F5      04632       movf        TABLAT,w
               04633       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
1604 E006      04634       bz          czytam_druga_linie
1606 EC05 F001 04635       call        write_lcd
160A EC32 F001 04636       call        check_busy
160E EF00 F00B 04637       goto        czytam_pierwsza_linie
               04638       
1612 04639 czytam_druga_linie
               04640       
1612 0EC0      04641       movlw       linia_dolna
1614 0F01      04642       addlw       1        
1616 ECF4 F000 04643       call        send
161A EC32 F001 04644       call        check_busy
               04645       
161E 04646 czytam_druga_linie2
               04647       ;czytam aktualny adres i zwiekszam
161E 0009      04648       TBLRD       *+
               04649       
1620 50F5      04650       movf        TABLAT,w
               04651       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
1622 E006      04652       bz          czytam_trzecia_linie
1624 EC05 F001 04653       call        write_lcd
1628 EC32 F001 04654       call        check_busy
               04655       
162C EF0F F00B 04656       goto        czytam_druga_linie2
               04657       
1630 04658 czytam_trzecia_linie
1630 0E90      04659       movlw       linia_trzecia
1632 0F01      04660       addlw       1        
1634 ECF4 F000 04661       call        send
1638 EC32 F001 04662       call        check_busy
163C 04663 czytam_trzecia_linie2      
163C 0009      04664       TBLRD       *+
               04665       
163E 50F5      04666       movf        TABLAT,w
               04667       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
1640 E006      04668       bz          czytam_4_linie
1642 EC05 F001 04669       call        write_lcd
1646 EC32 F001 04670       call        check_busy
               04671       
164A EF1E F00B 04672       goto        czytam_trzecia_linie2
               04673       
164E 04674 czytam_4_linie
164E 0ED0      04675       movlw       linia_czwarta
1650 0F01      04676       addlw       1        
1652 ECF4 F000 04677       call        send
1656 EC32 F001 04678       call        check_busy
               04679       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 104


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
165A 04680 czytam_4_linie2
165A 0009      04681       TBLRD       *+
               04682       
165C 50F5      04683       movf        TABLAT,w
               04684       ;jezeli 0 to skocz do wyswietlania slowa z linii 2
165E E006      04685       bz          czytam_4_linie3
1660 EC05 F001 04686       call        write_lcd
1664 EC32 F001 04687       call        check_busy
               04688       
1668 EF2D F00B 04689       goto        czytam_4_linie2
               04690       
166C 04691 czytam_4_linie3
166C 0012      04692       return 
               04693  
               04694  
               04695  
               04696 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;; ;                       ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;                                ENTER
166E 04697 wykryto_enter
               04698       ;co sie dzieje jezeli wykryje ze wcisnieto i puszczono klawisz enter
               04699       
166E BFE0      04700       btfsc       pozycja_menu,zmiana_opcji
1670 EF2B F00C 04701       goto        wykryto_enter_zmiana_opcji
               04702       
1674 51E0      04703       movf        pozycja_menu,w
1676 E121      04704       bnz         sprawdz_czy_wchodze_do_zmiany_opcji
               04705 ;jezeli pozycja menu ==0 to po nacisnieciu klawisza enter wyswietlane sa napisy ekranu menu 0 i gwiazdka w linii pierwszej przy pierwszej opcji
               04706       
               04707       ;wylaczam wskazywanie temperatur i czasu
1678 9B9F      04708       bcf         markers,czy_wyswietlam_temp
167A 95A1      04709       bcf         markers3,czy_zegar_wyswietlac
               04710       
               04711       
               04712       
167C EC32 F001 04713       call        check_busy
1680 0E01      04714       movlw       display_clear
1682 ECF4 F000 04715       call        send
1686 EC32 F001 04716       call        check_busy
               04717       
168A 0E01      04718       movlw       1
168C 6FE0      04719       movwf       pozycja_menu
168E 6FE2      04720       movwf       polozenie_gwiazdki
               04721       
1690 6FE1      04722       movwf        numer_opcji
               04723             
1692 EC32 F001 04724       call        check_busy
1696 0E80      04725       movlw       linia_gorna
               04726       
1698 ECF4 F000 04727       call        send
169C EC32 F001 04728       call        check_busy
16A0 0E2A      04729       movlw       _star
16A2 EC05 F001 04730       call        write_lcd
16A6 EC32 F001 04731       call        check_busy
               04732       
               04733       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 105


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
16AA 0E1B      04734       movlw       HIGH tablica_pierwsza
16AC 6EF7      04735       movwf       TBLPTRH
               04736       
16AE 0E00      04737       movlw       LOW tablica_pierwsza
16B0 6EF6      04738       movwf       TBLPTRL
               04739       
16B2 ECF8 F00A 04740       call  wyswietl_opcje_menu
               04741       
16B6 EF81 F00C 04742       goto        wykryto_enter_exit     
               04743       
16BA 04744 sprawdz_czy_wchodze_do_zmiany_opcji
16BA 0E01      04745       movlw       opcja_czujniki
16BC 63E1      04746       cpfseq      numer_opcji
16BE EF70 F00B 04747       goto        wykryto_enter_sprawdz_opcje2
               04748       ;obok nazwy opcji wypisuje aktualna ilosc mierzonych temperatur
               04749       ;naciskanie klawiszy gora/ dół to zmiana ilości kanałów mierzonych
               04750       ;klawisz enter lub back powoduje zatwierdzenie pomiarów 
               04751       
               04752       ;opcja wyboru jest umieszczona na pierwszej linii ekranu
               04753       ;
               04754       ;*pomiar t   2
               04755       ;na 12 znaku linii pierwszej piszemy aktualną cyfrę kanałów
16C2 EC32 F001 04756       call     check_busy
16C6 0E80      04757       movlw    linia_gorna
16C8 0F0C      04758       addlw       0xc
16CA ECF4 F000 04759       call      send
               04760       ;
16CE EC32 F001 04761       call     check_busy
16D2 51A5      04762       movf        ile_kanalow,w
16D4 0F30      04763       addlw       0x30
16D6 EC05 F001 04764       call        write_lcd
               04765             
               04766       ;zaznaczam ze jest zmiana opcji
16DA 8FE0      04767       bsf         pozycja_menu,zmiana_opcji
               04768       
16DC EF81 F00C 04769       goto        wykryto_enter_exit
               04770       
16E0 04771 wykryto_enter_sprawdz_opcje2
               04772 
16E0 0E02      04773       movlw       opcja_odstep
16E2 63E1      04774       cpfseq      numer_opcji
16E4 EF80 F00B 04775       goto        wykryto_enter_sprawdz_opcje3
               04776 
               04777       ;pokaz na ekranie ustawienie aktualne odstępu w s.
16E8 51A7      04778       movf        odstep_pomiarowy,w
16EA 6F92      04779       movwf       tmp_hex
16EC 6B93      04780       clrf        tmp_hex_H
16EE 6B98      04781       clrf        dec1
16F0 6B97      04782       clrf        dec10
16F2 ECEE F001 04783       call        hex2dec18
               04784 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04785       ;wyświetlam obok nazwy opcji czyli 
16F6 EC90 F00C 04786       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04787       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 106


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04788       ;zaznaczam ze jest zmiana opcji
16FA 8FE0      04789       bsf         pozycja_menu,zmiana_opcji
               04790       
16FC EF81 F00C 04791       goto        wykryto_enter_exit
               04792       
               04793       
1700 04794 wykryto_enter_sprawdz_opcje3
1700 0E03      04795       movlw       opcja_srednia
1702 63E1      04796       cpfseq      numer_opcji
1704 EF90 F00B 04797       goto        wykryto_enter_sprawdz_opcje4
               04798 
               04799       ;pokaz na ekranie ustawienie aktualne odstępu w s.
1708 51AF      04800       movf        jak_duzo_probek,w
170A 6F92      04801       movwf       tmp_hex
170C 6B93      04802       clrf        tmp_hex_H
170E 6B98      04803       clrf        dec1
1710 6B97      04804       clrf        dec10
1712 ECEE F001 04805       call        hex2dec18
               04806 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04807       ;wyświetlam obok nazwy opcji czyli 
1716 EC90 F00C 04808       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04809       
171A 8FE0      04810       bsf         pozycja_menu,zmiana_opcji
               04811       
171C EF81 F00C 04812       goto        wykryto_enter_exit
               04813       
1720 04814 wykryto_enter_sprawdz_opcje4
1720 0E04      04815       movlw       opcja_regulacja
1722 63E1      04816       cpfseq      numer_opcji
1724 EF97 F00B 04817       goto        wykryto_enter_sprawdz_opcje5
               04818       
1728 7DA0      04819       btg         markers2,reguluj
               04820       
172A EF81 F00C 04821       goto        wykryto_enter_exit
               04822       
172E 04823 wykryto_enter_sprawdz_opcje5
172E 0E05      04824       movlw       opcja_ustaw_temp
1730 63E1      04825       cpfseq      numer_opcji
1732 EFBA F00B 04826       goto        wykryto_enter_sprawdz_opcje6
               04827       
               04828       
               04829       
               04830                                           ;movf        jaka_wartosc_regulujeL,w      
               04831                                           ;movwf       tmp_hex
               04832                                           ;movf        jaka_wartosc_regulujeH,w
               04833                                           ;movwf        tmp_hex_H
               04834                                           ;clrf        dec1
               04835                                           ;clrf        dec10
               04836                                           ;call        hex2dec18
               04837                                           ;call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04838                                           
1736 ECA0 F00B 04839       call  wyswietl_temp_w_opcjach
               04840       
173A 8FE0      04841       bsf         pozycja_menu,zmiana_opcji
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 107


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               04842       
173C EF81 F00C 04843       goto        wykryto_enter_exit
               04844       
1740 04845 wyswietl_temp_w_opcjach      
1740 51AE      04846       movf        jaka_wartosc_regulujeL,w
               04847            ;dziele przez 4
1742 0D40      04848       mullw       0x40
               04849       
1744 50F3      04850       movf        PRODL,w
1746 6F9D      04851       movwf       wynik01
               04852       
               04853       ;temperatura jest w bajcie starszym
1748 50F4      04854       movf        PRODH,w
174A 6F92      04855       movwf       tmp_hex
               04856       
174C 51AD      04857       movf        jaka_wartosc_regulujeH,w
174E 6F93      04858       movwf        tmp_hex_H
               04859       
1750 ECEE F001 04860          call     hex2dec18
               04861          
1754 0E1B      04862          movlw       HIGH tablica_gwiazdki
1756 6EF7      04863       movwf       TBLPTRH
               04864       
1758 0EA6      04865       movlw       LOW tablica_gwiazdki
175A 6EF6      04866       movwf       TBLPTRL
               04867       
               04868       ;poniewaz najpierw zmniejszam polozenie
               04869       
175C 51E2      04870       movf       polozenie_gwiazdki,w
               04871       
175E 26F6      04872       addwf       TBLPTRL,f
               04873       
               04874       
               04875       
1760 EC32 F001 04876       call        check_busy
               04877        ;a nastepnie czytam to uzywam polecenia
1764 0008      04878       TBLRD *
1766 50F5      04879       movf        TABLAT,w
               04880   ;teraz należy do adresu lini dodać miejsce położenia cyfry 100
               04881   
               04882 
1768 0F09      04883       addlw       0x09
176A ECF4 F000 04884       call        send
               04885          
176E EC5B F005 04886        call     wyswietl_cyfry_temperatury
               04887       
1772 0012      04888       return
               04889 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04890       ;wyświetlam obok nazwy opcji czyli 
               04891       
               04892       
               04893       
1774 04894 wykryto_enter_sprawdz_opcje6 
1774 0E06      04895       movlw       opcja_pomiar_i
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 108


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1776 63E1      04896       cpfseq      numer_opcji
1778 EFC4 F00B 04897       goto        wykryto_enter_sprawdz_opcje7
               04898       
177C 0E02      04899       movlw       2
177E 6FD5      04900       movwf       jak_duzo_kanalow_pradu
1780 6BD6      04901       clrf        ktory_aktualnie_kanal_pradu
               04902       
1782 71A1      04903       btg   markers3,pomiary_pradu
               04904       
               04905       
1784 EF81 F00C 04906       goto        wykryto_enter_exit
               04907      
1788 04908 wykryto_enter_sprawdz_opcje7
               04909 
1788 0E07      04910       movlw       opcja_wlacz_1
178A 63E1      04911       cpfseq      numer_opcji
178C EFCB F00B 04912       goto        wykryto_enter_sprawdz_opcje8
               04913       
1790 7081      04914       btg   port_triak,triak1
               04915       
               04916       
               04917       
1792 EF81 F00C 04918       goto        wykryto_enter_exit
               04919       
1796 04920 wykryto_enter_sprawdz_opcje8
1796 0E08      04921       movlw       opcja_wlacz_2
1798 63E1      04922       cpfseq      numer_opcji
179A EFD2 F00B 04923       goto        wykryto_enter_sprawdz_opcje9
               04924       
179E 7281      04925       btg   port_triak,triak2
               04926       
               04927       
               04928       
17A0 EF81 F00C 04929       goto        wykryto_enter_exit
               04930       
               04931       
17A4 04932 wykryto_enter_sprawdz_opcje9
17A4 0E09      04933       movlw       opcja_histereza1
17A6 63E1      04934       cpfseq      numer_opcji
17A8 EFE2 F00B 04935       goto        wykryto_enter_sprawdz_opcje10
               04936       
               04937       ;wlacz pomiar pradu
               04938       ;jako test wlacz podswietlenie lub je wylacz
               04939       
               04940       ;btg   portlampka2,lampka2
17AC 51E6      04941       movf        histereza1,w
17AE 6F92      04942       movwf       tmp_hex
               04943       
17B0 6B93      04944       clrf        tmp_hex_H
17B2 6B98      04945       clrf        dec1
17B4 6B97      04946       clrf        dec10
17B6 ECEE F001 04947       call        hex2dec18
               04948 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04949       ;wyświetlam obok nazwy opcji czyli 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 109


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
17BA EC90 F00C 04950       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04951       
17BE 8FE0      04952       bsf         pozycja_menu,zmiana_opcji
               04953       
17C0 EF81 F00C 04954       goto        wykryto_enter_exit
               04955 
17C4 04956 wykryto_enter_sprawdz_opcje10
17C4 0E0A      04957          movlw       opcja_histereza2
17C6 63E1      04958       cpfseq      numer_opcji
17C8 EFF2 F00B 04959       goto        wykryto_enter_sprawdz_opcje11
               04960       
               04961       ;wlacz pomiar pradu
               04962       ;jako test wlacz podswietlenie lub je wylacz
               04963       
               04964       ;btg   portlampka2,lampka2
17CC 51E7      04965       movf        histereza2,w
17CE 6F92      04966       movwf       tmp_hex
               04967       
17D0 6B93      04968       clrf        tmp_hex_H
17D2 6B98      04969       clrf        dec1
17D4 6B97      04970       clrf        dec10
17D6 ECEE F001 04971       call        hex2dec18
               04972 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               04973       ;wyświetlam obok nazwy opcji czyli 
17DA EC90 F00C 04974       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               04975       
17DE 8FE0      04976       bsf         pozycja_menu,zmiana_opcji
               04977       
17E0 EF81 F00C 04978       goto        wykryto_enter_exit
               04979       
               04980       
17E4 04981 wykryto_enter_sprawdz_opcje11
17E4 0E10      04982       movlw       opcja_ustaw_zegar
17E6 63E1      04983       cpfseq      numer_opcji
17E8 EFFD F00B 04984       goto        wykryto_enter_sprawdz_opcje12
               04985       ;czyszcze rejestr przechowujący wyświetlaną liczbę
17EC 0ED7      04986       movlw       dzien_10
17EE 6FE8      04987       movwf        ustawianie_czasu_co_wyswietlam
17F0 8FE0      04988       bsf         pozycja_menu,zmiana_opcji
               04989       
17F2 ECBD F00C 04990       call        procedura_wyswietlania_kolejnych_liczb_zegara
               04991       
               04992       
17F6 EF81 F00C 04993       goto        wykryto_enter_exit
               04994       
17FA 04995 wykryto_enter_sprawdz_opcje12
17FA 0E0C      04996       movlw       opcja_ustaw_serial
17FC 63E1      04997       cpfseq      numer_opcji
17FE EF04 F00C 04998       goto        wykryto_enter_sprawdz_opcje13
               04999       
1802 799F      05000       btg         markers,czy_wysylac_pomiary_serial      
               05001       
               05002            
1804 EF81 F00C 05003       goto        wykryto_enter_exit
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 110


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05004 
               05005       
1808 05006 wykryto_enter_sprawdz_opcje13      
               05007 
1808 0E0D      05008       movlw       opcja_wyswietl_zegar
180A 63E1      05009       cpfseq      numer_opcji
180C EF0B F00C 05010       goto        wykryto_enter_sprawdz_opcje14
               05011       
1810 739E      05012       btg   znaczniki,czy_ponownie_wlaczyc_zegar
               05013       
1812 EF81 F00C 05014       goto        wykryto_enter_exit
               05015       
1816 05016 wykryto_enter_sprawdz_opcje14
               05017 
1816 0E0E      05018       movlw       opcja_wyswietl_temp
1818 63E1      05019       cpfseq      numer_opcji
181A EF12 F00C 05020       goto        wykryto_enter_sprawdz_opcje15
               05021       
181E 719E      05022       btg   znaczniki,czy_ponownie_wlaczyc_temp
               05023       
1820 EF81 F00C 05024       goto        wykryto_enter_exit
               05025 
1824 05026 wykryto_enter_sprawdz_opcje15
               05027 
1824 0E0F      05028       movlw       opcja_podswietlenie
1826 63E1      05029       cpfseq      numer_opcji
1828 EF19 F00C 05030       goto        wykryto_enter_sprawdz_opcje16
               05031       
182C 7881      05032       btg   portlampka2,lampka2
               05033       
182E EF81 F00C 05034       goto        wykryto_enter_exit
               05035 
               05036       
1832 05037 wykryto_enter_sprawdz_opcje16  
1832 0E0B      05038       movlw       opcja_czujnik_regulacji
1834 63E1      05039       cpfseq      numer_opcji
1836 EF29 F00C 05040       goto        wykryto_enter_sprawdz_opcje17
               05041       
               05042       ;wlacz pomiar pradu
               05043       ;jako test wlacz podswietlenie lub je wylacz
               05044       
               05045       ;btg   portlampka2,lampka2
183A 500B      05046       movf        opcja_czujnik_regulacji ,w
183C 6F92      05047       movwf       tmp_hex
               05048       
183E 6B93      05049       clrf        tmp_hex_H
1840 6B98      05050       clrf        dec1
1842 6B97      05051       clrf        dec10
1844 ECEE F001 05052       call        hex2dec18
               05053 ;czyli zawartość rejestru jest zamieniana na postać dziesiętną i przenoszonona do dec100 dec10 dec1
               05054       ;wyświetlam obok nazwy opcji czyli 
1848 EC90 F00C 05055       call        wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               05056       
184C 8FE0      05057       bsf         pozycja_menu,zmiana_opcji
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 111


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05058       
184E EF81 F00C 05059       goto        wykryto_enter_exit
               05060       
1852 05061 wykryto_enter_sprawdz_opcje17      
1852 EF81 F00C 05062       goto        wykryto_enter_exit
               05063       
1856 05064 wykryto_enter_zmiana_opcji
1856 0E01      05065       movlw       opcja_czujniki
1858 63E1      05066       cpfseq      numer_opcji
185A EF3D F00C 05067       goto          wykryto_enter_wyjscie_opcje2
               05068       
               05069       
185E ECB0 F00C 05070       call     enter_back_wyjsc_z_opcji_czujniki
               05071       
               05072       ;jeżeli zmieniam ilość obsługiwanych czujników temp
               05073       ;to tu powinno być wyjście z opcji włączania czujników
               05074       ;czyli jeżeli ile_kanalow > 0 to włącz pomiary
               05075       
1862 51A5      05076       movf         ile_kanalow,w
1864 E04E      05077       bz          wykryto_enter_exit
               05078       
               05079       
1866 6FA6      05080       movwf    ktory_kanal_mierze
               05081       
               05082       
1868 51A7      05083       movf    odstep_pomiarowy,w
               05084       
186A 6FA8      05085       movwf    aktualny_odstep
               05086       
               05087       
186C 85A0      05088       bsf      markers2,pomiary
186E 859F      05089       bsf      markers,pomiary_zrobione
1870 819F      05090       bsf       markers,czy_usrednianie
               05091       ;włączyć trzeba moduł A/D
1872 0E01      05092       movlw    b'00000001'
1874 6EC2      05093       movwf    ADCON0
               05094       ;bsf      markers,czy_wyswietlam_temp
1876 EF81 F00C 05095       goto        wykryto_enter_exit
               05096             
               05097       
187A 05098 wykryto_enter_wyjscie_opcje2
               05099 ;opcja z liczbą      
187A 0E02      05100       movlw       opcja_odstep
187C 63E1      05101       cpfseq      numer_opcji
187E EF45 F00C 05102       goto          wykryto_enter_wyjscie_opcje3
1882 ECEC F00C 05103       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05104       
               05105       ;call  wykryto_enter_back_wyjsc_z_opcji_skasuj_liczbe
               05106       
               05107       
               05108       
1886 EF81 F00C 05109       goto        wykryto_enter_exit
               05110       
188A 05111 wykryto_enter_wyjscie_opcje3
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 112


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05112       
188A 0E03      05113       movlw       opcja_srednia
188C 63E1      05114       cpfseq      numer_opcji
188E EF4D F00C 05115       goto          wykryto_enter_wyjscie_opcje4
1892 ECEC F00C 05116       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05117       
               05118      ; bcf        pozycja_menu,zmiana_opcji
               05119       
1896 EF81 F00C 05120       goto        wykryto_enter_exit
               05121       
               05122 
189A 05123 wykryto_enter_wyjscie_opcje4
               05124 
189A 05125 wykryto_enter_wyjscie_opcje5
               05126 
189A 0E05      05127       movlw       opcja_ustaw_temp
189C 63E1      05128       cpfseq      numer_opcji
189E EF55 F00C 05129       goto          wykryto_enter_wyjscie_opcje6
18A2 ECEC F00C 05130       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05131       
               05132       ;bcf        pozycja_menu,zmiana_opcji
               05133       
18A6 EF81 F00C 05134       goto        wykryto_enter_exit
               05135       
18AA 05136 wykryto_enter_wyjscie_opcje6
               05137 
18AA 05138 wykryto_enter_wyjscie_opcje9
               05139 
18AA 0E09      05140       movlw       opcja_histereza1
18AC 63E1      05141       cpfseq      numer_opcji
18AE EF5D F00C 05142       goto          wykryto_enter_wyjscie_opcje10
18B2 ECEC F00C 05143       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05144       
               05145       ;bcf        pozycja_menu,zmiana_opcji
               05146       
18B6 EF81 F00C 05147       goto        wykryto_enter_exit
               05148 
               05149 
18BA 05150 wykryto_enter_wyjscie_opcje10
18BA 0E0A      05151          movlw       opcja_histereza2
18BC 63E1      05152       cpfseq      numer_opcji
18BE EF65 F00C 05153       goto          wykryto_enter_wyjscie_opcje11
18C2 ECEC F00C 05154       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05155       
               05156       ;bcf        pozycja_menu,zmiana_opcji
               05157       
18C6 EF81 F00C 05158       goto        wykryto_enter_exit
               05159 
               05160 
               05161 
18CA 05162 wykryto_enter_wyjscie_opcje11
18CA 0E10      05163       movlw       opcja_ustaw_zegar
18CC 63E1      05164       cpfseq      numer_opcji
18CE EF79 F00C 05165       goto        wykryto_enter_wyjscie_opcje12
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 113


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05166 
18D2 0EDD      05167       movlw       sekundy_10
18D4 63E8      05168       cpfseq      ustawianie_czasu_co_wyswietlam
18D6 EF71 F00C 05169       goto        wykryto_enter_wyjscie_opcje11_2
               05170       ;jezeli jest w tej chwili sekundy_10 tzn ze wychodze z wyswietlania ustawien zegara
               05171             
18DA ECEC F00C 05172       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05173       
               05174       ;bcf        pozycja_menu,zmiana_opcji
               05175       
18DE EF81 F00C 05176       goto        wykryto_enter_exit
               05177       
               05178       
18E2 05179 wykryto_enter_wyjscie_opcje11_2
18E2 0E02      05180       movlw       2
18E4 27E8      05181       addwf       ustawianie_czasu_co_wyswietlam,f
18E6 ECBD F00C 05182       call        procedura_wyswietlania_kolejnych_liczb_zegara
18EA EF81 F00C 05183       goto        wykryto_enter_exit
               05184       
               05185 
18EE EF81 F00C 05186       goto        wykryto_enter_exit
               05187       
18F2 05188 wykryto_enter_wyjscie_opcje12      
               05189 
18F2 05190 wykryto_enter_wyjscie_opcje16
18F2 0E0B      05191       movlw       opcja_czujnik_regulacji
18F4 63E1      05192       cpfseq      numer_opcji
18F6 EF81 F00C 05193       goto          wykryto_enter_wyjscie_opcje17
18FA ECEC F00C 05194       call  enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05195       
               05196       ;bcf        pozycja_menu,zmiana_opcji
               05197       
18FE EF81 F00C 05198       goto        wykryto_enter_exit
1902 05199 wykryto_enter_wyjscie_opcje17
               05200 
               05201 ;             
               05202 ;       call     check_busy
               05203 ;       movlw    linia_czwarta
               05204 ;       call      send
               05205 ;         
               05206 ;       call     check_busy
               05207 ; ;czy gasze czy wyswietlam      
               05208 ;       btfsc       markers,test
               05209 ;       goto        zamaz_E
               05210 ; napisz_E
               05211 ;       bsf   markers,test
               05212 ;       movlw       _E
               05213 ;       goto  wykryto_back_pisz
               05214 ; zamaz_E
               05215 ;       bcf   markers,test
               05216 ;       movlw       _puste
               05217 ;       
               05218 ; wykryto_enter_pisz
               05219 ;       call     write_lcd
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 114


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05220       
               05221       
               05222       
1902 05223 wykryto_enter_exit 
1902 9BA1      05224       bcf   markers3,dzialanie_po_klawiszu
1904 6B99      05225       clrf  stan_key
1906 EFF1 F00D 05226       goto  LOOP11
               05227  
               05228 ;wykryto_enter_back_wyjsc_z_opcji_skasuj_liczbe
               05229 ;odczytaj_polozenie_gwiazdki_wybierz_linie
               05230  
190A 05231 odczytaj_adres_polozenia_gwiazdki
190A 0E1B      05232       movlw       HIGH tablica_gwiazdki
190C 6EF7      05233       movwf       TBLPTRH
               05234       
190E 0EA6      05235       movlw       LOW tablica_gwiazdki
1910 6EF6      05236       movwf       TBLPTRL
               05237       
               05238       ;poniewaz najpierw zmniejszam polozenie
               05239       
1912 51E2      05240       movf       polozenie_gwiazdki,w
               05241       
1914 26F6      05242       addwf       TBLPTRL,f
               05243       
               05244       
               05245       
1916 EC32 F001 05246       call        check_busy
               05247        ;a nastepnie czytam to uzywam polecenia
191A 0008      05248       TBLRD *
191C 50F5      05249       movf        TABLAT,w
               05250 ;na zakończenie procedury adres linii z gwiazdką jest umieszczany w rejestrze W
191E 0012      05251       return
               05252       
               05253       
1920 05254 wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa
               05255 ;aby liczba wyświetlana znalazła się obok swojej opcji w menu, należy wcześniej odczytać aktualne położenie gwiazdki
               05256 ;z tablicy
               05257 ;dzięki temu uniknięte zostanie wielokrotne powtarzanie procedur wyświetlania liczb w zależności od opcji przy której umieszczona ma być wartośc liczby
               05258 ;poza tym w wypadku zmiany położenia opcji w tablicy opcji menu ( z linii 2 na 3) to zmiana nastąpi automatycznie
               05259 ;gdyż to położenie gwiazdki decyduje o położeniu cyfr
1920 0E1B      05260       movlw       HIGH tablica_gwiazdki
1922 6EF7      05261       movwf       TBLPTRH
               05262       
1924 0EA6      05263       movlw       LOW tablica_gwiazdki
1926 6EF6      05264       movwf       TBLPTRL
               05265       
               05266       ;poniewaz najpierw zmniejszam polozenie
               05267       
1928 51E2      05268       movf       polozenie_gwiazdki,w
               05269       
192A 26F6      05270       addwf       TBLPTRL,f
               05271       
               05272       
               05273       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 115


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
192C EC32 F001 05274       call        check_busy
               05275        ;a nastepnie czytam to uzywam polecenia
1930 0008      05276       TBLRD *
1932 50F5      05277       movf        TABLAT,w
               05278   ;teraz należy do adresu lini dodać miejsce położenia cyfry 100
               05279   
               05280 
1934 0F0D      05281       addlw       0x0d       
1936 ECF4 F000 05282       call        send
193A EC32 F001 05283       call        check_busy
               05284  
               05285  ;i wyswietlic wszystkie cyfry
193E 5196      05286       movf        dec100,w
1940 0F30      05287       addlw       0x30
1942 EC05 F001 05288       call        write_lcd      
1946 EC32 F001 05289       call        check_busy
               05290       
194A 5197      05291       movf        dec10,w      
194C 0F30      05292       addlw       0x30
194E EC05 F001 05293       call        write_lcd      
               05294       
1952 EC32 F001 05295       call        check_busy
1956 5198      05296       movf        dec1,w
1958 0F30      05297       addlw       0x30
195A EC05 F001 05298       call        write_lcd      
               05299       
195E 0012      05300       return
               05301       
               05302  
1960 05303 enter_back_wyjsc_z_opcji_czujniki
               05304       ;czysc ustawienia opcji i zgas bit zmiana_opcji
               05305        
1960 9FE0      05306        bcf        pozycja_menu,zmiana_opcji
1962 EC32 F001 05307        call     check_busy
1966 0E80      05308       movlw    linia_gorna
1968 0F0C      05309       addlw       0xc
196A ECF4 F000 05310       call      send
               05311       ;
               05312       
196E EC32 F001 05313       call     check_busy
1972 0E20      05314       movlw       _puste
1974 EC05 F001 05315       call        write_lcd
               05316       
1978 0012      05317       return
               05318        
197A 05319 procedura_wyswietlania_kolejnych_liczb_zegara
197A EC85 F00C 05320       call  odczytaj_adres_polozenia_gwiazdki
197E 0F0C      05321       addlw       0x0c
1980 ECF4 F000 05322       call        send
               05323       
1984 EC32 F001 05324       call        check_busy
               05325       
               05326 ;która litera jest wyświetlana obok cyfr = D - day, H - hours, M - minute, S- seconds      
1988 0ED7      05327       movlw       dzien_10
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 116


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
198A 63E8      05328       cpfseq      ustawianie_czasu_co_wyswietlam
198C EFCB F00C 05329       goto        procedura_wyswietlania_kolejnych_liczb_zegara_1
1990 0E44      05330       movlw       _D
1992 EFD8 F00C 05331       goto        procedura_wyswietlania_kolejnych_liczb_zegara_4
               05332       
1996 05333 procedura_wyswietlania_kolejnych_liczb_zegara_1
1996 0ED9      05334       movlw       godziny_10
1998 63E8      05335       cpfseq      ustawianie_czasu_co_wyswietlam
199A EFD0 F00C 05336       goto        procedura_wyswietlania_kolejnych_liczb_zegara_2
199E 0E48      05337       movlw       _H
               05338       
19A0 05339 procedura_wyswietlania_kolejnych_liczb_zegara_2
19A0 0EDB      05340       movlw       minuty_10
19A2 63E8      05341       cpfseq      ustawianie_czasu_co_wyswietlam
19A4 EFD7 F00C 05342       goto        procedura_wyswietlania_kolejnych_liczb_zegara_3
19A8 0E4D      05343       movlw       _M
19AA EFD8 F00C 05344       goto        procedura_wyswietlania_kolejnych_liczb_zegara_4
               05345       
19AE 05346 procedura_wyswietlania_kolejnych_liczb_zegara_3     
               05347       ; movlw       sekundy_10
               05348       ; cpfseq      ustawianie_czasu_co_wyswietlam
               05349       ; goto        procedura_wyswietlania_kolejnych_liczb_zegara_1
19AE 0E53      05350       movlw       _S
               05351       
19B0 05352 procedura_wyswietlania_kolejnych_liczb_zegara_4            
               05353       
19B0 EC05 F001 05354       call        write_lcd
               05355       
19B4 6ADA      05356       clrf        FSR2H
19B6 51E8      05357       movf        ustawianie_czasu_co_wyswietlam,w
19B8 6ED9      05358       movwf      FSR2L      
               05359       
19BA EC32 F001 05360       call        check_busy
19BE 50DF      05361       movf        INDF2,w      
19C0 EC05 F001 05362       call        write_lcd
               05363       
19C4 EC32 F001 05364       call        check_busy
               05365       
19C8 2AD9      05366       incf        FSR2L,f
19CA 50DF      05367       movf        INDF2,w      
19CC EC05 F001 05368       call        write_lcd
               05369       
19D0 EC32 F001 05370       call        check_busy
               05371       
19D4 2AD9      05372       incf        FSR2L,f       
               05373        
19D6 0012      05374       return
               05375 
               05376       
19D8 05377 enter_back_wyjsc_z_opcji_wyswietlanie_liczby
               05378 ;procedrura analogiczna to tej związanej z obsługą wyświetlania rejestru
19D8 0E1B      05379       movlw       HIGH tablica_gwiazdki
19DA 6EF7      05380       movwf       TBLPTRH
               05381       
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 117


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
19DC 0EA6      05382       movlw       LOW tablica_gwiazdki
19DE 6EF6      05383       movwf       TBLPTRL
               05384       
               05385       ;poniewaz najpierw zmniejszam polozenie
               05386       
19E0 51E2      05387       movf       polozenie_gwiazdki,w
               05388       
19E2 26F6      05389       addwf       TBLPTRL,f
               05390       
               05391        ;a nastepnie czytam to uzywam polecenia
19E4 0008      05392       TBLRD *
               05393       
19E6 EC32 F001 05394       call        check_busy
               05395       
19EA 50F5      05396       movf        TABLAT,w
               05397 ;teraz należy do adresu lini dodać miejsce położenia cyfry 100
19EC 0F0B      05398       addlw       0x0b 
19EE ECF4 F000 05399       call        send
               05400       
19F2 EC32 F001 05401       call        check_busy       
19F6 0E20      05402       movlw       _puste
19F8 EC05 F001 05403       call        write_lcd      
19FC EC32 F001 05404       call        check_busy
1A00 0E20      05405       movlw       _puste
1A02 EC05 F001 05406       call        write_lcd      
1A06 EC32 F001 05407       call        check_busy
1A0A 0E20      05408       movlw       _puste
1A0C EC05 F001 05409       call        write_lcd      
1A10 EC32 F001 05410       call        check_busy       
1A14 0E20      05411       movlw       _puste
1A16 EC05 F001 05412       call        write_lcd      
1A1A EC32 F001 05413       call        check_busy
1A1E 0E20      05414       movlw       _puste
1A20 EC05 F001 05415       call        write_lcd 
1A24 9FE0      05416       bcf        pozycja_menu,zmiana_opcji
               05417       
1A26 0012      05418       return
               05419 ;menu wyswietlane w ten sposob, ze na jednym ekranie umieszczone sa cztery opcje
               05420 ;a do kazdej linii odnosi sie zwiazana z nia tablica nazw opcji
               05421 ;przy przejsciu do kolejnego ekranu opcji nastepuje zmiana tych opcji na kolejne
1B00           05422       org         1b00h
1B00 05423 tablica_pierwsza
1B00 6F70 696D 05424       db   "pomiar t",0,"odstep",0,"srednia",0,"regulacja",0
     7261 7420 
     6F00 7364 
     6574 0070 
     7273 6465 
     696E 0061 
     6572 7567 
     616C 6A63 
     0061      
               05425       
1B22 05426 tablica_druga
1B22 7375 6174 05427       db    "ustaw t",0,"pomiar i" ,0, "wlacz1" ,0, "wlacz2" ,0
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 118


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
     2077 0074 
     6F70 696D 
     7261 6920 
     7700 616C 
     7A63 0031 
     6C77 6361 
     327A 0000 
1B42 05428 tablica_trzecia
1B42 6968 7473 05429       db     "histereza1",0,"histereza2",0,"zegar",0,"przesyl serial",0
     7265 7A65 
     3161 6800 
     7369 6574 
     6572 617A 
     0032 657A 
     6167 0072 
     7270 657A 
     7973 206C 
     6573 6972 
     6C61 0000 
               05430 
1B6E 05431 tablica_czwarta
1B6E 7977 7773 05432       db     "wyswietl. zegar",0,"wyswietl. temp",0,"podswietlenie",0,"czuj. reg",0      
     6569 6C74 
     202E 657A 
     6167 0072 
     7977 7773 
     6569 6C74 
     202E 6574 
     706D 7000 
     646F 7773 
     6569 6C74 
     6E65 6569 
     6300 757A 
     2E6A 7220 
     6765 0000 
               05433 ;####################  TABLICA POLOZEN gwiazdki
               05434 
1BA6 05435 tablica_gwiazdki        
1BA6 8000 90C0 05436       db    0,linia_gorna,linia_dolna,linia_trzecia,linia_czwarta,1
     01D0      
               05437       
               05438       
               05439 
               05440 
               05441 
               05442 
               05443 
               05444 
               05445 
               05446 
               05447 
               05448 
               05449 
               05450 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 119


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05451 
               05452 
               05453 
               05454 
               05455 
               05456 ;;;; tu jest procedura PETLI
               05457 
               05458 
               05459 
               05460 
               05461 
               05462 
               05463 
               05464 
               05465 
               05466       
               05467     
1BAC 05468 LOOP
               05469 
1BAC ABA1      05470       btfss       markers3,dzialanie_po_klawiszu
1BAE EFE5 F00D 05471       goto        LOOP_sprawdz_keys        
               05472 
               05473 
               05474       
1BB2 B199      05475       btfsc   stan_key,latch_back
1BB4 EFC5 F007 05476       goto    wykryto_back
               05477                   
1BB8 B399      05478       btfsc    stan_key,latch_down
1BBA EFD8 F007 05479       goto     wykryto_down
               05480                            
1BBE B599      05481       btfsc    stan_key,latch_up
1BC0 EF57 F009 05482       goto     wykryto_up
               05483          
1BC4 B799      05484       btfsc    stan_key,latch_enter
1BC6 EF37 F00B 05485       goto     wykryto_enter 
               05486       
               05487 ;jeżeli zaznaczono że należy zmieniać już wartości to sprawdź które klawisze i które procedury wywołuję      
               05488 ;      btfss       znaczniki,czy_moge_juz_zmieniac
               05489  ;     goto        
               05490       
               05491       
               05492       
1BCA 05493 LOOP_sprawdz_keys
1BCA A083      05494       btfss   latch_keys,latch_back
1BCC EC8C F007 05495       call    wcisnieto_back
               05496                   
1BD0 A283      05497       btfss    latch_keys,latch_down
1BD2 EC93 F007 05498       call     wcisnieto_down
               05499                            
1BD6 A483      05500       btfss    latch_keys,latch_up
1BD8 EC9F F007 05501       call     wcisnieto_up
               05502          
1BDC A683      05503       btfss    latch_keys,latch_enter
1BDE ECBE F007 05504       call     wcisnieto_enter
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 120


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05505 
1BE2 05506 LOOP11      
1BE2 B7A1      05507       btfsc markers3,odswiezanie_zegara
1BE4 EF21 F002 05508       goto  napisz_czas
               05509       
1BE8 05510 LOOP_temperatury      
               05511 ;jezeli jest ustawiony bit pomiary to sprawdz 
1BE8 A5A0      05512          btfss    markers2,pomiary
1BEA EF03 F00E 05513          goto     LOOP1
               05514 
               05515          
               05516 ;jezeli ustawiony jest bit czy_wlaczyc_ponownie_temp to nawet nie sprawdzaj
1BEE B7A1      05517             btfsc      markers3,odswiezanie_zegara
1BF0 EF03 F00E 05518             goto        LOOP1   
               05519          
1BF4 B59F      05520          btfsc    markers,pomiary_zrobione
1BF6 EF03 F00E 05521          goto     LOOP1
               05522          
1BFA B79F      05523          btfsc    markers,inicjuj_pomiary
1BFC EC67 F002 05524          call     rozpocznij_pomiary
               05525                   
1C00 B9A0      05526          btfsc    markers2,wyslij_pomiar
1C02 ECFF F005 05527          call     wysylanie_pomiaru
1C06 05528 LOOP1         
1C06 B3A0      05529          btfsc    markers2,przerwanie_t1
1C08 EC7B F002 05530          call     procedura_obslugi_zegara
               05531          
1C0C B7A0      05532          btfsc    markers2,sprawdz_odebrane
1C0E ECDE F004 05533          call     sprawdz_czy_polecenie
               05534 
               05535 
               05536 ;          btfsc    markers2,wyswietl
               05537 ;          call     wyswietl_litere
               05538                   
               05539 ;        btfsc    markers2,blad_transmisji
               05540 ;        call     wyswietl_error
               05541          
               05542          
               05543          
               05544 ;        btfsc    markers2,poczatkowy_bit
               05545 ;        call     poczatek_odbioru
               05546          
1C12 05547 LOOP2    
               05548          
               05549 
1C12 EFD6 F00D 05550          goto     LOOP
               05551          
               05552 
               05553 
               05554          
               05555          
               05556          
               05557          
               05558          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 121


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05559          
               05560          
               05561          
               05562          
               05563          
               05564          
               05565          
               05566          
               05567          
               05568          
               05569          
               05570          
               05571          
               05572          
               05573          
               05574          
               05575          
               05576          
               05577          
               05578          
               05579          
               05580          
               05581          
               05582          
               05583          
               05584          
               05585          
               05586          
               05587          
               05588          
               05589 ;tu sa procedury inicjacyjne!
               05590 
               05591 
               05592 
               05593 
               05594 
               05595 
               05596 
               05597          
               05598 ; org    800h
               05599 ;ta funkcja zlicza nacisniecia klawisza rb0ółńżą
               05600 ;funkcja odczekuj?ca
               05601 
               05602 
               05603 
               05604          
               05605 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
               05606 
               05607 ;POCZATEK
               05608 ;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;       
               05609          ;org      0800h    
               05610 
               05611 
               05612                 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 122


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1C16 05613 inicjacja
               05614          ;ulamek 0,25 - tzn 1 
               05615           ;movlw    0x0
               05616           ;movlw   numer_opcji_koncowej
               05617           ;movwf   
               05618           ;movwf    tmp
               05619           ;decf    tmp,f
               05620           ;bsf   tmp,(menu_opcje_end)
               05621           ;btfss   STATUS,C
               05622           ;incf    tmp,f
               05623 ;          
               05624 ;          addlw    0xc3
               05625          ;movwf    tmp7
               05626          ;mnoze 2,5 * 0x30 tzn 
               05627          ;movlw    0x30
               05628          ;ulamek
               05629          ;mulwf    tmp
               05630          ;movf     PRODH,w
               05631          ;movwf    dec10
               05632          ;movf    PRODL,w
               05633          ;movwf    dec1
               05634          
               05635          ;movlw    0x30
               05636          
               05637          
               05638          ;mulwf    tmp7
               05639          
               05640          
1C16 6AD8      05641          clrf    STATUS ;czyszcze status
               05642          ;movlw    
               05643          ;clrf    czas;
1C18 6A80      05644          clrf     PORTA
1C1A 6A81      05645          clrf     PORTB
1C1C 6A82      05646          clrf     PORTC
1C1E 6A83      05647           clrf     PORTD
1C20 6A84      05648          clrf     PORTE
1C22 6A89      05649          clrf     LATA
1C24 6A8A      05650          clrf     LATB
1C26 6A8B      05651          clrf     LATC
1C28 6A8C      05652          clrf     LATD
1C2A 6A8D      05653          clrf     LATE
               05654 ;przerwania kompatybilne z 16fxx
1C2C 8ED0      05655          bsf      RCON,IPEN         
               05656          
               05657 ;ustawiam TMR1
               05658                                     ;Timer 1 ustawiony jako 1/16 sekundy
1C2E 0E01      05659          movlw    b'00000001'
1C30 6ECD      05660          movwf    T1CON
               05661 ;pzrerwania
1C32 6AF2      05662          clrf     INTCON
1C34 8EF2      05663          bsf      INTCON,GIE
1C36 8CF2      05664          bsf      INTCON,PEIE
               05665          
               05666          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 123


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1C38 6AF0      05667          clrf     INTCON3
1C3A 0E80      05668          movlw    b'10000000'
1C3C 6EF1      05669          movwf    INTCON2
1C3E 9AF2      05670          bcf     INTCON,TMR0IE
1C40 9896      05671          bcf      TRISE,PSPMODE
1C42 9AC6      05672          bcf      SSPCON1,SSPEN
1C44 9EAB      05673          BCF      RCSTA,SPEN
               05674          
               05675          ;ustawienia comparatora
1C46 0E00      05676          movlw    b'00000000'
1C48 6EB5      05677          movwf    CVRCON
               05678          ;komparator wylaczony
1C4A 0E07      05679          movlw    b'00000111'
1C4C 6EB4      05680          movwf    CMCON
               05681          ;movlw   b'00000000'       ;wszystkie linie na wysoko
               05682          ;ovwf    PORTB
               05683          
1C4E 05684 CCP_init         
1C4E 0E00      05685          movlw    0
1C50 6EBD      05686          movwf    CCP1CON
1C52 6EBA      05687          movwf    CCP2CON
               05688          ;BCF     
1C54 6ACC      05689          clrf     TMR2
               05690          
1C56 05691 Timer3_init                                                 ;ustawienie zegara tmr3
1C56 0E61      05692             movlw       b'01100001'
1C58 6EB1      05693             movwf       T3CON
               05694          
               05695          
1C5A 05696 BEGIN2lcd_init
               05697          ;bsf      STATUS,RP0        ;bank 1
1C5A 6A9D      05698          clrf     PIE1
1C5C 6AA0      05699          clrf     PIE2
1C5E 809D      05700          bsf      PIE1,TMR1IE
               05701          
               05702      ;ustawiam na wyjscia 1 -wejscie
               05703         ;movlw   b'11111111'
               05704          
1C60 0E3F      05705          movlw    b'00111111'
1C62 6E92      05706          movwf    TRISA
               05707          
               05708 IF (czy_ekran==1)
1C64 0EE0      05709          movlw   b'11100000'
1C66 6E93      05710          movwf    TRISB
               05711 ENDIF
               05712 
               05713 IF (czy_ekran==0)
               05714          movlw   b'11111111'
               05715          movwf    TRISB
               05716 ENDIF
               05717 
1C68 0EA0      05718         movlw   b'10100000'
1C6A 6E94      05719          movwf    TRISC
               05720          
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 124


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05721 ;tu sie zminienia dla kabli
               05722         ;movlw   b'11111111'
               05723 IF (czy_ekran==1)        
1C6C 0E0F      05724          movlw    normalne_ustawienie_tris_lcd
1C6E 6E95      05725          movwf    TRISD
               05726 ENDIF
               05727          
               05728 IF (czy_ekran==0)
               05729          movlw    0x0F
               05730          movwf    TRISD
               05731 ENDIF
               05732          
1C70 0E07      05733          movlw   b'00000111'
1C72 6E96      05734          movwf    TRISE
               05735          
               05736          
               05737 ;ustawienia timera 0
1C74 0EC7      05738          movlw    b'11000111'
1C76 6ED5      05739          movwf    T0CON
               05740  ;dopiero teraz w??cz zegar
               05741          
               05742 
               05743 
               05744 ;90  czyli 5a
               05745 ;50      32
               05746 ;210(200us) d2
               05747 ;196(190us) c4    
               05748 ;        movlw    b'11010010'
1C78 0E80      05749          movlw    0x80
1C7A 6ECB      05750          movwf    PR2
               05751          
               05752 ;bank 0
               05753          ;bcf      STATUS,RP0
               05754 ;        movlw    b'01000000'
               05755 ;        movwf    ADCON0
               05756          
               05757 ;ustawiam TMR2 z licznikiem 1:1
               05758          
               05759 ;wyczyscic trzeba pamiec na zmienne
               05760 ;jezeli tego nie zrobie to
               05761 ;po wlaczeniu zasilani moga pojawic
               05762 ; sie problemy bo moga tam byc losowe dane
               05763 ;od 000 do f7f
1C7C 0E80      05764          movlw    0x80
1C7E 6EE9      05765          movwf    FSR0L
1C80 6AEA      05766          clrf     FSR0H
1C82 05767 next
               05768          ;movlw   0
1C82 6AEF      05769          clrf     INDF0
1C84 2AE9      05770          INCF     FSR0L,f
               05771          ;movlw    0ffh
               05772          
1C86 A0D8      05773          btfss    STATUS,C
1C88 EF41 F00E 05774          goto     next
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 125


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05775          
1C8C 2AEA      05776          incf     FSR0H,f
1C8E 0E02      05777          movlw    b'00000010' ;02 banki
1C90 18EA      05778          xorwf    FSR0H,w
1C92 A4D8      05779          BTFSS    STATUS,Z
               05780          ;btfss    FSR0H,4
1C94 EF41 F00E 05781          goto     next
               05782          
1C98 EF81 F00E 05783          goto     test_koniec
               05784 ;w przyadku testowania
               05785 
1C9C 0E00      05786          movlw    dane_odebraneL
1C9E 6EE9      05787          movwf    FSR0L
1CA0 0E01      05788          movlw    dane_odebraneH
1CA2 6EEA      05789          movwf    FSR0H
               05790          
               05791         
1CA4 0E1C      05792         movlw      HIGH(tab_test)
1CA6 6EFA      05793         movwf     PCLATH
1CA8 05794 test_petla        
               05795          
               05796          
               05797         
               05798         ;movf      PCLATH,w,0
1CA8 5191      05799          movf     tmp,w
1CAA EC61 F00E 05800          call     tab_test
               05801          
               05802          
               05803          
1CAE 6EEF      05804          movwf    INDF0
1CB0 0A00      05805          xorlw    0
1CB2 B4D8      05806          btfsc    STATUS,Z
1CB4 EF69 F00E 05807          goto     test_regulator
1CB8 2B91      05808          incf     tmp,f
1CBA 2B91      05809          incf     tmp,f
1CBC 2AE9      05810          incf     FSR0L,f
1CBE EF54 F00E 05811          goto     test_petla
               05812          
               05813          
1CC2 05814 tab_test
1CC2 26F9      05815          addwf    PCL,f
               05816          ;retlw    0x2a
               05817          
               05818          ;retlw    0x43
               05819          ;retlw    0x46
               05820          ;retlw    0x0d
1CC4 0C2A      05821          retlw    _star
               05822          ;retlw    _wiekszosci
               05823          ;retlw    _P     
1CC6 0C70      05824          retlw    _p
               05825          ;retlw    _1
               05826          
1CC8 0C30      05827          retlw    0x30
               05828          ;retlw    _
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 126


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05829          
               05830          ;retlw    _F
               05831          ;retlw    _
               05832          ;retlw    _F
1CCA 0C32      05833          retlw    0x32
               05834          ;retlw    _kropka
1CCC 0C30      05835          retlw    0x30
1CCE 0C36      05836          retlw    0x36
               05837          ;retlw    _e
               05838          ;retlw    0x34
               05839          ;retlw    0x30
               05840          ;retlw    _A
               05841          ;retlw    0x30
               05842          ;retlw    0x37
1CD0 0C00      05843          retlw    0
               05844          
               05845          
1CD2 05846 test_regulator
               05847       ;bsf      markers2,sprawdz_odebrane
               05848          ;goto     test_koniec
               05849          
1CD2 0E01      05850          movlw    1
1CD4 6FA5      05851          movwf    ile_kanalow
               05852          
1CD6 0E00      05853          movlw    0
1CD8 6FA6      05854          movwf    ktory_kanal_mierze
               05855          
               05856          ;movwf     ktore_dzielenie_przez2
               05857          
1CDA 0E01      05858          movlw    0x01
1CDC 6FAF      05859          movwf    jak_duzo_probek
               05860          
1CDE 0E04      05861          movlw    0x04
1CE0 6FA7      05862          movwf    odstep_pomiarowy
1CE2 0E04      05863          movlw    0x04
1CE4 6FA8      05864         movwf    aktualny_odstep
               05865          
               05866          
1CE6 819F      05867          bsf       markers,czy_usrednianie
1CE8 85A0      05868          bsf      markers2,pomiary
1CEA 859F      05869          bsf      markers,pomiary_zrobione
1CEC 8B9F      05870          bsf      markers,czy_wyswietlam_temp
               05871          ;
1CEE 0E01      05872          movlw    0x01
1CF0 6EC2      05873          movwf    ADCON0   
               05874                
1CF2 0E0F      05875          movlw    0xf
1CF4 6F8D      05876          movwf    odebrano_liter
1CF6 0EFF      05877          movlw    0xff
1CF8 6F86      05878          movwf    linia1
1CFA 0EF0      05879          movlw    0xf0
1CFC 6F87      05880          movwf    linia2
1CFE 0E11      05881          movlw    0x11
1D00 6F9E      05882          movwf    znaczniki
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 127


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               05883          
               05884          
               05885          
               05886          
1D02 05887 test_koniec
               05888          
               05889          ;bcf      PCLATH,3
               05890          ;bcf      PCLATH,4
1D02 6AFA      05891          clrf     PCLATH
1D04 EF9C F001 05892          goto    Start
               05893                   
               05894 ;test ustawiania probkowania
               05895 ;0x2a 0x93 probka         
               05896 
               05897 
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 128


SYMBOL TABLE
  LABEL                             VALUE 

A                                 00000000
ACCESS                            00000000
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACQT0                             00000003
ACQT1                             00000004
ACQT2                             00000005
ADCON0                            00000FC2
ADCON1                            00000FC1
ADCON2                            00000FC0
ADCS0                             00000000
ADCS1                             00000001
ADCS2                             00000002
ADDEN                             00000003
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADIP                              00000006
ADON                              00000000
ADRESH                            00000FC4
ADRESL                            00000FC3
AN0                               00000000
AN1                               00000001
AN10                              00000001
AN11                              00000004
AN12                              00000000
AN2                               00000002
AN3                               00000003
AN4                               00000005
AN5                               00000000
AN6                               00000001
AN7                               00000002
AN8                               00000002
AN9                               00000003
BANKED                            00000001
BCLIE                             00000003
BCLIF                             00000003
BCLIP                             00000003
BEGIN                             00000000
BEGIN2lcd_init                    00001C5A
BF                                00000000
BOR                               00000000
BRGH                              00000002
BSR                               00000FE0
C                                 00000000
C1INV                             00000004
C1OUT                             00000006
C2INV                             00000005
C2OUT                             00000007
CCP1                              00000002
CCP1CON                           00000FBD
CCP1IE                            00000002
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 129


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
CCP1IF                            00000002
CCP1IP                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP2                              00000001
CCP2A                             00000003
CCP2CON                           00000FBA
CCP2IE                            00000000
CCP2IF                            00000000
CCP2IP                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCPR1H                            00000FBF
CCPR1L                            00000FBE
CCPR2H                            00000FBC
CCPR2L                            00000FBB
CCP_init                          00001C4E
CFGS                              00000006
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CIS                               00000003
CK                                00000006
CKE                               00000006
CKP                               00000004
CLKI                              00000007
CLKO                              00000006
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON                             00000FB4
CMIE                              00000006
CMIF                              00000006
CMIP                              00000006
CREN                              00000004
CS                                00000002
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
CVRCON                            00000FB5
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
D                                 00000005
DATA_ADDRESS                      00000005
DC                                00000001
DC1B0                             00000004
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 130


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DONE                              00000001
D_A                               00000005
ECCPAS                            00000FB6
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             00000FA9
EECON1                            00000FA6
EECON2                            00000FA7
EEDATA                            00000FA8
EEIE                              00000004
EEIF                              00000004
EEIP                              00000004
EEPGD                             00000007
FAST                              00000001
FERR                              00000002
FLTS                              00000002
FREE                              00000004
FSR0                              00000000
FSR0H                             00000FEA
FSR0L                             00000FE9
FSR1                              00000001
FSR1H                             00000FE2
FSR1L                             00000FE1
FSR2                              00000002
FSR2H                             00000FDA
FSR2L                             00000FD9
GCEN                              00000007
GIE                               00000007
GIEH                              00000007
GIEL                              00000006
GO                                00000001
GO_DONE                           00000001
I2C_DAT                           00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IBF                               00000007
IBOV                              00000005
IDLEN                             00000007
INDF0                             00000FEF
INDF1                             00000FE7
INDF2                             00000FDF
INT0                              00000000
INT0IE                            00000004
INT0IF                            00000001
INT1                              00000001
INT1IE                            00000003
INT1IF                            00000000
INT1IP                            00000006
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 131


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
INT2                              00000002
INT2IE                            00000004
INT2IF                            00000001
INT2IP                            00000007
INTCON                            00000FF2
INTCON2                           00000FF1
INTCON3                           00000FF0
INTEDG0                           00000006
INTEDG1                           00000005
INTEDG2                           00000004
IOFS                              00000002
IPEN                              00000007
IPR1                              00000F9F
IPR2                              00000FA2
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRVST                             00000005
LATA                              00000F89
LATB                              00000F8A
LATC                              00000F8B
LATD                              00000F8C
LATE                              00000F8D
LOOP                              00001BAC
LOOP1                             00001C06
LOOP11                            00001BE2
LOOP2                             00001C12
LOOP_sprawdz_keys                 00001BCA
LOOP_temperatury                  00001BE8
LVDCON                            00000FD2
LVDEN                             00000004
LVDIE                             00000002
LVDIF                             00000002
LVDIN                             00000005
LVDIP                             00000002
LVDL0                             00000000
LVDL1                             00000001
LVDL2                             00000002
LVDL3                             00000003
MCLR                              00000003
N                                 00000004
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BOR                           00000000
NOT_DONE                          00000001
NOT_PD                            00000002
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RI                            00000004
NOT_T1SYNC                        00000002
NOT_T3SYNC                        00000002
NOT_TO                            00000003
NOT_W                             00000002
NOT_WRITE                         00000002
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 132


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
OBF                               00000006
OERR                              00000001
OSC1                              00000007
OSC2                              00000006
OSCCON                            00000FD3
OSCFIE                            00000007
OSCFIF                            00000007
OSCFIP                            00000007
OSCTUNE                           00000F9B
OSTS                              00000003
OV                                00000003
P                                 00000004
P1A                               00000002
P1B                               00000005
P1C                               00000006
P1D                               00000007
P1M0                              00000006
P1M1                              00000007
PCFG0                             00000000
PCFG1                             00000001
PCFG2                             00000002
PCFG3                             00000003
PCL                               00000FF9
PCLATH                            00000FFA
PCLATU                            00000FFB
PD                                00000002
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PEN                               00000002
PIE1                              00000F9D
PIE2                              00000FA0
PIN_HI                            0000077E
PIN_LO                            00000782
PIR1                              00000F9E
PIR2                              00000FA1
PLUSW0                            00000FEB
PLUSW1                            00000FE3
PLUSW2                            00000FDB
POR                               00000001
PORTA                             00000F80
PORTB                             00000F81
PORTC                             00000F82
PORTD                             00000F83
PORTE                             00000F84
POSTDEC0                          00000FED
POSTDEC1                          00000FE5
POSTDEC2                          00000FDD
POSTINC0                          00000FEE
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 133


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
POSTINC1                          00000FE6
POSTINC2                          00000FDE
PR2                               00000FCB
PREINC0                           00000FEC
PREINC1                           00000FE4
PREINC2                           00000FDC
PRODH                             00000FF4
PRODL                             00000FF3
PRSEN                             00000007
PSA                               00000003
PSP0                              00000000
PSP1                              00000001
PSP2                              00000002
PSP3                              00000003
PSP4                              00000004
PSP5                              00000005
PSP6                              00000006
PSP7                              00000007
PSPIE                             00000007
PSPIF                             00000007
PSPIP                             00000007
PSPMODE                           00000004
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PWM1CON                           00000FB7
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RBIP                              00000000
RBPU                              00000007
RC0                               00000000
RC1                               00000001
RC2                               00000002
RC3                               00000003
RC4                               00000004
RC5                               00000005
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 134


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
RC6                               00000006
RC7                               00000007
RCEN                              00000003
RCIE                              00000005
RCIF                              00000005
RCIP                              00000005
RCON                              00000FD0
RCREG                             00000FAE
RCSTA                             00000FAB
RD                                00000000
RD0                               00000000
RD1                               00000001
RD16                              00000007
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RE0                               00000000
RE1                               00000001
RE2                               00000002
RE3                               00000003
READ_WRITE                        00000002
RI                                00000004
RSEN                              00000001
RX                                00000007
RX9                               00000006
RX9D                              00000000
RXD                               00000007
R_W                               00000002
S                                 00000003
SCK                               00000003
SCL                               00000003
SCS0                              00000000
SCS1                              00000001
SDA                               00000004
SDI                               00000004
SDO                               00000005
SEN                               00000000
SMP                               00000007
SPBRG                             00000FAF
SPEN                              00000007
SREN                              00000005
SS                                00000005
SSPADD                            00000FC8
SSPBUF                            00000FC9
SSPCON1                           00000FC6
SSPCON2                           00000FC5
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPIP                             00000003
SSPM0                             00000000
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 135


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000FC7
STATUS                            00000FD8
STKFUL                            00000007
STKPTR                            00000FFC
STKUNF                            00000006
SWDTEN                            00000000
SYNC                              00000004
Start                             00000338
T08BIT                            00000006
T0CKI                             00000004
T0CON                             00000FD5
T0CS                              00000005
T0IP                              00000002
T0PS0                             00000000
T0PS1                             00000001
T0PS2                             00000002
T0SE                              00000004
T1CKI                             00000000
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000FCD
T1OSCEN                           00000003
T1OSI                             00000001
T1OSO                             00000000
T1RUN                             00000006
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000FCA
T3CCP1                            00000003
T3CCP2                            00000006
T3CKPS0                           00000004
T3CKPS1                           00000005
T3CON                             00000FB1
T3SYNC                            00000002
TABLAT                            00000FF5
TBLPTRH                           00000FF7
TBLPTRL                           00000FF6
TBLPTRU                           00000FF8
TMR0H                             00000FD7
TMR0IE                            00000005
TMR0IF                            00000002
TMR0IP                            00000002
TMR0L                             00000FD6
TMR0ON                            00000007
TMR1CS                            00000001
TMR1H                             00000FCF
TMR1IE                            00000000
TMR1IF                            00000000
TMR1IP                            00000000
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 136


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TMR1L                             00000FCE
TMR1ON                            00000000
TMR2                              00000FCC
TMR2IE                            00000001
TMR2IF                            00000001
TMR2IP                            00000001
TMR2ON                            00000002
TMR3CS                            00000001
TMR3H                             00000FB3
TMR3IE                            00000001
TMR3IF                            00000001
TMR3IP                            00000001
TMR3L                             00000FB2
TMR3ON                            00000000
TMR_nie_pusty                     00000556
TO                                00000003
TOSH                              00000FFE
TOSL                              00000FFD
TOSU                              00000FFF
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000F92
TRISB                             00000F93
TRISC                             00000F94
TRISD                             00000F95
TRISE                             00000F96
TRMT                              00000001
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
TX                                00000006
TX9                               00000006
TX9D                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXIP                              00000004
TXREG                             00000FAD
TXREG_nie_pusty                   0000055C
TXSTA                             00000FAC
Tab_zle_polecenie                 00000676
Timer3_init                       00001C56
UA                                00000001
VCFG0                             00000004
VCFG1                             00000005
VREFM                             00000002
VREFP                             00000003
W                                 00000000
WCOL                              00000007
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 137


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
WDTCON                            00000FD1
WR                                00000001
WREG                              00000FE8
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_0                                00000030
_1                                00000031
_2                                00000032
_3                                00000033
_4                                00000034
_5                                00000035
_6                                00000036
_7                                00000037
_8                                00000038
_9                                00000039
_A                                00000041
_B                                00000042
_BORV_20_2L                       000000FF
_BORV_27_2L                       000000FB
_BORV_42_2L                       000000F7
_BORV_45_2L                       000000F3
_BOR_OFF_2L                       000000FD
_BOR_ON_2L                        000000FF
_C                                00000043
_CCP2MX_B3_3H                     000000FE
_CCP2MX_C1_3H                     000000FF
_CCP2MX_OFF_3H                    000000FE
_CCP2MX_ON_3H                     000000FF
_CONFIG1H                         00300001
_CONFIG2H                         00300003
_CONFIG2L                         00300002
_CONFIG3H                         00300005
_CONFIG4L                         00300006
_CONFIG5H                         00300009
_CONFIG5L                         00300008
_CONFIG6H                         0030000B
_CONFIG6L                         0030000A
_CONFIG7H                         0030000D
_CONFIG7L                         0030000C
_CP0_OFF_5L                       000000FF
_CP0_ON_5L                        000000FE
_CP1_OFF_5L                       000000FF
_CP1_ON_5L                        000000FD
_CP2_OFF_5L                       000000FF
_CP2_ON_5L                        000000FB
_CP3_OFF_5L                       000000FF
_CP3_ON_5L                        000000F7
_CPB_OFF_5H                       000000FF
_CPB_ON_5H                        000000BF
_CPD_OFF_5H                       000000FF
_CPD_ON_5H                        0000007F
_D                                00000044
_DEBUG_OFF_4L                     000000FF
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 138


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_DEBUG_ON_4L                      0000007F
_DEVID1                           003FFFFE
_DEVID2                           003FFFFF
_E                                00000045
_EBTR0_OFF_7L                     000000FF
_EBTR0_ON_7L                      000000FE
_EBTR1_OFF_7L                     000000FF
_EBTR1_ON_7L                      000000FD
_EBTR2_OFF_7L                     000000FF
_EBTR2_ON_7L                      000000FB
_EBTR3_OFF_7L                     000000FF
_EBTR3_ON_7L                      000000F7
_EBTRB_OFF_7H                     000000FF
_EBTRB_ON_7H                      000000BF
_ECIO_OSC_1H                      000000F5
_EC_OSC_1H                        000000F4
_F                                00000046
_FSCM_OFF_1H                      000000BF
_FSCM_ON_1H                       000000FF
_G                                00000047
_H                                00000048
_HSPLL_OSC_1H                     000000F6
_HS_OSC_1H                        000000F2
_I                                00000049
_IDLOC0                           00200000
_IDLOC1                           00200001
_IDLOC2                           00200002
_IDLOC3                           00200003
_IDLOC4                           00200004
_IDLOC5                           00200005
_IDLOC6                           00200006
_IDLOC7                           00200007
_IESO_OFF_1H                      0000007F
_IESO_ON_1H                       000000FF
_INTIO1_OSC_1H                    000000F9
_INTIO2_OSC_1H                    000000F8
_J                                0000004A
_K                                0000004B
_L                                0000004C
_LP_OSC_1H                        000000F0
_LVP_OFF_4L                       000000FB
_LVP_ON_4L                        000000FF
_M                                0000004D
_MCLRE_OFF_3H                     0000007F
_MCLRE_ON_3H                      000000FF
_N                                0000004E
_O                                0000004F
_P                                00000050
_PBAD_ANA_3H                      000000FF
_PBAD_DIG_3H                      000000FD
_PWRT_OFF_2L                      000000FF
_PWRT_ON_2L                       000000FE
_Q                                00000051
_R                                00000052
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 139


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_RCIO_OSC_1H                      000000F7
_RC_OSC_1H                        000000FF
_S                                00000053
_STVR_OFF_4L                      000000FE
_STVR_ON_4L                       000000FF
_T                                00000054
_U                                00000055
_V                                00000056
_W                                00000057
_WDTPS_128_2H                     000000EF
_WDTPS_16K_2H                     000000FD
_WDTPS_16_2H                      000000E9
_WDTPS_1K_2H                      000000F5
_WDTPS_1_2H                       000000E1
_WDTPS_256_2H                     000000F1
_WDTPS_2K_2H                      000000F7
_WDTPS_2_2H                       000000E3
_WDTPS_32K_2H                     000000FF
_WDTPS_32_2H                      000000EB
_WDTPS_4K_2H                      000000F9
_WDTPS_4_2H                       000000E5
_WDTPS_512_2H                     000000F3
_WDTPS_64_2H                      000000ED
_WDTPS_8K_2H                      000000FB
_WDTPS_8_2H                       000000E7
_WDT_OFF_2H                       000000FE
_WDT_ON_2H                        000000FF
_WRT0_OFF_6L                      000000FF
_WRT0_ON_6L                       000000FE
_WRT1_OFF_6L                      000000FF
_WRT1_ON_6L                       000000FD
_WRT2_OFF_6L                      000000FF
_WRT2_ON_6L                       000000FB
_WRT3_OFF_6L                      000000FF
_WRT3_ON_6L                       000000F7
_WRTB_OFF_6H                      000000FF
_WRTB_ON_6H                       000000BF
_WRTC_OFF_6H                      000000FF
_WRTC_ON_6H                       000000DF
_WRTD_OFF_6H                      000000FF
_WRTD_ON_6H                       0000007F
_X                                00000058
_XT_OSC_1H                        000000F1
_Y                                00000059
_Z                                0000005A
__18F4320                         00000001
_a                                00000061
_b                                00000062
_c                                00000063
_d                                00000064
_dwukropek                        0000003A
_e                                00000065
_f                                00000066
_g                                00000067
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 140


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_h                                00000068
_i                                00000069
_j                                0000006A
_k                                0000006B
_kropka                           0000002E
_l                                0000006C
_linia_pionowa                    0000007C
_m                                0000006D
_minus                            0000002D
_mniejszosci                      0000003C
_n                                0000006E
_o                                0000006F
_p                                00000070
_plus                             0000002B
_przecinek                        0000002C
_puste                            00000020
_q                                00000071
_r                                00000072
_s                                00000073
_star                             0000002A
_stopni                           000000DF
_t                                00000074
_u                                00000075
_up                               0000005E
_v                                00000076
_w                                00000077
_wiekszosci                       0000003E
_x                                00000078
_y                                00000079
_z                                0000007A
aktualny_odstep                   000000A8
bajt_ds                           000000CA
bez_wlaczania_pomiarow            000004F6
bez_wyswietlania_pradu            00000D46
bez_wyswietlania_pradu2           00000D82
bez_wyswietlania_temp1            00000C78
bez_wyswietlania_temp2            00000D02
bit                               0000008C
blad_inicjacji_ds                 000007E4
bsr_temp                          00000083
check                             00000272
check_busy                        00000264
check_if_write                    00000316
clear_line                        00000246
clear_line_old                    00000218
clear_line_old2                   0000022C
clear_line_petla                  0000024C
cmd_off                           00000214
cyfry_0_9                         0000060A
czekam_na_kolejny_bit             000008BC
czujnik_ds1820                    00000005
czy_ekran                         00000001
czy_moge_juz_zmieniac             00000002
czy_pomiary_na_ekran              00000001
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 141


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
czy_ponownie_wlaczyc_temp         00000000
czy_ponownie_wlaczyc_zegar        00000001
czy_usrednianie                   00000000
czy_wlaczyc_ponownie_temp         00000006
czy_wyswietlam_temp               00000005
czy_wysylac_pomiary_serial        00000004
czy_wysylanie                     00000001
czy_zegar_wyswietlac              00000002
czytaj_eeprom                     0000030C
czytam_4_linie                    0000164E
czytam_4_linie2                   0000165A
czytam_4_linie3                   0000166C
czytam_druga_linie                00001612
czytam_druga_linie2               0000161E
czytam_pierwsza_linie             00001600
czytam_trzecia_linie              00001630
czytam_trzecia_linie2             0000163C
dana                              00000003
dane_lcd                          000000A2
dane_odebraneH                    00000001
dane_odebraneL                    00000000
dd_addres_set                     00000080
dec1                              00000098
dec10                             00000097
dec100                            00000096
disp_home                         00000002
display1_4b                       00000000
display2_4b                       0000000F
display_2                         0000000F
display_clear                     00000001
display_clear1_4b                 00000000
display_clear2_4b                 00000001
display_off                       00000008
display_on                        0000000C
dlugosc_oczekiwania_na_zmiane     00000004
do_sekundy                        000000DF
dzialanie_po_klawiszu             00000005
dzien_1                           000000D8
dzien_10                          000000D7
enable                            00000003
enter_back_wyjsc_z_opcji_czujniki  00001960
enter_back_wyjsc_z_opcji_wyswietlanie_liczby  000019D8
entry                             00000006
entry1_4b                         00000000
entry2_4b                         0000000C
fsrh1_temp                        000000E5
fsrh_temp                         00000085
fsrl1_temp                        000000E4
fsrl_temp                         00000084
function_set1_4b                  00000003
function_set2                     00000008
function_set2_4b                  00000008
godziny_1                         000000DA
godziny_10                        000000D9
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 142


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
hex2_dec_koniec                   00000440
hex2dec18                         000003DC
hex2dec18_brak_setek              00000412
hex2dec18_nie_przekroczono_1      00000400
hex2dec_temperatur_popraw_o_128   00000430
hex2dec_temperatur_popraw_o_64    00000424
histereza1                        000000E6
histereza2                        000000E7
ile_kanalow                       000000A5
ile_znakow                        00000010
ilosc_czujnikow                   00000007
inicjacja                         00001C16
inicjacja_ds1820                  000007B6
inicjacja_ok                      0000080C
inicjuj_pomiar                    00000696
inicjuj_pomiary                   00000003
init_4bit                         0000002A
init_8bit                         00000030
jak_duzo_bajtow_odbieram_z_ds     000000B5
jak_duzo_kanalow_pradu            000000D5
jak_duzo_probek                   000000AF
jak_duzo_zliczen_tmr1_na_sekunde  00000010
jaka_wartosc_regulujeH            000000AD
jaka_wartosc_regulujeL            000000AE
juz_wysylac_znak_LF               00000EAC
kalibracja                        00000000
kb_change                         00000004
kb_cofnij                         00000005
kb_enter                          00000006
kb_minus                          00000007
koncz_z_moca                      00000E32
koniec_mierzenia                  00000E36
koniec_pomiarow                   00000EBC
koniec_wyswietlania               00000AB0
kopiuj_liczbe_przeslana           000005E2
ktora_probka                      000000B0
ktore_bity_lcd_tris               000000F0
ktore_bity_uzywane_na_lcd         0000000F
ktory_aktualnie_kanal_pradu       000000D6
ktory_czujnik_reguluje            000000E9
ktory_kanal                       000000B1
ktory_kanal_mierze                000000A6
ktory_rejestr_zapisuje            000000A9
lampka                            00000004
lampka2                           00000004
latch_back                        00000000
latch_down                        00000001
latch_enter                       00000003
latch_keys                        00000F83
latch_lcd                         00000F8C
latch_lcd_e                       00000F8B
latch_lcd_rs                      00000F8A
latch_lcd_rw                      00000F8A
latch_moc                         00000F8A
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 143


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
latch_multiplekser                00000F8B
latch_up                          00000002
lcd_init                          00000298
letter                            0000008A
liczba1                           0000008E
liczba2                           0000008F
liczba3                           00000090
linia1                            00000086
linia2                            00000087
linia3                            00000088
linia4                            00000089
linia_czwarta                     000000D0
linia_dolna                       000000C0
linia_druga                       000000C0
linia_gorna                       00000080
linia_pierwsza                    00000080
linia_trzecia                     00000090
ma                                00000002
mamy_back                         00000000
mamy_down                         00000001
mamy_enter                        00000003
mamy_up                           00000002
markers                           0000009F
markers2                          000000A0
markers3                          000000A1
mb                                00000001
mc                                00000000
menu_opcje1                       00000000
menu_opcje2                       00000001
menu_opcje3                       00000002
menu_opcje4                       00000003
menu_opcje_end                    00000004
minuty_1                          000000DC
minuty_10                         000000DB
n                                 0000008B
napisz_czas                       00000442
napisz_minus                      00000006
napisz_wartosc_temperatury        00000CD6
next                              00001C82
nie                               00000001
nie_czysc_rejestru_polozenia      00000C8A
nie_przekroczono_bajtu_ulamka     00000BEA
normalne_ustawienie_tris_lcd      0000000F
numer_opcji                       000000E1
numer_opcji_koncowej              00000010
odczytaj_adres_polozenia_gwiazdki  0000190A
odebrano_liter                    0000008D
odejmij_512_od_wyniku_sredniej    00000B9E
odstep_pomiarowy                  000000A7
odswiezanie_zegara                00000003
odznacz_by_znow_mierzyc           000004BC
opcja_czujnik_regulacji           0000000B
opcja_czujniki                    00000001
opcja_histereza1                  00000009
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 144


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
opcja_histereza2                  0000000A
opcja_odstep                      00000002
opcja_podswietlenie               0000000F
opcja_pomiar_i                    00000006
opcja_regulacja                   00000004
opcja_srednia                     00000003
opcja_ustaw_serial                0000000C
opcja_ustaw_temp                  00000005
opcja_ustaw_zegar                 00000010
opcja_wlacz_1                     00000007
opcja_wlacz_2                     00000008
opcja_wyswietl_temp               0000000E
opcja_wyswietl_zegar              0000000D
pclath_temp                       00000082
petla_czy_jest_0                  00000896
petla_dzielenia                   00000BB8
petla_inicjacji1                  000007CC
petla_inicjacji2                  000007D8
petla_inicjacji3                  00000800
petla_napisz_czas                 00000482
petla_napisz_czas_dwukropek       00000478
petla_odbioru_ds1820              0000088C
petla_odczytu_poprawek_z_eeprom   00000344
petla_send0                       000007AA
petla_send1                       00000796
petla_sending                     0000085A
petla_wysylania_odebranych_bajtow  000008DA
pin_A                             00000000
pin_B                             00000001
pin_C                             00000002
pin_e_4724                        00000001
pisz_cyfre_1                      00000B20
pisz_cyfre_10                     00000B14
pisz_cyfre_100                    00000B08
pisz_ulamek_00                    00000B46
pisz_ulamek_25                    00000B5C
pisz_ulamek_50                    00000B72
pisz_ulamek_75                    00000B88
pokaz_rejestr                     0000061C
pokazuje_temperatury_47           00000007
polecenie_wysylane                000000B4
polozenie_danych_lcd              00000001
polozenie_gwiazdki                000000E2
polozenie_liczby_menu             0000000C
pomiar0H                          000000B6
pomiar0L                          000000B7
pomiar1H                          000000B8
pomiar1L                          000000B9
pomiar2H                          000000BA
pomiar2L                          000000BB
pomiar3H                          000000BC
pomiar3L                          000000BD
pomiar4H                          000000BE
pomiar4L                          000000BF
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 145


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
pomiar5H                          000000C0
pomiar5L                          000000C1
pomiar6H                          000000C2
pomiar6L                          000000C3
pomiar7H                          000000C4
pomiar7L                          000000C5
pomiarH                           000000AA
pomiarL                           000000AB
pomiar_prad1                      00000002
pomiar_prad1H                     000000C6
pomiar_prad1L                     000000C7
pomiar_prad2                      00000004
pomiar_prad2H                     000000C8
pomiar_prad2L                     000000C9
pomiar_ulamek                     000000AC
pomiary                           00000002
pomiary_pradu                     00000000
pomiary_zrobione                  00000002
poprawka0                         000000CB
poprawka0_ee                      00000000
poprawka1                         000000CC
poprawka1_ee                      00000001
poprawka2                         000000CD
poprawka2_ee                      00000002
poprawka3                         000000CE
poprawka3_ee                      00000003
poprawka4                         000000CF
poprawka4_ee                      00000004
poprawka5                         000000D0
poprawka5_ee                      00000005
poprawka6                         000000D1
poprawka6_ee                      00000006
poprawka7                         000000D2
poprawka7_ee                      00000007
poprawka_prad1                    000000D3
poprawka_prad1_ee                 00000008
poprawka_prad2                    000000D4
poprawka_prad2_ee                 00000009
port_CTS                          00000F82
port_RTS                          00000F82
port_ds1820                       00000F82
port_keys                         00000F83
port_lcd                          00000F83
port_lcd_e                        00000F82
port_lcd_rs                       00000F81
port_lcd_rw                       00000F81
port_multiplekser                 00000F82
port_serial                       00000F81
port_triak                        00000F81
portlampka2                       00000F81
powrot_z_polecen                  00000A52
pozycja_menu                      000000E0
procedura_obslugi_zegara          000004F6
procedura_regulacji_dwustawnej    00000D86
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 146


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
procedura_sumowania_wyniku        00000BD8
procedura_wyswietlania_kolejnych_liczb_zegara  0000197A
procedura_wyswietlania_kolejnych_liczb_zegara_1  00001996
procedura_wyswietlania_kolejnych_liczb_zegara_2  000019A0
procedura_wyswietlania_kolejnych_liczb_zegara_3  000019AE
procedura_wyswietlania_kolejnych_liczb_zegara_4  000019B0
procek                            018F4320
przerwanie                        00000008
przerwanie_1                      0000002E
przerwanie_2                      0000003A
przerwanie_3                      00000046
przerwanie_4                      00000052
przerwanie_5                      0000005E
przerwanie_6                      00000064
przerwanie_7                      00000070
przerwanie_pomiaru                0000018A
przerwanie_t0                     00000000
przerwanie_t1                     00000001
przerwanie_wysylania              00000176
rcsta_temp                        000000A4
regulacja_dwu_moc_OFF             00000DB8
regulacja_dwu_moc_ON              00000DD0
regulacja_dwu_moc_ON_wylacz       00000DE2
reguluj                           00000006
rozkaz_rejestracji_poprawki_pomiaru_temperatury  00000970
rozkaz_wysylania_znaku_na_lcd     00000766
rozkazy_ds1820                    0000092A
rozpocznij_pomiary                000004CE
rs                                00000003
rw                                00000002
sa_rowne_nic_nie_rob              00000DE8
sa_rowne_sprawdz_Lbajt            00000DB2
sekundy_1                         000000DE
sekundy_10                        000000DD
send                              000001E8
send4bit_petla                    000001EE
send_0                            0000079E
send_1                            00000788
set_4bit                          00000028
set_8bit                          0000003C
sprawdz_10                        00000AC0
sprawdz_RTS_prad                  00000E3C
sprawdz_czy_ds1820_wysyla         00000884
sprawdz_czy_mam_dalej_mierzyc     00000DF0
sprawdz_czy_mam_dalej_mierzyc_prad  00000E02
sprawdz_czy_mam_wyswietlac_47     00000CA4
sprawdz_czy_mozna_wysylac         00000556
sprawdz_czy_odebrano_litere       000005AA
sprawdz_czy_odebrano_mala_litere  000005CA
sprawdz_czy_polecenie             000009BC
sprawdz_czy_wchodze_do_zmiany_opcji  000016BA
sprawdz_czy_wlaczyc_szybka_zmiane  00000F56
sprawdz_czy_wlaczyc_szybka_zmiane2  00000F62
sprawdz_czy_wlaczyc_szybka_zmiane3  00000F6E
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 147


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
sprawdz_dzien                     000000E2
sprawdz_godziny                   000000FC
sprawdz_ktore_polecenie           000009CE
sprawdz_odebrane                  00000003
sprawdz_zwiekszanie_godzin_normalnie  00001536
stan2_key                         0000009A
stan_key                          00000099
status_temp                       00000081
sumuj_liczby                      00000506
sumuj_liczby_do_kropki            0000050A
szybka_zmiana_wartosci            000000E3
tab_test                          00001CC2
tablica_czwarta                   00001B6E
tablica_druga                     00001B22
tablica_gwiazdki                  00001BA6
tablica_pierwsza                  00001B00
tablica_trzecia                   00001B42
test_koniec                       00001D02
test_petla                        00001CA8
test_regulator                    00001CD2
tmp                               00000091
tmp6                              00000094
tmp7                              00000095
tmp_hex                           00000092
tmp_hex_H                         00000093
tmp_lcd                           000000A3
triak1                            00000000
triak2                            00000001
tris_lcd                          00000F95
trzymanie_klawisza                00000007
usrednianie_przez_co_mnoze        000000B2
usrednianie_wartosci              00000BB4
ustaw_linie_druga                 00000CC6
ustaw_linie_trzecia               00000CB6
ustaw_probki                      00000740
ustaw_regulator                   00000702
ustaw_spbrg                       00000610
ustaw_sprawdzanie_szybkiej_zmiany  00000F72
ustaw_wartosc_dzielenia_usredniania  00000720
ustaw_wyswietlanie_czasu_na_lcd   00000108
ustawianie_czasu_co_wyswietlam    000000E8
ustawienie_liczby_odbieranych_bajtow  0000090A
ustawienie_liczby_odbieranych_bajtow_zero  00000922
w_temp                            00000080
wait                              000001DA
wait_petla                        000001DC
wcisnieto_back                    00000F18
wcisnieto_down                    00000F26
wcisnieto_enter                   00000F7C
wcisnieto_klawisz                 00000004
wcisnieto_up                      00000F3E
wlacz_przerwanie_tmr3             00000F0C
wlaczenie_rejestracji_pradu       0000094E
write                             00000040
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 148


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
write_4bit                        00000010
write_lcd                         0000020A
wybor_czujnika_regulatora         000009A0
wybrano_czujnik_regulatora_wiekszy_od_7  000009B4
wyjscie_przerwanie                00000070
wykonano_pomiary_wszystkich_kanalow  00000E16
wykryto_back                      00000F8A
wykryto_back_exit                 00000FA8
wykryto_back_nic_nie_rob          00000FA8
wykryto_blad                      00000184
wykryto_down                      00000FB0
wykryto_down_3_wyswietl           00001114
wykryto_down_exit                 0000129C
wykryto_down_exit_trzymanie       000012AA
wykryto_down_sprawdz12            0000126C
wykryto_down_sprawdz16            0000126C
wykryto_down_sprawdz16_nie_ma_zero  00001284
wykryto_down_sprawdz16_show       00001286
wykryto_down_sprawdz17            0000129C
wykryto_down_sprawdz_10           0000117A
wykryto_down_sprawdz_11           0000119A
wykryto_down_sprawdz_11_1         000011D4
wykryto_down_sprawdz_11_2         00001208
wykryto_down_sprawdz_11_3         0000123C
wykryto_down_sprawdz_11_4         00001264
wykryto_down_sprawdz_2            000010D0
wykryto_down_sprawdz_3            000010F0
wykryto_down_sprawdz_3_zmniejsz_probki  00001108
wykryto_down_sprawdz_4            00001132
wykryto_down_sprawdz_5            00001132
wykryto_down_sprawdz_5_zawracanie  0000114E
wykryto_down_sprawdz_5_zero       00001152
wykryto_down_sprawdz_6            0000115A
wykryto_down_sprawdz_9            0000115A
wykryto_down_sprawdz_czy_wyswietlam_kolejne_opcje  00000FCE
wykryto_down_wyswietl_opcje_tablicy_cztery  0000105A
wykryto_down_wyswietl_opcje_tablicy_druga  0000103A
wykryto_down_wyswietl_opcje_tablicy_trzy  0000104A
wykryto_down_zmiana_opcji         0000109E
wykryto_down_zmiana_opcji_wyswietl_kanaly  000010B4
wykryto_down_zmiana_polozenia_gwiazdki  0000106A
wykryto_enter                     0000166E
wykryto_enter_exit                00001902
wykryto_enter_gdzie_wyswietlam_liczbe_bajtowa  00001920
wykryto_enter_sprawdz_opcje10     000017C4
wykryto_enter_sprawdz_opcje11     000017E4
wykryto_enter_sprawdz_opcje12     000017FA
wykryto_enter_sprawdz_opcje13     00001808
wykryto_enter_sprawdz_opcje14     00001816
wykryto_enter_sprawdz_opcje15     00001824
wykryto_enter_sprawdz_opcje16     00001832
wykryto_enter_sprawdz_opcje17     00001852
wykryto_enter_sprawdz_opcje2      000016E0
wykryto_enter_sprawdz_opcje3      00001700
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 149


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
wykryto_enter_sprawdz_opcje4      00001720
wykryto_enter_sprawdz_opcje5      0000172E
wykryto_enter_sprawdz_opcje6      00001774
wykryto_enter_sprawdz_opcje7      00001788
wykryto_enter_sprawdz_opcje8      00001796
wykryto_enter_sprawdz_opcje9      000017A4
wykryto_enter_wyjscie_opcje10     000018BA
wykryto_enter_wyjscie_opcje11     000018CA
wykryto_enter_wyjscie_opcje11_2   000018E2
wykryto_enter_wyjscie_opcje12     000018F2
wykryto_enter_wyjscie_opcje16     000018F2
wykryto_enter_wyjscie_opcje17     00001902
wykryto_enter_wyjscie_opcje2      0000187A
wykryto_enter_wyjscie_opcje3      0000188A
wykryto_enter_wyjscie_opcje4      0000189A
wykryto_enter_wyjscie_opcje5      0000189A
wykryto_enter_wyjscie_opcje6      000018AA
wykryto_enter_wyjscie_opcje9      000018AA
wykryto_enter_zmiana_opcji        00001856
wykryto_odbior                    00000132
wykryto_odbior_CR                 00000162
wykryto_odbior_odczyt             00000132
wykryto_oerr                      0000017A
wykryto_rb                        00000116
wykryto_t0                        00000122
wykryto_t1                        0000008C
wykryto_t1_wyjscie                00000110
wykryto_t2                        0000012C
wykryto_t3                        000001A6
wykryto_t3_nie_puszczono          000001BE
wykryto_up                        000012AE
wykryto_up_3_wyswietl             00001464
wykryto_up_exit                   000015DE
wykryto_up_exit_trzymanie         000015EC
wykryto_up_sprawdz12              000015B0
wykryto_up_sprawdz16              000015B0
wykryto_up_sprawdz16_increase     000015C6
wykryto_up_sprawdz16_show         000015C8
wykryto_up_sprawdz_10             000014BA
wykryto_up_sprawdz_11             000014DA
wykryto_up_sprawdz_11_1           00001514
wykryto_up_sprawdz_11_2           0000154E
wykryto_up_sprawdz_11_3           00001580
wykryto_up_sprawdz_11_4           000015A8
wykryto_up_sprawdz_2              0000141C
wykryto_up_sprawdz_3              0000143C
wykryto_up_sprawdz_3_zwieksz_probki  00001456
wykryto_up_sprawdz_4              0000147A
wykryto_up_sprawdz_5              0000147A
wykryto_up_sprawdz_5_dalej        00001492
wykryto_up_sprawdz_6              0000149A
wykryto_up_sprawdz_9              0000149A
wykryto_up_sprawdz_czy_wyswietlam_kolejne_opcje  000012CC
wykryto_up_wyswietl_opcje_tablicy_dwa  00001338
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 150


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
wykryto_up_wyswietl_opcje_tablicy_end  00001388
wykryto_up_wyswietl_opcje_tablicy_pierwsza  00001310
wykryto_up_wyswietl_opcje_tablicy_trzy  00001360
wykryto_up_zmiana_opcji           000013EC
wykryto_up_zmiana_opcji_wyswietl_kanaly  00001400
wykryto_up_zmiana_polozenia_gwiazdki  000013B8
wylacz_moc                        00000007
wylacz_pomiary                    000006E6
wylacz_regulator                  000006FA
wylaczam_moc                      00000E30
wylaczenie_rejestarcji_pradu      0000096A
wynik                             0000009C
wynik01                           0000009D
wynik_to_po_prostu_L              00000BB2
wynikh                            0000009B
wyslij_na_ekran_to_co_odebralem   00000A5C
wyslij_pomiar                     00000004
wyslij_znak                       00000564
wyslij_znak_koniec                00000584
wyslij_znak_petla                 0000056C
wyswietl_1                        00000494
wyswietl_cyfry_temperatury        00000AB6
wyswietl_cyfry_temperatury2       00000ACA
wyswietl_litere_petla             00000A72
wyswietl_litere_petla2            00000A8C
wyswietl_litere_petla3            00000AAA
wyswietl_opcje_menu               000015F0
wyswietl_puste                    00000492
wyswietl_temp_w_opcjach           00001740
wysylanie_bajtu_rozkazu           0000084C
wysylanie_danych                  0000083A
wysylanie_danych_rozkaz           00000840
wysylanie_pomiaru                 00000BFE
zalacz_grzanie                    00000DAA
zalacz_moc                        00000005
zamien_na_hex                     000005F8
zapal_lampke                      00000500
zapis_do_pamieci_prad             00000D06
zapis_do_pamieci_temperatury      00000C16
zapis_eeprom                      00000316
zapisz_do_dzien_1_0               00001504
zapisz_do_dzien_1_99              000011C4
zapisz_do_godziny_1_9             000011F8
zapisz_do_minuty_1_0              00001570
zapisz_do_minuty_1_9              0000122C
zapisz_do_pamieci                 00000C10
zapisz_do_pamieci_czy_mam_send    00000C2E
zapisz_do_pamieci_juz_po_SERIAL   00000C66
zapisz_do_pamieci_nie_sprawdzaj_przekroczenia  00000C2E
zapisz_do_sekundy_1_0             0000159C
zapisz_do_sekundy_1_9             00001258
zla_dana_wez_0                    000005DE
zle_polecenie                     00000654
zle_polecenie_petla               00000656
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 151


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
zmiana_opcji                      00000007
zmierz_nastepny_czujnik_temperatury  00000ED6
zmierz_nastepny_kanal             00000EE2
zmierz_nastepny_nie_3             00000EFA
zmierz_prad                       00000ECC
zmniejsz_dzien_1                  000011CE
zmniejsz_godziny_1                00001202
zmniejsz_minuty_1                 00001236
zmniejsz_sekundy_1                00001262
znacznik_CTS                      00000004
znacznik_RTS                      00000005
znacznik_pomiaru_pradu            00000001
znaczniki                         0000009E
znaczniki_ds                      000000B3
znak_I                            000000CC
znak_cr                           0000000D
znak_lf                           0000000A
znow_kaz_mierzyc                  00000BF8
zwieksz_dzien_1                   0000150E
zwieksz_godziny_1                 00001548
zwieksz_minuty_1                  0000157A
zwieksz_sekundy_1                 000015A6
﻿                               00000000
ADRES                             ADRESH
CCP1X                             DC1B1
CCP1Y                             DC1B0
CCP2X                             DC2B1
CCP2Y                             DC2B0
DDRA                              TRISA
DDRB                              TRISB
DDRC                              TRISC
DDRD                              TRISD
DDRE                              TRISE
INTE                              INT0IE
INTF                              INT0IF
SCS                               SCS0


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

00000000 : XXXX----XXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000000c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000001c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000002c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 152


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00000380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000003c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000004c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000005c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000006c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000780 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000007c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000008c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000009c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000a00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000a40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000a80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000ac0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000b00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000b40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000b80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000bc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000c00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000c40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000c80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000cc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000d00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000d40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000d80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000dc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000e00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000e40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000e80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000ec0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000f00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000f40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000f80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000fc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000010c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
gpasm-0.13.7 beta               serial.asm  10-7-2011  14:04:28          PAGE 153


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00001100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000011c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000012c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000013c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000014c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000015c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000016c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001780 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000017c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000018c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000019c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001a00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXX-------- ----------------
00001b00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001bc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001cc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001d00 : XXXXXXXX-------- ---------------- ---------------- ----------------
00300000 : XXXXXXXX-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used: 3610


Errors   :       0
Warnings :       0 reported,       0 suppressed
Messages :       0 reported,       0 suppressed

